import{S as N,_ as se}from"./AppLayout-j0eOd4m7.js";import{Q as q,d as C,p as w,o as l,e as c,a as e,F as E,h as T,t as i,f as I,x as G,i as Q,j as U,l as K,v as Y,z as X,k as ne,b as R,u as oe,B as ie,y as te,g as W,n as Z,C as re,c as J,w as le}from"./app-CyioI9Lc.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as ce}from"./createLucideIcon-D191QXI-.js";/**
 * @license lucide-vue-next v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=ce("Trash2Icon",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),pe={class:"bg-white rounded-lg shadow-md overflow-hidden"},me={class:"overflow-x-auto"},fe={class:"min-w-full divide-y divide-gray-200"},xe={class:"bg-white divide-y divide-gray-200"},ve={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},ge={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},he={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ye={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},be={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},_e={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},we={key:0},$e={class:"bg-gray-50"},De={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},ke={__name:"PastesHorneados",setup(D){const{props:x}=q();C(x.pastesHorneados);const S=w(()=>{const p={};x.pastesHorneados.forEach(u=>{p[u.relleno]||(p[u.relleno]={totalPiezas:0,items:[]}),p[u.relleno].totalPiezas+=Number(u.piezas),p[u.relleno].items.push(u)});const b=[];return Object.keys(p).forEach(u=>{p[u].items.forEach((P,$)=>{b.push({...P,totalPiezas:p[u].totalPiezas,isFirst:$===0})})}),b}),y=w(()=>S.value.reduce((p,b)=>Number(p)+(b.isFirst?Number(b.totalPiezas):0),0)),k=p=>new Date(p).toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"America/Mexico_City"}),g=p=>new Date(p).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",timeZone:"America/Mexico_City"});return(p,b)=>(l(),c("div",null,[b[3]||(b[3]=e("h1",{class:"pb-4 pt-10 font-semibold text-xl"},"Pastes/Empanadas horneados de hoy",-1)),e("div",pe,[e("div",me,[e("table",fe,[b[2]||(b[2]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Responsable"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Paste/Empanada"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Hora"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Día"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Piezas Horneadas"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Total del día")])],-1)),e("tbody",xe,[(l(!0),c(E,null,T(S.value,(u,P)=>{var $,A,z;return l(),c("tr",{key:P},[e("td",ve,i(($=u==null?void 0:u.responsable)==null?void 0:$.name)+" "+i(((A=u==null?void 0:u.responsable)==null?void 0:A.apellido_p)||"")+" "+i(((z=u==null?void 0:u.responsable)==null?void 0:z.apellido_m)||""),1),e("td",ge,i(u.relleno),1),e("td",he,i(k(u.updated_at)),1),e("td",ye,i(g(u.updated_at)),1),e("td",be,i(u.piezas),1),e("td",_e,[u.isFirst?(l(),c("span",we,i(u.totalPiezas),1)):I("",!0)])])}),128))]),e("tfoot",$e,[e("tr",null,[b[0]||(b[0]=e("td",{colspan:"3",class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},"Total de piezas horneadas:",-1)),e("td",De,i(y.value),1),b[1]||(b[1]=e("td",null,null,-1))])])])])])]))}},He=de(ke,[["__scopeId","data-v-1a02fb88"]]),Ce={class:"pt-16"},Se={class:"max-w-7xl mx-auto space-y-6"},Me={class:"bg-white rounded-lg shadow p-6"},Ee={class:"text-2xl font-bold text-gray-900"},Te={class:"mt-4"},Pe=["value"],Fe={key:0,class:"bg-white rounded-lg shadow overflow-x-auto"},ze={class:"min-w-full divide-y divide-gray-200"},Le={class:"bg-gray-50"},Ne={class:"bg-white divide-y divide-gray-200"},Ae={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ve=["onUpdate:modelValue"],Be={key:1,class:"w-full flex justify-end"},Ie={__name:"EstimacionPastes",setup(D){const{props:x}=q(),S=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"],y=new Date().getDay(),k=S[y],g=C(k||"Lunes"),p=C(!1),b=[{value:"Lunes",label:"Lunes"},{value:"Martes",label:"Martes"},{value:"Miercoles",label:"Miércoles"},{value:"Jueves",label:"Jueves"},{value:"Viernes",label:"Viernes"},{value:"Sábado",label:"Sábado"},{value:"Domingo",label:"Domingo"}],u=["7:00 am","8:00 am","9:00 am","10:00 am","11:00 am","12:00 pm","1:00 pm","2:00 pm","3:00 pm","4:00 pm","5:00 pm","6:00 pm","7:00 pm","8:00 pm","9:00 pm"],P=w(()=>x.inventario.filter(f=>["pastes","empanadas dulces","empanadas saladas"].includes(f.tipo)).map(f=>f.nombre)),$=C({}),A=N.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:f=>{f.onmouseenter=N.stopTimer,f.onmouseleave=N.resumeTimer}}),z=()=>{const f={};return u.forEach(H=>{f[H]={},P.value.forEach(_=>{f[H][_]=0})}),f},V=()=>{p.value=!1,$.value=z(),x.estimaciones.filter(H=>H.dia===g.value).forEach(({hora:H,cantidad:_,inventario_id:L})=>{var s;const m=(s=x.inventario.find(a=>a.id===L))==null?void 0:s.nombre;m&&$.value[H]&&($.value[H][m]=_)}),p.value=!0},B=()=>{X.post("/estimaciones",{estimaciones:$.value,dia:g.value},{preserveState:!1,preserveScroll:!0,onSuccess:()=>A.fire({icon:"success",title:"Sobrantes guardados exitosamente"}),onError:()=>A.fire({icon:"error",title:"Error al guardar los sobrantes"})})};return G(()=>{V()}),Q(g,()=>{V()}),(f,H)=>(l(),c("div",Ce,[e("div",Se,[e("header",Me,[e("h1",Ee,"Sistema de Control de Producción - Día: "+i(g.value),1),e("div",Te,[U(e("select",{"onUpdate:modelValue":H[0]||(H[0]=_=>g.value=_),class:"rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500"},[(l(),c(E,null,T(b,_=>e("option",{key:_.value,value:_.value},i(_.label),9,Pe)),64))],512),[[K,g.value]])])]),p.value?(l(),c("div",Fe,[e("table",ze,[e("thead",Le,[e("tr",null,[H[1]||(H[1]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo",-1)),(l(!0),c(E,null,T(P.value,_=>(l(),c("th",{key:_,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},i(_),1))),128))])]),e("tbody",Ne,[(l(),c(E,null,T(u,_=>e("tr",{key:_},[e("td",Ae,i(_),1),(l(!0),c(E,null,T(P.value,L=>(l(),c("td",{key:L,class:"px-6 py-4 whitespace-nowrap"},[U(e("input",{type:"number","onUpdate:modelValue":m=>$.value[_][L]=m,class:"w-20 rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500",min:"0"},null,8,Ve),[[Y,$.value[_][L]]])]))),128))])),64))])])])):I("",!0),f.$page.props.auth.user.roles[0].name=="admin"?(l(),c("div",Be,[e("button",{onClick:B,class:"px-3 py-2 bg-orange-500 rounded-lg text-white hover:bg-orange-400"}," Guardar ")])):I("",!0)])]))}},je={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Re={class:"bg-white shadow rounded-lg p-6"},Ue={class:"mb-6"},Oe={class:"list-disc pl-5"},Ze={class:"capitalize"},qe={class:"font-semibold"},Xe={class:"list-disc pl-5"},We={class:"font-semibold"},Ge={class:"bg-white shadow rounded-lg p-6"},Je=["value"],Qe=["max"],Ke=["disabled"],Ye={class:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-4"},et={class:"flex justify-between"},tt={class:"text-xl font-semibold mb-4"},at=["onClick"],ot={key:0},st={class:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 mb-4"},nt={key:1},it=["disabled"],rt={class:"mt-8 bg-white shadow rounded-lg p-6"},lt={key:0,class:"text-gray-500 text-center py-4"},dt={key:1,class:"divide-y divide-gray-200"},ct=["onClick"],ut={__name:"SistemaHorneado",setup(D){const{props:x}=q(),S=x.inventario,y=C(x.hornos||[]),k=C(y.value.map(o=>({...o,horneando:o.estado||!1,pastesHorneando:o.pastesHorneando||[],tiempoInicio:o.tiempo_inicio?new Date(o.tiempo_inicio).getTime():0,tiempoFin:o.tiempo_fin?new Date(o.tiempo_fin).getTime():0,tiempoTranscurrido:0,timer:null,labeltime:"00:00"}))),g=C(9e5),p=C([]),b=()=>{if(p.value.length===0)return;const o=k.value.find(t=>!t.horneando);if(o){o.horneando=!0,o.pastesHorneando=[...p.value],p.value=[],o.tiempoInicio=Date.now(),o.tiempoFin=o.tiempoInicio+g.value;try{te.post("/iniciar-horneado",{horno_id:o.id,tiempo_inicio:o.tiempoInicio,tiempo_fin:o.tiempoFin,pastes_horneando:o.pastesHorneando,estado:!0}).then(t=>{console.log(t)}).catch(t=>{console.error("Error al iniciar el horneado:",t)}),N.fire({icon:"success",title:"Horneando",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500}),F(o.id)}catch(t){console.error("Error al iniciar el horneado:",t),N.fire({icon:"error",title:"Error al iniciar",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}}else O()},u=N.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:o=>{o.addEventListener("mouseenter",N.stopTimer),o.addEventListener("mouseleave",N.resumeTimer)}}),P=async o=>{const t=k.value.find(n=>n.id===o);if(!(!t||!t.horneando))try{clearInterval(t.timer);const n=[...t.pastesHorneando];t.horneando=!1,t.pastesHorneando=[],t.tiempoTranscurrido=0,t.labeltime="00:00",$();for(const d of n){const h=S.find(j=>j.nombre.toLowerCase()===d.nombre.toLowerCase()&&(j.tipo==="pastes"||j.tipo==="empanadas saladas"||j.tipo==="empanadas dulces"));if(h)try{await te.post("/api/control-produccion/horneado",{horno_id:o,paste_id:h.id,cantidad:d.cantidad})}catch(j){console.error(`Horno ${o} - Error al registrar producción para ${d.nombre}:`,j)}else console.error(`Horno ${o} - No se encontró el paste ${d.nombre} en el inventario`)}X.post("/hornear",{horno_id:o,pastes:n},{preserveScroll:!0,preserveState:!1,replace:!0,onSuccess:()=>{u.fire({icon:"success",title:"Horneado finalizado"})},onError:d=>{console.error(`Horno ${o} - Error al registrar el horneado:`,d),u.fire({icon:"error",title:"Error al registrar el horneado"})}})}catch(n){console.error(`Horno ${o} - Error en finalizarHorneado:`,n)}},$=()=>{new Audio("/sound/videoplayback.mp3").play().catch(t=>console.error("Error al reproducir el sonido:",t))},A=w(()=>S.filter(o=>o.tipo==="masa")),z=w(()=>S.filter(o=>o.tipo==="relleno")),V=w(()=>A.value.map(o=>{const t=k.value.filter(n=>n.horneando&&n.pastesHorneando.some(d=>d.masa===o.nombre)).reduce((n,d)=>n+d.pastesHorneando.find(h=>h.masa===o.nombre).cantidad,0);return{...o,cantidad:o.cantidad-t}})),B=w(()=>z.value.map(o=>{const t=k.value.filter(n=>n.horneando&&n.pastesHorneando.some(d=>d.nombre===o.nombre)).reduce((n,d)=>n+d.pastesHorneando.find(h=>h.nombre===o.nombre).cantidad,0);return{...o,cantidad:o.cantidad-t}})),f=C({masa:"",relleno:"",cantidad:1,sucursal_id:x.auth.user.sucursal_id}),H=o=>{const t={pastes:"bola","empanadas saladas":"salada","empanadas dulces":"dulce"},n=x.inventario.find(d=>(d.nombre.toLowerCase()===o.value.relleno.toLowerCase()||d.nombre.toLowerCase().startsWith(o.value.relleno.toLowerCase()))&&t[d.tipo.toLowerCase()]);return n?t[n.tipo.toLowerCase()]:"bola"},_=()=>{const o=H(f).toLowerCase(),t=V.value.find(d=>d.nombre.toLowerCase()===o),n=B.value.find(d=>d.nombre.toLowerCase()===f.value.relleno.toLowerCase());if(!t||t.cantidad<=0){u.fire({icon:"error",title:"No hay suficiente masa disponible"});return}if(t&&n&&f.value.cantidad<=L.value){t.cantidad-=f.value.cantidad,n.cantidad-=f.value.cantidad;const d=p.value.find(h=>h.nombre===n.nombre);d?d.cantidad+=f.value.cantidad:a({id:Date.now(),masa:t.nombre,nombre:n.nombre,cantidad:f.value.cantidad,sucursal_id:x.auth.user.sucursal_id}),f.value={masa:"",relleno:"",cantidad:1,sucursal_id:x.auth.user.sucursal_id}}},L=w(()=>{const o=B.value.find(t=>t.nombre===f.value.relleno);return o?o.cantidad:1}),m=w(()=>f.value.relleno&&f.value.cantidad>0&&f.value.cantidad<=L.value);C("00:00");const s=o=>{if(o<=0)return"00:00";const t=Math.floor(o/1e3),n=Math.floor(t/60),d=t%60;return`${String(n).padStart(2,"0")}:${String(d).padStart(2,"0")}`},a=o=>{const t=S.find(n=>n.nombre.toLowerCase()===o.nombre.toLowerCase()&&(n.tipo==="pastes"||n.tipo==="empanadas saladas"||n.tipo==="empanadas dulces"));t?p.value.push({...o,paste_id:t.id}):console.error(`No se encontró el paste ${o.nombre} en el inventario`)},r=o=>{p.value=p.value.filter(t=>t.id!==o)},v=o=>{P(o).catch(t=>{console.error(`Error al finalizar horneado desde timer: ${t}`)})},F=o=>{const t=k.value.find(h=>h.id===o);if(!t)return;const d=t.tiempoFin-Date.now();if(d<=0){v(o);return}t.tiempoTranscurrido=g.value-d,t.labeltime=s(d),t.timer&&clearInterval(t.timer),t.timer=setInterval(()=>{const h=t.tiempoFin-Date.now();if(h<=0){clearInterval(t.timer),v(o);return}t.tiempoTranscurrido=g.value-h,t.labeltime=s(h)},1e3)},M=o=>{const t=k.value.find(h=>h.id===o);if(!t)return;const d=t.tiempoFin-Date.now();if(d<=0){v(o);return}t.tiempoTranscurrido=g.value-d,t.labeltime=s(d),t.timer&&clearInterval(t.timer),t.timer=setInterval(()=>{const h=t.tiempoFin-Date.now();if(h<=0){clearInterval(t.timer),v(o);return}t.tiempoTranscurrido=g.value-h,t.labeltime=s(h)},1e3)};G(()=>{k.value.forEach(o=>{o.timer&&clearInterval(o.timer)}),k.value.forEach(o=>{if(o.estado){const t=Date.now()-new Date(o.tiempo_inicio).getTime(),n=g.value-t;if(n<=0){v(o.id);return}o.tiempoFin=Date.now()+n,M(o.id)}})});const O=()=>{X.post("/crear-horno",{estado:!1,pastesHorneando:[]},{preserverScroll:!0,preserveState:!1,onSuccess:o=>{var t;y.value=(t=o==null?void 0:o.props)==null?void 0:t.hornos,p.value=[],k.value=y.value.map(n=>({...n,horneando:n.estado||!1,pastesHorneando:n.pastesHorneando||[],tiempoInicio:n.tiempo_inicio?new Date(n.tiempo_inicio).getTime():0,tiempoFin:n.tiempo_fin?new Date(n.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),N.fire({icon:"success",title:"Horno creado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:o=>{console.error("Error al crear el horno:",o),N.fire({icon:"error",title:"Error al crear horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})},ee=o=>{X.post("/eliminar-horno",{horno_id:o},{preserveScroll:!0,preserveState:!1,onSuccess:t=>{var n;y.value=(n=t==null?void 0:t.props)==null?void 0:n.hornos,k.value=y.value.map(d=>({...d,horneando:d.estado||!1,pastesHorneando:d.pastesHorneando||[],tiempoInicio:d.tiempo_inicio?new Date(d.tiempo_inicio).getTime():0,tiempoFin:d.tiempo_fin?new Date(d.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),N.fire({icon:"success",title:"Horno eliminado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:t=>{console.error("Error al eliminar el horno:",t),N.fire({icon:"error",title:"Error al eliminar horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})};return(o,t)=>(l(),c(E,null,[e("div",je,[e("div",Re,[t[4]||(t[4]=e("h2",{class:"text-xl font-semibold mb-4"},"Ingredientes Disponibles",-1)),e("div",Ue,[t[2]||(t[2]=e("h3",{class:"text-lg font-medium mb-2"},"Masas",-1)),e("ul",Oe,[(l(!0),c(E,null,T(V.value,n=>(l(),c("li",{key:n.id,class:"flex justify-between"},[e("span",Ze,i(n.nombre),1),e("span",qe,i(n.cantidad)+" unidades",1)]))),128))])]),e("div",null,[t[3]||(t[3]=e("h3",{class:"text-lg font-medium mb-2"},"Rellenos",-1)),e("ul",Xe,[(l(!0),c(E,null,T(B.value,n=>(l(),c("li",{key:n.id,class:"flex justify-between"},[e("span",null,i(n.nombre),1),e("span",We,i(n.cantidad)+" unidades",1)]))),128))])])]),e("div",Ge,[t[8]||(t[8]=e("h2",{class:"text-xl font-semibold mb-4"},"Crear Nuevo Paste/Empanada",-1)),e("form",{onSubmit:ne(_,["prevent"]),class:"space-y-4"},[e("div",null,[t[6]||(t[6]=e("label",{for:"relleno",class:"block text-sm font-medium text-gray-700"},"Seleccionar Relleno",-1)),U(e("select",{"onUpdate:modelValue":t[0]||(t[0]=n=>f.value.relleno=n),id:"relleno",required:"",class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md"},[t[5]||(t[5]=e("option",{value:""},"Seleccione un relleno",-1)),(l(!0),c(E,null,T(z.value,n=>(l(),c("option",{key:n.id,value:n.nombre},i(n.nombre),9,Je))),128))],512),[[K,f.value.relleno]])]),e("div",null,[t[7]||(t[7]=e("label",{for:"cantidad",class:"block text-sm font-medium text-gray-700"},"Cantidad",-1)),U(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>f.value.cantidad=n),type:"number",id:"cantidad",required:"",min:"1",max:L.value,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 sm:text-sm"},null,8,Qe),[[Y,f.value.cantidad,void 0,{number:!0}]])]),e("button",{type:"submit",disabled:!m.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Asignar Unidades ",8,Ke)],32)])]),e("div",Ye,[(l(!0),c(E,null,T(k.value,(n,d)=>(l(),c("div",{key:n.id,class:"bg-white shadow rounded-lg p-6"},[e("div",et,[e("h2",tt,"Horno "+i(d+1),1),!n.horneando&&y.value.length>1?(l(),c("button",{key:0,onClick:h=>ee(n.id),class:"flex items-center gap-2 bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"},[R(oe(ue),{class:"w-4 h-4"})],8,at)):I("",!0)]),n.horneando?(l(),c("div",ot,[t[9]||(t[9]=e("p",{class:"text-lg mb-2"},"Horneando grupo de pastes:",-1)),e("ul",null,[(l(!0),c(E,null,T(n.pastesHorneando,h=>(l(),c("li",{key:h.nombre},i(h.cantidad)+" "+i(h.nombre)+" - masa "+i(h.masa),1))),128))]),e("div",st,[e("div",{class:"bg-orange-600 h-2.5 rounded-full transition-all duration-100",style:ie({width:`${n.tiempoTranscurrido/g.value*100}%`})},null,4)]),e("p",null,"Tiempo restante: "+i(n.labeltime),1)])):(l(),c("div",nt,[t[10]||(t[10]=e("p",{class:"text-lg mb-4"},"El horno está disponible",-1)),e("button",{onClick:b,disabled:!p.value.length,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Iniciar Horneado de Grupo ",8,it)]))]))),128)),e("div",{class:"mt-4 h-full flex justify-center items-center"},[e("button",{onClick:O,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500"}," Crear Nuevo Horno ")])]),e("div",rt,[t[11]||(t[11]=e("h2",{class:"text-xl font-semibold mb-4"},"Grupos de Pastes por Hornear",-1)),p.value.length===0?(l(),c("div",lt," No hay grupos de pastes en la cola de horneado ")):(l(),c("ul",dt,[(l(!0),c(E,null,T(p.value,n=>(l(),c("li",{key:n.id,class:"py-4 flex justify-between items-center"},[e("span",null,i(n.cantidad)+" "+i(n.nombre)+" - masa "+i(n.masa),1),e("button",{onClick:d=>r(n.id),class:"bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"}," Cancelar ",8,ct)]))),128))]))])],64))}},pt={key:0,class:"mt-8 bg-white shadow rounded-lg p-6"},mt={class:"flex justify-between items-center mb-4"},ft={class:"flex items-center space-x-4"},xt={class:"flex items-center space-x-2"},vt={class:"flex items-center space-x-2"},gt=["value"],ht={class:"mb-6"},yt={class:"overflow-x-auto"},bt={class:"min-w-full divide-y divide-gray-200"},_t={class:"bg-white divide-y divide-gray-200"},wt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 capitalize"},$t={class:"text-xs text-gray-500 block capitalize"},Dt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},kt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ht={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ct={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize"},St={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Mt={class:"px-6 py-4 whitespace-nowrap"},Et={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Tt={class:"mb-6"},Pt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ft={class:"font-medium"},zt={class:"mt-8"},Lt={class:"overflow-x-auto"},Nt={class:"min-w-full divide-y divide-gray-200"},At={class:"bg-white divide-y divide-gray-200"},Vt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Bt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},It={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},jt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Rt={class:"px-6 py-4 whitespace-nowrap capitalize"},Ut={__name:"ControlProduccion",setup(D){const{props:x}=q();C([]);const S=C([]),y=C([]);C([]);const k=w(()=>x.auth.user.roles[0].name==="admin");console.log(k.value);const g=C(new Date().toISOString().split("T")[0]),p=C("actual"),b=C([{value:"todas",label:"Todas las horas"},{value:"actual",label:"Hora Actual"},{value:"9-am",label:"9:00 AM"},{value:"10-am",label:"10:00 AM"},{value:"11-am",label:"11:00 AM"},{value:"12-pm",label:"12:00 PM"},{value:"1-pm",label:"1:00 PM"},{value:"2-pm",label:"2:00 PM"},{value:"3-pm",label:"3:00 PM"},{value:"4-pm",label:"4:00 PM"},{value:"5-pm",label:"5:00 PM"},{value:"6-pm",label:"6:00 PM"},{value:"7-pm",label:"7:00 PM"},{value:"8-pm",label:"8:00 PM"},{value:"9-pm",label:"9:00 PM"}]),u=m=>{const s=new Date(m),a=s.getHours();s.getMinutes();const r=a>=12?"pm":"am";return`${a%12||12}-${r}`},P=()=>{const m=new Date(g.value+"T00:00:00-06:00"),s=new Date(g.value+"T23:59:59-06:00");return{inicio:m,fin:s}},$=m=>{const s=P();if(!s)return!0;const a=new Date(m),r=new Date(a.toLocaleString("en-US",{timeZone:"America/Mexico_City"})),v=new Date(s.inicio.toLocaleString("en-US",{timeZone:"America/Mexico_City"})),F=new Date(s.fin.toLocaleString("en-US",{timeZone:"America/Mexico_City"}));return r>=v&&r<=F},A=()=>{const m=new Date,s=new Date(m.toLocaleString("en-US",{timeZone:"America/Mexico_City"}));g.value=s.toISOString().split("T")[0]},z=m=>{if(m.estado==="pendiente")return"pendiente";const a=u(new Date);return u(m.created_at)!==a?"desperdicio":m.estado},V=w(()=>{var a;if(!((a=x.notificaciones)!=null&&a.faltantes))return[];let s=x.notificaciones.faltantes.map(r=>({id:r.id,paste:r.paste,cantidad:r.cantidad,hora_notificacion:r.hora_notificacion,dia_notificacion:r.dia_notificacion,estado:z(r),tiempo_inicio_horneado:r.tiempo_inicio_horneado,hora_ultima_venta:r.hora_ultima_venta,cantidad_vendida:r.cantidad_vendida,diferencia_notificacion_inicio:r.diferencia_notificacion_inicio,created_at:r.created_at,cantidad_horneada:r.cantidad_horneada})).filter(r=>$(r.created_at));if(p.value==="todas")return s;if(p.value==="actual"){const v=u(new Date);return s.filter(F=>u(F.created_at)===v)}return s.filter(r=>u(r.created_at)===p.value)}),B=w(()=>{var m;return(m=x.notificaciones)!=null&&m.faltantes?x.notificaciones.faltantes.map(s=>({id:s.id,paste:s.paste,cantidad:s.cantidad,hora_notificacion:s.hora_notificacion,dia_notificacion:s.dia_notificacion,estado:s.estado,tiempo_inicio_horneado:s.tiempo_inicio_horneado,hora_ultima_venta:s.hora_ultima_venta,cantidad_vendida:s.cantidad_vendida,diferencia_notificacion_inicio:s.diferencia_notificacion_inicio,created_at:s.created_at})):[]});w(()=>{var m;return(m=x.notificaciones)!=null&&m.horneados?x.notificaciones.horneados:[]});const f=w(()=>B.value.map(s=>({paste:s.paste.nombre,recomendacion:"Producir",razon:`Faltan ${s.cantidad} unidades para las ${s.hora_notificacion}`})));Q(()=>{var m;return(m=x.notificaciones)==null?void 0:m.faltantes},m=>{m&&(y.value=f.value)},{immediate:!0});const H=m=>m?new Date(m).toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:"America/Mexico_City"}):"-",_=m=>`px-2 py-1 rounded-full text-xs font-medium ${{horneando:"bg-yellow-100 text-yellow-800 capitalize",retirado:"bg-blue-100 text-blue-800 capitalize",vendido:"bg-green-100 text-green-800 capitalize",desperdicio:"bg-red-100 text-red-800 capitalize",pendiente:"bg-gray-100 text-gray-800 capitalize",en_espera:"bg-green-100 text-green-800"}[m]}`,L=w(()=>{var a;if(!((a=x.notificaciones)!=null&&a.horneados))return[];let s=x.notificaciones.horneados.filter(r=>$(r.created_at));if(p.value==="todas")return s;if(p.value==="actual"){const v=u(new Date);return s.filter(F=>u(F.created_at)===v)}return s.filter(r=>u(r.created_at)===p.value)});return G(()=>{A()}),(m,s)=>k.value?(l(),c("div",pt,[e("div",mt,[s[4]||(s[4]=e("h2",{class:"text-xl font-semibold"},"Control de Producción",-1)),e("div",ft,[e("div",xt,[s[2]||(s[2]=e("label",{for:"fecha",class:"text-sm font-medium text-gray-700"},"Seleccionar día:",-1)),U(e("input",{type:"date",id:"fecha","onUpdate:modelValue":s[0]||(s[0]=a=>g.value=a),class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},null,512),[[Y,g.value]])]),e("div",vt,[s[3]||(s[3]=e("label",{for:"hora",class:"text-sm font-medium text-gray-700"},"Filtrar por hora:",-1)),U(e("select",{id:"hora","onUpdate:modelValue":s[1]||(s[1]=a=>p.value=a),class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[(l(!0),c(E,null,T(b.value,a=>(l(),c("option",{key:a.value,value:a.value},i(a.label),9,gt))),128))],512),[[K,p.value]])])])]),e("div",ht,[s[6]||(s[6]=e("h3",{class:"text-lg font-medium mb-2"},"Productos Faltantes",-1)),e("div",yt,[e("table",bt,[s[5]||(s[5]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Producto"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Faltante"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Horneada"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Vendida"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Día"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora Requerida"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Última Venta")])],-1)),e("tbody",_t,[(l(!0),c(E,null,T(V.value,a=>(l(),c("tr",{key:a.id,class:"hover:bg-gray-50"},[e("td",wt,[W(i(a.paste.nombre)+" ",1),e("span",$t,i(a.paste.tipo),1)]),e("td",Dt,i(a.cantidad)+" unidades ",1),e("td",kt,i(a.cantidad_horneada?`${a.cantidad_horneada} unidades`:"-"),1),e("td",Ht,i(a.cantidad_vendida?`${a.cantidad_vendida} unidades`:"-"),1),e("td",Ct,i(a.dia_notificacion),1),e("td",St,i(H(a.created_at)),1),e("td",Mt,[e("span",{class:Z(["px-2 py-1 text-xs font-medium rounded-full",a.estado==="pendiente"?"bg-red-100 text-red-800":a.estado==="horneando"?"bg-yellow-100 text-yellow-800":a.estado==="desperdicio"?"bg-red-100 text-red-800":"bg-green-100 text-green-800"])},i(a.estado==="pendiente"?"Sin hornear":a.estado==="desperdicio"?"Desperdicio":a.estado),3)]),e("td",Et,i(a.estado==="pendiente"?"-":a.hora_ultima_venta?H(a.hora_ultima_venta):"Sin ventas"),1)]))),128))])])])]),e("div",Tt,[s[7]||(s[7]=e("h3",{class:"text-lg font-medium mb-2"},"Tiempo de Reposición",-1)),e("div",Pt,[(l(!0),c(E,null,T(S.value,(a,r)=>(l(),c("div",{key:r,class:"bg-gray-50 p-4 rounded-lg"},[e("p",Ft,i(a.paste),1),e("p",null,"Tiempo promedio: "+i(a.promedio)+" minutos",1),e("p",null,"Última reposición: "+i(a.ultima),1)]))),128))])]),e("div",zt,[s[9]||(s[9]=e("h3",{class:"text-lg font-medium mb-2"},"Control de Tiempo de Producción",-1)),e("div",Lt,[e("table",Nt,[s[8]||(s[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Paste"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de notificación"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de Producción"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo en meter producción"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado")])],-1)),e("tbody",At,[(l(!0),c(E,null,T(L.value,a=>(l(),c("tr",{key:a.id},[e("td",Vt,i(a.paste.nombre),1),e("td",Bt,i(H(a.created_at)),1),e("td",It,i(H(a.tiempo_inicio_horneado)),1),e("td",jt,i(Math.round((new Date(a.diferencia_notificacion_inicio)-new Date(a.created_at))/6e4))+" min",1),e("td",Rt,[e("span",{class:Z(_(a.estado))},i(a.estado),3)])]))),128))])])])])])):I("",!0)}},Ot={class:"animate-pulse"},Zt={key:0,class:"mt-2"},qt={class:"font-bold"},ae={__name:"NotificationPanel",props:{notifications:{type:Array,required:!0},isVisible:{type:Boolean,default:!1},type:{type:String,required:!0,validator:D=>["warning","info"].includes(D)},title:{type:String,required:!0}},emits:["toggle"],setup(D){return(x,S)=>(l(),c("div",{class:Z(["p-4 border rounded shadow mb-4 size-fit cursor-pointer",{"bg-yellow-100":D.type==="warning","bg-blue-100":D.type==="info"}]),onClick:S[0]||(S[0]=y=>x.$emit("toggle"))},[e("h2",{class:Z(["text-lg font-bold text-center",{"text-yellow-800":D.type==="warning","text-blue-800":D.type==="info"}])},[W(i(D.type==="warning"?"⚠️":"ℹ️")+" "+i(D.title)+" ",1),e("span",Ot,"("+i(D.notifications.length)+")",1),W(" "+i(D.type==="warning"?"⚠️":"ℹ️"),1)],2),D.isVisible?(l(),c("ul",Zt,[(l(!0),c(E,null,T(D.notifications,y=>(l(),c("li",{key:y.id,class:"mb-2"},[e("span",null,[e("span",qt,i(y.nombre),1),W(": "+i(D.type==="warning"?"Faltan":"Hay")+" "+i(D.type==="warning"?Math.abs(y.diferencia):y.diferencia)+" unidades para las "+i(y.hora)+" ",1),e("span",{class:Z(["text-sm",{"text-red-600":D.type==="warning","text-green-600":D.type==="info"}])}," ("+i(y.porcentaje)+"% del estimado) ",3)])]))),128))])):I("",!0)],2))}},Xt={class:"container mx-auto p-4"},Wt={class:"sm:flex justify-between flex-row text-sm"},Gt={class:"flex gap-3 sm:flex-row flex-col"},Jt={class:"mt-6"},Qt={__name:"Hornear",setup(D){const x=C(!1),S=C(!1),y=C(null),k=C(null),{props:g}=q(),p=w(()=>g.auth.user.roles[0].name==="admin"),b=w(()=>g.inventario||[]),u=w(()=>g.estimacionesHoy||[]),P=()=>{const s=new Date;return{day:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"][s.getDay()].toLowerCase(),hour:s.getHours(),minutes:s.getMinutes()}},$=C(P());Q(()=>$.value.hour,s=>{s!==y.value&&(y.value=s,H.value.length>0&&(x.value=!0),_.value.length>0&&(S.value=!0))}),G(()=>{y.value=$.value.hour,k.value=setInterval(()=>{$.value=P()},1e3)}),re(()=>{k.value&&clearInterval(k.value)});const A=s=>{const[a,r]=s.toLowerCase().split(" ");let[v,F]=a.split(":").map(Number);return{hours:r==="pm"&&v!==12?v+12:r==="am"&&v===12?0:v,minutes:F}},z=w(()=>b.value.filter(s=>{var a;return["pastes","empanadas dulces","empanadas saladas"].includes((a=s.tipo)==null?void 0:a.toLowerCase())})),V=w(()=>{if(!u.value.length||!z.value.length)return console.log("No hay estimaciones o productos relevantes"),[];const s=new Map(z.value.map(r=>[r.id,r]));return u.value.map(r=>{const v=s.get(r.inventario_id);if(!v)return null;const{hours:F}=A(r.hora);return{id:`${v.id}-${r.hora}`,nombre:v.nombre,estimado:r.cantidad,existente:v.cantidad,diferencia:v.cantidad-r.cantidad,hora:r.hora,dia:r.dia.toLowerCase(),horaEnNumero:F,tipo:v.tipo}}).filter(Boolean).filter((r,v,F)=>v===F.findIndex(M=>M.id===r.id))}),B=w(()=>V.value.filter(a=>a.dia===$.value.day)),f=w(()=>{const a=($.value.hour+1)%24,r=B.value.filter(M=>M.horaEnNumero===a),v=new Map(r.map(M=>[M.nombre,M]));return z.value.map(M=>{const O=v.get(M.nombre);return O||{id:`${M.id}-${a}:00`,nombre:M.nombre,estimado:0,existente:M.cantidad,diferencia:M.cantidad,hora:`${a}:00`,dia:$.value.day,horaEnNumero:a,tipo:M.tipo}})}),H=w(()=>f.value.filter(a=>a.estimado>0&&a.diferencia<0).map(a=>({...a,porcentaje:a.estimado>0?Math.round(a.existente/a.estimado*100):0}))),_=w(()=>f.value.filter(a=>a.estimado>0&&a.diferencia>0||a.estimado===0&&a.existente>0).map(a=>({...a,porcentaje:a.estimado>0?Math.round(a.existente/a.estimado*100):100}))),L=()=>x.value=!x.value,m=()=>S.value=!S.value;return(s,a)=>(l(),c("div",Xt,[e("div",Wt,[a[0]||(a[0]=e("h1",{class:"text-2xl font-bold mb-4"},"Sistema de Horneado",-1)),e("div",Gt,[R(ae,{notifications:H.value,"is-visible":x.value,type:"warning",title:"Faltantes",onToggle:L},null,8,["notifications","is-visible"]),R(ae,{notifications:_.value,"is-visible":S.value,type:"info",title:"Excedentes",onToggle:m},null,8,["notifications","is-visible"])])]),e("div",Jt,[R(ut),R(Ut),oe(g).user.roles[0]!=="supervisor"?(l(),J(He,{key:0})):I("",!0),p.value?(l(),J(Ie,{key:1})):I("",!0)])]))}},Kt={class:"py-6"},Yt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 rounded-xl overflow-hidden"},ea={class:"flex justify-between p-6 lg:p-8 bg-white border-b border-gray-200 rounded-2xl"},na={__name:"index",setup(D){return(x,S)=>(l(),J(se,{title:"Tablero principal"},{default:le(()=>[e("div",Kt,[e("div",Yt,[e("div",ea,[R(Qt)])])])]),_:1}))}};export{na as default};
