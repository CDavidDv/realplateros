import{Q as pt,d as c,p as xe,x as vt,o as i,e as u,a as t,j as f,l as E,v as C,f as _,F as N,h as j,t as d,u as P,n as A,g as He,q as gt,b as ue,c as Oe,z as ye,w as mt}from"./app-BQOY_4-T.js";import{S as be,_ as ft}from"./AppLayout-8Y73kmGt.js";import{_ as xt,a as yt,b as bt,c as _t,r as ht}from"./Sobrantes-CyIaSffd.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const wt={class:"print min-h-screen flex rounded-2xl border-0 flex-col justify-center"},kt={class:"relative w-full px-4 sm:px-0 pb-8"},Ct={class:"relative px-4 bg-white shadow-lg rounded-3xl sm:p-20 sm:pt-8"},St={class:"flex flex-col md:flex-row items-center gap-4 mb-8"},Vt={class:"w-full gap-2 flex flex-col items-center"},Ft={class:"flex gap-2"},Dt={class:"flex gap-2"},Et=["value"],Nt={key:0,class:"text-red-500 font-bold mt-2"},Pt={key:1,class:"mb-6 no-print"},$t={class:"flex space-x-2"},jt=["disabled"],At={class:"flex space-x-2"},It=["disabled"],Ut=["disabled"],Mt={class:"bg-gray-50 p-4 rounded-lg mb-6"},Tt={class:"grid grid-cols-2 gap-4"},zt={key:0,class:"col-span-2 mb-4"},Ht={class:"grid grid-cols-3 gap-4"},Ot={class:"font-medium"},Lt={class:"text-sm text-gray-600"},Bt={class:"text-sm text-gray-600"},Gt={class:"text-sm text-gray-600"},Jt={class:"text-sm text-gray-600"},Rt={key:1},qt={class:"font-medium"},Yt={key:2},Qt={class:"font-medium"},Wt={class:"font-medium"},Xt={class:"font-medium"},Zt={class:"font-medium"},Kt={class:"font-medium"},ea={class:"font-medium"},ta={class:"mb-6"},aa={class:"flex justify-between"},oa={class:"flex gap-2"},sa=["disabled","title"],ra={class:"mb-4 no-print"},la={class:"bg-gray-50 p-4 rounded-lg"},na={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},ia={class:"flex gap-2"},ua={key:0,class:"text-center py-8"},da={class:"text-gray-500"},ca={class:"text-gray-500"},pa={key:0,class:"mt-4"},va={key:1,class:"mt-4"},ga={key:2,class:"mt-4"},ma={key:3,class:"mt-4"},fa={key:1},xa={class:"bg-gray-100 p-4 rounded-lg mb-4"},ya={class:"text-lg font-semibold"},ba={class:"text-sm text-gray-600"},_a={class:"grid grid-cols-3 gap-4 mt-2"},ha={class:"font-medium"},wa={class:"font-medium"},ka={class:"font-medium"},Ca={class:"overflow-x-auto h-screen overflow-auto ventasR"},Sa={class:"tabla min-w-full divide-y overflow-auto divide-gray-200"},Va={class:"bg-gray-50"},Fa={class:"bg-white divide-y divide-gray-200"},Da={key:0},Ea={key:0},Na={key:1,class:"flex flex-col items-center"},Pa=["onUpdate:modelValue","onChange"],$a={class:"flex flex-col items-center"},ja={key:0},Aa={key:1},Ia={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 text-center"},Ua={key:0},Ma={key:1},Ta={class:"px-6 py-4 whitespace-nowrap overflow-auto text-sm text-gray-500"},za={key:0,class:"text-xs text-gray-500 italic"},Ha={key:1,class:"print"},Oa={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center"},La={key:0},Ba={key:1},Ga={class:"px-6 py-4 text-sm text-gray-500"},Ja={key:0,class:"flex flex-col space-y-1"},Ra={key:1,class:"flex flex-col space-y-1"},qa={class:"px-6 py-4 text-sm text-gray-500 capitalize text-center"},Ya={key:0},Qa={class:"px-2 w-fit py-4 text-sm text-gray-500 capitalize text-center"},Wa={key:0},Xa={class:"px-6 py-4 text-sm text-gray-900 font-semibold text-right"},Za={key:0},Ka={key:1},eo={class:"no-print"},to={class:"flex text-xs justify-center gap-2 text-gray-500 capitalize"},ao={class:"no-print px-6 py-4 text-center"},oo={class:"flex justify-center gap-2"},so=["onClick"],ro=["onClick"],lo={class:"flex text-xs justify-center items-center gap-2 text-gray-500 capitalize"},no={key:0,class:"text-xs text-gray-500 italic"},io={key:1,class:"text-xs text-gray-500 italic"},uo=["onClick"],co={key:2,class:"text-center text-gray-500"},po={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},vo={class:"bg-white p-6 rounded-lg overflow-auto w-11/12 min-w-2xl min-h-2xl max-w-7xl max-h-[100vh]"},go={class:"flex justify-between items-center mb-6"},mo={class:"text-2xl font-bold"},fo={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},xo={class:"space-y-4"},yo=["value"],bo={key:0,class:"mb-4 hidden"},_o=["value"],ho={class:"space-y-4"},wo={class:"space-y-3 max-h-64 overflow-y-auto"},ko={class:"flex justify-between items-start mb-2"},Co={class:"text-sm font-medium text-gray-700"},So=["onClick"],Vo={class:"mb-2"},Fo=["onUpdate:modelValue","onChange"],Do=["value"],Eo={class:"grid grid-cols-2 gap-2"},No=["onUpdate:modelValue","onInput"],Po=["onUpdate:modelValue","onInput"],$o={class:"text-right"},jo={class:"text-sm text-gray-600"},Ao={class:"border-t pt-4"},Io={class:"text-right"},Uo={class:"text-lg font-bold"},Mo={class:"flex justify-end gap-3 mt-6 pt-4 border-t"},To={__name:"GestorVentas",setup(Le){var Ne,Pe,$e,je,Ae;const{props:a}=pt(),W=c(a.sobrantes||[]),_e=c(a.sobrantesInventario||[]),he=c((a==null?void 0:a.cantidadDeCortes)||0),we=c((a==null?void 0:a.categoriasInventario)||[]),$=c("day"),B=new Date,z=c(B.getFullYear()+"-"+String(B.getMonth()+1).padStart(2,"0")+"-"+String(B.getDate()).padStart(2,"0")),ae=c(null),oe=c(null),H=c(((Ne=a==null?void 0:a.corte)==null?void 0:Ne.dinero_inicio)||0),O=c(((Pe=a==null?void 0:a.corte)==null?void 0:Pe.dinero_final)||0),I=c(0),U=c(0),Be=c(a.productosVendidos||[]),G=c(!1),X=c(""),ke=c(a.ventasProductos||[]),se=c(a.inventario||[]),Z=s=>Array.isArray(s)?s.map(e=>({...e,visible:e.visible===!0||e.visible===1||e.visible==="1"})):[],x=c(Z(a.ventas||[])),Ce=c(a.gastos||[]),de=c(a.totalGastos||0),Ge=c((a==null?void 0:a.cantidadCortes)||0),Je=c((a==null?void 0:a.sucursales)||[]),re=c((($e=a==null?void 0:a.sucursales[0])==null?void 0:$e.id)||null),J=c((a==null?void 0:a.cortes)||[]),R=c(!1),L=c(!1),ce=c(!!((je=a==null?void 0:a.corte)!=null&&je.dinero_inicio)),le=c(!!((Ae=a==null?void 0:a.corte)!=null&&Ae.dinero_final)),q=c(!1),Re=["Folio","ID Venta","Creado por","Hora","Productos vendidos","Metodo de pago","Factura","Total"],qe=xe(()=>{const s=new Date,e=s.getFullYear()+"-"+String(s.getMonth()+1).padStart(2,"0")+"-"+String(s.getDate()).padStart(2,"0");return $.value==="day"&&z.value===e}),K=s=>{if(!s)return"-";const e=new Date(s);return isNaN(e.getTime())?"-":e.toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:"America/Mexico_City"})},Ye=s=>{if(!s)return"";if(typeof s=="string"){const e=s.replace(" ","T"),o=new Date(e);if(isNaN(o.getTime()))return"";const l=o.getFullYear(),m=String(o.getMonth()+1).padStart(2,"0"),h=String(o.getDate()).padStart(2,"0"),k=String(o.getHours()).padStart(2,"0"),V=String(o.getMinutes()).padStart(2,"0");return`${l}-${m}-${h}T${k}:${V}`}if(s instanceof Date){const e=s.getFullYear(),o=String(s.getMonth()+1).padStart(2,"0"),l=String(s.getDate()).padStart(2,"0"),m=String(s.getHours()).padStart(2,"0"),h=String(s.getMinutes()).padStart(2,"0");return`${e}-${o}-${l}T${m}:${h}`}return""},w=c([]),Se=xe(()=>Object.values(p.value).some(s=>typeof s=="string"?s.trim()!=="":s!=null)),pe=()=>{var e,o;if(w.value=[],!x.value||((e=x.value)==null?void 0:e.length)===0)return;if(!J.value||((o=J.value)==null?void 0:o.length)===0){w.value=[{id:1,ventas:x.value,created_at:null,updated_at:null}];return}const s=[...J.value].sort((l,m)=>new Date(l.created_at)-new Date(m.created_at));s.forEach((l,m)=>{const h=l.updated_at?new Date(l.updated_at):null,k=m>0?s[m-1]:null,V=k!=null&&k.updated_at?new Date(k.updated_at):null;let F=[];m===0?F=x.value.filter(D=>new Date(D.created_at)<=(h||new Date)):h?F=x.value.filter(D=>{const r=new Date(D.created_at);return r>V&&r<=h}):F=x.value.filter(D=>new Date(D.created_at)>V),w.value.push({id:l.id,ventas:F,created_at:l.created_at,updated_at:l.updated_at,dinero_inicio:l.dinero_inicio,dinero_final:l.dinero_final})})},ve=s=>{const e=s.filter(o=>o.estado!=="eliminada"&&o.visible===!0);return{efectivo:e.reduce((o,l)=>l.metodo_pago==="efectivo"?o+Number(l.total):o,0),tarjeta:e.reduce((o,l)=>l.metodo_pago==="tarjeta"?o+Number(l.total):o,0),total:e.reduce((o,l)=>o+Number(l.total),0)}},Ve=c((a==null?void 0:a.registrosInventario)||[]),ne=()=>{G.value=!0,X.value="";let s=$.value,e=null;s==="day"?e=z.value:s==="week"?e=ae.value:s==="month"&&(e=oe.value),ye.post("/gestor-ventas/filtro",{filter:s,value:e,sucursal_id:re.value},{preserveScroll:!0,onSuccess(o){try{if(!o||!o.props){console.error("Respuesta inválida del servidor:",o),X.value="Error: Respuesta inválida del servidor",G.value=!1;return}w.value=[],I.value=o.props.cashPayments||0,U.value=o.props.cardPayments||0,Be.value=Array.isArray(o.props.productsUsed)?o.props.productsUsed:[],x.value=Z(o.props.ventas||[]),H.value=o.props.initialCash||0,O.value=o.props.finalCash||0,console.log("fetchFilteredData - response.props:",o.props),console.log("fetchFilteredData - ventas.value:",x.value),console.log("fetchFilteredData - cashPayments.value:",I.value),console.log("fetchFilteredData - cardPayments.value:",U.value),ke.value=Array.isArray(o.props.ventasProductos)?o.props.ventasProductos:[],se.value=Array.isArray(o.props.inventario)?o.props.inventario:[],Ve.value=Array.isArray(o.props.registrosInventario)?o.props.registrosInventario:[],Je.value=Array.isArray(o.props.sucursales)?o.props.sucursales:[],Ce.value=Array.isArray(o.props.gastos)?o.props.gastos:[],de.value=o.props.totalGastos||0,J.value=Array.isArray(o.props.cortes)?o.props.cortes:[],Ge.value=o.props.cantidadCortes||0,W.value=Array.isArray(o.props.sobrantes)?o.props.sobrantes:[],_e.value=Array.isArray(o.props.sobrantesInventario)?o.props.sobrantesInventario:[],he.value=o.props.cantidadDeCortes||0,we.value=Array.isArray(o.props.categoriasInventario)?o.props.categoriasInventario:[],Q.value=Array.isArray(o.props.users)?o.props.users:[],v("success","Filtro actualizado correctamente"),x.value&&x.value.length>0&&Y(),J.value&&J.value.length>0&&x.value&&x.value.length>0?pe():x.value&&x.value.length>0&&(w.value=[{id:1,ventas:x.value,created_at:null,updated_at:null}]),S.value=JSON.parse(JSON.stringify(w.value)),G.value=!1}catch(l){console.error("Error al procesar la respuesta:",l),l.value="Error al procesar los datos recibidos",G.value=!1}},onError(o){var l,m;console.error("Error en la petición:",o),v("error",((m=(l=o.props)==null?void 0:l.flash)==null?void 0:m.error)||"Error al obtener datos con este filtro"),X.value="Ocurrió un error al obtener los datos. Inténtalo de nuevo.",G.value=!1}})},Qe=()=>{var s;$.value="day",z.value=B.getFullYear()+"-"+String(B.getMonth()+1).padStart(2,"0")+"-"+String(B.getDate()).padStart(2,"0"),ae.value=null,oe.value=null,re.value=((s=a==null?void 0:a.sucursales[0])==null?void 0:s.id)||null,Fe.value=null,ge(),v("info","Filtros reseteados. Haga clic en 'Aplicar Filtro' para ver los datos.")},We=()=>{window.print()},Y=()=>{try{const s=x.value||(a==null?void 0:a.ventas)||[];if(console.log("calculatePayments - ventasACalcular:",s),console.log("calculatePayments - ventas.value:",x.value),console.log("calculatePayments - props?.ventas:",a==null?void 0:a.ventas),!Array.isArray(s)){console.warn("calculatePayments: ventas no es un array válido"),I.value=0,U.value=0;return}const e=s.filter(o=>o&&o.estado!=="eliminada"&&o.visible!==!1);console.log("calculatePayments - ventasValidas:",e),I.value=e.reduce((o,l)=>!l||typeof l.metodo_pago!="string"||typeof l.total!="number"?Number(o):l.metodo_pago==="efectivo"?Number(o)+Number(l.total||0):Number(o),0),U.value=e.reduce((o,l)=>!l||typeof l.metodo_pago!="string"||typeof l.total!="number"?Number(o):l.metodo_pago==="tarjeta"?Number(o)+Number(l.total||0):Number(o),0),console.log("calculatePayments - cashPayments.value:",I.value),console.log("calculatePayments - cardPayments.value:",U.value)}catch(s){console.error("Error al calcular pagos:",s),I.value=0,U.value=0}},Fe=c(null),p=c({idVenta:"",creadoPor:"",metodoPago:"",factura:"",precioMin:"",precioMax:"",producto:"",soloConFolio:"",tarjetaConFactura:""}),S=c([]),Xe=()=>{if((!S.value||S.value.length===0)&&(S.value=JSON.parse(JSON.stringify(w.value))),!S.value||S.value.length===0){v("warning","No hay datos disponibles para aplicar filtros.");return}const s=S.value.map(e=>{const o=e.ventas.filter(l=>{var m,h,k,V,F,D;if(p.value.idVenta&&!((m=l.idVentaDia)!=null&&m.toString().includes(p.value.idVenta))&&!((h=l.id)!=null&&h.toString().includes(p.value.idVenta))||p.value.creadoPor&&!`${((k=l==null?void 0:l.usuario)==null?void 0:k.name)||""} ${((V=l==null?void 0:l.usuario)==null?void 0:V.apellido_p)||""} ${((F=l==null?void 0:l.usuario)==null?void 0:F.apellido_m)||""}`.toLowerCase().includes(p.value.creadoPor.toLowerCase())||p.value.metodoPago&&l.metodo_pago!==p.value.metodoPago)return!1;if(p.value.factura!==""){const r=p.value.factura==="true";if(!!l.factura!==r)return!1}return!(p.value.precioMin&&Number(l.total)<Number(p.value.precioMin)||p.value.precioMax&&Number(l.total)>Number(p.value.precioMax)||p.value.producto&&!((D=l.detalles)==null?void 0:D.some(n=>{var y,te;return(te=(y=n.producto)==null?void 0:y.nombre)==null?void 0:te.toLowerCase().includes(p.value.producto.toLowerCase())}))||p.value.soloConFolio==="true"&&!l.folio||p.value.soloConFolio==="false"&&l.folio||p.value.tarjetaConFactura==="true"&&(l.metodo_pago!=="tarjeta"||!l.factura))});return{...e,ventas:o}});w.value=s.filter(e=>e.ventas.length>0),console.log("Datos originales:",S.value),console.log("Datos filtrados:",s),console.log("Cortes con ventas:",w.value),w.value.length===0?(v("info","No se encontraron ventas con los filtros aplicados. Intente ajustar los criterios de búsqueda."),w.value=[]):v("success",`Se encontraron ${w.value.length} corte(s) con ventas que coinciden con los filtros.`)},ge=()=>{p.value={idVenta:"",creadoPor:"",metodoPago:"",factura:"",precioMin:"",precioMax:"",producto:"",soloConFolio:"",tarjetaConFactura:""},S.value&&S.value.length>0?w.value=JSON.parse(JSON.stringify(S.value)):a.ventas&&a.ventas.length>0?(x.value=Z([...a.ventas]),pe()):w.value=[],v("success","Filtros limpiados correctamente")},Ze=()=>{Fe.value=null,x.value=Z(a.ventas),Y()},v=(s,e)=>{be.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,customClass:"no-print",didOpen:o=>{o.addEventListener("mouseenter",be.stopTimer),o.addEventListener("mouseleave",be.resumeTimer)}}).fire({icon:s,title:e})},Ke=()=>{const s={sucursal_id:a==null?void 0:a.sucursal_id,usuario_id:a==null?void 0:a.usuario_id,fecha:z.value,dinero_inicio:H.value};R.value=!0;try{ye.post(ht("corte-caja.guardar-inicial"),s,{preserveScroll:!0,onSuccess:e=>{e.props.flash.success?(e.props.corte&&(H.value=e.props.corte.dinero_inicio,ce.value=!0),v("success",e.props.flash.success)):v("error",e.props.flash.error),R.value=!1}})}catch(e){v("error",e.error||"Error al guardar la cantidad inicial"),R.value=!1}},et=()=>{const s={sucursal_id:a==null?void 0:a.sucursal_id,usuario_id:a==null?void 0:a.usuario_id,fecha:z.value,dinero_final:O.value};L.value=!0;try{ye.post("/corte-caja/guardar-final",s,{preserveScroll:!0,onSuccess:e=>{e.props.flash.success?(e.props.corte&&(O.value=e.props.corte.dinero_final,le.value=!0),v("success",e.props.flash.success)):v("error",e.props.flash.error),L.value=!1}})}catch(e){v("error",e.error||"Error al guardar la cantidad final"),L.value=!1}};vt(()=>{a.ventas&&Array.isArray(a.ventas)&&(x.value=Z(a.ventas)),Y(),pe(),S.value=JSON.parse(JSON.stringify(w.value)),a!=null&&a.users&&(console.log(a==null?void 0:a.users),Q.value=a.users)});const M=s=>parseFloat(s).toFixed(2),ee=c(!1),T=c(!1);c([]);const ie=c(null),g=c({fechaHora:"",usuario_id:0,metodo_pago:"efectivo",factura:!1,folio:"",productos:[],sucursal_id:"",fechaOriginalBackend:""}),Q=c((a==null?void 0:a.users)||[]),tt=s=>{const e=x.value.find(m=>m.id===s),o=Ye(e.created_at);console.log("Fecha original del backend:",e.created_at),console.log("Fecha convertida para datetime-local:",o),console.log("Valor factura del backend:",e.factura,"Tipo:",typeof e.factura);const l=e.factura===!0||e.factura===1||e.factura==="1";console.log("Factura normalizada:",l),g.value={fechaHora:o,usuario_id:e.usuario_id,metodo_pago:e.metodo_pago,factura:l,folio:e.folio||"",productos:e.detalles.map(m=>({producto_id:m.producto.id,cantidad:m.cantidad,precio_unitario:m.producto.precio,subtotal:m.cantidad*m.producto.precio})),sucursal_id:e.sucursal_id,fechaOriginalBackend:e.created_at},e.sucursal_id!==(a==null?void 0:a.sucursal_id)&&(v("warning",`Editando venta de la sucursal ${e.sucursal_id}. Puede cambiar la sucursal si es necesario.`),e.sucursal_id&&it(e.sucursal_id)),ie.value=s,ee.value=!0,T.value=!1},at=()=>{if(!(a!=null&&a.sucursal_id)){v("error","Debe seleccionar una sucursal antes de crear una venta");return}g.value={fechaHora:new Date().toISOString().slice(0,16),usuario_id:(a==null?void 0:a.usuario_id)||"",metodo_pago:"efectivo",factura:!1,folio:"",productos:[],sucursal_id:(a==null?void 0:a.sucursal_id)||"",fechaOriginalBackend:""},De(),T.value=!0,ee.value=!1,ie.value=null},De=()=>{g.value.productos.push({producto_id:"",cantidad:1,precio_unitario:0,subtotal:0})},ot=s=>{g.value.productos.splice(s,1),Ee()},st=s=>{const e=g.value.productos[s];if(e.producto_id){const o=se.value.find(l=>l.id==e.producto_id);o&&(e.precio_unitario=o.precio,me(s))}},me=s=>{const e=g.value.productos[s];e.subtotal=e.cantidad*e.precio_unitario,Ee()},Ee=()=>{console.log("Calculando total de la venta")},rt=xe(()=>g.value.productos.reduce((s,e)=>s+(e.subtotal||0),0)),lt=async()=>{var s,e;try{if(!g.value.sucursal_id){v("error","Debe seleccionar una sucursal");return}if(!g.value.usuario_id){v("error","Debe seleccionar un usuario");return}if(g.value.productos.length===0){v("error","Debe agregar al menos un producto");return}if(g.value.productos.some(m=>!m.producto_id||!m.cantidad||m.cantidad<=0)){v("error","Todos los productos deben tener cantidad válida");return}if(!g.value.fechaHora){v("error","Debe seleccionar una fecha y hora válida");return}const o={fecha_hora:g.value.fechaHora,usuario_id:g.value.usuario_id,metodo_pago:g.value.metodo_pago,factura:g.value.factura,folio:g.value.folio,productos:g.value.productos,sucursal_id:g.value.sucursal_id};console.log("Fecha original de la venta:",g.value.fechaHora),console.log("Fecha formateada para envío:",o.fecha_hora);let l;T.value?l=await axios.post("/ventas/crear",o):l=await axios.put(`/ventas/${ie.value}`,o),l.status===200?(v("success",T.value?"Venta creada correctamente":"Venta actualizada correctamente"),fe(),ne()):v("error",l.data.error||"Error al procesar la venta")}catch(o){console.error("Error al guardar venta:",o),v("error",((e=(s=o.response)==null?void 0:s.data)==null?void 0:e.error)||"Error al procesar la venta")}},nt=async()=>{q.value=!0;try{const s=await axios.post("/corte-caja/crear-corte",{dinero_inicio:0});s.status===200?(v("success","Nuevo corte creado correctamente"),H.value=0,O.value=0,window.location.reload()):v("error",s.data.error||"Error al crear nuevo corte")}catch(s){v("error",s.response||"Error al crear nuevo corte")}finally{q.value=!1}},it=async s=>{try{const e=await axios.get(`/api/usuarios-sucursal/${s}`);if(e.status===200){const o=e.data.usuarios||[],l=new Set([...Q.value.map(h=>h.id),...o.map(h=>h.id)]),m=[...Q.value,...o];Q.value=m.filter((h,k,V)=>k===V.findIndex(F=>F.id===h.id))}}catch(e){console.error("Error al cargar usuarios de la sucursal:",e)}},fe=()=>{ee.value=!1,T.value=!1,ie.value=null,g.value={fechaHora:"",usuario_id:"",metodo_pago:"efectivo",factura:!1,folio:"",productos:[],sucursal_id:(a==null?void 0:a.sucursal_id)||"",fechaOriginalBackend:""}},ut=async s=>{try{const e=await axios.post("/ventas/eliminar",{venta_id:s});e.status===200?(v("success",e.data.message),e.data.renumeracion&&v("info",e.data.renumeracion),ne()):v("error",e.data.error||"Error al eliminar la venta")}catch(e){console.error("Error al eliminar venta:",e),e.response&&e.response.data?v("error",e.response.data.error||"Error al eliminar la venta"):v("error","Error al eliminar la venta")}},dt=async s=>{try{const e=await axios.post("/ventas/restaurar",{venta_id:s});e.status===200?(v("success",e.data.message),ne()):v("error",e.data.error||"Error al restaurar la venta")}catch(e){console.error("Error al restaurar venta:",e),e.response&&e.response.data?v("error",e.response.data.error||"Error al restaurar la venta"):v("error","Error al restaurar la venta")}},ct=(s,e)=>{const o=x.value.find(l=>l.id===s);o&&(o.visible=e),axios.post("/ventas/actualizar-visible",{id:s,visible:e}).then(l=>{l.status===200?(v("success",l.data.message),Y()):(v("error",l.data.error||"Error al actualizar las ventas"),Y())}).catch(l=>{o&&(o.visible=!e),v("error","Error al actualizar la visibilidad"),Y()})};return(s,e)=>{var o,l,m,h,k,V,F,D;return i(),u(N,null,[t("div",wt,[t("div",kt,[t("div",Ct,[e[70]||(e[70]=t("h1",{class:"text-3xl font-bold mb-6 text-center"},"Gestor de Ventas",-1)),t("div",St,[t("div",Vt,[e[23]||(e[23]=t("label",{for:"filter",class:"font-bold"},"Filtrar por:",-1)),t("div",Ft,[f(t("select",{class:"ml-1 py-0 rounded",id:"filter","onUpdate:modelValue":e[0]||(e[0]=r=>$.value=r)},e[21]||(e[21]=[t("option",{value:"day"},"Día",-1),t("option",{value:"week"},"Semana",-1),t("option",{value:"month"},"Mes",-1)]),512),[[E,$.value]]),$.value==="day"?f((i(),u("input",{key:0,class:"w-fit h-fit p-1 rounded",id:"valueSelect",type:"date","onUpdate:modelValue":e[1]||(e[1]=r=>z.value=r)},null,512)),[[C,z.value]]):_("",!0),$.value==="week"?f((i(),u("input",{key:1,class:"w-fit h-fit p-1 rounded",id:"valueSelect",type:"week","onUpdate:modelValue":e[2]||(e[2]=r=>ae.value=r)},null,512)),[[C,ae.value]]):_("",!0),$.value==="month"?f((i(),u("input",{key:2,class:"w-fit h-fit p-1 rounded",id:"valueSelect",type:"month","onUpdate:modelValue":e[3]||(e[3]=r=>oe.value=r)},null,512)),[[C,oe.value]]):_("",!0)]),t("div",Dt,[e[22]||(e[22]=t("label",{for:"sucursal",class:"font-bold"},"Sucursal: ",-1)),f(t("select",{class:"ml-1 py-0 rounded",id:"sucursal","onUpdate:modelValue":e[4]||(e[4]=r=>re.value=r)},[(i(!0),u(N,null,j(P(a).sucursales,r=>(i(),u("option",{key:r.id,value:r.id},d(r.nombre),9,Et))),128))],512),[[E,re.value]])]),e[24]||(e[24]=t("div",{class:"text-xs text-gray-600 text-center mt-1 no-print"},' Seleccione los filtros y haga clic en "Aplicar Filtro" ',-1)),t("div",{class:"flex gap-1"},[t("button",{class:"no-print text-sm rounded-lg shadow-lg px-3 py-2 bg-orange-500 text-white hover:bg-orange-600",onClick:ne},"Aplicar Filtro"),t("button",{class:"no-print text-sm rounded-lg shadow-lg px-3 py-2 bg-gray-500 text-white hover:bg-gray-600",onClick:Qe},"Limpiar Filtro")])])]),X.value?(i(),u("div",Nt,d(X.value),1)):_("",!0),qe.value&&s.$page.props.user.roles[0]!=="supervisor"?(i(),u("div",Pt,[e[25]||(e[25]=t("label",{for:"initialCash",class:"block text-sm font-medium text-gray-700"},"Cantidad Inicial en Caja",-1)),t("div",$t,[f(t("input",{type:"number",id:"initialCash","onUpdate:modelValue":e[5]||(e[5]=r=>H.value=r),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",min:"0",step:"0.01",placeholder:"Ingrese cantidad"},null,512),[[C,H.value]]),t("button",{onClick:Ke,class:A(["px-4 py-2 rounded-md",R.value?"bg-gray-500 text-gray-300":"text-white hover:bg-orange-600 bg-orange-500",ce.value?"cursor-not-allowed bg-gray-500 text-gray-300":""]),disabled:R.value||ce.value},d(R.value?"Guardando...":"Guardar"),11,jt)]),e[26]||(e[26]=t("label",{for:"finalCash",class:"block text-sm font-medium text-gray-700 mt-4"},"Cantidad Final en Caja",-1)),t("div",At,[f(t("input",{type:"number",id:"finalCash","onUpdate:modelValue":e[6]||(e[6]=r=>O.value=r),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",min:"0",step:"0.01",placeholder:"Ingrese cantidad"},null,512),[[C,O.value]]),t("button",{onClick:et,class:A(["px-4 py-2 rounded-md",L.value?"bg-gray-500 text-gray-300":"text-white hover:bg-orange-600 bg-orange-500",le.value?"cursor-not-allowed bg-gray-500 text-gray-300":""]),disabled:L.value||le.value},d(L.value?"Guardando...":"Guardar"),11,It)]),le.value&&!L.value&&!q.value?(i(),u("button",{key:0,onClick:nt,class:A(["mt-4 w-full px-4 py-2 rounded-md text-white",q.value?"bg-gray-500":"hover:bg-green-600 bg-green-500"]),disabled:q.value},d(q.value?"Abriendo nuevo corte...":"Abrir nuevo corte"),11,Ut)):_("",!0)])):_("",!0),t("div",Mt,[e[35]||(e[35]=t("h2",{class:"text-xl font-semibold mb-4"},"Resumen Financiero",-1)),t("div",Tt,[P(a).cortes&&((o=P(a).cortes)==null?void 0:o.length)>0?(i(),u("div",zt,[e[27]||(e[27]=t("h3",{class:"text-lg font-semibold mb-2"},"Cortes del día",-1)),t("div",Ht,[(i(!0),u(N,null,j(P(a).cortes,(r,n)=>(i(),u("div",{key:r.id,class:"bg-white p-3 rounded shadow"},[t("h4",Ot,"Corte #"+d(n+1),1),t("p",Lt,"Inicial: $"+d(M(r.dinero_inicio||0)),1),t("p",Bt,"Final: $"+d(M(r.dinero_final||0)),1),t("p",Gt,"Hora inicio: "+d(K(r.created_at)),1),t("p",Jt,"Hora fin: "+d(K(r.updated_at)),1)]))),128))]),t("button",{class:"no-print mt-2 text-sm rounded-lg shadow-lg px-3 py-2 bg-gray-500 text-white hover:bg-gray-600 mb-4",onClick:Ze}," Restablecer Selección ")])):_("",!0),$.value==="day"?(i(),u("div",Rt,[e[28]||(e[28]=t("p",{class:"text-sm text-gray-600"},"Dinero inicial:",-1)),t("p",qt,"$"+d(M(H.value)),1)])):_("",!0),$.value==="day"?(i(),u("div",Yt,[e[29]||(e[29]=t("p",{class:"text-sm text-gray-600"},"Dinero final:",-1)),t("p",Qt,"$"+d(M(O.value)),1)])):_("",!0),t("div",null,[e[30]||(e[30]=t("p",{class:"text-sm text-gray-600"},"Efectivo:",-1)),t("p",Wt,"$"+d(M(I.value)),1)]),t("div",null,[e[31]||(e[31]=t("p",{class:"text-sm text-gray-600"},"Tarjetas:",-1)),t("p",Xt,"$"+d(U.value),1)]),t("div",null,[e[32]||(e[32]=t("p",{class:"text-sm text-gray-600"},"Total ventas (Efectivo + Tarjetas):",-1)),t("p",Zt,"$"+d(Number(I.value)+Number(U.value)),1)]),t("div",null,[e[33]||(e[33]=t("p",{class:"text-sm text-gray-600"},"Gastos:",-1)),t("p",Kt,"$"+d(de.value),1)]),t("div",null,[e[34]||(e[34]=t("p",{class:"text-sm text-gray-600"},"Total menos gastos:",-1)),t("p",ea,"$"+d(Number(I.value)+Number(U.value)-Number(de.value)),1)])])]),t("div",ta,[t("div",aa,[e[36]||(e[36]=t("h2",{class:"text-xl font-semibold mb-4"},"Ventas",-1)),t("div",oa,[t("button",{onClick:at,disabled:!((l=P(a))!=null&&l.sucursal_id),class:A(["no-print size-fit py-1 px-3 rounded-md text-white",(m=P(a))!=null&&m.sucursal_id?"hover:bg-green-600 bg-green-500":"bg-gray-400 cursor-not-allowed"]),title:(h=P(a))!=null&&h.sucursal_id?"":"Seleccione una sucursal primero"}," + Nueva Venta ",10,sa),t("button",{onClick:We,class:"no-print size-fit py-1 px-2 rounded-md text-white hover:bg-purple-600 bg-purple-500"}," Imprimir ")])]),t("div",ra,[t("div",la,[e[49]||(e[49]=t("h3",{class:"text-lg font-semibold mb-3"},"Filtros de Búsqueda",-1)),t("div",na,[t("div",null,[e[37]||(e[37]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"ID Venta",-1)),f(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=r=>p.value.idVenta=r),placeholder:"Buscar por ID...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},null,512),[[C,p.value.idVenta]])]),t("div",null,[e[38]||(e[38]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Creado por",-1)),f(t("input",{type:"text","onUpdate:modelValue":e[8]||(e[8]=r=>p.value.creadoPor=r),placeholder:"Buscar por nombre...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},null,512),[[C,p.value.creadoPor]])]),t("div",null,[e[40]||(e[40]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Método de Pago",-1)),f(t("select",{"onUpdate:modelValue":e[9]||(e[9]=r=>p.value.metodoPago=r),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},e[39]||(e[39]=[t("option",{value:""},"Todos",-1),t("option",{value:"efectivo"},"Efectivo",-1),t("option",{value:"tarjeta"},"Tarjeta",-1)]),512),[[E,p.value.metodoPago]])]),t("div",null,[e[42]||(e[42]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Factura",-1)),f(t("select",{"onUpdate:modelValue":e[10]||(e[10]=r=>p.value.factura=r),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},e[41]||(e[41]=[t("option",{value:""},"Todos",-1),t("option",{value:"true"},"Facturado",-1),t("option",{value:"false"},"No facturado",-1)]),512),[[E,p.value.factura]])]),t("div",null,[e[43]||(e[43]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Rango de Precio",-1)),t("div",ia,[f(t("input",{type:"number","onUpdate:modelValue":e[11]||(e[11]=r=>p.value.precioMin=r),placeholder:"Min",class:"w-1/2 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},null,512),[[C,p.value.precioMin]]),f(t("input",{type:"number","onUpdate:modelValue":e[12]||(e[12]=r=>p.value.precioMax=r),placeholder:"Max",class:"w-1/2 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},null,512),[[C,p.value.precioMax]])])]),t("div",null,[e[44]||(e[44]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Producto",-1)),f(t("input",{type:"text","onUpdate:modelValue":e[13]||(e[13]=r=>p.value.producto=r),placeholder:"Buscar por producto...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},null,512),[[C,p.value.producto]])]),t("div",null,[e[46]||(e[46]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Solo con Folio",-1)),f(t("select",{"onUpdate:modelValue":e[14]||(e[14]=r=>p.value.soloConFolio=r),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},e[45]||(e[45]=[t("option",{value:""},"Todas las ventas",-1),t("option",{value:"true"},"Solo con folio",-1),t("option",{value:"false"},"Sin folio",-1)]),512),[[E,p.value.soloConFolio]])]),t("div",null,[e[48]||(e[48]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tarjeta + Factura",-1)),f(t("select",{"onUpdate:modelValue":e[15]||(e[15]=r=>p.value.tarjetaConFactura=r),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},e[47]||(e[47]=[t("option",{value:""},"Todas las ventas",-1),t("option",{value:"true"},"Solo tarjeta + factura",-1)]),512),[[E,p.value.tarjetaConFactura]])]),t("div",{class:"flex items-end"},[t("div",{class:"flex gap-2 w-full"},[t("button",{onClick:Xe,class:"flex-1 bg-orange-500 text-white px-4 py-2 rounded-md hover:bg-orange-600 transition-colors"}," Aplicar Filtros "),t("button",{onClick:ge,class:"flex-1 bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition-colors"}," Limpiar ")])])])])]),((k=w.value)==null?void 0:k.length)<=0?(i(),u("div",ua,[t("div",da,[e[53]||(e[53]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),e[54]||(e[54]=t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No hay datos disponibles",-1)),t("p",ca,d(Se.value?"No se encontraron ventas con los filtros aplicados.":"No se han vendido productos en este período."),1),Se.value?(i(),u("div",pa,[t("button",{onClick:ge,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500"}," Limpiar Filtros ")])):(V=P(a))!=null&&V.sucursal_id?!((F=P(a))!=null&&F.ventas)||P(a).ventas.length===0?(i(),u("div",ga,e[51]||(e[51]=[t("p",{class:"text-sm text-gray-400"}," No hay ventas registradas para la sucursal y período seleccionados. ",-1)]))):(i(),u("div",ma,e[52]||(e[52]=[t("p",{class:"text-sm text-gray-400"}," No se encontraron ventas que coincidan con los criterios de búsqueda. ",-1)]))):(i(),u("div",va,e[50]||(e[50]=[t("p",{class:"text-sm text-gray-400"}," Seleccione una sucursal para ver las ventas disponibles. ",-1)])))])])):(i(),u("div",fa,[(i(!0),u(N,null,j(w.value,r=>(i(),u("div",{key:r.id,class:"mb-8"},[t("div",xa,[t("h3",ya,[He(" Corte #"+d(r.id)+" ",1),t("span",ba," ("+d(K(r.created_at))+" - "+d(K(r.updated_at))+") ",1)]),t("div",_a,[t("div",null,[e[55]||(e[55]=t("p",{class:"text-sm text-gray-600"},"Efectivo:",-1)),t("p",ha,"$"+d(M(ve(r.ventas).efectivo)),1)]),t("div",null,[e[56]||(e[56]=t("p",{class:"text-sm text-gray-600"},"Tarjetas:",-1)),t("p",wa,"$"+d(M(ve(r.ventas).tarjeta)),1)]),t("div",null,[e[57]||(e[57]=t("p",{class:"text-sm text-gray-600"},"Total:",-1)),t("p",ka,"$"+d(M(ve(r.ventas).total)),1)])])]),t("div",Ca,[t("table",Sa,[t("thead",Va,[t("tr",null,[e[58]||(e[58]=t("th",{class:"px-6 py-3 w-full text-left text-xs font-medium text-gray-500 uppercase tracking-wider no-print"}," Visible ",-1)),(i(),u(N,null,j(Re,n=>t("th",{key:n,class:"px-6 py-3 w-full text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},d(n),1)),64)),e[59]||(e[59]=t("th",{class:"px-6 py-3 w-full text-left text-xs font-medium text-gray-500 uppercase tracking-wider no-print"}," Estado ",-1)),e[60]||(e[60]=t("th",{class:"px-6 py-3 w-full text-left text-xs font-medium text-gray-500 uppercase tracking-wider no-print"}," Acciones ",-1))])]),t("tbody",Fa,[r.ventas.length===0?(i(),u("tr",Da,e[61]||(e[61]=[t("td",{colspan:"10",class:"text-center text-gray-500 py-8"},[t("div",{class:"flex flex-col items-center"},[t("svg",{class:"h-8 w-8 text-gray-400 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})]),t("span",{class:"text-sm font-medium text-gray-900"},"No hay ventas en este corte"),t("span",{class:"text-xs text-gray-500"},"Este corte no registró ninguna venta")])],-1)]))):(i(!0),u(N,{key:1},j(r.ventas,n=>{var y,te,Ie,Ue,Me;return i(),u("tr",{key:n.id,class:A(["divide-y divide-gray-200",n.estado==="editada"?"bg-yellow-100":n.estado==="creada"?"bg-green-100":"odd:bg-white even:bg-gray-100",n.estado==="eliminada"?"bg-red-100 opacity-50 p-0 no-print":""])},[t("td",{class:A([n.estado==="eliminada"?"p-0 m-0":"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 text-center no-print"])},[n.estado==="eliminada"?(i(),u("span",Ea,e[62]||(e[62]=[t("span",{class:"text-xs text-center text-gray-500 italic"}," Eliminado ",-1)]))):(i(),u("div",Na,[f(t("input",{type:"checkbox","onUpdate:modelValue":b=>n.visible=b,class:"w-5 h-5",onChange:b=>ct(n.id,n.visible)},null,40,Pa),[[gt,n.visible]]),He(" "+d(n.visible?"Visible":"No visible"),1)]))],2),t("td",{class:A([n.estado==="eliminada"?"p-0 m-0":"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 text-center"])},[t("div",$a,[n.estado==="eliminada"?(i(),u("span",ja,e[63]||(e[63]=[t("span",{class:"text-xs text-gray-500 italic"}," Eliminado ",-1)]))):(i(),u("span",Aa,d(n.folio?n.folio:"-"),1))])],2),t("td",Ia,[n.estado==="eliminada"?(i(),u("span",Ua,e[64]||(e[64]=[t("span",{class:"text-xs text-gray-500 italic"}," Eliminado ",-1)]))):(i(),u("span",Ma,d(n.idVentaDia||n.id),1))]),t("td",Ta,[n.estado==="eliminada"?(i(),u("span",za," Eliminado ")):(i(),u("span",Ha,d(`${(y=n==null?void 0:n.usuario)==null?void 0:y.name}
                              ${(te=n==null?void 0:n.usuario)!=null&&te.apellido_p?(Ie=n==null?void 0:n.usuario)==null?void 0:Ie.apellido_p:""}
                              ${(Ue=n==null?void 0:n.usuario)!=null&&Ue.apellido_m?(Me=n==null?void 0:n.usuario)==null?void 0:Me.apellido_m:""}`),1))]),t("td",Oa,[n.estado==="eliminada"?(i(),u("span",La,e[65]||(e[65]=[t("span",{class:"text-xs text-gray-500 italic"}," Eliminado ",-1)]))):(i(),u("span",Ba,d(K(n.created_at)),1))]),t("td",Ga,[n.estado!=="eliminada"?(i(),u("div",Ja,[(i(!0),u(N,null,j(n.detalles,b=>{var Te,ze;return i(),u("div",{key:b.id,class:"flex justify-between"},[t("span",null,d(b.cantidad)+" × "+d(((Te=b.producto)==null?void 0:Te.nombre)||"Producto desconocido"),1),t("span",{class:A(["font-semibold",!(b!=null&&b.cantidadEditado)||(b==null?void 0:b.cantidadEditado)===(b==null?void 0:b.cantidad)?"text-gray-700":"text-red-700"])}," $"+d((((ze=b.producto)==null?void 0:ze.precio)??0)*(b.cantidad??0)),3)])}),128))])):_("",!0),n.estado==="eliminada"?(i(),u("div",Ra,e[66]||(e[66]=[t("span",{class:"text-xs text-gray-500 italic"}," Eliminado ",-1)]))):_("",!0)]),t("td",qa,[n.estado==="eliminada"?(i(),u("span",Ya,e[67]||(e[67]=[t("span",{class:"text-xs text-gray-500 italic"}," Eliminado ",-1)]))):(i(),u("span",{key:1,class:A([[n.metodo_pago=="tarjeta"?"bg-yellow-500":"bg-green-500"],"px-2 py-1 rounded-md text-white"])},d(n.metodo_pago),3))]),t("td",Qa,[n.estado==="eliminada"?(i(),u("span",Wa,e[68]||(e[68]=[t("span",{class:"text-xs text-gray-500 italic"}," Eliminado ",-1)]))):(i(),u("span",{key:1,class:A([[n.factura==!0?"bg-blue-500":"bg-red-500"],"px-2 py-1 rounded-md text-white whitespace-nowrap capitalize"])},d(n.factura?"Facturado":"No facturado"),3))]),t("td",Xa,[n.estado==="eliminada"?(i(),u("span",Za,e[69]||(e[69]=[t("span",{class:"text-xs text-gray-500 italic"}," Eliminado ",-1)]))):(i(),u("span",Ka,"$"+d(n.total),1))]),t("td",eo,[t("div",to,d(n.estado),1)]),t("td",ao,[t("div",oo,[n.estado!=="eliminada"&&n.visible!==!1?(i(),u("button",{key:0,onClick:b=>tt(n.id),class:"text-white rounded-md px-2 py-1 bg-orange-500 hover:bg-orange-700"}," Editar ",8,so)):_("",!0),n.estado!=="eliminada"&&n.visible!==!1?(i(),u("button",{key:1,onClick:b=>ut(n.id),class:"text-white rounded-md px-2 py-1 bg-red-500 hover:bg-red-700"}," Eliminar ",8,ro)):_("",!0),t("div",lo,[n.estado==="eliminada"?(i(),u("span",no," Eliminado ")):_("",!0),n.visible===!1?(i(),u("span",io," No visible ")):_("",!0),n.estado==="eliminada"?(i(),u("button",{key:2,onClick:b=>dt(n.id),class:"text-white rounded-md px-2 py-1 bg-green-500 hover:bg-green-700 text-xs"}," Restaurar ",8,uo)):_("",!0)])])])],2)}),128))])])])]))),128))]))]),G.value?(i(),u("div",co,"Cargando...")):_("",!0)])])]),ue(xt,{registrosInventario:Ve.value},null,8,["registrosInventario"]),ue(yt,{gastos:Ce.value},null,8,["gastos"]),W.value&&W.value.length>0?(i(),Oe(bt,{key:0,cantidadDeCortes:he.value,sobrantes:W.value,categoriasInventario:we.value,sobrantesInventario:_e.value},null,8,["cantidadDeCortes","sobrantes","categoriasInventario","sobrantesInventario"])):_("",!0),ue(_t,{ventasProductos:ke.value,inventario:se.value},null,8,["ventasProductos","inventario"]),ee.value||T.value?(i(),u("div",po,[t("div",vo,[t("div",go,[t("h2",mo,d(T.value?"Crear Nueva Venta":"Editar Venta"),1),t("button",{onClick:fe,class:"text-gray-500 hover:text-gray-700 text-2xl"},"×")]),t("div",fo,[t("div",xo,[e[80]||(e[80]=t("h3",{class:"text-lg font-semibold text-gray-700"},"Información de la Venta",-1)),t("div",null,[e[71]||(e[71]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha y Hora de Venta",-1)),f(t("input",{type:"datetime-local","onUpdate:modelValue":e[16]||(e[16]=r=>g.value.fechaHora=r),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},null,512),[[C,g.value.fechaHora]])]),t("div",null,[e[73]||(e[73]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Vendido por",-1)),f(t("select",{"onUpdate:modelValue":e[17]||(e[17]=r=>g.value.usuario_id=r),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},[e[72]||(e[72]=t("option",{value:"",selected:""},"Seleccionar usuario",-1)),(i(!0),u(N,null,j(Q.value,r=>(i(),u("option",{key:r.id,value:r.id},d(r.name)+" "+d(r.apellido_p||"")+" "+d(r.apellido_m||""),9,yo))),128))],512),[[E,g.value.usuario_id]])]),ee.value?(i(),u("div",bo,[e[74]||(e[74]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Sucursal",-1)),f(t("select",{"onUpdate:modelValue":e[18]||(e[18]=r=>g.value.sucursal_id=r),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},[(i(!0),u(N,null,j((D=P(a))==null?void 0:D.sucursales,r=>(i(),u("option",{key:r.id,value:r.id},d(r.nombre),9,_o))),128))],512),[[E,g.value.sucursal_id]]),e[75]||(e[75]=t("p",{class:"text-xs text-gray-500 mt-1"},"Puede cambiar la sucursal de la venta si es necesario",-1))])):_("",!0),t("div",null,[e[77]||(e[77]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Método de Pago",-1)),f(t("select",{"onUpdate:modelValue":e[19]||(e[19]=r=>g.value.metodo_pago=r),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},e[76]||(e[76]=[t("option",{value:"efectivo"},"Efectivo",-1),t("option",{value:"tarjeta"},"Tarjeta",-1)]),512),[[E,g.value.metodo_pago]])]),t("div",null,[e[79]||(e[79]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Factura",-1)),f(t("select",{"onUpdate:modelValue":e[20]||(e[20]=r=>g.value.factura=r),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},e[78]||(e[78]=[t("option",{value:!1},"No facturado",-1),t("option",{value:!0},"Facturado",-1)]),512),[[E,g.value.factura]])])]),t("div",ho,[t("div",{class:"flex justify-between items-center"},[e[81]||(e[81]=t("h3",{class:"text-lg font-semibold text-gray-700"},"Productos",-1)),t("button",{onClick:De,class:"bg-green-500 text-white px-3 py-1 rounded-md hover:bg-green-600 text-sm"}," + Agregar Producto ")]),t("div",wo,[(i(!0),u(N,null,j(g.value.productos,(r,n)=>(i(),u("div",{key:n,class:"border border-gray-200 rounded-lg p-3"},[t("div",ko,[t("span",Co,"Producto "+d(n+1),1),t("button",{onClick:y=>ot(n),class:"text-red-500 hover:text-red-700 text-sm"}," × Eliminar ",8,So)]),t("div",Vo,[f(t("select",{"onUpdate:modelValue":y=>r.producto_id=y,onChange:y=>st(n),class:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-orange-500"},[e[82]||(e[82]=t("option",{value:""},"Seleccionar producto",-1)),(i(!0),u(N,null,j(se.value,y=>(i(),u("option",{key:y.id,value:y.id},d(y.nombre)+" ("+d(y.detalle)+") - $"+d(y.precio),9,Do))),128))],40,Fo),[[E,r.producto_id]])]),t("div",Eo,[t("div",null,[e[83]||(e[83]=t("label",{class:"block text-xs text-gray-600 mb-1"},"Cantidad",-1)),f(t("input",{type:"number","onUpdate:modelValue":y=>r.cantidad=y,onInput:y=>me(n),min:"1",class:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-orange-500"},null,40,No),[[C,r.cantidad]])]),t("div",null,[e[84]||(e[84]=t("label",{class:"block text-xs text-gray-600 mb-1"},"Precio Unit.",-1)),f(t("input",{type:"number",disabled:"","onUpdate:modelValue":y=>r.precio_unitario=y,onInput:y=>me(n),step:"0.01",class:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-orange-500"},null,40,Po),[[C,r.precio_unitario]])])]),t("div",$o,[t("span",jo,"Subtotal: $"+d(r.subtotal||0),1)])]))),128))]),t("div",Ao,[t("div",Io,[t("span",Uo,"Total: $"+d(rt.value),1)])])])]),t("div",Mo,[t("button",{onClick:fe,class:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600"}," Cancelar "),t("button",{onClick:lt,class:"px-4 py-2 bg-orange-500 text-white rounded-md hover:bg-orange-600"},d(T.value?"Crear Venta":"Guardar Cambios"),1)])])])):_("",!0)],64)}}},zo={class:"py-6"},Ho={class:"max-w-9xl w-full mx-auto sm:px-6 lg:px-8 rounded-xl"},Oo={class:"overflow-scroll md:overflow-hidden rounded-xl"},Ro={__name:"index",setup(Le){return(a,W)=>(i(),Oe(ft,{title:"Tablero principal"},{default:mt(()=>[t("div",zo,[t("div",Ho,[t("div",Oo,[ue(To)])])])]),_:1}))}};export{Ro as default};
