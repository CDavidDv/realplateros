import{Q as vt,d as p,i as be,s as gt,o as i,e as u,a as t,j as x,l as $,k as V,f as y,F as D,h as T,t as d,u as M,n as S,g as U,A as mt,b as ce,c as He,y as _e,w as ft}from"./app-DSHkHlqr.js";import{S as he,_ as xt}from"./AppLayout-CPeL6_8p.js";import{_ as yt,a as bt,b as _t,c as ht,r as wt}from"./Sobrantes-BoH-Dtm5.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chart-BZcJGg0T.js";const kt={class:"print min-h-screen flex rounded-2xl border-0 flex-col justify-center"},Ct={class:"relative w-full px-4 sm:px-0 pb-8"},St={class:"relative px-4 bg-white shadow-lg rounded-3xl sm:p-20 sm:pt-8"},Vt={class:"flex flex-col md:flex-row items-center gap-4 mb-8"},Ft={class:"w-full gap-2 flex flex-col items-center"},Et={class:"flex gap-2"},$t={class:"flex gap-2"},Dt=["value"],Nt={class:"flex gap-1"},Pt=["disabled"],Tt=["disabled"],jt={key:0,class:"text-red-500 font-bold mt-2"},It={key:1,class:"mb-6 no-print"},At={class:"flex space-x-2"},Mt=["disabled"],Ut={class:"flex space-x-2"},zt=["disabled"],Ht=["disabled"],Ot={class:"bg-gray-50 p-4 rounded-lg mb-6"},Rt={class:"grid grid-cols-2 gap-4"},Bt={key:0,class:"col-span-2 mb-4"},Lt={class:"grid grid-cols-3 gap-4"},Gt={class:"font-medium"},Jt={class:"text-sm text-gray-600"},qt={class:"text-sm text-gray-600"},Yt={class:"text-sm text-gray-600"},Qt={class:"text-sm text-gray-600"},Wt={key:1},Xt={class:"font-medium"},Zt={key:2},Kt={class:"font-medium"},ea={class:"font-medium"},ta={class:"font-medium"},aa={class:"font-medium"},oa={class:"font-medium"},sa={class:"font-medium"},ra={class:"font-medium"},la={class:"font-medium"},na={class:"mb-6"},ia={class:"flex justify-between"},ua={class:"flex gap-2"},da=["disabled","title"],ca=["disabled","title","aria-label"],pa={key:0},va=["disabled","title","aria-label"],ga={key:0},ma={class:"mb-4 no-print"},fa={class:"bg-gray-50 p-4 rounded-lg"},xa={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},ya={class:"flex gap-2"},ba={key:0,class:"text-center py-8"},_a={class:"text-gray-500"},ha={class:"text-gray-500"},wa={key:0,class:"mt-4"},ka={key:1,class:"mt-4"},Ca={key:2,class:"mt-4"},Sa={key:3,class:"mt-4"},Va={key:1},Fa={class:"bg-gray-100 p-4 rounded-lg mb-4"},Ea={class:"text-lg font-semibold"},$a={class:"text-sm text-gray-600"},Da={class:"grid grid-cols-3 gap-4 mt-2"},Na={class:"font-medium"},Pa={class:"font-medium"},Ta={class:"font-medium"},ja={class:"overflow-x-auto h-screen overflow-auto ventasR"},Ia={class:"tabla min-w-full divide-y overflow-auto divide-gray-200"},Aa={class:"bg-gray-50"},Ma={class:"bg-white divide-y divide-gray-200"},Ua={key:0},za={key:0},Ha={key:1,class:"flex flex-col items-center"},Oa=["onUpdate:modelValue","onChange"],Ra={class:"flex flex-col items-center"},Ba={key:0},La={key:1},Ga={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 text-center"},Ja={key:0},qa={key:1},Ya={class:"px-6 py-4 whitespace-nowrap overflow-auto text-sm text-gray-500"},Qa={key:0,class:"text-xs text-gray-500 italic"},Wa={key:1,class:"print"},Xa={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center"},Za={key:0},Ka={key:1},eo={class:"px-6 py-4 text-sm text-gray-500"},to={key:0,class:"flex flex-col space-y-1"},ao={key:1,class:"flex flex-col space-y-1"},oo={class:"px-6 py-4 text-sm text-gray-500 capitalize text-center"},so={key:0},ro={class:"px-2 w-fit py-4 text-sm text-gray-500 capitalize text-center"},lo={key:0},no={class:"px-6 py-4 text-sm text-gray-900 font-semibold text-right"},io={key:0},uo={key:1},co={class:"no-print"},po={class:"flex text-xs justify-center gap-2 text-gray-500 capitalize"},vo={class:"no-print px-6 py-4 text-center"},go={class:"flex justify-center gap-2"},mo=["onClick"],fo=["onClick"],xo={class:"flex text-xs justify-center items-center gap-2 text-gray-500 capitalize"},yo={key:0,class:"text-xs text-gray-500 italic"},bo={key:1,class:"text-xs text-gray-500 italic"},_o=["onClick"],ho={key:2,class:"text-center text-gray-500"},wo={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ko={class:"bg-white p-6 rounded-lg overflow-auto w-11/12 min-w-2xl min-h-2xl max-w-7xl max-h-[100vh]"},Co={class:"flex justify-between items-center mb-6"},So={class:"text-2xl font-bold"},Vo={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Fo={class:"space-y-4"},Eo=["value"],$o={key:0,class:"mb-4 hidden"},Do=["value"],No={class:"space-y-4"},Po={class:"space-y-3 max-h-64 overflow-y-auto"},To={class:"flex justify-between items-start mb-2"},jo={class:"text-sm font-medium text-gray-700"},Io=["onClick"],Ao={class:"mb-2"},Mo=["onUpdate:modelValue","onChange"],Uo=["value"],zo={class:"grid grid-cols-2 gap-2"},Ho=["onUpdate:modelValue","onInput"],Oo=["onUpdate:modelValue","onInput"],Ro={class:"text-right"},Bo={class:"text-sm text-gray-600"},Lo={class:"border-t pt-4"},Go={class:"text-right"},Jo={class:"text-lg font-bold"},qo={class:"flex justify-end gap-3 mt-6 pt-4 border-t"},Yo={__name:"GestorVentas",setup(Oe){var je,Ie,Ae,Me;const{props:o}=vt(),W=p(o.sobrantes||[]),we=p(o.sobrantesInventario||[]),ke=p((o==null?void 0:o.cantidadDeCortes)||0),Ce=p((o==null?void 0:o.categoriasInventario)||[]),N=p("day"),L=new Date,j=p(L.getFullYear()+"-"+String(L.getMonth()+1).padStart(2,"0")+"-"+String(L.getDate()).padStart(2,"0")),oe=p(null),se=p(null),z=p(((je=o==null?void 0:o.corte)==null?void 0:je.dinero_inicio)||0),H=p(((Ie=o==null?void 0:o.corte)==null?void 0:Ie.dinero_final)||0),re=p(0),le=p(0),Re=p(o.productosVendidos||[]),G=p(!1),X=p(""),Se=p(o.ventasProductos||[]),ne=p(o.inventario||[]),Z=r=>Array.isArray(r)?r.map(e=>({...e,visible:e.visible===!0||e.visible===1||e.visible==="1"})):[],_=p(Z(o.ventas||[])),Ve=p(o.gastos||[]),pe=p(o.totalGastos||0),Be=p((o==null?void 0:o.cantidadCortes)||0),Le=p((o==null?void 0:o.sucursales)||[]),h=p(null),J=p((o==null?void 0:o.cortes)||[]),q=p(!1),O=p(!1),ve=p(!!((Ae=o==null?void 0:o.corte)!=null&&Ae.dinero_inicio)),ie=p(!!((Me=o==null?void 0:o.corte)!=null&&Me.dinero_final)),Y=p(!1),Fe=p((o==null?void 0:o.cashPaymentsTotal)||0),Ee=p((o==null?void 0:o.cardPaymentsTotal)||0),Ge=["Folio","ID Venta","Creado por","Hora","Productos vendidos","Metodo de pago","Factura","Total"],Je=be(()=>{const r=new Date,e=r.getFullYear()+"-"+String(r.getMonth()+1).padStart(2,"0")+"-"+String(r.getDate()).padStart(2,"0");return N.value==="day"&&j.value===e}),K=r=>{if(!r)return"-";const e=new Date(r);return isNaN(e.getTime())?"-":e.toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:"America/Mexico_City"})},qe=r=>{if(!r)return"";if(typeof r=="string"){const e=r.replace(" ","T"),a=new Date(e);if(isNaN(a.getTime()))return"";const n=a.getFullYear(),m=String(a.getMonth()+1).padStart(2,"0"),w=String(a.getDate()).padStart(2,"0"),C=String(a.getHours()).padStart(2,"0"),s=String(a.getMinutes()).padStart(2,"0");return`${n}-${m}-${w}T${C}:${s}`}if(r instanceof Date){const e=r.getFullYear(),a=String(r.getMonth()+1).padStart(2,"0"),n=String(r.getDate()).padStart(2,"0"),m=String(r.getHours()).padStart(2,"0"),w=String(r.getMinutes()).padStart(2,"0");return`${e}-${a}-${n}T${m}:${w}`}return""},k=p([]),$e=be(()=>Object.values(v.value).some(r=>typeof r=="string"?r.trim()!=="":r!=null)),ge=()=>{var e,a;if(k.value=[],!_.value||((e=_.value)==null?void 0:e.length)===0)return;if(!J.value||((a=J.value)==null?void 0:a.length)===0){k.value=[{id:1,ventas:_.value,created_at:null,updated_at:null}];return}const r=[...J.value].sort((n,m)=>new Date(n.created_at)-new Date(m.created_at));r.forEach((n,m)=>{const w=n.updated_at?new Date(n.updated_at):null,C=m>0?r[m-1]:null,s=C!=null&&C.updated_at?new Date(C.updated_at):null;let l=[];m===0?l=_.value.filter(f=>new Date(f.created_at)<=(w||new Date)):w?l=_.value.filter(f=>{const E=new Date(f.created_at);return E>s&&E<=w}):l=_.value.filter(f=>new Date(f.created_at)>s),k.value.push({id:n.id,ventas:l,created_at:n.created_at,updated_at:n.updated_at,dinero_inicio:n.dinero_inicio,dinero_final:n.dinero_final})})},me=r=>{const e=r.filter(a=>a.estado!=="eliminada"&&a.visible===!0);return{efectivo:e.reduce((a,n)=>n.metodo_pago==="efectivo"?a+Number(n.total):a,0),tarjeta:e.reduce((a,n)=>n.metodo_pago==="tarjeta"?a+Number(n.total):a,0),total:e.reduce((a,n)=>a+Number(n.total),0)}},De=p((o==null?void 0:o.registrosInventario)||[]),I=()=>{G.value=!0,X.value="";let r=N.value,e=null;r==="day"?e=j.value:r==="week"?e=oe.value:r==="month"&&(e=se.value),_e.post("/gestor-ventas/filtro",{filter:r,value:e,sucursal_id:h.value},{preserveScroll:!0,onSuccess(a){try{if(!a||!a.props){console.error("Respuesta inválida del servidor:",a),X.value="Error: Respuesta inválida del servidor",G.value=!1;return}k.value=[],re.value=a.props.cashPayments||0,le.value=a.props.cardPayments||0,Re.value=Array.isArray(a.props.productsUsed)?a.props.productsUsed:[],_.value=Z(a.props.ventas||[]),z.value=a.props.initialCash||0,H.value=a.props.finalCash||0,Se.value=Array.isArray(a.props.ventasProductos)?a.props.ventasProductos:[],ne.value=Array.isArray(a.props.inventario)?a.props.inventario:[],De.value=Array.isArray(a.props.registrosInventario)?a.props.registrosInventario:[],Le.value=Array.isArray(a.props.sucursales)?a.props.sucursales:[],Ve.value=Array.isArray(a.props.gastos)?a.props.gastos:[],pe.value=a.props.totalGastos||0,J.value=Array.isArray(a.props.cortes)?a.props.cortes:[],Be.value=a.props.cantidadCortes||0,W.value=Array.isArray(a.props.sobrantes)?a.props.sobrantes:[],we.value=Array.isArray(a.props.sobrantesInventario)?a.props.sobrantesInventario:[],ke.value=a.props.cantidadDeCortes||0,Ce.value=Array.isArray(a.props.categoriasInventario)?a.props.categoriasInventario:[],Q.value=Array.isArray(a.props.users)?a.props.users:[],Fe.value=a.props.cashPaymentsTotal||0,Ee.value=a.props.cardPaymentsTotal||0,c("success","Filtro actualizado correctamente"),_.value&&_.value.length>0,J.value&&J.value.length>0&&_.value&&_.value.length>0?ge():_.value&&_.value.length>0&&(k.value=[{id:1,ventas:_.value,created_at:null,updated_at:null}]),F.value=JSON.parse(JSON.stringify(k.value)),G.value=!1}catch(n){console.error("Error al procesar la respuesta:",n),n.value="Error al procesar los datos recibidos",G.value=!1}},onError(a){var n,m;console.error("Error en la petición:",a),c("error",((m=(n=a.props)==null?void 0:n.flash)==null?void 0:m.error)||"Error al obtener datos con este filtro"),X.value="Ocurrió un error al obtener los datos. Inténtalo de nuevo.",G.value=!1}})},Ye=()=>{N.value="day",j.value=L.getFullYear()+"-"+String(L.getMonth()+1).padStart(2,"0")+"-"+String(L.getDate()).padStart(2,"0"),oe.value=null,se.value=null,h.value=null,Ne.value=null,fe(),c("info","Filtros reseteados. Haga clic en 'Aplicar Filtro' para ver los datos.")},Qe=()=>{window.print()},Ne=p(null),v=p({idVenta:"",creadoPor:"",metodoPago:"",factura:"",precioMin:"",precioMax:"",producto:"",soloConFolio:"",tarjetaConFactura:""}),F=p([]),We=()=>{if((!F.value||F.value.length===0)&&(F.value=JSON.parse(JSON.stringify(k.value))),!F.value||F.value.length===0){c("warning","No hay datos disponibles para aplicar filtros.");return}const r=F.value.map(e=>{const a=e.ventas.filter(n=>{var m,w,C,s,l,f;if(v.value.idVenta&&!((m=n.idVentaDia)!=null&&m.toString().includes(v.value.idVenta))&&!((w=n.id)!=null&&w.toString().includes(v.value.idVenta))||v.value.creadoPor&&!`${((C=n==null?void 0:n.usuario)==null?void 0:C.name)||""} ${((s=n==null?void 0:n.usuario)==null?void 0:s.apellido_p)||""} ${((l=n==null?void 0:n.usuario)==null?void 0:l.apellido_m)||""}`.toLowerCase().includes(v.value.creadoPor.toLowerCase())||v.value.metodoPago&&n.metodo_pago!==v.value.metodoPago)return!1;if(v.value.factura!==""){const E=v.value.factura==="true";if(!!n.factura!==E)return!1}return!(v.value.precioMin&&Number(n.total)<Number(v.value.precioMin)||v.value.precioMax&&Number(n.total)>Number(v.value.precioMax)||v.value.producto&&!((f=n.detalles)==null?void 0:f.some(de=>{var te,ae;return(ae=(te=de.producto)==null?void 0:te.nombre)==null?void 0:ae.toLowerCase().includes(v.value.producto.toLowerCase())}))||v.value.soloConFolio==="true"&&!n.folio||v.value.soloConFolio==="false"&&n.folio||v.value.tarjetaConFactura==="true"&&(n.metodo_pago!=="tarjeta"||!n.factura))});return{...e,ventas:a}});k.value=r.filter(e=>e.ventas.length>0),console.log("Datos originales:",F.value),console.log("Datos filtrados:",r),console.log("Cortes con ventas:",k.value),k.value.length===0?(c("info","No se encontraron ventas con los filtros aplicados. Intente ajustar los criterios de búsqueda."),k.value=[]):c("success",`Se encontraron ${k.value.length} corte(s) con ventas que coinciden con los filtros.`)},fe=()=>{v.value={idVenta:"",creadoPor:"",metodoPago:"",factura:"",precioMin:"",precioMax:"",producto:"",soloConFolio:"",tarjetaConFactura:""},F.value&&F.value.length>0?k.value=JSON.parse(JSON.stringify(F.value)):o.ventas&&o.ventas.length>0?(_.value=Z([...o.ventas]),ge()):k.value=[],c("success","Filtros limpiados correctamente")},Xe=()=>{Ne.value=null,_.value=Z(o.ventas)},c=(r,e)=>{he.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,customClass:"no-print",didOpen:a=>{a.addEventListener("mouseenter",he.stopTimer),a.addEventListener("mouseleave",he.resumeTimer)}}).fire({icon:r,title:e})},Ze=()=>{const r={sucursal_id:o==null?void 0:o.sucursal_id,usuario_id:o==null?void 0:o.usuario_id,fecha:j.value,dinero_inicio:z.value};q.value=!0;try{_e.post(wt("corte-caja.guardar-inicial"),r,{preserveScroll:!0,onSuccess:e=>{e.props.flash.success?(e.props.corte&&(z.value=e.props.corte.dinero_inicio,ve.value=!0),c("success",e.props.flash.success)):c("error",e.props.flash.error),q.value=!1}})}catch(e){c("error",e.error||"Error al guardar la cantidad inicial"),q.value=!1}},Ke=()=>{const r={sucursal_id:o==null?void 0:o.sucursal_id,usuario_id:o==null?void 0:o.usuario_id,fecha:j.value,dinero_final:H.value};O.value=!0;try{_e.post("/corte-caja/guardar-final",r,{preserveScroll:!0,onSuccess:e=>{e.props.flash.success?(e.props.corte&&(H.value=e.props.corte.dinero_final,ie.value=!0),c("success",e.props.flash.success)):c("error",e.props.flash.error),O.value=!1}})}catch(e){c("error",e.error||"Error al guardar la cantidad final"),O.value=!1}};gt(()=>{o.ventas&&Array.isArray(o.ventas)&&(_.value=Z(o.ventas)),ge(),F.value=JSON.parse(JSON.stringify(k.value)),o!=null&&o.users&&(console.log(o==null?void 0:o.users),Q.value=o.users)});const P=r=>parseFloat(r).toFixed(2),ee=p(!1),A=p(!1);p([]);const ue=p(null),g=p({fechaHora:"",usuario_id:0,metodo_pago:"efectivo",factura:!1,folio:"",productos:[],sucursal_id:"",fechaOriginalBackend:""}),Q=p((o==null?void 0:o.users)||[]),et=r=>{const e=_.value.find(m=>m.id===r),a=qe(e.created_at);console.log("Fecha original del backend:",e.created_at),console.log("Fecha convertida para datetime-local:",a),console.log("Valor factura del backend:",e.factura,"Tipo:",typeof e.factura);const n=e.factura===!0||e.factura===1||e.factura==="1";console.log("Factura normalizada:",n),g.value={fechaHora:a,usuario_id:e.usuario_id,metodo_pago:e.metodo_pago,factura:n,folio:e.folio||"",productos:e.detalles.map(m=>({producto_id:m.producto.id,cantidad:m.cantidad,precio_unitario:m.producto.precio,subtotal:m.cantidad*m.producto.precio})),sucursal_id:e.sucursal_id,fechaOriginalBackend:e.created_at},e.sucursal_id!==(o==null?void 0:o.sucursal_id)&&(c("warning",`Editando venta de la sucursal ${e.sucursal_id}. Puede cambiar la sucursal si es necesario.`),e.sucursal_id&&nt(e.sucursal_id)),ue.value=r,ee.value=!0,A.value=!1},tt=()=>{if(!(o!=null&&o.sucursal_id)){c("error","Debe seleccionar una sucursal antes de crear una venta");return}g.value={fechaHora:new Date().toISOString().slice(0,16),usuario_id:(o==null?void 0:o.usuario_id)||"",metodo_pago:"efectivo",factura:!1,folio:"",productos:[],sucursal_id:(o==null?void 0:o.sucursal_id)||"",fechaOriginalBackend:""},Pe(),A.value=!0,ee.value=!1,ue.value=null},Pe=()=>{g.value.productos.push({producto_id:"",cantidad:1,precio_unitario:0,subtotal:0})},at=r=>{g.value.productos.splice(r,1),Te()},ot=r=>{const e=g.value.productos[r];if(e.producto_id){const a=ne.value.find(n=>n.id==e.producto_id);a&&(e.precio_unitario=a.precio,xe(r))}},xe=r=>{const e=g.value.productos[r];e.subtotal=e.cantidad*e.precio_unitario,Te()},Te=()=>{console.log("Calculando total de la venta")},st=be(()=>g.value.productos.reduce((r,e)=>r+(e.subtotal||0),0)),rt=async()=>{var r,e;try{if(!g.value.sucursal_id){c("error","Debe seleccionar una sucursal");return}if(!g.value.usuario_id){c("error","Debe seleccionar un usuario");return}if(g.value.productos.length===0){c("error","Debe agregar al menos un producto");return}if(g.value.productos.some(m=>!m.producto_id||!m.cantidad||m.cantidad<=0)){c("error","Todos los productos deben tener cantidad válida");return}if(!g.value.fechaHora){c("error","Debe seleccionar una fecha y hora válida");return}const a={fecha_hora:g.value.fechaHora,usuario_id:g.value.usuario_id,metodo_pago:g.value.metodo_pago,factura:g.value.factura,folio:g.value.folio,productos:g.value.productos,sucursal_id:g.value.sucursal_id};console.log("Fecha original de la venta:",g.value.fechaHora),console.log("Fecha formateada para envío:",a.fecha_hora);let n;A.value?n=await axios.post("/ventas/crear",a):n=await axios.put(`/ventas/${ue.value}`,a),n.status===200?(c("success",A.value?"Venta creada correctamente":"Venta actualizada correctamente"),ye(),I()):c("error",n.data.error||"Error al procesar la venta")}catch(a){console.error("Error al guardar venta:",a),c("error",((e=(r=a.response)==null?void 0:r.data)==null?void 0:e.error)||"Error al procesar la venta")}},lt=async()=>{Y.value=!0;try{const r=await axios.post("/corte-caja/crear-corte",{dinero_inicio:0});r.status===200?(c("success","Nuevo corte creado correctamente"),z.value=0,H.value=0,window.location.reload()):c("error",r.data.error||"Error al crear nuevo corte")}catch(r){c("error",r.response||"Error al crear nuevo corte")}finally{Y.value=!1}},nt=async r=>{try{const e=await axios.get(`/api/usuarios-sucursal/${r}`);if(e.status===200){const a=e.data.usuarios||[],n=new Set([...Q.value.map(w=>w.id),...a.map(w=>w.id)]),m=[...Q.value,...a];Q.value=m.filter((w,C,s)=>C===s.findIndex(l=>l.id===w.id))}}catch(e){console.error("Error al cargar usuarios de la sucursal:",e)}},ye=()=>{ee.value=!1,A.value=!1,ue.value=null,g.value={fechaHora:"",usuario_id:"",metodo_pago:"efectivo",factura:!1,folio:"",productos:[],sucursal_id:(o==null?void 0:o.sucursal_id)||"",fechaOriginalBackend:""}},it=async r=>{try{const e=await axios.post("/ventas/eliminar",{venta_id:r});e.status===200?(c("success",e.data.message),e.data.renumeracion&&c("info",e.data.renumeracion),I()):c("error",e.data.error||"Error al eliminar la venta")}catch(e){console.error("Error al eliminar venta:",e),e.response&&e.response.data?c("error",e.response.data.error||"Error al eliminar la venta"):c("error","Error al eliminar la venta")}},ut=async r=>{try{const e=await axios.post("/ventas/restaurar",{venta_id:r});e.status===200?(c("success",e.data.message),I()):c("error",e.data.error||"Error al restaurar la venta")}catch(e){console.error("Error al restaurar venta:",e),e.response&&e.response.data?c("error",e.response.data.error||"Error al restaurar la venta"):c("error","Error al restaurar la venta")}},dt=(r,e)=>{const a=_.value.find(n=>n.id===r);a&&(a.visible=e),axios.post("/ventas/actualizar-visible",{id:r,visible:e}).then(n=>{n.status===200?(c("success",n.data.message),I()):c("error",n.data.error||"Error al actualizar las ventas")}).catch(n=>{a&&(a.visible=!e),c("error","Error al actualizar la visibilidad"),I()})},R=p(!1),B=p(!1),ct=async()=>{var r,e;try{R.value=!0;const a=await axios.post("/ventas/renumerar-normales",{sucursal_id:h.value,fecha:j.value});a.status===200?(c("success",a.data.message),I()):c("error",a.data.error||"Error al refolear ventas normales")}catch(a){console.error("Error al refolear ventas normales:",a),c("error",((e=(r=a.response)==null?void 0:r.data)==null?void 0:e.error)||"Error al refolear ventas normales")}finally{R.value=!1}},pt=async()=>{var r,e;try{B.value=!0;const a=await axios.post("/ventas/renumerar-folios",{sucursal_id:h.value,fecha:j.value});a.status===200?(c("success",a.data.message),I()):c("error",a.data.error||"Error al renumerar folios")}catch(a){console.error("Error al renumerar folios:",a),c("error",((e=(r=a.response)==null?void 0:r.data)==null?void 0:e.error)||"Error al renumerar folios")}finally{B.value=!1}};return(r,e)=>{var a,n,m,w,C;return i(),u(D,null,[t("div",kt,[t("div",Ct,[t("div",St,[e[76]||(e[76]=t("h1",{class:"text-3xl font-bold mb-6 text-center"},"Gestor de Ventas",-1)),t("div",Vt,[t("div",Ft,[e[23]||(e[23]=t("label",{for:"filter",class:"font-bold"},"Filtrar por:",-1)),t("div",Et,[x(t("select",{class:"ml-1 py-0 rounded",id:"filter","onUpdate:modelValue":e[0]||(e[0]=s=>N.value=s)},e[21]||(e[21]=[t("option",{value:"day"},"Día",-1),t("option",{value:"week"},"Semana",-1),t("option",{value:"month"},"Mes",-1)]),512),[[$,N.value]]),N.value==="day"?x((i(),u("input",{key:0,class:"w-fit h-fit p-1 rounded",id:"valueSelect",type:"date","onUpdate:modelValue":e[1]||(e[1]=s=>j.value=s)},null,512)),[[V,j.value]]):y("",!0),N.value==="week"?x((i(),u("input",{key:1,class:"w-fit h-fit p-1 rounded",id:"valueSelect",type:"week","onUpdate:modelValue":e[2]||(e[2]=s=>oe.value=s)},null,512)),[[V,oe.value]]):y("",!0),N.value==="month"?x((i(),u("input",{key:2,class:"w-fit h-fit p-1 rounded",id:"valueSelect",type:"month","onUpdate:modelValue":e[3]||(e[3]=s=>se.value=s)},null,512)),[[V,se.value]]):y("",!0)]),t("div",$t,[e[22]||(e[22]=t("label",{for:"sucursal",class:"font-bold"},"Sucursal: ",-1)),x(t("select",{class:"ml-1 py-0 rounded",id:"sucursal","onUpdate:modelValue":e[4]||(e[4]=s=>h.value=s)},[(i(!0),u(D,null,T(M(o).sucursales,s=>(i(),u("option",{key:s.id,value:s.id},d(s.nombre),9,Dt))),128))],512),[[$,h.value]])]),e[24]||(e[24]=t("div",{class:"text-xs text-gray-600 text-center mt-1 no-print"},' Seleccione los filtros y haga clic en "Aplicar Filtro" ',-1)),t("div",Nt,[t("button",{disabled:!h.value,class:S([[h.value?"bg-orange-500 hover:bg-orange-600":"bg-gray-400 cursor-not-allowed"],"no-print text-sm rounded-lg shadow-lg px-3 py-2 bg-orange-500 text-white hover:bg-orange-600"]),onClick:I},"Aplicar Filtro",10,Pt),t("button",{disabled:!h.value,class:S([[h.value?"bg-gray-500 hover:bg-gray-600":"bg-gray-400 cursor-not-allowed"],"no-print text-sm rounded-lg shadow-lg px-3 py-2 bg-gray-500 text-white hover:bg-gray-600"]),onClick:Ye},"Limpiar Filtro",10,Tt)])])]),X.value?(i(),u("div",jt,d(X.value),1)):y("",!0),Je.value&&r.$page.props.user.roles[0]!=="supervisor"?(i(),u("div",It,[e[25]||(e[25]=t("label",{for:"initialCash",class:"block text-sm font-medium text-gray-700"},"Cantidad Inicial en Caja",-1)),t("div",At,[x(t("input",{type:"number",id:"initialCash","onUpdate:modelValue":e[5]||(e[5]=s=>z.value=s),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",min:"0",step:"0.01",placeholder:"Ingrese cantidad"},null,512),[[V,z.value]]),t("button",{onClick:Ze,class:S(["px-4 py-2 rounded-md",q.value?"bg-gray-500 text-gray-300":"text-white hover:bg-orange-600 bg-orange-500",ve.value?"cursor-not-allowed bg-gray-500 text-gray-300":""]),disabled:q.value||ve.value},d(q.value?"Guardando...":"Guardar"),11,Mt)]),e[26]||(e[26]=t("label",{for:"finalCash",class:"block text-sm font-medium text-gray-700 mt-4"},"Cantidad Final en Caja",-1)),t("div",Ut,[x(t("input",{type:"number",id:"finalCash","onUpdate:modelValue":e[6]||(e[6]=s=>H.value=s),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",min:"0",step:"0.01",placeholder:"Ingrese cantidad"},null,512),[[V,H.value]]),t("button",{onClick:Ke,class:S(["px-4 py-2 rounded-md",O.value?"bg-gray-500 text-gray-300":"text-white hover:bg-orange-600 bg-orange-500",ie.value?"cursor-not-allowed bg-gray-500 text-gray-300":""]),disabled:O.value||ie.value},d(O.value?"Guardando...":"Guardar"),11,zt)]),ie.value&&!O.value&&!Y.value?(i(),u("button",{key:0,onClick:lt,class:S(["mt-4 w-full px-4 py-2 rounded-md text-white",Y.value?"bg-gray-500":"hover:bg-green-600 bg-green-500"]),disabled:Y.value},d(Y.value?"Abriendo nuevo corte...":"Abrir nuevo corte"),11,Ht)):y("",!0)])):y("",!0),t("div",Ot,[e[37]||(e[37]=t("h2",{class:"text-xl font-semibold mb-4"},"Resumen Financiero",-1)),t("div",Rt,[M(o).cortes&&((a=M(o).cortes)==null?void 0:a.length)>0?(i(),u("div",Bt,[e[27]||(e[27]=t("h3",{class:"text-lg font-semibold mb-2"},"Cortes del día",-1)),t("div",Lt,[(i(!0),u(D,null,T(M(o).cortes,(s,l)=>(i(),u("div",{key:s.id,class:"bg-white p-3 rounded shadow"},[t("h4",Gt,"Corte #"+d(l+1),1),t("p",Jt,"Inicial: $"+d(P(s.dinero_inicio||0)),1),t("p",qt,"Final: $"+d(P(s.dinero_final||0)),1),t("p",Yt,"Hora inicio: "+d(K(s.created_at)),1),t("p",Qt,"Hora fin: "+d(K(s.updated_at)),1)]))),128))]),t("button",{class:"no-print mt-2 text-sm rounded-lg shadow-lg px-3 py-2 bg-gray-500 text-white hover:bg-gray-600 mb-4",onClick:Xe}," Restablecer Selección ")])):y("",!0),N.value==="day"?(i(),u("div",Wt,[e[28]||(e[28]=t("p",{class:"text-sm text-gray-600"},"Dinero inicial:",-1)),t("p",Xt,"$"+d(P(z.value)),1)])):y("",!0),N.value==="day"?(i(),u("div",Zt,[e[29]||(e[29]=t("p",{class:"text-sm text-gray-600"},"Dinero final:",-1)),t("p",Kt,"$"+d(P(H.value)),1)])):y("",!0),t("div",null,[e[30]||(e[30]=t("p",{class:"text-sm text-gray-600"},"Efectivo:",-1)),t("p",ea,"$"+d(P(re.value)),1)]),t("div",null,[e[31]||(e[31]=t("p",{class:"text-sm text-gray-600"},"Tarjetas:",-1)),t("p",ta,"$"+d(le.value),1)]),t("div",null,[e[32]||(e[32]=t("p",{class:"text-sm text-gray-600"},[U("Efectivo Totales "),t("small",{class:"text-xs text-gray-500 capitalize"},"(eliminados y no visibles)"),U(":")],-1)),t("p",aa,"$"+d(P(Fe.value)),1)]),t("div",null,[e[33]||(e[33]=t("p",{class:"text-sm text-gray-600"},[U("Tarjetas Totales "),t("small",{class:"text-xs text-gray-500 capitalize"},"(eliminados y no visibles)"),U(":")],-1)),t("p",oa,"$"+d(P(Ee.value)),1)]),t("div",null,[e[34]||(e[34]=t("p",{class:"text-sm text-gray-600"},"Total ventas (Efectivo + Tarjetas):",-1)),t("p",sa,"$"+d(Number(re.value)+Number(le.value)),1)]),t("div",null,[e[35]||(e[35]=t("p",{class:"text-sm text-gray-600"},"Gastos:",-1)),t("p",ra,"$"+d(pe.value),1)]),t("div",null,[e[36]||(e[36]=t("p",{class:"text-sm text-gray-600"},"Total menos gastos:",-1)),t("p",la,"$"+d(Number(re.value)+Number(le.value)-Number(pe.value)),1)])])]),t("div",na,[t("div",ia,[e[42]||(e[42]=t("h2",{class:"text-xl font-semibold mb-4"},"Ventas",-1)),t("div",ua,[t("button",{onClick:tt,disabled:!h.value,class:S(["no-print size-fit py-1 px-3 rounded-md text-white",h.value?"hover:bg-green-600 bg-green-500":"bg-gray-400 cursor-not-allowed"]),title:h.value?"":"Seleccione una sucursal primero"}," + Nueva Venta ",10,da),t("button",{onClick:ct,disabled:!h.value||R.value,class:S(["no-print size-fit py-1 px-3 rounded-md text-white",h.value&&!R.value?"hover:bg-blue-600 bg-blue-500":"bg-gray-400 cursor-not-allowed"]),title:h.value?R.value?"Refolio en progreso":"":"Seleccione una sucursal primero","aria-label":R.value?"Refolio en progreso":""},[R.value?(i(),u("span",pa,e[38]||(e[38]=[t("svg",{class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):y("",!0),e[39]||(e[39]=U(" Refolio ventas normales "))],10,ca),t("button",{onClick:pt,disabled:!h.value||B.value,class:S(["no-print size-fit py-1 px-3 rounded-md text-white",h.value&&!B.value?"hover:bg-indigo-600 bg-indigo-500":"bg-gray-400 cursor-not-allowed"]),title:h.value?B.value?"Renumeración en progreso":"":"Seleccione una sucursal primero","aria-label":B.value?"Renumeración en progreso":""},[B.value?(i(),u("span",ga,e[40]||(e[40]=[t("svg",{class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):y("",!0),e[41]||(e[41]=U(" Renumerar folios "))],10,va),t("button",{onClick:Qe,class:"no-print size-fit py-1 px-2 rounded-md text-white hover:bg-purple-600 bg-purple-500"}," Imprimir ")])]),t("div",ma,[t("div",fa,[e[55]||(e[55]=t("h3",{class:"text-lg font-semibold mb-3"},"Filtros de Búsqueda",-1)),t("div",xa,[t("div",null,[e[43]||(e[43]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"ID Venta",-1)),x(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=s=>v.value.idVenta=s),placeholder:"Buscar por ID...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},null,512),[[V,v.value.idVenta]])]),t("div",null,[e[44]||(e[44]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Creado por",-1)),x(t("input",{type:"text","onUpdate:modelValue":e[8]||(e[8]=s=>v.value.creadoPor=s),placeholder:"Buscar por nombre...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},null,512),[[V,v.value.creadoPor]])]),t("div",null,[e[46]||(e[46]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Método de Pago",-1)),x(t("select",{"onUpdate:modelValue":e[9]||(e[9]=s=>v.value.metodoPago=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},e[45]||(e[45]=[t("option",{value:""},"Todos",-1),t("option",{value:"efectivo"},"Efectivo",-1),t("option",{value:"tarjeta"},"Tarjeta",-1)]),512),[[$,v.value.metodoPago]])]),t("div",null,[e[48]||(e[48]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Factura",-1)),x(t("select",{"onUpdate:modelValue":e[10]||(e[10]=s=>v.value.factura=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},e[47]||(e[47]=[t("option",{value:""},"Todos",-1),t("option",{value:"true"},"Facturado",-1),t("option",{value:"false"},"No facturado",-1)]),512),[[$,v.value.factura]])]),t("div",null,[e[49]||(e[49]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Rango de Precio",-1)),t("div",ya,[x(t("input",{type:"number","onUpdate:modelValue":e[11]||(e[11]=s=>v.value.precioMin=s),placeholder:"Min",class:"w-1/2 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},null,512),[[V,v.value.precioMin]]),x(t("input",{type:"number","onUpdate:modelValue":e[12]||(e[12]=s=>v.value.precioMax=s),placeholder:"Max",class:"w-1/2 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},null,512),[[V,v.value.precioMax]])])]),t("div",null,[e[50]||(e[50]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Producto",-1)),x(t("input",{type:"text","onUpdate:modelValue":e[13]||(e[13]=s=>v.value.producto=s),placeholder:"Buscar por producto...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},null,512),[[V,v.value.producto]])]),t("div",null,[e[52]||(e[52]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Solo con Folio",-1)),x(t("select",{"onUpdate:modelValue":e[14]||(e[14]=s=>v.value.soloConFolio=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},e[51]||(e[51]=[t("option",{value:""},"Todas las ventas",-1),t("option",{value:"true"},"Solo con folio",-1),t("option",{value:"false"},"Sin folio",-1)]),512),[[$,v.value.soloConFolio]])]),t("div",null,[e[54]||(e[54]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tarjeta + Factura",-1)),x(t("select",{"onUpdate:modelValue":e[15]||(e[15]=s=>v.value.tarjetaConFactura=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},e[53]||(e[53]=[t("option",{value:""},"Todas las ventas",-1),t("option",{value:"true"},"Solo tarjeta + factura",-1)]),512),[[$,v.value.tarjetaConFactura]])]),t("div",{class:"flex items-end"},[t("div",{class:"flex gap-2 w-full"},[t("button",{onClick:We,class:"flex-1 bg-orange-500 text-white px-4 py-2 rounded-md hover:bg-orange-600 transition-colors"}," Aplicar Filtros "),t("button",{onClick:fe,class:"flex-1 bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition-colors"}," Limpiar ")])])])])]),((n=k.value)==null?void 0:n.length)<=0?(i(),u("div",ba,[t("div",_a,[e[59]||(e[59]=t("svg",{class:"mx-auto h-12 w-12 text-gray-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),e[60]||(e[60]=t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No hay datos disponibles",-1)),t("p",ha,d($e.value?"No se encontraron ventas con los filtros aplicados.":"No se han vendido productos en este período."),1),$e.value?(i(),u("div",wa,[t("button",{onClick:fe,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500"}," Limpiar Filtros ")])):(m=M(o))!=null&&m.sucursal_id?!((w=M(o))!=null&&w.ventas)||M(o).ventas.length===0?(i(),u("div",Ca,e[57]||(e[57]=[t("p",{class:"text-sm text-gray-400"}," No hay ventas registradas para la sucursal y período seleccionados. ",-1)]))):(i(),u("div",Sa,e[58]||(e[58]=[t("p",{class:"text-sm text-gray-400"}," No se encontraron ventas que coincidan con los criterios de búsqueda. ",-1)]))):(i(),u("div",ka,e[56]||(e[56]=[t("p",{class:"text-sm text-gray-400"}," Seleccione una sucursal para ver las ventas disponibles. ",-1)])))])])):(i(),u("div",Va,[(i(!0),u(D,null,T(k.value,s=>(i(),u("div",{key:s.id,class:"mb-8"},[t("div",Fa,[t("h3",Ea,[U(" Corte #"+d(s.id)+" ",1),t("span",$a," ("+d(K(s.created_at))+" - "+d(K(s.updated_at))+") ",1)]),t("div",Da,[t("div",null,[e[61]||(e[61]=t("p",{class:"text-sm text-gray-600"},"Efectivo:",-1)),t("p",Na,"$"+d(P(me(s.ventas).efectivo)),1)]),t("div",null,[e[62]||(e[62]=t("p",{class:"text-sm text-gray-600"},"Tarjetas:",-1)),t("p",Pa,"$"+d(P(me(s.ventas).tarjeta)),1)]),t("div",null,[e[63]||(e[63]=t("p",{class:"text-sm text-gray-600"},"Total:",-1)),t("p",Ta,"$"+d(P(me(s.ventas).total)),1)])])]),t("div",ja,[t("table",Ia,[t("thead",Aa,[t("tr",null,[e[64]||(e[64]=t("th",{class:"px-6 py-3 w-full text-left text-xs font-medium text-gray-500 uppercase tracking-wider no-print"}," Visible ",-1)),(i(),u(D,null,T(Ge,l=>t("th",{key:l,class:"px-6 py-3 w-full text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},d(l),1)),64)),e[65]||(e[65]=t("th",{class:"px-6 py-3 w-full text-left text-xs font-medium text-gray-500 uppercase tracking-wider no-print"}," Estado ",-1)),e[66]||(e[66]=t("th",{class:"px-6 py-3 w-full text-left text-xs font-medium text-gray-500 uppercase tracking-wider no-print"}," Acciones ",-1))])]),t("tbody",Ma,[s.ventas.length===0?(i(),u("tr",Ua,e[67]||(e[67]=[t("td",{colspan:"10",class:"text-center text-gray-500 py-8"},[t("div",{class:"flex flex-col items-center"},[t("svg",{class:"h-8 w-8 text-gray-400 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})]),t("span",{class:"text-sm font-medium text-gray-900"},"No hay ventas en este corte"),t("span",{class:"text-xs text-gray-500"},"Este corte no registró ninguna venta")])],-1)]))):(i(!0),u(D,{key:1},T(s.ventas,l=>{var f,E,de,te,ae;return i(),u("tr",{key:l.id,class:S(["divide-y divide-gray-200",l.estado==="editada"?"bg-yellow-100":l.estado==="creada"?"bg-green-100":"odd:bg-white even:bg-gray-100",l.estado==="eliminada"?"bg-red-100 opacity-50 p-0 no-print":"",l.visible?"":"no-print"])},[t("td",{class:S([l.estado==="eliminada"?"p-0 m-0":"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 text-center no-print"])},[l.estado==="eliminada"?(i(),u("span",za,e[68]||(e[68]=[t("span",{class:"text-xs text-center text-gray-500 italic"}," Eliminado ",-1)]))):(i(),u("div",Ha,[x(t("input",{type:"checkbox","onUpdate:modelValue":b=>l.visible=b,class:"w-5 h-5",onChange:b=>dt(l.id,l.visible)},null,40,Oa),[[mt,l.visible]]),U(" "+d(l.visible?"Visible":"No visible"),1)]))],2),t("td",{class:S([l.estado==="eliminada"?"p-0 m-0":"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 text-center"])},[t("div",Ra,[l.estado==="eliminada"?(i(),u("span",Ba,e[69]||(e[69]=[t("span",{class:"text-xs text-gray-500 italic"}," Eliminado ",-1)]))):(i(),u("span",La,d(l.folio?l.folio:"-"),1))])],2),t("td",Ga,[l.estado==="eliminada"?(i(),u("span",Ja,e[70]||(e[70]=[t("span",{class:"text-xs text-gray-500 italic"}," Eliminado ",-1)]))):(i(),u("span",qa,d(l.idVentaDia||"-"),1))]),t("td",Ya,[l.estado==="eliminada"?(i(),u("span",Qa," Eliminado ")):(i(),u("span",Wa,d(`${(f=l==null?void 0:l.usuario)==null?void 0:f.name}
                              ${(E=l==null?void 0:l.usuario)!=null&&E.apellido_p?(de=l==null?void 0:l.usuario)==null?void 0:de.apellido_p:""}
                              ${(te=l==null?void 0:l.usuario)!=null&&te.apellido_m?(ae=l==null?void 0:l.usuario)==null?void 0:ae.apellido_m:""}`),1))]),t("td",Xa,[l.estado==="eliminada"?(i(),u("span",Za,e[71]||(e[71]=[t("span",{class:"text-xs text-gray-500 italic"}," Eliminado ",-1)]))):(i(),u("span",Ka,d(K(l.created_at)),1))]),t("td",eo,[l.estado!=="eliminada"?(i(),u("div",to,[(i(!0),u(D,null,T(l.detalles,b=>{var Ue,ze;return i(),u("div",{key:b.id,class:"flex justify-between"},[t("span",null,d(b.cantidad)+" × "+d(((Ue=b.producto)==null?void 0:Ue.nombre)||"Producto desconocido"),1),t("span",{class:S(["font-semibold",!(b!=null&&b.cantidadEditado)||(b==null?void 0:b.cantidadEditado)===(b==null?void 0:b.cantidad)?"text-gray-700":"text-red-700"])}," $"+d((((ze=b.producto)==null?void 0:ze.precio)??0)*(b.cantidad??0)),3)])}),128))])):y("",!0),l.estado==="eliminada"?(i(),u("div",ao,e[72]||(e[72]=[t("span",{class:"text-xs text-gray-500 italic"}," Eliminado ",-1)]))):y("",!0)]),t("td",oo,[l.estado==="eliminada"?(i(),u("span",so,e[73]||(e[73]=[t("span",{class:"text-xs text-gray-500 italic"}," Eliminado ",-1)]))):(i(),u("span",{key:1,class:S([[l.metodo_pago=="tarjeta"?"bg-yellow-500":"bg-green-500"],"px-2 py-1 rounded-md text-white"])},d(l.metodo_pago),3))]),t("td",ro,[l.estado==="eliminada"?(i(),u("span",lo,e[74]||(e[74]=[t("span",{class:"text-xs text-gray-500 italic"}," Eliminado ",-1)]))):(i(),u("span",{key:1,class:S([[l.factura==!0?"bg-blue-500":"bg-red-500"],"px-2 py-1 rounded-md text-white whitespace-nowrap capitalize"])},d(l.factura?"Facturado":"No facturado"),3))]),t("td",no,[l.estado==="eliminada"?(i(),u("span",io,e[75]||(e[75]=[t("span",{class:"text-xs text-gray-500 italic"}," Eliminado ",-1)]))):(i(),u("span",uo,"$"+d(l.total),1))]),t("td",co,[t("div",po,d(l.estado),1)]),t("td",vo,[t("div",go,[l.estado!=="eliminada"&&l.visible!==!1?(i(),u("button",{key:0,onClick:b=>et(l.id),class:"text-white rounded-md px-2 py-1 bg-orange-500 hover:bg-orange-700"}," Editar ",8,mo)):y("",!0),l.estado!=="eliminada"&&l.visible!==!1?(i(),u("button",{key:1,onClick:b=>it(l.id),class:"text-white rounded-md px-2 py-1 bg-red-500 hover:bg-red-700"}," Eliminar ",8,fo)):y("",!0),t("div",xo,[l.estado==="eliminada"?(i(),u("span",yo," Eliminado ")):y("",!0),l.visible===!1?(i(),u("span",bo," No visible ")):y("",!0),l.estado==="eliminada"?(i(),u("button",{key:2,onClick:b=>ut(l.id),class:"text-white rounded-md px-2 py-1 bg-green-500 hover:bg-green-700 text-xs"}," Restaurar ",8,_o)):y("",!0)])])])],2)}),128))])])])]))),128))]))]),G.value?(i(),u("div",ho,"Cargando...")):y("",!0)])])]),ce(yt,{registrosInventario:De.value},null,8,["registrosInventario"]),ce(bt,{gastos:Ve.value},null,8,["gastos"]),W.value&&W.value.length>0?(i(),He(_t,{key:0,cantidadDeCortes:ke.value,sobrantes:W.value,categoriasInventario:Ce.value,sobrantesInventario:we.value},null,8,["cantidadDeCortes","sobrantes","categoriasInventario","sobrantesInventario"])):y("",!0),ce(ht,{ventasProductos:Se.value,inventario:ne.value},null,8,["ventasProductos","inventario"]),ee.value||A.value?(i(),u("div",wo,[t("div",ko,[t("div",Co,[t("h2",So,d(A.value?"Crear Nueva Venta":"Editar Venta"),1),t("button",{onClick:ye,class:"text-gray-500 hover:text-gray-700 text-2xl"},"×")]),t("div",Vo,[t("div",Fo,[e[86]||(e[86]=t("h3",{class:"text-lg font-semibold text-gray-700"},"Información de la Venta",-1)),t("div",null,[e[77]||(e[77]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha y Hora de Venta",-1)),x(t("input",{type:"datetime-local","onUpdate:modelValue":e[16]||(e[16]=s=>g.value.fechaHora=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},null,512),[[V,g.value.fechaHora]])]),t("div",null,[e[79]||(e[79]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Vendido por",-1)),x(t("select",{"onUpdate:modelValue":e[17]||(e[17]=s=>g.value.usuario_id=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},[e[78]||(e[78]=t("option",{value:"",selected:""},"Seleccionar usuario",-1)),(i(!0),u(D,null,T(Q.value,s=>(i(),u("option",{key:s.id,value:s.id},d(s.name)+" "+d(s.apellido_p||"")+" "+d(s.apellido_m||""),9,Eo))),128))],512),[[$,g.value.usuario_id]])]),ee.value?(i(),u("div",$o,[e[80]||(e[80]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Sucursal",-1)),x(t("select",{"onUpdate:modelValue":e[18]||(e[18]=s=>g.value.sucursal_id=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},[(i(!0),u(D,null,T((C=M(o))==null?void 0:C.sucursales,s=>(i(),u("option",{key:s.id,value:s.id},d(s.nombre),9,Do))),128))],512),[[$,g.value.sucursal_id]]),e[81]||(e[81]=t("p",{class:"text-xs text-gray-500 mt-1"},"Puede cambiar la sucursal de la venta si es necesario",-1))])):y("",!0),t("div",null,[e[83]||(e[83]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Método de Pago",-1)),x(t("select",{"onUpdate:modelValue":e[19]||(e[19]=s=>g.value.metodo_pago=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},e[82]||(e[82]=[t("option",{value:"efectivo"},"Efectivo",-1),t("option",{value:"tarjeta"},"Tarjeta",-1)]),512),[[$,g.value.metodo_pago]])]),t("div",null,[e[85]||(e[85]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Factura",-1)),x(t("select",{"onUpdate:modelValue":e[20]||(e[20]=s=>g.value.factura=s),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},e[84]||(e[84]=[t("option",{value:!1},"No facturado",-1),t("option",{value:!0},"Facturado",-1)]),512),[[$,g.value.factura]])])]),t("div",No,[t("div",{class:"flex justify-between items-center"},[e[87]||(e[87]=t("h3",{class:"text-lg font-semibold text-gray-700"},"Productos",-1)),t("button",{onClick:Pe,class:"bg-green-500 text-white px-3 py-1 rounded-md hover:bg-green-600 text-sm"}," + Agregar Producto ")]),t("div",Po,[(i(!0),u(D,null,T(g.value.productos,(s,l)=>(i(),u("div",{key:l,class:"border border-gray-200 rounded-lg p-3"},[t("div",To,[t("span",jo,"Producto "+d(l+1),1),t("button",{onClick:f=>at(l),class:"text-red-500 hover:text-red-700 text-sm"}," × Eliminar ",8,Io)]),t("div",Ao,[x(t("select",{"onUpdate:modelValue":f=>s.producto_id=f,onChange:f=>ot(l),class:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-orange-500"},[e[88]||(e[88]=t("option",{value:""},"Seleccionar producto",-1)),(i(!0),u(D,null,T(ne.value,f=>(i(),u("option",{key:f.id,value:f.id},d(f.nombre)+" ("+d(f.detalle)+") - $"+d(f.precio),9,Uo))),128))],40,Mo),[[$,s.producto_id]])]),t("div",zo,[t("div",null,[e[89]||(e[89]=t("label",{class:"block text-xs text-gray-600 mb-1"},"Cantidad",-1)),x(t("input",{type:"number","onUpdate:modelValue":f=>s.cantidad=f,onInput:f=>xe(l),min:"1",class:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-orange-500"},null,40,Ho),[[V,s.cantidad]])]),t("div",null,[e[90]||(e[90]=t("label",{class:"block text-xs text-gray-600 mb-1"},"Precio Unit.",-1)),x(t("input",{type:"number",disabled:"","onUpdate:modelValue":f=>s.precio_unitario=f,onInput:f=>xe(l),step:"0.01",class:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-orange-500"},null,40,Oo),[[V,s.precio_unitario]])])]),t("div",Ro,[t("span",Bo,"Subtotal: $"+d(s.subtotal||0),1)])]))),128))]),t("div",Lo,[t("div",Go,[t("span",Jo,"Total: $"+d(st.value),1)])])])]),t("div",qo,[t("button",{onClick:ye,class:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600"}," Cancelar "),t("button",{onClick:rt,class:"px-4 py-2 bg-orange-500 text-white rounded-md hover:bg-orange-600"},d(A.value?"Crear Venta":"Guardar Cambios"),1)])])])):y("",!0)],64)}}},Qo={class:"py-6"},Wo={class:"max-w-9xl w-full mx-auto sm:px-6 lg:px-8 rounded-xl"},Xo={class:"overflow-scroll md:overflow-hidden rounded-xl"},os={__name:"index",setup(Oe){return(o,W)=>(i(),He(xt,{title:"Tablero principal"},{default:ft(()=>[t("div",Qo,[t("div",Wo,[t("div",Xo,[ce(Yo)])])])]),_:1}))}};export{os as default};
