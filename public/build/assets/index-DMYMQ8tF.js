import{Q as ze,d,p as Be,x as Le,o as i,e as c,a as t,t as n,j as f,l as se,v as _,f as v,n as T,u as re,F as j,h as U,g as Ae,b as ie,c as de,z as le,w as Ge}from"./app-C-gYCell.js";import{S as ne,_ as Oe}from"./AppLayout-DFrwUGZg.js";import{_ as Qe,a as Je,b as Re,c as He,r as Ye}from"./Sobrantes-BHrWDrkP.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const qe={class:"print min-h-screen py-6 flex rounded-2xl border-0 flex-col justify-center sm:py-4"},We={class:"relative py-3 w-full px-4 sm:px-0"},Xe={class:"relative px-4 py-10 bg-white shadow-lg rounded-3xl sm:p-20"},Ze={class:"text-3xl font-bold mb-6 text-center"},Ke={key:0,class:"flex flex-col md:flex-row items-center gap-4 mb-8"},et={class:"w-full gap-2 flex flex-col items-center"},tt={class:"flex gap-2"},at={key:1,class:"text-red-500 font-bold mt-2"},ot={key:2,class:"mb-6 no-print"},st={class:"flex space-x-2"},rt=["disabled"],lt={class:"flex space-x-2"},nt=["disabled"],it=["disabled"],dt={class:"bg-gray-50 p-4 rounded-lg mb-6"},ut={class:"grid grid-cols-2 gap-4"},ct={key:0,class:"col-span-2 mb-4"},pt={class:"grid grid-cols-3 gap-4"},vt={class:"font-medium"},mt={class:"text-sm text-gray-600"},gt={class:"text-sm text-gray-600"},ft={class:"text-sm text-gray-600"},xt={class:"text-sm text-gray-600"},bt={key:1},yt={class:"font-medium"},_t={key:2},ht={class:"font-medium"},wt={class:"font-medium"},Ct={class:"font-medium"},kt={class:"font-medium"},$t={class:"font-medium"},Dt={class:"font-medium"},St={class:"mb-6"},Vt={class:"mb-4 no-print"},Pt={class:"bg-gray-50 p-4 rounded-lg"},Ft={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Nt={class:"flex gap-2"},jt={key:0,class:"text-gray-500"},It={key:1},Mt={class:"bg-gray-100 p-4 rounded-lg mb-4"},Et={class:"text-lg font-semibold"},Tt={class:"text-sm text-gray-600"},Ut={class:"grid grid-cols-3 gap-4 mt-2"},zt={class:"font-medium"},Bt={class:"font-medium"},Lt={class:"font-medium"},At={class:"overflow-x-auto h-screen overflow-auto ventasR"},Gt={class:"tabla min-w-full divide-y divide-gray-200"},Ot={class:"bg-gray-50"},Qt={key:0,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Jt={key:1,class:"no-print px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},Rt={class:"bg-white divide-y divide-gray-200"},Ht={key:0,class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 text-center"},Yt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 text-center"},qt={class:"px-6 py-4 whitespace-nowrap overflow-auto text-sm text-gray-500"},Wt={class:"print"},Xt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center"},Zt={class:"px-6 py-4 text-sm text-gray-500"},Kt={class:"flex flex-col space-y-1"},ea={class:"px-6 py-4 text-sm text-gray-500 capitalize text-center"},ta={class:"px-2 w-fit py-4 text-sm text-gray-500 capitalize text-center"},aa={class:"px-6 py-4 text-sm text-gray-900 font-semibold text-right"},oa={key:1,class:"no-print px-6 py-4 text-center"},sa={class:"flex justify-center gap-2"},ra=["onClick"],la={key:3,class:"text-center text-gray-500"},na={class:"max-w-7xl mx-auto"},ia={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center"},da={class:"bg-white p-6 rounded-lg overflow-auto w-1/2 max-h-96"},ua={class:""},ca={class:"block text-sm font-medium text-gray-700"},pa=["onUpdate:modelValue"],va={class:"flex justify-end"},ma={__name:"Corte",setup(we){var be,ye,_e,he;const{props:a}=ze(),q=d(a.sobrantes||[]),ue=d(a.sobrantesInventario||[]),ce=d((a==null?void 0:a.cantidadDeCortes)||0),pe=d((a==null?void 0:a.categoriasInventario)||[]),h=d("day"),I=new Date,S=d(I.getFullYear()+"-"+String(I.getMonth()+1).padStart(2,"0")+"-"+String(I.getDate()).padStart(2,"0")),O=d(null),Q=d(null),V=d(((be=a==null?void 0:a.corte)==null?void 0:be.dinero_inicio)||0),P=d(((ye=a==null?void 0:a.corte)==null?void 0:ye.dinero_final)||0),z=d(0),B=d(0),Ce=d(a.productosVendidos||[]),J=d(!1),R=d(""),ve=d(a.ventasProductos||[]),me=d(a.inventario||[]),x=d(a.ventas||[]),ge=d(a.gastos||[]),W=d(a.totalGastos||0),X=d((a==null?void 0:a.cantidadCortes)||0),M=d(!1),F=d(!1),Z=d(!!((_e=a==null?void 0:a.corte)!=null&&_e.dinero_inicio)),H=d(!!((he=a==null?void 0:a.corte)!=null&&he.dinero_final)),E=d(!1),ke=["ID Venta","Creado por","Hora","Productos vendidos","Metodo de pago","Factura","Total"],$e=Be(()=>{const o=new Date,e=o.getFullYear()+"-"+String(o.getMonth()+1).padStart(2,"0")+"-"+String(o.getDate()).padStart(2,"0");return h.value==="day"&&S.value===e}),L=o=>{if(!o)return"-";const e=new Date(o);return isNaN(e.getTime())?"-":e.toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:"America/Mexico_City"})},k=d([]),K=()=>{var e,s;if(k.value=[],!x.value||((e=x.value)==null?void 0:e.length)===0)return;if(!a.cortes||((s=a.cortes)==null?void 0:s.length)===0){k.value=[{id:1,ventas:x.value,created_at:null,updated_at:null}];return}const o=[...a.cortes].sort((u,r)=>new Date(u.created_at)-new Date(r.created_at));o.forEach((u,r)=>{const l=u.updated_at?new Date(u.updated_at):null,w=r>0?o[r-1]:null,D=w!=null&&w.updated_at?new Date(w.updated_at):null;let C=[];r===0?C=x.value.filter(b=>new Date(b.created_at)<=(l||new Date)):l?C=x.value.filter(b=>{const y=new Date(b.created_at);return y>D&&y<=l}):C=x.value.filter(b=>new Date(b.created_at)>D),k.value.push({id:u.id,ventas:C,created_at:u.created_at,updated_at:u.updated_at,dinero_inicio:u.dinero_inicio,dinero_final:u.dinero_final})})},ee=o=>({efectivo:o.reduce((e,s)=>s.metodo_pago==="efectivo"?e+Number(s.total):e,0),tarjeta:o.reduce((e,s)=>s.metodo_pago==="tarjeta"?e+Number(s.total):e,0),total:o.reduce((e,s)=>e+Number(s.total),0)}),fe=d((a==null?void 0:a.registrosInventario)||[]),te=()=>{J.value=!0,R.value="";let o=h.value,e=null;o==="day"?e=S.value:o==="week"?e=O.value:o==="month"&&(e=Q.value),le.post("/corte-caja",{filter:o,value:e},{preserveScroll:!0,onSuccess(s){var u;z.value=s.props.cashPayments||0,B.value=s.props.cardPayments||0,Ce.value=s.props.productsUsed||[],x.value=s.props.ventas||[],V.value=s.props.initialCash||0,P.value=s.props.finalCash||0,J.value=!1,ve.value=s.props.ventasProductos||[],me.value=s.props.inventario||[],fe.value=s.props.registrosInventario||[],ge.value=s.props.gastos||[],W.value=s.props.totalGastos||0,a.cortes=s.props.cortes||[],X.value=((u=s==null?void 0:s.props)==null?void 0:u.cantidadCortes)||0,q.value=s.props.sobrantes||[],ue.value=s.props.sobrantesInventario||[],ce.value=s.props.cantidadDeCortes||0,pe.value=s.props.categoriasInventario||[],console.log("Datos actualizados:",s.props),g("success","Filtro actualizado correctamente"),ae(),K(),N.value=[]},onError(s){g("error",s.props.flash.error||"Error al obtener datos con este filtro"),R.value="Ocurrió un error al obtener los datos. Inténtalo de nuevo.",J.value=!1}})},De=()=>{h.value="day",S.value=I.getFullYear()+"-"+String(I.getMonth()+1).padStart(2,"0")+"-"+String(I.getDate()).padStart(2,"0"),O.value=null,Q.value=null,te()},Se=()=>{window.print()},ae=()=>{const o=x.value||(a==null?void 0:a.ventas)||[];z.value=o.reduce((e,s)=>s.metodo_pago==="efectivo"?Number(e)+Number(s.total||0):Number(e),0),B.value=o.reduce((e,s)=>s.metodo_pago==="tarjeta"?Number(e)+Number(s.total||0):Number(e),0)},Ve=d(null),p=d({idVenta:"",creadoPor:"",metodoPago:"",factura:"",precioMin:"",precioMax:"",producto:""}),N=d([]),Pe=()=>{(!N.value||N.value.length===0)&&(N.value=JSON.parse(JSON.stringify(k.value)));const o=N.value.map(e=>{const s=e.ventas.filter(u=>{var r,l,w,D,C,b;if(p.value.idVenta&&!((r=u.idVentaDia)!=null&&r.toString().includes(p.value.idVenta))&&!((l=u.id)!=null&&l.toString().includes(p.value.idVenta))||p.value.creadoPor&&!`${((w=u==null?void 0:u.usuario)==null?void 0:w.name)||""} ${((D=u==null?void 0:u.usuario)==null?void 0:D.apellido_p)||""} ${((C=u==null?void 0:u.usuario)==null?void 0:C.apellido_m)||""}`.toLowerCase().includes(p.value.creadoPor.toLowerCase())||p.value.metodoPago&&u.metodo_pago!==p.value.metodoPago)return!1;if(p.value.factura!==""){const y=p.value.factura==="true";if(!!u.factura!==y)return!1}return!(p.value.precioMin&&Number(u.total)<Number(p.value.precioMin)||p.value.precioMax&&Number(u.total)>Number(p.value.precioMax)||p.value.producto&&!((b=u.detalles)==null?void 0:b.some(m=>{var A,G;return(G=(A=m.producto)==null?void 0:A.nombre)==null?void 0:G.toLowerCase().includes(p.value.producto.toLowerCase())})))});return{...e,ventas:s}});k.value=o.filter(e=>e.ventas.length>0)},Fe=()=>{p.value={idVenta:"",creadoPor:"",metodoPago:"",factura:"",precioMin:"",precioMax:"",producto:""},N.value=[],K()},Ne=()=>{Ve.value=null,x.value=a.ventas,ae()},g=(o,e)=>{ne.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,customClass:"no-print",didOpen:s=>{s.addEventListener("mouseenter",ne.stopTimer),s.addEventListener("mouseleave",ne.resumeTimer)}}).fire({icon:o,title:e})},je=()=>{const o={sucursal_id:a==null?void 0:a.sucursal_id,usuario_id:a==null?void 0:a.usuario_id,fecha:S.value,dinero_inicio:V.value};M.value=!0;try{le.post(Ye("corte-caja.guardar-inicial"),o,{preserveScroll:!0,onSuccess:e=>{e.props.flash.success?(e.props.corte&&(V.value=e.props.corte.dinero_inicio,Z.value=!0),g("success",e.props.flash.success)):g("error",e.props.flash.error),M.value=!1}})}catch(e){g("error",e.error||"Error al guardar la cantidad inicial"),M.value=!1}},Ie=()=>{const o={sucursal_id:a==null?void 0:a.sucursal_id,usuario_id:a==null?void 0:a.usuario_id,fecha:S.value,dinero_final:P.value};F.value=!0;try{le.post("/corte-caja/guardar-final",o,{preserveScroll:!0,onSuccess:e=>{e.props.flash.success?(e.props.corte&&(P.value=e.props.corte.dinero_final,H.value=!0),g("success",e.props.flash.success)):g("error",e.props.flash.error),F.value=!1}})}catch(e){g("error",e.error||"Error al guardar la cantidad final"),F.value=!1}};Le(()=>{a.ventas&&Array.isArray(a.ventas)&&(x.value=a.ventas),ae(),K(),N.value=JSON.parse(JSON.stringify(k.value))});const $=o=>parseFloat(o).toFixed(2),Y=d(!1),oe=d([]),xe=d(null),Me=o=>{const e=x.value.find(s=>s.id===o);oe.value=e.detalles.map(s=>({id:s.producto.id,nombre:s.producto.nombre,cantidad:s.cantidad,oldQuantity:s.producto.cantidad,precio:s.producto.precio})),xe.value=o,Y.value=!0},Ee=async()=>{const o={venta_id:xe.value,productos:oe.value.map(e=>({id:e.id,ticketQuantity:e.cantidad,oldQuantity:e.oldQuantity}))};console.log(o);try{const e=await axios.post("/ventas/editar",o);e.status===200?(g("success","Venta actualizada correctamente"),te(),Y.value=!1):g("error",e.data.error||"Error al actualizar la venta")}catch(e){console.error("Error al actualizar venta:",e),e.response&&e.response.data?g("error",e.response.data.error||"Error al actualizar la venta"):g("error","Error al actualizar la venta")}},Te=async()=>{E.value=!0;try{const o=await axios.post("/corte-caja/crear-corte",{dinero_inicio:0});console.log(o),o.status===200?(g("success","Nuevo corte creado correctamente"),console.log(o),V.value=0,P.value=0,window.location.reload()):(console.log(o),g("error",o.data.error||"Error al crear nuevo corte"))}catch(o){console.log(o),g("error",o.response||"Error al crear nuevo corte")}finally{E.value=!1}},Ue=()=>{Y.value=!1};return(o,e)=>{var s,u;return i(),c(j,null,[t("div",qe,[t("div",We,[t("div",Xe,[t("h1",Ze,"Corte de Caja "+n(X.value?X.value:1),1),o.$page.props.user.roles[0]!="trabajador"?(i(),c("div",Ke,[t("div",et,[e[14]||(e[14]=t("label",{for:"filter",class:"font-bold"},"Filtrar por:",-1)),t("div",tt,[f(t("select",{class:"ml-1 py-0 rounded",id:"filter","onUpdate:modelValue":e[0]||(e[0]=r=>h.value=r)},e[13]||(e[13]=[t("option",{value:"day"},"Día",-1),t("option",{value:"week"},"Semana",-1),t("option",{value:"month"},"Mes",-1)]),512),[[se,h.value]]),h.value==="day"?f((i(),c("input",{key:0,class:"w-fit h-fit p-1 rounded",id:"valueSelect",type:"date","onUpdate:modelValue":e[1]||(e[1]=r=>S.value=r)},null,512)),[[_,S.value]]):v("",!0),h.value==="week"?f((i(),c("input",{key:1,class:"w-fit h-fit p-1 rounded",id:"valueSelect",type:"week","onUpdate:modelValue":e[2]||(e[2]=r=>O.value=r)},null,512)),[[_,O.value]]):v("",!0),h.value==="month"?f((i(),c("input",{key:2,class:"w-fit h-fit p-1 rounded",id:"valueSelect",type:"month","onUpdate:modelValue":e[3]||(e[3]=r=>Q.value=r)},null,512)),[[_,Q.value]]):v("",!0)]),t("div",{class:"flex gap-1"},[t("button",{class:"no-print text-sm rounded-lg shadow-lg px-3 py-2 bg-orange-500 text-white hover:bg-orange-600",onClick:te},"Aplicar Filtro"),t("button",{class:"no-print text-sm rounded-lg shadow-lg px-3 py-2 bg-gray-500 text-white hover:bg-gray-600",onClick:De},"Limpiar Filtro")])])])):v("",!0),R.value?(i(),c("div",at,n(R.value),1)):v("",!0),$e.value&&o.$page.props.user.roles[0]!=="supervisor"?(i(),c("div",ot,[e[15]||(e[15]=t("label",{for:"initialCash",class:"block text-sm font-medium text-gray-700"},"Cantidad Inicial en Caja",-1)),t("div",st,[f(t("input",{type:"number",id:"initialCash","onUpdate:modelValue":e[4]||(e[4]=r=>V.value=r),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",min:"0",step:"0.01",placeholder:"Ingrese cantidad"},null,512),[[_,V.value]]),t("button",{onClick:je,class:T(["px-4 py-2 rounded-md",M.value?"bg-gray-500 text-gray-300":"text-white hover:bg-orange-600 bg-orange-500",Z.value?"cursor-not-allowed bg-gray-500 text-gray-300":""]),disabled:M.value||Z.value},n(M.value?"Guardando...":"Guardar"),11,rt)]),e[16]||(e[16]=t("label",{for:"finalCash",class:"block text-sm font-medium text-gray-700 mt-4"},"Cantidad Final en Caja",-1)),t("div",lt,[f(t("input",{type:"number",id:"finalCash","onUpdate:modelValue":e[5]||(e[5]=r=>P.value=r),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",min:"0",step:"0.01",placeholder:"Ingrese cantidad"},null,512),[[_,P.value]]),t("button",{onClick:Ie,class:T(["px-4 py-2 rounded-md",F.value?"bg-gray-500 text-gray-300":"text-white hover:bg-orange-600 bg-orange-500",H.value?"cursor-not-allowed bg-gray-500 text-gray-300":""]),disabled:F.value||H.value},n(F.value?"Guardando...":"Guardar"),11,nt)]),H.value&&!F.value&&!E.value?(i(),c("button",{key:0,onClick:Te,class:T(["mt-4 w-full px-4 py-2 rounded-md text-white",E.value?"bg-gray-500":"hover:bg-green-600 bg-green-500"]),disabled:E.value},n(E.value?"Abriendo nuevo corte...":"Abrir nuevo corte"),11,it)):v("",!0)])):v("",!0),t("div",dt,[e[25]||(e[25]=t("h2",{class:"text-xl font-semibold mb-4"},"Resumen Financiero",-1)),t("div",ut,[re(a).cortes&&((s=re(a).cortes)==null?void 0:s.length)>0?(i(),c("div",ct,[e[17]||(e[17]=t("h3",{class:"text-lg font-semibold mb-2"},"Cortes del día",-1)),t("div",pt,[(i(!0),c(j,null,U(re(a).cortes,(r,l)=>(i(),c("div",{key:r.id,class:"bg-white p-3 rounded shadow"},[t("h4",vt,"Corte #"+n(l+1),1),t("p",mt,"Inicial: $"+n($(r.dinero_inicio||0)),1),t("p",gt,"Final: $"+n($(r.dinero_final||0)),1),t("p",ft,"Hora inicio: "+n(L(r.created_at)),1),t("p",xt,"Hora fin: "+n(L(r.updated_at)),1)]))),128))]),t("button",{class:"no-print mt-2 text-sm rounded-lg shadow-lg px-3 py-2 bg-gray-500 text-white hover:bg-gray-600 mb-4",onClick:Ne}," Restablecer Selección ")])):v("",!0),h.value==="day"?(i(),c("div",bt,[e[18]||(e[18]=t("p",{class:"text-sm text-gray-600"},"Dinero inicial:",-1)),t("p",yt,"$"+n($(V.value)),1)])):v("",!0),h.value==="day"?(i(),c("div",_t,[e[19]||(e[19]=t("p",{class:"text-sm text-gray-600"},"Dinero final:",-1)),t("p",ht,"$"+n($(P.value)),1)])):v("",!0),t("div",null,[e[20]||(e[20]=t("p",{class:"text-sm text-gray-600"},"Efectivo:",-1)),t("p",wt,"$"+n($(z.value)),1)]),t("div",null,[e[21]||(e[21]=t("p",{class:"text-sm text-gray-600"},"Tarjetas:",-1)),t("p",Ct,"$"+n(B.value),1)]),t("div",null,[e[22]||(e[22]=t("p",{class:"text-sm text-gray-600"},"Total ventas (Efectivo + Tarjetas):",-1)),t("p",kt,"$"+n(Number(z.value)+Number(B.value)),1)]),t("div",null,[e[23]||(e[23]=t("p",{class:"text-sm text-gray-600"},"Gastos:",-1)),t("p",$t,"$"+n(W.value),1)]),t("div",null,[e[24]||(e[24]=t("p",{class:"text-sm text-gray-600"},"Total menos gastos:",-1)),t("p",Dt,"$"+n(Number(z.value)+Number(B.value)-Number(W.value)),1)])])]),t("div",St,[t("div",{class:"flex justify-between"},[e[26]||(e[26]=t("h2",{class:"text-xl font-semibold mb-4"},"Ventas",-1)),t("button",{onClick:Se,class:"no-print size-fit py-1 px-2 mr-8 rounded-md text-white hover:bg-purple-600 bg-purple-500"}," Imprimir ")]),t("div",Vt,[t("div",Pt,[e[35]||(e[35]=t("h3",{class:"text-lg font-semibold mb-3"},"Filtros de Búsqueda",-1)),t("div",Ft,[t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"ID Venta",-1)),f(t("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=r=>p.value.idVenta=r),placeholder:"Buscar por ID...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},null,512),[[_,p.value.idVenta]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Creado por",-1)),f(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=r=>p.value.creadoPor=r),placeholder:"Buscar por nombre...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},null,512),[[_,p.value.creadoPor]])]),t("div",null,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Método de Pago",-1)),f(t("select",{"onUpdate:modelValue":e[8]||(e[8]=r=>p.value.metodoPago=r),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},e[29]||(e[29]=[t("option",{value:""},"Todos",-1),t("option",{value:"efectivo"},"Efectivo",-1),t("option",{value:"tarjeta"},"Tarjeta",-1)]),512),[[se,p.value.metodoPago]])]),t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Factura",-1)),f(t("select",{"onUpdate:modelValue":e[9]||(e[9]=r=>p.value.factura=r),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},e[31]||(e[31]=[t("option",{value:""},"Todos",-1),t("option",{value:"true"},"Facturado",-1),t("option",{value:"false"},"No facturado",-1)]),512),[[se,p.value.factura]])]),t("div",null,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Rango de Precio",-1)),t("div",Nt,[f(t("input",{type:"number","onUpdate:modelValue":e[10]||(e[10]=r=>p.value.precioMin=r),placeholder:"Min",class:"w-1/2 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},null,512),[[_,p.value.precioMin]]),f(t("input",{type:"number","onUpdate:modelValue":e[11]||(e[11]=r=>p.value.precioMax=r),placeholder:"Max",class:"w-1/2 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},null,512),[[_,p.value.precioMax]])])]),t("div",null,[e[34]||(e[34]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Producto",-1)),f(t("input",{type:"text","onUpdate:modelValue":e[12]||(e[12]=r=>p.value.producto=r),placeholder:"Buscar por producto...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},null,512),[[_,p.value.producto]])]),t("div",{class:"flex items-end"},[t("div",{class:"flex gap-2 w-full"},[t("button",{onClick:Pe,class:"flex-1 bg-orange-500 text-white px-4 py-2 rounded-md hover:bg-orange-600 transition-colors"}," Aplicar Filtros "),t("button",{onClick:Fe,class:"flex-1 bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition-colors"}," Limpiar ")])])])])]),((u=k.value)==null?void 0:u.length)<=0?(i(),c("div",jt," No se han vendido productos en este período. ")):(i(),c("div",It,[(i(!0),c(j,null,U(k.value,r=>(i(),c("div",{key:r.id,class:"mb-8"},[t("div",Mt,[t("h3",Et,[Ae(" Corte #"+n(r.id)+" ",1),t("span",Tt," ("+n(L(r.created_at))+" - "+n(L(r.updated_at))+") ",1)]),t("div",Ut,[t("div",null,[e[36]||(e[36]=t("p",{class:"text-sm text-gray-600"},"Efectivo:",-1)),t("p",zt,"$"+n($(ee(r.ventas).efectivo)),1)]),t("div",null,[e[37]||(e[37]=t("p",{class:"text-sm text-gray-600"},"Tarjetas:",-1)),t("p",Bt,"$"+n($(ee(r.ventas).tarjeta)),1)]),t("div",null,[e[38]||(e[38]=t("p",{class:"text-sm text-gray-600"},"Total:",-1)),t("p",Lt,"$"+n($(ee(r.ventas).total)),1)])])]),t("div",At,[t("table",Gt,[t("thead",Ot,[t("tr",null,[o.$page.props.user.roles[0]==="admin"?(i(),c("th",Qt," Folio ")):v("",!0),(i(),c(j,null,U(ke,l=>t("th",{key:l,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},n(l),1)),64)),o.$page.props.user.roles[0]!="trabajador"?(i(),c("th",Jt," Acciones ")):v("",!0)])]),t("tbody",Rt,[(i(!0),c(j,null,U(r.ventas,l=>{var w,D,C,b,y;return i(),c("tr",{class:"odd:bg-white even:bg-gray-100",key:l.id},[o.$page.props.user.roles[0]==="admin"?(i(),c("td",Ht,n(l.folio?l.folio:"-"),1)):v("",!0),t("td",Yt,n(l.idVentaDia||l.id),1),t("td",qt,[t("span",Wt,n(`${(w=l==null?void 0:l.usuario)==null?void 0:w.name}
                              ${(D=l==null?void 0:l.usuario)!=null&&D.apellido_p?(C=l==null?void 0:l.usuario)==null?void 0:C.apellido_p:""}
                              ${(b=l==null?void 0:l.usuario)!=null&&b.apellido_m?(y=l==null?void 0:l.usuario)==null?void 0:y.apellido_m:""}`),1)]),t("td",Xt,n(L(l.created_at)),1),t("td",Zt,[t("div",Kt,[(i(!0),c(j,null,U(l.detalles,m=>{var A,G;return i(),c("div",{key:m.id,class:"flex justify-between"},[t("span",null,n(m.cantidad)+" × "+n(((A=m.producto)==null?void 0:A.nombre)||"Producto desconocido"),1),t("span",{class:T(["font-semibold",!(m!=null&&m.cantidadEditado)||(m==null?void 0:m.cantidadEditado)===(m==null?void 0:m.cantidad)?"text-gray-700":"text-red-700"])}," $"+n((((G=m.producto)==null?void 0:G.precio)??0)*(m.cantidad??0)),3)])}),128))])]),t("td",ea,[t("span",{class:T([[l.metodo_pago=="tarjeta"?"bg-yellow-500":"bg-green-500"],"px-2 py-1 rounded-md text-white"])},n(l.metodo_pago),3)]),t("td",ta,[t("span",{class:T([[l.factura==!0?"bg-blue-500":"bg-red-500"],"px-2 py-1 rounded-md text-white whitespace-nowrap capitalize"])},n(l.factura?"Facturado":"No facturado"),3)]),t("td",aa," $"+n(l.total),1),o.$page.props.user.roles[0]!="trabajador"?(i(),c("td",oa,[t("div",sa,[t("button",{onClick:m=>Me(l.id),class:"text-white rounded-md px-2 py-1 bg-orange-500 hover:bg-orange-700"}," Editar ",8,ra)])])):v("",!0)])}),128))])])])]))),128))]))]),J.value?(i(),c("div",la,"Cargando...")):v("",!0)])])]),ie(Qe,{registrosInventario:fe.value},null,8,["registrosInventario"]),ie(Je,{gastos:ge.value},null,8,["gastos"]),o.$page.props.user.roles[0]!=="supervisor"?(i(),de(Re,{key:0,cantidadDeCortes:ce.value,sobrantes:q.value,categoriasInventario:pe.value,sobrantesInventario:ue.value},null,8,["cantidadDeCortes","sobrantes","categoriasInventario","sobrantesInventario"])):v("",!0),t("div",na,[o.$page.props.user.roles[0]!="trabajador"&&o.$page.props.user.roles[0]!="supervisor"?(i(),de(He,{key:0,ventasProductos:ve.value,inventario:me.value},null,8,["ventasProductos","inventario"])):v("",!0)]),Y.value?(i(),c("div",ia,[t("div",da,[e[39]||(e[39]=t("h2",{class:"text-xl font-bold mb-4"},"Editar Venta",-1)),t("div",ua,[(i(!0),c(j,null,U(oe.value,r=>(i(),c("div",{key:r.id,class:"mb-4"},[t("label",ca,n(r.nombre),1),f(t("input",{type:"number","onUpdate:modelValue":l=>r.cantidad=l,class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",min:"1"},null,8,pa),[[_,r.cantidad]])]))),128)),t("div",va,[o.$page.props.user.roles[0]!=="supervisor"?(i(),c("button",{key:0,onClick:Ee,class:"bg-orange-500 text-white px-4 py-2 rounded-md hover:bg-orange-600"},"Guardar")):v("",!0),o.$page.props.user.roles[0]!=="supervisor"?(i(),c("button",{key:1,onClick:Ue,class:"ml-2 bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600"},"Cancelar")):v("",!0)])])])])):v("",!0)],64)}}},ga={class:"py-6"},fa={class:"max-w-9xl w-full mx-auto sm:px-6 lg:px-8 rounded-xl"},xa={class:"overflow-scroll md:overflow-hidden rounded-xl"},wa={__name:"index",setup(we){return(a,q)=>(i(),de(Oe,{title:"Tablero principal"},{default:Ge(()=>[t("div",ga,[t("div",fa,[t("div",xa,[ie(ma)])])])]),_:1}))}};export{wa as default};
