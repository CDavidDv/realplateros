import{Q as st,d,i as q,q as rt,o as i,e as c,a as t,t as l,j as b,l as ge,k as y,f as p,n as x,g as A,u as fe,F as O,h as H,b as ye,c as _e,x as be,w as lt}from"./app-COT3Dlhe.js";import{S as xe,_ as nt}from"./AppLayout-BX7n8Ah4.js";import{_ as it,a as dt,b as ut,c as ct,r as vt}from"./Sobrantes-BB794-T5.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./chart-BZcJGg0T.js";const pt={class:"print min-h-screen py-6 flex rounded-2xl border-0 flex-col justify-center sm:py-4"},mt={class:"relative py-3 w-full px-4 sm:px-0"},gt={class:"relative px-4 py-10 bg-white shadow-lg rounded-3xl sm:p-20"},ft={class:"text-3xl font-bold mb-6 text-center"},bt={key:0,class:"flex flex-col md:flex-row items-center gap-4 mb-8"},xt={class:"w-full gap-2 flex flex-col items-center"},yt={class:"flex gap-2"},_t={key:1,class:"text-red-500 font-bold mt-2"},ht={key:2,class:"mb-6 no-print"},wt={class:"flex space-x-2"},Ct=["disabled"],kt={class:"flex space-x-2"},jt=["disabled"],$t={key:0,class:"mt-6 border-t pt-6"},St={class:"grid grid-cols-2 gap-4 mb-4 p-4 bg-blue-50 rounded-lg"},Nt=["value"],Dt=["value"],Vt={class:"grid grid-cols-2 gap-4 mb-4"},Et=["disabled"],Mt=["disabled"],Pt={class:"grid grid-cols-2 gap-4 mb-4"},Ft={key:0,class:"mb-4"},Tt=["disabled"],It=["disabled"],Ut={class:"bg-gray-50 p-4 rounded-lg mb-6"},Bt={class:"grid grid-cols-2 gap-4"},zt={key:0,class:"col-span-2 mb-4"},At={class:"grid grid-cols-3 gap-4"},Ot=["onClick"],Lt={class:"font-medium"},Rt={class:"text-sm text-gray-600"},Gt={class:"text-sm text-gray-600"},Jt={class:"text-sm text-gray-600"},Qt={class:"text-sm text-gray-600"},qt={class:"mt-2 pt-2 border-t text-xs"},Ht={class:"text-green-600"},Yt={class:"text-yellow-600"},Wt={key:1},Xt={class:"font-medium"},Zt={key:2},Kt={class:"font-medium"},ea={class:"font-medium"},ta={class:"font-medium"},aa={class:"font-medium"},oa={class:"font-medium"},sa={class:"font-medium"},ra={key:3,class:"col-span-2 mt-6 pt-6 border-t"},la={class:"grid grid-cols-2 gap-4"},na={class:"bg-blue-50 p-4 rounded-lg"},ia={class:"text-sm text-gray-600"},da={class:"font-medium"},ua={class:"text-sm text-gray-600"},ca={class:"font-medium"},va={class:"bg-purple-50 p-4 rounded-lg"},pa={class:"text-sm text-gray-600"},ma={class:"font-medium"},ga={class:"text-sm text-gray-600"},fa={class:"font-medium"},ba={class:"mt-4 grid grid-cols-2 gap-4"},xa={class:"text-xs text-gray-600 mt-1"},ya={class:"text-xs text-gray-600 mt-1"},_a={key:0,class:"mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-200"},ha={class:"text-sm text-gray-700 whitespace-pre-wrap"},wa={class:"mb-6"},Ca={class:"mb-4 no-print"},ka={class:"bg-gray-50 p-4 rounded-lg"},ja={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},$a={class:"flex gap-2"},Sa={key:0,class:"text-gray-500"},Na={key:1},Da={class:"bg-gray-100 p-4 rounded-lg mb-4"},Va={class:"text-lg font-semibold"},Ea={class:"text-sm text-gray-600"},Ma={class:"grid grid-cols-3 gap-4 mt-2"},Pa={class:"font-medium"},Fa={class:"font-medium"},Ta={class:"font-medium"},Ia={class:"overflow-x-auto h-screen overflow-auto ventasR"},Ua={class:"tabla min-w-full divide-y divide-gray-200"},Ba={class:"bg-gray-50"},za={key:0,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Aa={key:1,class:"no-print px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},Oa={class:"bg-white divide-y divide-gray-200"},La={key:0,class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 text-center"},Ra={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 text-center"},Ga={class:"px-6 py-4 whitespace-nowrap overflow-auto text-sm text-gray-500"},Ja={class:"print"},Qa={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center"},qa={class:"px-6 py-4 text-sm text-gray-500"},Ha={class:"flex flex-col space-y-1"},Ya={class:"px-6 py-4 text-sm text-gray-500 capitalize text-center"},Wa={class:"px-2 w-fit py-4 text-sm text-gray-500 capitalize text-center"},Xa={class:"px-6 py-4 text-sm text-gray-900 font-semibold text-right"},Za={key:1,class:"no-print px-6 py-4 text-center"},Ka={class:"flex justify-center gap-2"},eo=["onClick"],to={key:3,class:"text-center text-gray-500"},ao={class:"max-w-7xl mx-auto"},oo={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center"},so={class:"bg-white p-6 rounded-lg overflow-auto w-1/2 max-h-96"},ro={class:""},lo={class:"block text-sm font-medium text-gray-700"},no=["onUpdate:modelValue"],io={class:"flex justify-end"},uo={__name:"Corte",setup(Ae){var Ee,Me,Pe,Fe,Te,Ie,Ue,Be,ze;const{props:o}=st(),ie=d(o.sobrantes||[]),he=d(o.sobrantesInventario||[]),we=d((o==null?void 0:o.cantidadDeCortes)||0),Ce=d((o==null?void 0:o.categoriasInventario)||[]),k=d("day"),L=new Date,T=d(L.getFullYear()+"-"+String(L.getMonth()+1).padStart(2,"0")+"-"+String(L.getDate()).padStart(2,"0")),te=d(null),ae=d(null),I=d(((Ee=o==null?void 0:o.corte)==null?void 0:Ee.dinero_inicio)||0),F=d(((Me=o==null?void 0:o.corte)==null?void 0:Me.dinero_final)||0),Y=d(0),W=d(0),Oe=d(o.productosVendidos||[]),oe=d(!1),se=d(""),ke=d(o.ventasProductos||[]),je=d(o.inventario||[]),C=d(o.ventas||[]),$e=d(o.gastos||[]),de=d(o.totalGastos||0),ue=d((o==null?void 0:o.cantidadCortes)||0),R=d(!1),U=d(!1),ce=d(!!((Pe=o==null?void 0:o.corte)!=null&&Pe.dinero_inicio)),S=d(!!((Fe=o==null?void 0:o.corte)!=null&&Fe.dinero_final)),G=d(!1),N=d(((Te=o==null?void 0:o.corte)==null?void 0:Te.efectivo_contado)||0),D=d(((Ie=o==null?void 0:o.corte)==null?void 0:Ie.tarjeta_contada)||0),V=d(((Ue=o==null?void 0:o.corte)==null?void 0:Ue.notas_reconciliacion)||""),ve=d(!!((Be=o==null?void 0:o.corte)!=null&&Be.efectivo_contado&&((ze=o==null?void 0:o.corte)!=null&&ze.tarjeta_contada))),Le=["ID Venta","Creado por","Hora","Productos vendidos","Metodo de pago","Factura","Total"],Re=q(()=>{const a=new Date,e=a.getFullYear()+"-"+String(a.getMonth()+1).padStart(2,"0")+"-"+String(a.getDate()).padStart(2,"0");return k.value==="day"&&T.value===e}),Ge=q(()=>{const a=w.value.find(e=>{var s;return e.id===((s=o.corte)==null?void 0:s.id)});return(a==null?void 0:a.ventas)||[]}),J=q(()=>{const a=Ge.value;return{efectivo:a.reduce((e,s)=>s.metodo_pago==="efectivo"?e+Number(s.total):e,0),tarjeta:a.reduce((e,s)=>s.metodo_pago==="tarjeta"?e+Number(s.total):e,0)}}),_=q(()=>Number(N.value)-Number(J.value.efectivo)),h=q(()=>Number(D.value)-Number(J.value.tarjeta)),Se=q(()=>Math.abs(_.value)>.01||Math.abs(h.value)>.01),X=a=>{if(!a)return"-";const e=new Date(a);return isNaN(e.getTime())?"-":e.toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:"America/Mexico_City"})},w=d([]),E=d([]),re=()=>{var e,s;if(w.value=[],!C.value||((e=C.value)==null?void 0:e.length)===0)return;if(!o.cortes||((s=o.cortes)==null?void 0:s.length)===0){w.value=[{id:1,ventas:C.value,created_at:null,updated_at:null}];return}const a=[...o.cortes].sort((u,r)=>new Date(u.created_at)-new Date(r.created_at));a.forEach((u,r)=>{const M=u.dinero_final!==null&&u.dinero_final!==void 0?new Date(u.updated_at):new Date,j=r>0?a[r-1]:null,z=j!=null&&j.updated_at?new Date(j.updated_at):null;let P=[];r===0?P=C.value.filter($=>new Date($.created_at)<=M):P=C.value.filter($=>{const m=new Date($.created_at);return m>z&&m<=M}),w.value.push({id:u.id,ventas:P,created_at:u.created_at,updated_at:u.updated_at,dinero_inicio:u.dinero_inicio,dinero_final:u.dinero_final})})},Z=a=>!a||!Array.isArray(a)?{efectivo:0,tarjeta:0,total:0}:{efectivo:a.reduce((e,s)=>s.metodo_pago==="efectivo"?e+Number(s.total):e,0),tarjeta:a.reduce((e,s)=>s.metodo_pago==="tarjeta"?e+Number(s.total):e,0),total:a.reduce((e,s)=>e+Number(s.total),0)},Ne=a=>{const s=(E.value.length>0?E.value:w.value).find(u=>u.id===a);return(s==null?void 0:s.ventas)||[]},De=d((o==null?void 0:o.registrosInventario)||[]),pe=()=>{oe.value=!0,se.value="";let a=k.value,e=null;a==="day"?e=T.value:a==="week"?e=te.value:a==="month"&&(e=ae.value),be.post("/corte-caja",{filter:a,value:e},{preserveScroll:!0,onSuccess(s){var u;Y.value=s.props.cashPayments||0,W.value=s.props.cardPayments||0,Oe.value=s.props.productsUsed||[],C.value=s.props.ventas||[],I.value=s.props.initialCash||0,F.value=s.props.finalCash||0,oe.value=!1,ke.value=s.props.ventasProductos||[],je.value=s.props.inventario||[],De.value=s.props.registrosInventario||[],$e.value=s.props.gastos||[],de.value=s.props.totalGastos||0,o.cortes=s.props.cortes||[],ue.value=((u=s==null?void 0:s.props)==null?void 0:u.cantidadCortes)||0,ie.value=s.props.sobrantes||[],he.value=s.props.sobrantesInventario||[],we.value=s.props.cantidadDeCortes||0,Ce.value=s.props.categoriasInventario||[],console.log("Datos actualizados:",s.props),f("success","Filtro actualizado correctamente"),le(),re(),B.value=[],E.value=[],Q.value=null},onError(s){f("error",s.props.flash.error||"Error al obtener datos con este filtro"),se.value="Ocurrió un error al obtener los datos. Inténtalo de nuevo.",oe.value=!1}})},Je=()=>{k.value="day",T.value=L.getFullYear()+"-"+String(L.getMonth()+1).padStart(2,"0")+"-"+String(L.getDate()).padStart(2,"0"),te.value=null,ae.value=null,Q.value=null,E.value=[],pe()},Qe=()=>{window.print()},le=()=>{const a=C.value||(o==null?void 0:o.ventas)||[];Y.value=a.reduce((e,s)=>s.metodo_pago==="efectivo"?Number(e)+Number(s.total||0):Number(e),0),W.value=a.reduce((e,s)=>s.metodo_pago==="tarjeta"?Number(e)+Number(s.total||0):Number(e),0)},Q=d(null),v=d({idVenta:"",creadoPor:"",metodoPago:"",factura:"",precioMin:"",precioMax:"",producto:""}),B=d([]),qe=()=>{(!B.value||B.value.length===0)&&(B.value=JSON.parse(JSON.stringify(w.value)));const a=B.value.map(e=>{const s=e.ventas.filter(u=>{var r,n,M,j,z,P;if(v.value.idVenta&&!((r=u.idVentaDia)!=null&&r.toString().includes(v.value.idVenta))&&!((n=u.id)!=null&&n.toString().includes(v.value.idVenta))||v.value.creadoPor&&!`${((M=u==null?void 0:u.usuario)==null?void 0:M.name)||""} ${((j=u==null?void 0:u.usuario)==null?void 0:j.apellido_p)||""} ${((z=u==null?void 0:u.usuario)==null?void 0:z.apellido_m)||""}`.toLowerCase().includes(v.value.creadoPor.toLowerCase())||v.value.metodoPago&&u.metodo_pago!==v.value.metodoPago)return!1;if(v.value.factura!==""){const $=v.value.factura==="true";if(!!u.factura!==$)return!1}return!(v.value.precioMin&&Number(u.total)<Number(v.value.precioMin)||v.value.precioMax&&Number(u.total)>Number(v.value.precioMax)||v.value.producto&&!((P=u.detalles)==null?void 0:P.some(m=>{var K,ee;return(ee=(K=m.producto)==null?void 0:K.nombre)==null?void 0:ee.toLowerCase().includes(v.value.producto.toLowerCase())})))});return{...e,ventas:s}});w.value=a.filter(e=>e.ventas.length>0)},He=()=>{v.value={idVenta:"",creadoPor:"",metodoPago:"",factura:"",precioMin:"",precioMax:"",producto:""},B.value=[],re()},Ye=a=>{if(!a){console.error("corteId inválido");return}E.value.length===0&&(E.value=JSON.parse(JSON.stringify(w.value))),Q.value=a;const e=E.value.find(s=>s.id===a);e&&(w.value=[e],C.value=e.ventas),le()},We=()=>{Q.value=null,E.value.length>0?w.value=JSON.parse(JSON.stringify(E.value)):re(),C.value=o.ventas,le()},f=(a,e)=>{xe.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,customClass:"no-print",didOpen:s=>{s.addEventListener("mouseenter",xe.stopTimer),s.addEventListener("mouseleave",xe.resumeTimer)}}).fire({icon:a,title:e})},Xe=()=>{const a={sucursal_id:o==null?void 0:o.sucursal_id,usuario_id:o==null?void 0:o.usuario_id,fecha:T.value,dinero_inicio:I.value};R.value=!0;try{be.post(vt("corte-caja.guardar-inicial"),a,{preserveScroll:!0,onSuccess:e=>{console.log(e),e.props.flash.success?(e.props.corte&&(I.value=e.props.corte.dinero_inicio,ce.value=!0),f("success",e.props.flash.success)):f("error",e.props.flash.error),R.value=!1}})}catch(e){f("error",e.error||"Error al guardar la cantidad inicial"),R.value=!1}},Ze=()=>{if(!N.value||Number(N.value)<0){f("error","Debe ingresar el efectivo contado");return}if(!D.value||Number(D.value)<0){f("error","Debe ingresar el monto de tarjeta");return}if(Se.value&&(!V.value||Ke(V.value)==="")){f("error","Debe justificar las diferencias encontradas");return}const a={sucursal_id:o==null?void 0:o.sucursal_id,usuario_id:o==null?void 0:o.usuario_id,fecha:T.value,dinero_final:F.value,efectivo_contado:N.value,tarjeta_contada:D.value,notas_reconciliacion:V.value};U.value=!0;try{be.post("/corte-caja/guardar-final",a,{preserveScroll:!0,onSuccess:e=>{var s,u,r;if(console.log("Response:",e.props),e.props.success||e.props.corte)e.props.corte&&(F.value=e.props.corte.dinero_final,N.value=e.props.corte.efectivo_contado,D.value=e.props.corte.tarjeta_contada,V.value=e.props.corte.notas_reconciliacion,S.value=!0,ve.value=!0),f("success",e.props.success||"Corte final y reconciliación guardados correctamente.");else{const n=((u=(s=e.props)==null?void 0:s.jetstream)==null?void 0:u.flash)||((r=e.props)==null?void 0:r.flash)||{};n.success?(f("success",n.success),e.props.corte&&(F.value=e.props.corte.dinero_final,N.value=e.props.corte.efectivo_contado,D.value=e.props.corte.tarjeta_contada,V.value=e.props.corte.notas_reconciliacion,S.value=!0,ve.value=!0)):n.error&&f("error",n.error)}U.value=!1}})}catch(e){f("error",e.error||"Error al guardar la cantidad final"),U.value=!1}},Ke=a=>(a==null?void 0:a.trim())||"";rt(()=>{o.ventas&&Array.isArray(o.ventas)&&(C.value=o.ventas),le(),re(),B.value=JSON.parse(JSON.stringify(w.value))});const g=a=>parseFloat(a).toFixed(2),ne=d(!1),me=d([]),Ve=d(null),et=a=>{const e=C.value.find(s=>s.id===a);me.value=e.detalles.map(s=>({id:s.producto.id,nombre:s.producto.nombre,cantidad:s.cantidad,oldQuantity:s.producto.cantidad,precio:s.producto.precio})),Ve.value=a,ne.value=!0},tt=async()=>{const a={venta_id:Ve.value,productos:me.value.map(e=>({id:e.id,ticketQuantity:e.cantidad,oldQuantity:e.oldQuantity}))};console.log(a);try{const e=await axios.post("/ventas/editar",a);e.status===200?(f("success","Venta actualizada correctamente"),pe(),ne.value=!1):f("error",e.data.error||"Error al actualizar la venta")}catch(e){console.error("Error al actualizar venta:",e),e.response&&e.response.data?f("error",e.response.data.error||"Error al actualizar la venta"):f("error","Error al actualizar la venta")}},at=async()=>{G.value=!0;try{const a=await axios.post("/corte-caja/crear-corte",{dinero_inicio:0});console.log(a),a.status===200?(f("success","Nuevo corte creado correctamente"),console.log(a),I.value=0,F.value=0,window.location.reload()):(console.log(a),f("error",a.data.error||"Error al crear nuevo corte"))}catch(a){console.log(a),f("error",a.response||"Error al crear nuevo corte")}finally{G.value=!1}},ot=()=>{ne.value=!1};return(a,e)=>{var s,u;return i(),c(O,null,[t("div",pt,[t("div",mt,[t("div",gt,[t("h1",ft,"Corte de Caja "+l(ue.value?ue.value:1),1),a.$page.props.user.roles[0]!="trabajador"?(i(),c("div",bt,[t("div",xt,[e[17]||(e[17]=t("label",{for:"filter",class:"font-bold"},"Filtrar por:",-1)),t("div",yt,[b(t("select",{class:"ml-1 py-0 rounded",id:"filter","onUpdate:modelValue":e[0]||(e[0]=r=>k.value=r)},e[16]||(e[16]=[t("option",{value:"day"},"Día",-1),t("option",{value:"week"},"Semana",-1),t("option",{value:"month"},"Mes",-1)]),512),[[ge,k.value]]),k.value==="day"?b((i(),c("input",{key:0,class:"w-fit h-fit p-1 rounded",id:"valueSelect",type:"date","onUpdate:modelValue":e[1]||(e[1]=r=>T.value=r)},null,512)),[[y,T.value]]):p("",!0),k.value==="week"?b((i(),c("input",{key:1,class:"w-fit h-fit p-1 rounded",id:"valueSelect",type:"week","onUpdate:modelValue":e[2]||(e[2]=r=>te.value=r)},null,512)),[[y,te.value]]):p("",!0),k.value==="month"?b((i(),c("input",{key:2,class:"w-fit h-fit p-1 rounded",id:"valueSelect",type:"month","onUpdate:modelValue":e[3]||(e[3]=r=>ae.value=r)},null,512)),[[y,ae.value]]):p("",!0)]),t("div",{class:"flex gap-1"},[t("button",{class:"no-print text-sm rounded-lg shadow-lg px-3 py-2 bg-orange-500 text-white hover:bg-orange-600",onClick:pe},"Aplicar Filtro"),t("button",{class:"no-print text-sm rounded-lg shadow-lg px-3 py-2 bg-gray-500 text-white hover:bg-gray-600",onClick:Je},"Limpiar Filtro")])])])):p("",!0),se.value?(i(),c("div",_t,l(se.value),1)):p("",!0),Re.value&&a.$page.props.user.roles[0]!=="supervisor"?(i(),c("div",ht,[e[26]||(e[26]=t("label",{for:"initialCash",class:"block text-sm font-medium text-gray-700"},"Cantidad Inicial en Caja",-1)),t("div",wt,[b(t("input",{type:"number",id:"initialCash","onUpdate:modelValue":e[4]||(e[4]=r=>I.value=r),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",min:"0",step:"0.01",placeholder:"Ingrese cantidad"},null,512),[[y,I.value]]),t("button",{onClick:Xe,class:x(["px-4 py-2 rounded-md",R.value?"bg-gray-500 text-gray-300":"text-white hover:bg-orange-600 bg-orange-500",ce.value?"cursor-not-allowed bg-gray-500 text-gray-300":""]),disabled:R.value||ce.value},l(R.value?"Guardando...":"Guardar"),11,Ct)]),e[27]||(e[27]=t("label",{for:"finalCash",class:"block text-sm font-medium text-gray-700 mt-4"},"Cantidad Final en Caja",-1)),t("div",kt,[b(t("input",{type:"number",id:"finalCash","onUpdate:modelValue":e[5]||(e[5]=r=>F.value=r),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",min:"0",step:"0.01",placeholder:"Ingrese cantidad"},null,512),[[y,F.value]]),t("button",{onClick:Ze,class:x(["px-4 py-2 rounded-md",U.value?"bg-gray-500 text-gray-300":"text-white hover:bg-orange-600 bg-orange-500",S.value?"cursor-not-allowed bg-gray-500 text-gray-300":""]),disabled:U.value||S.value},l(U.value?"Guardando...":"Guardar"),11,jt)]),S.value?p("",!0):(i(),c("div",$t,[e[25]||(e[25]=t("h3",{class:"text-lg font-semibold mb-4"},"Comparación de Pagos",-1)),t("div",St,[t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700"},"Efectivo (Sistema - Este Corte)",-1)),t("input",{type:"number",value:g(J.value.efectivo),disabled:"",class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 bg-gray-100 focus:outline-none sm:text-sm rounded-md"},null,8,Nt)]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700"},"Tarjeta (Sistema - Este Corte)",-1)),t("input",{type:"number",value:g(J.value.tarjeta),disabled:"",class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 bg-gray-100 focus:outline-none sm:text-sm rounded-md"},null,8,Dt)])]),t("div",Vt,[t("div",null,[e[20]||(e[20]=t("label",{for:"efectivoContado",class:"block text-sm font-medium text-gray-700"},"Efectivo Contado *",-1)),b(t("input",{type:"number",id:"efectivoContado","onUpdate:modelValue":e[6]||(e[6]=r=>N.value=r),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",min:"0",step:"0.01",placeholder:"Ingrese efectivo contado",disabled:S.value},null,8,Et),[[y,N.value]])]),t("div",null,[e[21]||(e[21]=t("label",{for:"tarjetaContada",class:"block text-sm font-medium text-gray-700"},"Terminal/Tarjeta *",-1)),b(t("input",{type:"number",id:"tarjetaContada","onUpdate:modelValue":e[7]||(e[7]=r=>D.value=r),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",min:"0",step:"0.01",placeholder:"Ingrese monto de terminal",disabled:S.value},null,8,Mt),[[y,D.value]])])]),t("div",Pt,[t("div",{class:x(["p-3 rounded-lg",[Math.abs(_.value)<.01?"bg-gray-100":_.value>0?"bg-green-100":"bg-red-100"]])},[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700"},"Diferencia Efectivo",-1)),t("p",{class:x(["text-lg font-bold mt-1",Math.abs(_.value)<.01?"text-gray-700":_.value>0?"text-green-700":"text-red-700"])}," $"+l(g(_.value)),3)],2),t("div",{class:x(["p-3 rounded-lg",[Math.abs(h.value)<.01?"bg-gray-100":h.value>0?"bg-green-100":"bg-red-100"]])},[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700"},"Diferencia Tarjeta",-1)),t("p",{class:x(["text-lg font-bold mt-1",Math.abs(h.value)<.01?"text-gray-700":h.value>0?"text-green-700":"text-red-700"])}," $"+l(g(h.value)),3)],2)]),Se.value?(i(),c("div",Ft,[e[24]||(e[24]=t("label",{for:"notasReconciliacion",class:"block text-sm font-medium text-red-700"},[A(" Justificación de Diferencias "),t("span",{class:"text-red-600"},"*")],-1)),b(t("textarea",{id:"notasReconciliacion","onUpdate:modelValue":e[8]||(e[8]=r=>V.value=r),placeholder:"Explique las diferencias encontradas...",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm",rows:"3",disabled:S.value},null,8,Tt),[[y,V.value]])])):p("",!0)])),S.value&&!U.value&&!G.value?(i(),c("button",{key:1,onClick:at,class:x(["mt-4 w-full px-4 py-2 rounded-md text-white",G.value?"bg-gray-500":"hover:bg-green-600 bg-green-500"]),disabled:G.value},l(G.value?"Abriendo nuevo corte...":"Abrir nuevo corte"),11,It)):p("",!0)])):p("",!0),t("div",Ut,[e[46]||(e[46]=t("h2",{class:"text-xl font-semibold mb-4"},"Resumen Financiero",-1)),t("div",Bt,[fe(o).cortes&&((s=fe(o).cortes)==null?void 0:s.length)>0?(i(),c("div",zt,[e[28]||(e[28]=t("h3",{class:"text-lg font-semibold mb-2"},[A("Cortes del día "),t("span",{class:"text-sm text-gray-500"},"(click para ver detalle)")],-1)),t("div",At,[(i(!0),c(O,null,H(fe(o).cortes,(r,n)=>(i(),c("div",{key:r.id,class:x(["bg-white p-3 rounded shadow cursor-pointer hover:bg-orange-50 transition-colors",{"ring-2 ring-orange-500 bg-orange-50":Q.value===r.id}]),onClick:M=>Ye(r.id)},[t("h4",Lt,"Corte #"+l(n+1),1),t("p",Rt,"Inicial: $"+l(g(r.dinero_inicio||0)),1),t("p",Gt,"Final: $"+l(g(r.dinero_final||0)),1),t("p",Jt,"Hora inicio: "+l(X(r.created_at)),1),t("p",Qt,"Hora fin: "+l(r.dinero_final?X(r.updated_at):"En curso"),1),t("div",qt,[t("p",Ht,"Efectivo: $"+l(g(Z(Ne(r.id)).efectivo)),1),t("p",Yt,"Tarjeta: $"+l(g(Z(Ne(r.id)).tarjeta)),1)])],10,Ot))),128))]),Q.value?(i(),c("button",{key:0,class:"no-print mt-2 text-sm rounded-lg shadow-lg px-3 py-2 bg-gray-500 text-white hover:bg-gray-600 mb-4",onClick:We}," Restablecer Selección (Ver Todo) ")):p("",!0)])):p("",!0),k.value==="day"?(i(),c("div",Wt,[e[29]||(e[29]=t("p",{class:"text-sm text-gray-600"},"Dinero inicial:",-1)),t("p",Xt,"$"+l(g(I.value)),1)])):p("",!0),k.value==="day"?(i(),c("div",Zt,[e[30]||(e[30]=t("p",{class:"text-sm text-gray-600"},"Dinero final:",-1)),t("p",Kt,"$"+l(g(F.value)),1)])):p("",!0),t("div",null,[e[31]||(e[31]=t("p",{class:"text-sm text-gray-600"},"Efectivo:",-1)),t("p",ea,"$"+l(g(Y.value)),1)]),t("div",null,[e[32]||(e[32]=t("p",{class:"text-sm text-gray-600"},"Tarjetas:",-1)),t("p",ta,"$"+l(W.value),1)]),t("div",null,[e[33]||(e[33]=t("p",{class:"text-sm text-gray-600"},"Total ventas (Efectivo + Tarjetas):",-1)),t("p",aa,"$"+l(Number(Y.value)+Number(W.value)),1)]),t("div",null,[e[34]||(e[34]=t("p",{class:"text-sm text-gray-600"},"Gastos:",-1)),t("p",oa,"$"+l(de.value),1)]),t("div",null,[e[35]||(e[35]=t("p",{class:"text-sm text-gray-600"},"Total menos gastos:",-1)),t("p",sa,"$"+l(Number(Y.value)+Number(W.value)-Number(de.value)),1)]),ve.value?(i(),c("div",ra,[e[45]||(e[45]=t("h3",{class:"text-lg font-semibold mb-4"},"Resumen de comparación (Este Corte)",-1)),t("div",la,[t("div",na,[e[38]||(e[38]=t("h4",{class:"font-semibold text-gray-700 mb-2"},"Sistema (Calculado)",-1)),t("p",ia,[e[36]||(e[36]=A("Efectivo: ")),t("span",da,"$"+l(g(J.value.efectivo)),1)]),t("p",ua,[e[37]||(e[37]=A("Tarjeta: ")),t("span",ca,"$"+l(g(J.value.tarjeta)),1)])]),t("div",va,[e[41]||(e[41]=t("h4",{class:"font-semibold text-gray-700 mb-2"},"Contado (Real)",-1)),t("p",pa,[e[39]||(e[39]=A("Efectivo: ")),t("span",ma,"$"+l(g(N.value)),1)]),t("p",ga,[e[40]||(e[40]=A("Tarjeta: ")),t("span",fa,"$"+l(g(D.value)),1)])])]),t("div",ba,[t("div",{class:x(["p-4 rounded-lg",Math.abs(_.value)<.01?"bg-gray-100":_.value>0?"bg-green-100":"bg-red-100"])},[e[42]||(e[42]=t("h4",{class:"font-semibold text-gray-700 mb-2"},"Diferencia Efectivo",-1)),t("p",{class:x(["text-xl font-bold",Math.abs(_.value)<.01?"text-gray-700":_.value>0?"text-green-700":"text-red-700"])}," $"+l(g(_.value)),3),t("p",xa,l(Math.abs(_.value)<.01?"Cuadrado":_.value>0?"Sobrante":"Faltante"),1)],2),t("div",{class:x(["p-4 rounded-lg",Math.abs(h.value)<.01?"bg-gray-100":h.value>0?"bg-green-100":"bg-red-100"])},[e[43]||(e[43]=t("h4",{class:"font-semibold text-gray-700 mb-2"},"Diferencia Tarjeta",-1)),t("p",{class:x(["text-xl font-bold",Math.abs(h.value)<.01?"text-gray-700":h.value>0?"text-green-700":"text-red-700"])}," $"+l(g(h.value)),3),t("p",ya,l(Math.abs(h.value)<.01?"Cuadrado":h.value>0?"Sobrante":"Faltante"),1)],2)]),V.value?(i(),c("div",_a,[e[44]||(e[44]=t("h4",{class:"font-semibold text-gray-700 mb-2"},"Notas de Reconciliación",-1)),t("p",ha,l(V.value),1)])):p("",!0)])):p("",!0)])]),t("div",wa,[t("div",{class:"flex justify-between"},[e[47]||(e[47]=t("h2",{class:"text-xl font-semibold mb-4"},"Ventas",-1)),t("button",{onClick:Qe,class:"no-print size-fit py-1 px-2 mr-8 rounded-md text-white hover:bg-purple-600 bg-purple-500"}," Imprimir ")]),t("div",Ca,[t("div",ka,[e[56]||(e[56]=t("h3",{class:"text-lg font-semibold mb-3"},"Filtros de Búsqueda",-1)),t("div",ja,[t("div",null,[e[48]||(e[48]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"ID Venta",-1)),b(t("input",{type:"text","onUpdate:modelValue":e[9]||(e[9]=r=>v.value.idVenta=r),placeholder:"Buscar por ID...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},null,512),[[y,v.value.idVenta]])]),t("div",null,[e[49]||(e[49]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Creado por",-1)),b(t("input",{type:"text","onUpdate:modelValue":e[10]||(e[10]=r=>v.value.creadoPor=r),placeholder:"Buscar por nombre...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},null,512),[[y,v.value.creadoPor]])]),t("div",null,[e[51]||(e[51]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Método de Pago",-1)),b(t("select",{"onUpdate:modelValue":e[11]||(e[11]=r=>v.value.metodoPago=r),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},e[50]||(e[50]=[t("option",{value:""},"Todos",-1),t("option",{value:"efectivo"},"Efectivo",-1),t("option",{value:"tarjeta"},"Tarjeta",-1)]),512),[[ge,v.value.metodoPago]])]),t("div",null,[e[53]||(e[53]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Factura",-1)),b(t("select",{"onUpdate:modelValue":e[12]||(e[12]=r=>v.value.factura=r),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},e[52]||(e[52]=[t("option",{value:""},"Todos",-1),t("option",{value:"true"},"Facturado",-1),t("option",{value:"false"},"No facturado",-1)]),512),[[ge,v.value.factura]])]),t("div",null,[e[54]||(e[54]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Rango de Precio",-1)),t("div",$a,[b(t("input",{type:"number","onUpdate:modelValue":e[13]||(e[13]=r=>v.value.precioMin=r),placeholder:"Min",class:"w-1/2 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},null,512),[[y,v.value.precioMin]]),b(t("input",{type:"number","onUpdate:modelValue":e[14]||(e[14]=r=>v.value.precioMax=r),placeholder:"Max",class:"w-1/2 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},null,512),[[y,v.value.precioMax]])])]),t("div",null,[e[55]||(e[55]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Producto",-1)),b(t("input",{type:"text","onUpdate:modelValue":e[15]||(e[15]=r=>v.value.producto=r),placeholder:"Buscar por producto...",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"},null,512),[[y,v.value.producto]])]),t("div",{class:"flex items-end"},[t("div",{class:"flex gap-2 w-full"},[t("button",{onClick:qe,class:"flex-1 bg-orange-500 text-white px-4 py-2 rounded-md hover:bg-orange-600 transition-colors"}," Aplicar Filtros "),t("button",{onClick:He,class:"flex-1 bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 transition-colors"}," Limpiar ")])])])])]),((u=w.value)==null?void 0:u.length)<=0?(i(),c("div",Sa," No se han vendido productos en este período. ")):(i(),c("div",Na,[(i(!0),c(O,null,H(w.value,r=>(i(),c("div",{key:r.id,class:"mb-8"},[t("div",Da,[t("h3",Va,[A(" Corte #"+l(r.id)+" ",1),t("span",Ea," ("+l(X(r.created_at))+" - "+l(X(r.updated_at))+") ",1)]),t("div",Ma,[t("div",null,[e[57]||(e[57]=t("p",{class:"text-sm text-gray-600"},"Efectivo:",-1)),t("p",Pa,"$"+l(g(Z(r.ventas).efectivo)),1)]),t("div",null,[e[58]||(e[58]=t("p",{class:"text-sm text-gray-600"},"Tarjetas:",-1)),t("p",Fa,"$"+l(g(Z(r.ventas).tarjeta)),1)]),t("div",null,[e[59]||(e[59]=t("p",{class:"text-sm text-gray-600"},"Total:",-1)),t("p",Ta,"$"+l(g(Z(r.ventas).total)),1)])])]),t("div",Ia,[t("table",Ua,[t("thead",Ba,[t("tr",null,[a.$page.props.user.roles[0]==="admin"?(i(),c("th",za," Folio ")):p("",!0),(i(),c(O,null,H(Le,n=>t("th",{key:n,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},l(n),1)),64)),a.$page.props.user.roles[0]!="trabajador"?(i(),c("th",Aa," Acciones ")):p("",!0)])]),t("tbody",Oa,[(i(!0),c(O,null,H(r.ventas,n=>{var M,j,z,P,$;return i(),c("tr",{class:"odd:bg-white even:bg-gray-100",key:n.id},[a.$page.props.user.roles[0]==="admin"?(i(),c("td",La,l(n.folio?n.folio:"-"),1)):p("",!0),t("td",Ra,l(n.idVentaDia),1),t("td",Ga,[t("span",Ja,l(`${(M=n==null?void 0:n.usuario)==null?void 0:M.name}
                              ${(j=n==null?void 0:n.usuario)!=null&&j.apellido_p?(z=n==null?void 0:n.usuario)==null?void 0:z.apellido_p:""}
                              ${(P=n==null?void 0:n.usuario)!=null&&P.apellido_m?($=n==null?void 0:n.usuario)==null?void 0:$.apellido_m:""}`),1)]),t("td",Qa,l(X(n.created_at)),1),t("td",qa,[t("div",Ha,[(i(!0),c(O,null,H(n.detalles,m=>{var K,ee;return i(),c("div",{key:m.id,class:"flex justify-between"},[t("span",null,l(m.cantidad)+" × "+l(((K=m.producto)==null?void 0:K.nombre)||"Producto desconocido"),1),t("span",{class:x(["font-semibold",!(m!=null&&m.cantidadEditado)||(m==null?void 0:m.cantidadEditado)===(m==null?void 0:m.cantidad)?"text-gray-700":"text-red-700"])}," $"+l((((ee=m.producto)==null?void 0:ee.precio)??0)*(m.cantidad??0)),3)])}),128))])]),t("td",Ya,[t("span",{class:x([[n.metodo_pago=="tarjeta"?"bg-yellow-500":"bg-green-500"],"px-2 py-1 rounded-md text-white"])},l(n.metodo_pago),3)]),t("td",Wa,[t("span",{class:x([[n.factura==!0?"bg-blue-500":"bg-red-500"],"px-2 py-1 rounded-md text-white whitespace-nowrap capitalize"])},l(n.factura?"Facturado":"No facturado"),3)]),t("td",Xa," $"+l(n.total),1),a.$page.props.user.roles[0]!="trabajador"?(i(),c("td",Za,[t("div",Ka,[t("button",{onClick:m=>et(n.id),class:"text-white rounded-md px-2 py-1 bg-orange-500 hover:bg-orange-700"}," Editar ",8,eo)])])):p("",!0)])}),128))])])])]))),128))]))]),oe.value?(i(),c("div",to,"Cargando...")):p("",!0)])])]),ye(it,{registrosInventario:De.value},null,8,["registrosInventario"]),ye(dt,{gastos:$e.value},null,8,["gastos"]),a.$page.props.user.roles[0]!=="supervisor"?(i(),_e(ut,{key:0,cantidadDeCortes:we.value,sobrantes:ie.value,categoriasInventario:Ce.value,sobrantesInventario:he.value},null,8,["cantidadDeCortes","sobrantes","categoriasInventario","sobrantesInventario"])):p("",!0),t("div",ao,[a.$page.props.user.roles[0]!="trabajador"&&a.$page.props.user.roles[0]!="supervisor"?(i(),_e(ct,{key:0,ventasProductos:ke.value,inventario:je.value},null,8,["ventasProductos","inventario"])):p("",!0)]),ne.value?(i(),c("div",oo,[t("div",so,[e[60]||(e[60]=t("h2",{class:"text-xl font-bold mb-4"},"Editar Venta",-1)),t("div",ro,[(i(!0),c(O,null,H(me.value,r=>(i(),c("div",{key:r.id,class:"mb-4"},[t("label",lo,l(r.nombre),1),b(t("input",{type:"number","onUpdate:modelValue":n=>r.cantidad=n,class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md",min:"1"},null,8,no),[[y,r.cantidad]])]))),128)),t("div",io,[a.$page.props.user.roles[0]!=="supervisor"?(i(),c("button",{key:0,onClick:tt,class:"bg-orange-500 text-white px-4 py-2 rounded-md hover:bg-orange-600"},"Guardar")):p("",!0),a.$page.props.user.roles[0]!=="supervisor"?(i(),c("button",{key:1,onClick:ot,class:"ml-2 bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600"},"Cancelar")):p("",!0)])])])])):p("",!0)],64)}}},co={class:"py-6"},vo={class:"max-w-9xl w-full mx-auto sm:px-6 lg:px-8 rounded-xl"},po={class:"overflow-scroll md:overflow-hidden rounded-xl"},yo={__name:"index",setup(Ae){return(o,ie)=>(i(),_e(nt,{title:"Tablero principal"},{default:lt(()=>[t("div",co,[t("div",vo,[t("div",po,[ye(uo)])])])]),_:1}))}};export{yo as default};
