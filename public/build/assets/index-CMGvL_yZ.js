import{S as $,_ as D}from"./AppLayout-B3pg6JRc.js";import{Q as L,d as c,p as O,o as l,e as a,a as t,j as m,v as M,F as h,h as x,t as i,f as v,u as A,l as C,n as R,z as E,c as q,w as H,b as J}from"./app-B9tn1D5Z.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const G={class:"container mx-auto"},K={key:0,class:"text-2xl font-bold mb-4"},W={key:1,class:"text-2xl font-bold mb-4"},X={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Y={class:"bg-white shadow rounded-lg p-6"},Z={class:"flex gap-8 justify-between"},ee=["placeholder"],te={class:"text-lg font-semibold mb-2 text-gray-700 capitalize"},se={class:"min-w-full"},oe={key:0,class:"text-left"},le={key:1,class:"text-left"},ae={class:"flex flex-col w-full"},ne={class:"pl-6 text-sm text-gray-500"},re={key:0},ie={class:"hidden sm:block"},de={key:1},ue=["onClick","disabled"],ce=["onClick","disabled"],ve={key:0,class:"bg-white w-full shadow rounded-lg p-6"},pe={key:0,class:"text-xl font-semibold mb-4"},fe={key:1,class:"text-xl font-semibold mb-4"},_e={key:2,class:"w-full flex flex-col gap-2 py-5"},be={class:"w-full flex justify-between"},ge={key:0,class:"text-lg font-bold text-gray-600"},me=["value"],he={class:"w-full flex justify-between"},xe={key:0,class:"text-lg w-full font-bold text-gray-600"},ke=["value"],ye={class:"min-w-full"},we={key:0,class:"text-left"},Te={class:"pl-6 text-sm text-gray-500"},Ce={key:0},Se=["onClick"],je={key:3,class:"flex justify-end mt-4 gap-2"},$e={key:0,class:"text-lg font-bold"},Ae=["disabled"],Ve=["disabled"],Ee={__name:"SalesPanel",setup(Q){const{props:p}=L(),r=c(p.user.roles[0]==="almacen"),k=p.inventario,n=c([]),_=c(0),y=c(0),g=c(""),b=c("efectivo"),w=c(!1),d=c(!1),S=c(),P=c(p.sucursales.filter(o=>o.nombre!=="almacen")),B=c(p.trabajadores);c(p.estimacionesHoy),r.value?S.value=p.categorias.map(o=>o.tipo):S.value=["pastes","empanadas saladas","empanadas dulces","bebida","extras"];const F=o=>k.filter(e=>e.nombre==="-"?"":e.tipo===o&&e.nombre.toLowerCase().includes(g.value.toLowerCase())),V=o=>{if(o.cantidad<=0)return;const e=n.value.find(s=>s.id===o.id);e?e.ticketQuantity++:n.value.push({...o,ticketQuantity:1}),o.cantidad--},N=o=>{const e=n.value.findIndex(s=>s.id===o);if(e!==-1){const s=n.value[e];s.ticketQuantity>1?s.ticketQuantity--:n.value.splice(e,1),k.find(u=>u.id===s.id).cantidad++}},j=O(()=>n.value.reduce((o,e)=>o+e.precio*e.ticketQuantity,0)),f=(o,e)=>{$.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:s=>{s.onmouseenter=$.stopTimer,s.onmouseleave=$.resumeTimer}}).fire({icon:o,title:e})},U=()=>{d.value||n.value.length===0||(d.value=!0,E.post("/ventas",{productos:n.value,total:j.value,metodo_pago:b.value,factura:w.value},{preserveScroll:!0,onSuccess:o=>{console.log(o.props),setTimeout(()=>{T(o.props.ticket_id),k.value=o.props.inventario,n.value=[],g.value="",b.value="efectivo",w.value=!1,f("success","Registrado correctamente"),d.value=!1},2e3)},onError:o=>{console.error("Error al enviar el pedido:",o),f("error","Error al registrar"),d.value=!1}}))},I=()=>{if(!(d.value||n.value.length===0)){if(_.value===0){f("error","Seleccione una sucursal");return}d.value=!0,E.post("/asignar",{productos:n.value,sucursal_id:_.value,trabajador_id:y.value,total:"-",metodo_pago:"-"},{preserveScroll:!0,onSuccess:o=>{n.value.unshift({id:o.props.ticket_id||0,nombre:"Asignación ticket no.",detalle:`Sucursal: ${_.value}`,ticketQuantity:o.props.ticket_id||0,precio:0,sucursal_id:0,tipo:"asignacion"}),T(o.props.ticket_id),T(o.props.ticket_id),T(o.props.ticket_id),k.value=o.props.inventario,n.value=[],g.value="",_.value=0,y.value=0,b.value="efectivo",f("success","Registrado correctamente"),d.value=!1},onError:o=>{console.error("Error al enviar el pedido:",o),f("error","Error al registrar"),d.value=!1}})}},T=o=>{console.log(n.value),fetch("https://print.test/print-ticket",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productos:n.value,total:j.value||"-",metodo_pago:b.value||"-",ticket_id:o})}).then(e=>{e.success&&f("success","Ticket impreso correctamente")}).catch(e=>{console.error("Error en la impresión del ticket:",e),f("error","Error al imprimir el ticket")})};return(o,e)=>(l(),a("div",G,[r.value?(l(),a("h1",K,"Tablero de Asignación")):(l(),a("h1",W,"Tablero de Ventas")),t("div",X,[t("div",Y,[t("div",Z,[e[5]||(e[5]=t("h2",{class:"text-xl font-semibold mb-4"},"Inventario",-1)),m(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),placeholder:[r.value?"Buscar en almacén...":"Buscar en inventario..."],class:"w-6/12 p-2 mb-4 border rounded"},null,8,ee),[[M,g.value]])]),(l(!0),a(h,null,x(S.value,s=>(l(),a("div",{key:s,class:"mb-6 overflow-scroll md:overflow-hidden"},[t("h3",te,i(s),1),t("table",se,[t("thead",null,[t("tr",null,[e[6]||(e[6]=t("th",{class:"text-left"},"Nombre",-1)),r.value?v("",!0):(l(),a("th",oe,"Precio")),e[7]||(e[7]=t("th",{class:"text-left hidden sm:block"},"Disponible",-1)),A(p).user.roles[0]!=="supervisor"?(l(),a("th",le,"Acción")):v("",!0)])]),t("tbody",null,[(l(!0),a(h,null,x(F(s),u=>(l(),a("tr",{key:u.id},[t("td",ae,[t("p",null,i(u.nombre),1),t("p",ne,i(u.detalle),1)]),r.value?v("",!0):(l(),a("td",re,"$"+i(u.precio),1)),t("td",ie,i(u.cantidad),1),A(p).user.roles[0]!=="supervisor"?(l(),a("td",de,[r.value?(l(),a("button",{key:0,onClick:z=>V(u),disabled:u.cantidad===0,class:"px-3 py-1 bg-orange-500 text-white rounded hover:bg-orange-600 disabled:opacity-50"}," Asignar ",8,ue)):(l(),a("button",{key:1,onClick:z=>V(u),disabled:u.cantidad===0,class:"px-3 py-1 bg-orange-500 text-white rounded hover:bg-orange-600 disabled:opacity-50"}," Agregar ",8,ce))])):v("",!0)]))),128))])])]))),128))]),A(p).user.roles[0]!=="supervisor"?(l(),a("div",ve,[r.value?(l(),a("h2",pe,"Ticket de Asignación")):(l(),a("h2",fe,"Ticket de Venta")),r.value?(l(),a("div",_e,[t("div",be,[r.value?(l(),a("span",ge," Sucursal a la que se asignará ")):v("",!0),m(t("select",{class:"w-fit","onUpdate:modelValue":e[1]||(e[1]=s=>_.value=s)},[(l(!0),a(h,null,x(P.value,s=>(l(),a("option",{key:s.id,value:s.id},i(s.nombre),9,me))),128))],512),[[C,_.value]])]),t("div",he,[r.value?(l(),a("span",xe," Asignar responsable ")):v("",!0),m(t("select",{class:"w-fit","onUpdate:modelValue":e[2]||(e[2]=s=>y.value=s)},[e[8]||(e[8]=t("option",{value:"0"},"No asignar",-1)),(l(!0),a(h,null,x(B.value,s=>(l(),a("option",{key:s.id,value:s.id},i(s.name),9,ke))),128))],512),[[C,y.value]])])])):v("",!0),t("table",ye,[t("thead",null,[t("tr",null,[e[9]||(e[9]=t("th",{class:"text-left"},"Producto",-1)),e[10]||(e[10]=t("th",{class:"text-left"},"Cantidad",-1)),r.value?v("",!0):(l(),a("th",we,"Precio")),e[11]||(e[11]=t("th",{class:"text-left"},"Acción",-1))])]),t("tbody",null,[(l(!0),a(h,null,x(n.value,s=>(l(),a("tr",{key:s.id},[t("td",null,[t("p",null,i(s.nombre),1),t("p",Te,i(s.detalle),1)]),t("td",null,i(s.ticketQuantity),1),r.value?v("",!0):(l(),a("td",Ce,"$"+i((s.precio*s.ticketQuantity).toFixed(2)),1)),t("td",null,[t("button",{onClick:u=>N(s.id),class:"px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600"}," Quitar ",8,Se)])]))),128))])]),r.value?v("",!0):(l(),a("div",je,[m(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>w.value=s),class:"rounded"},e[12]||(e[12]=[t("option",{value:"false"},"No facturado",-1),t("option",{value:"true"},"Facturado",-1)]),512),[[C,w.value]]),m(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>b.value=s),class:"rounded"},e[13]||(e[13]=[t("option",{value:"efectivo"},"Efectivo",-1),t("option",{value:"tarjeta"},"Tarjeta",-1)]),512),[[C,b.value]])])),t("div",{class:R(["mt-4 flex  items-center",r.value?"justify-end":"justify-between"])},[r.value?v("",!0):(l(),a("span",$e,"Total: $"+i(j.value.toFixed(2)),1)),r.value?(l(),a("button",{key:2,onClick:I,disabled:n.value.length===0||d.value,class:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50"},i(d.value?"Procesando...":"Completar Asignacin"),9,Ve)):(l(),a("button",{key:1,onClick:U,disabled:n.value.length===0||d.value,class:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50"},i(d.value?"Procesando...":"Completar Venta"),9,Ae))],2)])):v("",!0)])]))}},Qe={class:"py-6 px-2"},Pe={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},Be={class:"bg-white overflow-hidden shadow-xl rounded-lg"},Fe={class:"flex justify-between p-6 lg:p-8 bg-white border-b border-gray-200"},ze={__name:"index",setup(Q){return(p,r)=>(l(),q(D,{title:"Tablero principal"},{default:H(()=>[t("div",Qe,[t("div",Pe,[t("div",Be,[t("div",Fe,[J(Ee)])])])])]),_:1}))}};export{ze as default};
