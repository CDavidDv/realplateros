import{S as U,_ as be}from"./AppLayout-DnASnLZc.js";import{Q as ee,d as H,i as M,o as d,e as c,a as e,g as q,t as i,u as ue,F as P,h as z,f as O,s as le,x as pe,j as Z,l as me,k as ie,y as te,C as he,p as _e,b as Y,G as we,q as ae,n as oe,m as $e,c as ce,w as Me}from"./app-rvPNrf7l.js";import{_ as De}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as ke}from"./createLucideIcon-BkMaMpX2.js";/**
 * @license lucide-vue-next v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=ke("Trash2Icon",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Ce={class:"pb-4 pt-10 font-semibold text-xl inline-flex items-center gap-2"},Ee={class:"bg-white rounded-lg shadow-md overflow-hidden"},He={class:"overflow-x-auto"},Te={class:"min-w-full divide-y divide-gray-200"},Ne={class:"bg-white divide-y divide-gray-200"},Fe={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Pe={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Le={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ze={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ie={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ae={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ve={key:0},je={class:"bg-gray-50"},Be={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Re={__name:"PastesHorneados",setup(S){const{props:x}=ee();H(x.pastesHorneados);const _=M(()=>{const $={};x.pastesHorneados.forEach(h=>{$[h.relleno]||($[h.relleno]={totalPiezas:0,items:[]}),$[h.relleno].totalPiezas+=Number(h.piezas),$[h.relleno].items.push(h)});const g=[];return Object.keys($).forEach(h=>{$[h].items.forEach((I,D)=>{g.push({...I,totalPiezas:$[h].totalPiezas,isFirst:D===0})})}),g}),T=M(()=>_.value.reduce(($,g)=>Number($)+(g.isFirst?Number(g.totalPiezas):0),0)),N=$=>new Date($).toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"America/Mexico_City"}),p=$=>new Date($).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",timeZone:"America/Mexico_City"});return($,g)=>(d(),c("div",null,[e("h1",Ce,[q(" Pastes/Empanadas horneados del "+i(ue(x).fechaFiltro||"hoy")+" ",1),g[0]||(g[0]=e("span",{title:"Muestra los pastes y empanadas registrados como horneados en la fecha seleccionada desde el Control de Producci√≥n",class:"inline-flex items-center justify-center w-4 h-4 text-xs font-bold text-white bg-gray-400 rounded-full cursor-help"},"?",-1))]),e("div",Ee,[e("div",He,[e("table",Te,[g[3]||(g[3]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Responsable"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Paste/Empanada"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Hora"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"D√≠a"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Piezas Horneadas"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Total del d√≠a")])],-1)),e("tbody",Ne,[(d(!0),c(P,null,z(_.value,(h,I)=>{var D,A,V;return d(),c("tr",{key:I},[e("td",Fe,i((D=h==null?void 0:h.responsable)==null?void 0:D.name)+" "+i(((A=h==null?void 0:h.responsable)==null?void 0:A.apellido_p)||"")+" "+i(((V=h==null?void 0:h.responsable)==null?void 0:V.apellido_m)||""),1),e("td",Pe,i(h.relleno),1),e("td",Le,i(N(h.updated_at)),1),e("td",ze,i(p(h.updated_at)),1),e("td",Ie,i(h.piezas),1),e("td",Ae,[h.isFirst?(d(),c("span",Ve,i(h.totalPiezas),1)):O("",!0)])])}),128))]),e("tfoot",je,[e("tr",null,[g[1]||(g[1]=e("td",{colspan:"3",class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},"Total de piezas horneadas:",-1)),e("td",Be,i(T.value),1),g[2]||(g[2]=e("td",null,null,-1))])])])])])]))}},Oe=De(Re,[["__scopeId","data-v-8268afb9"]]),Ue={class:"pt-16"},qe={class:"max-w-7xl mx-auto space-y-6"},We={class:"bg-white rounded-lg shadow p-6"},Ge={class:"text-2xl font-bold text-gray-900"},Je={class:"mt-4"},Xe=["value"],Ze={key:0,class:"bg-white rounded-lg shadow overflow-x-auto"},Qe={class:"min-w-full divide-y divide-gray-200"},Ke={class:"bg-gray-50"},Ye={class:"bg-white divide-y divide-gray-200"},et={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},tt=["onUpdate:modelValue"],at={key:1,class:"w-full flex justify-end"},ot={__name:"EstimacionPastes",setup(S){const{props:x}=ee(),_=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","S√°bado"],T=new Date().getDay(),N=_[T],p=H(N||"Lunes"),$=H(!1),g=[{value:"Lunes",label:"Lunes"},{value:"Martes",label:"Martes"},{value:"Miercoles",label:"Mi√©rcoles"},{value:"Jueves",label:"Jueves"},{value:"Viernes",label:"Viernes"},{value:"S√°bado",label:"S√°bado"},{value:"Domingo",label:"Domingo"}],h=["7:00 am","8:00 am","9:00 am","10:00 am","11:00 am","12:00 pm","1:00 pm","2:00 pm","3:00 pm","4:00 pm","5:00 pm","6:00 pm","7:00 pm","8:00 pm","9:00 pm"],I=M(()=>x.inventario.filter(C=>["pastes","empanadas dulces","empanadas saladas"].includes(C.tipo)).map(C=>C.nombre)),D=H({}),A=U.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:C=>{C.onmouseenter=U.stopTimer,C.onmouseleave=U.resumeTimer}}),V=()=>{const C={};return h.forEach(E=>{C[E]={},I.value.forEach(m=>{C[E][m]=0})}),C},G=()=>{$.value=!1,D.value=V(),x.estimaciones.filter(E=>E.dia===p.value).forEach(({hora:E,cantidad:m,inventario_id:R})=>{var w;const W=(w=x.inventario.find(u=>u.id===R))==null?void 0:w.nombre;W&&D.value[E]&&(D.value[E][W]=m)}),$.value=!0},J=()=>{te.post("/estimaciones",{estimaciones:D.value,dia:p.value},{preserveState:!1,preserveScroll:!0,onSuccess:()=>A.fire({icon:"success",title:"Estimaciones guardados exitosamente"}),onError:()=>A.fire({icon:"error",title:"Error al guardar las estimaciones"})})};return le(()=>{G()}),pe(p,()=>{G()}),(C,E)=>(d(),c("div",Ue,[e("div",qe,[e("header",We,[e("h1",Ge,"Sistema de Control de Producci√≥n - D√≠a: "+i(p.value),1),e("div",Je,[Z(e("select",{"onUpdate:modelValue":E[0]||(E[0]=m=>p.value=m),class:"rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500"},[(d(),c(P,null,z(g,m=>e("option",{key:m.value,value:m.value},i(m.label),9,Xe)),64))],512),[[me,p.value]])])]),$.value?(d(),c("div",Ze,[e("table",Qe,[e("thead",Ke,[e("tr",null,[E[1]||(E[1]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo",-1)),(d(!0),c(P,null,z(I.value,m=>(d(),c("th",{key:m,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},i(m),1))),128))])]),e("tbody",Ye,[(d(),c(P,null,z(h,m=>e("tr",{key:m},[e("td",et,i(m),1),(d(!0),c(P,null,z(I.value,R=>(d(),c("td",{key:R,class:"px-6 py-4 whitespace-nowrap"},[Z(e("input",{type:"number","onUpdate:modelValue":W=>D.value[m][R]=W,class:"w-20 rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500",min:"0"},null,8,tt),[[ie,D.value[m][R]]])]))),128))])),64))])])])):O("",!0),C.$page.props.auth.user.roles[0].name=="admin"?(d(),c("div",at,[e("button",{onClick:J,class:"px-3 py-2 bg-orange-500 rounded-lg text-white hover:bg-orange-400"}," Guardar ")])):O("",!0)])]))}},st={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},nt={class:"bg-white shadow rounded-lg p-6"},rt={class:"mb-6"},it={class:"list-disc pl-5"},lt={class:"capitalize"},dt={class:"font-semibold"},ct={class:"list-disc pl-5"},ut={class:"font-semibold"},pt={class:"bg-white shadow rounded-lg p-6"},mt=["value"],ft=["max"],ht=["disabled"],xt={key:0,class:"text-sm text-red-600 mt-2"},vt={key:0},gt={key:1},yt={class:"mt-8"},bt={class:"bg-white shadow rounded-lg p-6 mb-4"},_t={class:"mb-4"},wt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},$t={class:"flex justify-between"},Mt={class:"text-xl font-semibold mb-4"},Dt=["onClick"],kt={key:0},St={key:0,class:"mb-3 flex items-center gap-2 bg-blue-50 border border-blue-200 rounded-md px-3 py-2"},Ct={class:"text-sm text-blue-800"},Et={class:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 mb-4"},Ht={key:1},Tt=["disabled"],Nt={class:"mt-8 bg-white shadow rounded-lg p-6"},Ft={key:0,class:"text-gray-500 text-center py-4"},Pt={key:1,class:"divide-y divide-gray-200"},Lt=["onClick"],zt={__name:"SistemaHorneado",setup(S){var ne,re;const{props:x}=ee(),_=x.inventario||[],T=H(x.hornos||[]),N=H(""),p=H(T.value.map(n=>({...n,horneando:n.estado||!1,pastesHorneando:n.pastesHorneando||[],tiempoInicio:n.tiempo_inicio?new Date(n.tiempo_inicio).getTime():0,tiempoFin:n.tiempo_fin?new Date(n.tiempo_fin).getTime():0,tiempoTranscurrido:0,timer:null,labeltime:"00:00"}))),$=H(9e5),g=H([]),h=H(!0),I=()=>{if(g.value.length===0)return;const n=p.value.find(o=>!o.horneando);if(n){n.horneando=!0,n.pastesHorneando=[...g.value],n.operario=N.value||null,g.value=[],n.tiempoInicio=Date.now(),n.tiempoFin=n.tiempoInicio+$.value;try{ae.post("/iniciar-horneado",{horno_id:n.id,tiempo_inicio:n.tiempoInicio,tiempo_fin:n.tiempoFin,pastes_horneando:n.pastesHorneando,estado:!0,matricula:N.value}).then(o=>{console.log(o)}).catch(o=>{console.error("Error al iniciar el horneado:",o)}),N.value="",U.fire({icon:"success",title:"Horneando",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500}),X(n.id)}catch(o){console.error("Error al iniciar el horneado:",o),U.fire({icon:"error",title:"Error al iniciar",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}}else se()},D=U.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:n=>{n.addEventListener("mouseenter",U.stopTimer),n.addEventListener("mouseleave",U.resumeTimer)}}),A=async n=>{const o=p.value.find(r=>r.id===n);if(!(!o||!o.horneando))try{clearInterval(o.timer);const r=[...o.pastesHorneando],a=o.operario||null;o.horneando=!1,o.pastesHorneando=[],o.operario=null,o.tiempoTranscurrido=0,o.labeltime="00:00",V();for(const t of r){const s=_.find(l=>l.nombre.toLowerCase()===t.nombre.toLowerCase()&&(l.tipo==="pastes"||l.tipo==="empanadas saladas"||l.tipo==="empanadas dulces"));if(s)try{await ae.post("/api/control-produccion/horneado",{horno_id:n,paste_id:s.id,cantidad:t.cantidad})}catch(l){console.error(`Horno ${n} - Error al registrar producci√≥n para ${t.nombre}:`,l)}else console.error(`Horno ${n} - No se encontr√≥ el paste ${t.nombre} en el inventario`)}ae.post("/hornear",{horno_id:n,pastes:r,matricula:a},{headers:{Accept:"application/json"}}).then(()=>{D.fire({icon:"success",title:"Horneado finalizado"}),ee().url.startsWith("/hornear")&&te.reload({only:["inventario","hornos","notificaciones"]})}).catch(t=>{console.error(`Horno ${n} - Error al registrar el horneado:`,t),D.fire({icon:"error",title:"Error al registrar el horneado"})})}catch(r){console.error(`Horno ${n} - Error en finalizarHorneado:`,r)}},V=()=>{new Audio("/sound/videoplayback.mp3").play().catch(o=>console.error("Error al reproducir el sonido:",o))},G=M(()=>_.filter(n=>n.tipo==="masa")),J=M(()=>_.filter(n=>n.tipo==="relleno")),C=M(()=>G.value.map(n=>{const o=p.value.filter(r=>r.horneando&&r.pastesHorneando.some(a=>a.masa===n.nombre)).reduce((r,a)=>r+a.pastesHorneando.find(t=>t.masa===n.nombre).cantidad,0);return{...n,cantidad:Math.max(0,n.cantidad-o)}})),E=M(()=>J.value.map(n=>{const o=p.value.filter(r=>r.horneando&&r.pastesHorneando.some(a=>a.nombre===n.nombre)).reduce((r,a)=>r+a.pastesHorneando.find(t=>t.nombre===n.nombre).cantidad,0);return{...n,cantidad:Math.max(0,n.cantidad-o)}})),m=H({masa:"",relleno:"",cantidad:1,sucursal_id:(re=(ne=x.auth)==null?void 0:ne.user)==null?void 0:re.sucursal_id}),R=n=>{const o={pastes:"bola","empanadas saladas":"salada","empanadas dulces":"dulce"},r=_.find(a=>(a.nombre.toLowerCase()===n.value.relleno.toLowerCase()||a.nombre.toLowerCase().startsWith(n.value.relleno.toLowerCase()))&&o[a.tipo.toLowerCase()]);return r?o[r.tipo.toLowerCase()]:"bola"},W=()=>{var t,s,l,b;const n=R(m).toLowerCase(),o=C.value.find(f=>f.nombre.toLowerCase()===n),r=E.value.find(f=>f.nombre.toLowerCase()===m.value.relleno.toLowerCase());if(!o||o.cantidad<=0){D.fire({icon:"error",title:"No hay suficiente masa disponible"});return}if(!r||r.cantidad<=0){D.fire({icon:"error",title:"No hay suficiente relleno disponible"});return}const a=Math.min(o.cantidad,r.cantidad);if(m.value.cantidad>a){D.fire({icon:"error",title:`Solo hay ${a} unidades disponibles (${o.cantidad} masa, ${r.cantidad} relleno)`});return}if(o&&r&&m.value.cantidad<=a){o.cantidad-=m.value.cantidad,r.cantidad-=m.value.cantidad;const f=g.value.find(v=>v.nombre===r.nombre);f?f.cantidad+=m.value.cantidad:k({id:Date.now(),masa:o.nombre,nombre:r.nombre,cantidad:m.value.cantidad,sucursal_id:(s=(t=x.auth)==null?void 0:t.user)==null?void 0:s.sucursal_id}),m.value={masa:"",relleno:"",cantidad:1,sucursal_id:(b=(l=x.auth)==null?void 0:l.user)==null?void 0:b.sucursal_id}}},w=M(()=>{const n=R(m).toLowerCase(),o=C.value.find(a=>a.nombre.toLowerCase()===n),r=E.value.find(a=>a.nombre===m.value.relleno);return!o||!r?0:Math.min(o.cantidad,r.cantidad)}),u=M(()=>{const n=R(m).toLowerCase(),o=C.value.find(t=>t.nombre.toLowerCase()===n),r=E.value.find(t=>t.nombre===m.value.relleno);if(!o||!r)return!1;const a=Math.min(o.cantidad,r.cantidad);return m.value.relleno&&m.value.cantidad>0&&m.value.cantidad<=a&&a>0});H("00:00");const y=n=>{if(n<=0)return"00:00";const o=Math.floor(n/1e3),r=Math.floor(o/60),a=o%60;return`${String(r).padStart(2,"0")}:${String(a).padStart(2,"0")}`},k=n=>{const o=_.find(r=>r.nombre.toLowerCase()===n.nombre.toLowerCase()&&(r.tipo==="pastes"||r.tipo==="empanadas saladas"||r.tipo==="empanadas dulces"));o?g.value.push({...n,paste_id:o.id}):console.error(`No se encontr√≥ el paste ${n.nombre} en el inventario`)},j=n=>{g.value=g.value.filter(o=>o.id!==n)},F=n=>{h.value&&A(n).catch(o=>{console.error(`Error al finalizar horneado desde timer: ${o}`)})},X=n=>{const o=p.value.find(t=>t.id===n);if(!o)return;const a=o.tiempoFin-Date.now();if(a<=0){F(n);return}o.tiempoTranscurrido=$.value-a,o.labeltime=y(a),o.timer&&clearInterval(o.timer),o.timer=setInterval(()=>{const t=o.tiempoFin-Date.now();if(t<=0){clearInterval(o.timer),F(n);return}o.tiempoTranscurrido=$.value-t,o.labeltime=y(t)},1e3)},Q=n=>{const o=p.value.find(t=>t.id===n);if(!o)return;const a=o.tiempoFin-Date.now();if(a<=0){F(n);return}o.tiempoTranscurrido=$.value-a,o.labeltime=y(a),o.timer&&clearInterval(o.timer),o.timer=setInterval(()=>{const t=o.tiempoFin-Date.now();if(t<=0){clearInterval(o.timer),F(n);return}o.tiempoTranscurrido=$.value-t,o.labeltime=y(t)},1e3)};le(()=>{p.value.forEach(n=>{n.timer&&clearInterval(n.timer)}),p.value.forEach(n=>{if(n.estado){const o=Date.now()-new Date(n.tiempo_inicio).getTime(),r=$.value-o;if(r<=0){F(n.id);return}n.tiempoFin=Date.now()+r,Q(n.id)}})}),he(()=>{h.value=!1,p.value.forEach(n=>{n.timer&&clearInterval(n.timer)})});const se=()=>{te.post("/crear-horno",{estado:!1,pastesHorneando:[]},{preserverScroll:!0,preserveState:!1,onSuccess:n=>{var o;T.value=(o=n==null?void 0:n.props)==null?void 0:o.hornos,g.value=[],p.value=T.value.map(r=>({...r,horneando:r.estado||!1,pastesHorneando:r.pastesHorneando||[],tiempoInicio:r.tiempo_inicio?new Date(r.tiempo_inicio).getTime():0,tiempoFin:r.tiempo_fin?new Date(r.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),U.fire({icon:"success",title:"Horno creado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:n=>{console.error("Error al crear el horno:",n),U.fire({icon:"error",title:"Error al crear horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})},de=n=>{te.post("/eliminar-horno",{horno_id:n},{preserveScroll:!0,preserveState:!1,onSuccess:o=>{var r;T.value=(r=o==null?void 0:o.props)==null?void 0:r.hornos,p.value=T.value.map(a=>({...a,horneando:a.estado||!1,pastesHorneando:a.pastesHorneando||[],tiempoInicio:a.tiempo_inicio?new Date(a.tiempo_inicio).getTime():0,tiempoFin:a.tiempo_fin?new Date(a.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),U.fire({icon:"success",title:"Horno eliminado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:o=>{console.error("Error al eliminar el horno:",o),U.fire({icon:"error",title:"Error al eliminar horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})};return(n,o)=>(d(),c(P,null,[e("div",st,[e("div",nt,[o[5]||(o[5]=e("h2",{class:"text-xl font-semibold mb-4"},"Ingredientes Disponibles",-1)),e("div",rt,[o[3]||(o[3]=e("h3",{class:"text-lg font-medium mb-2"},"Masas",-1)),e("ul",it,[(d(!0),c(P,null,z(C.value,r=>(d(),c("li",{key:r.id,class:"flex justify-between"},[e("span",lt,i(r.nombre),1),e("span",dt,i(r.cantidad)+" unidades",1)]))),128))])]),e("div",null,[o[4]||(o[4]=e("h3",{class:"text-lg font-medium mb-2"},"Rellenos",-1)),e("ul",ct,[(d(!0),c(P,null,z(E.value,r=>(d(),c("li",{key:r.id,class:"flex justify-between"},[e("span",null,i(r.nombre),1),e("span",ut,i(r.cantidad)+" unidades",1)]))),128))])])]),e("div",pt,[o[9]||(o[9]=e("h2",{class:"text-xl font-semibold mb-4"},"Crear Nuevo Paste/Empanada",-1)),e("form",{onSubmit:_e(W,["prevent"]),class:"space-y-4"},[e("div",null,[o[7]||(o[7]=e("label",{for:"relleno",class:"block text-sm font-medium text-gray-700"},"Seleccionar Relleno",-1)),Z(e("select",{"onUpdate:modelValue":o[0]||(o[0]=r=>m.value.relleno=r),id:"relleno",required:"",class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md"},[o[6]||(o[6]=e("option",{value:""},"Seleccione un relleno",-1)),(d(!0),c(P,null,z(J.value,r=>(d(),c("option",{key:r.id,value:r.nombre},i(r.nombre),9,mt))),128))],512),[[me,m.value.relleno]])]),e("div",null,[o[8]||(o[8]=e("label",{for:"cantidad",class:"block text-sm font-medium text-gray-700"},"Cantidad",-1)),Z(e("input",{"onUpdate:modelValue":o[1]||(o[1]=r=>m.value.cantidad=r),type:"number",id:"cantidad",required:"",min:"1",max:w.value,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 sm:text-sm"},null,8,ft),[[ie,m.value.cantidad,void 0,{number:!0}]])]),e("button",{type:"submit",disabled:!u.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed"},i(u.value?"Asignar Unidades":"Sin ingredientes suficientes"),9,ht),m.value.relleno&&!u.value?(d(),c("div",xt,[w.value===0?(d(),c("span",vt,"No hay ingredientes disponibles")):(d(),c("span",gt,"M√°ximo disponible: "+i(w.value)+" unidades",1))])):O("",!0)],32)])]),e("div",yt,[e("div",bt,[o[11]||(o[11]=e("h2",{class:"text-xl font-semibold mb-4"},"Informaci√≥n del Operario",-1)),e("div",_t,[o[10]||(o[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Matr√≠cula",-1)),Z(e("input",{"onUpdate:modelValue":o[2]||(o[2]=r=>N.value=r),type:"text",placeholder:"Ingresa tu matr√≠cula",class:"w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[ie,N.value]])])]),e("div",wt,[(d(!0),c(P,null,z(p.value,(r,a)=>(d(),c("div",{key:r.id,class:"bg-white shadow rounded-lg p-6"},[e("div",$t,[e("h2",Mt,"Horno "+i(a+1),1),!r.horneando&&T.value.length>1?(d(),c("button",{key:0,onClick:t=>de(r.id),class:"flex items-center gap-2 bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"},[Y(ue(Se),{class:"w-4 h-4"})],8,Dt)):O("",!0)]),r.horneando?(d(),c("div",kt,[r.operario?(d(),c("div",St,[o[13]||(o[13]=e("svg",{class:"w-4 h-4 text-blue-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),e("span",Ct,[o[12]||(o[12]=q("Operario: ")),e("strong",null,i(r.operario),1)])])):O("",!0),o[14]||(o[14]=e("p",{class:"text-lg mb-2"},"Horneando grupo de pastes:",-1)),e("ul",null,[(d(!0),c(P,null,z(r.pastesHorneando,t=>(d(),c("li",{key:t.nombre},i(t.cantidad)+" "+i(t.nombre)+" - masa "+i(t.masa),1))),128))]),e("div",Et,[e("div",{class:"bg-orange-600 h-2.5 rounded-full transition-all duration-100",style:we({width:`${r.tiempoTranscurrido/$.value*100}%`})},null,4)]),e("p",null,"Tiempo restante: "+i(r.labeltime),1)])):(d(),c("div",Ht,[o[15]||(o[15]=e("p",{class:"text-lg mb-4"},"El horno est√° disponible",-1)),e("button",{onClick:I,disabled:!g.value.length,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Iniciar Horneado de Grupo ",8,Tt)]))]))),128)),e("div",{class:"mt-4 h-full flex justify-center items-center"},[e("button",{onClick:se,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500"}," Crear Nuevo Horno ")])])]),e("div",Nt,[o[16]||(o[16]=e("h2",{class:"text-xl font-semibold mb-4"},"Grupos de Pastes por Hornear",-1)),g.value.length===0?(d(),c("div",Ft," No hay grupos de pastes en la cola de horneado ")):(d(),c("ul",Pt,[(d(!0),c(P,null,z(g.value,r=>(d(),c("li",{key:r.id,class:"py-4 flex justify-between items-center"},[e("span",null,i(r.cantidad)+" "+i(r.nombre)+" - masa "+i(r.masa),1),e("button",{onClick:a=>j(r.id),class:"bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"}," Cancelar ",8,Lt)]))),128))]))])],64))}},It={key:0,class:"mt-8 bg-white shadow rounded-lg p-6"},At={class:"flex justify-between items-center mb-4"},Vt={class:"text-sm text-gray-600 mt-1"},jt={class:"font-medium"},Bt={key:0,class:"ml-2 inline-flex items-center text-blue-600"},Rt={class:"flex items-center space-x-4"},Ot={class:"flex items-center space-x-2"},Ut=["max"],qt={class:"flex items-center space-x-2"},Wt=["value"],Gt={class:"mb-6"},Jt={class:"flex justify-between items-center mb-2"},Xt={class:"flex items-center space-x-2"},Zt={class:"text-sm text-gray-600"},Qt={class:"font-medium"},Kt={class:"font-medium"},Yt={key:0,class:"flex items-center space-x-1"},ea={key:0,class:"text-center py-12"},ta={class:"flex flex-col items-center space-y-4"},aa={class:"text-center"},oa={class:"text-sm text-gray-500"},sa={key:1,class:"overflow-x-auto"},na={class:"min-w-full divide-y divide-gray-200"},ra={class:"bg-white divide-y divide-gray-200"},ia={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 capitalize"},la={class:"text-xs text-gray-500 block capitalize"},da={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ca={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ua={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},pa={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize"},ma={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},fa={class:"px-6 py-4 whitespace-nowrap"},ha={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},xa={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},va={key:2,class:"text-center py-12"},ga={class:"flex flex-col items-center space-y-4"},ya={class:"text-center"},ba={class:"text-lg font-medium text-gray-700"},_a={class:"text-sm text-gray-500 mt-1"},wa={class:"mt-8"},$a={class:"flex justify-between items-center mb-2"},Ma={class:"text-sm text-gray-600"},Da={class:"font-medium"},ka={class:"overflow-x-auto"},Sa={class:"min-w-full divide-y divide-gray-200"},Ca={class:"bg-white divide-y divide-gray-200"},Ea={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Ha={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ta={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Na={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Fa={class:"px-6 py-4 whitespace-nowrap capitalize"},Pa={key:0,class:"text-center py-8"},La={__name:"ControlProduccion",setup(S){const{props:x}=ee(),_=H(),T=H("actual"),N=H(!1),p=H({faltantes:[],horneados:[]}),$=M(()=>{var s,l;const a=(s=x.auth)==null?void 0:s.user,t=a==null?void 0:a.roles;return t&&t.length>0&&((l=t[0])==null?void 0:l.name)==="admin"}),g=H([{value:"todas",label:"Todas las horas"},{value:"actual",label:"Hora Siguiente"},{value:"7-am",label:"7:00 AM"},{value:"8-am",label:"8:00 AM"},{value:"9-am",label:"9:00 AM"},{value:"10-am",label:"10:00 AM"},{value:"11-am",label:"11:00 AM"},{value:"12-pm",label:"12:00 PM"},{value:"1-pm",label:"1:00 PM"},{value:"2-pm",label:"2:00 PM"},{value:"3-pm",label:"3:00 PM"},{value:"4-pm",label:"4:00 PM"},{value:"5-pm",label:"5:00 PM"},{value:"6-pm",label:"6:00 PM"},{value:"7-pm",label:"7:00 PM"},{value:"8-pm",label:"8:00 PM"},{value:"9-pm",label:"9:00 PM"},{value:"10-pm",label:"10:00 PM"},{value:"11-pm",label:"11:00 PM"}]),h=()=>{try{const a=new Date;return new Date(a.toLocaleString("en-US",{timeZone:"America/Mexico_City"})).toISOString().split("T")[0]}catch(a){return console.error("Error al obtener fecha M√©xico:",a),new Date().toISOString().split("T")[0]}},I=()=>{const a=new Date,t=new Date(a.getTime()+60*60*1e3),s=new Date(t);s.setMinutes(0,0,0);const l=s.getHours(),b=l>=12?"pm":"am";return`${l%12||12}-${b}`},D=a=>{if(!a||typeof a!="string")return"";try{if(a.includes("-"))return a;const t=a.match(/(\d+):(\d+)\s*(am|pm)/i);if(t){const[,s,l,b]=t;return`${parseInt(s)%12||12}-${b.toLowerCase()}`}if(a.includes(":")){const[s,l]=a.split(":"),b=parseInt(s),f=b>=12?"pm":"am";return`${b%12||12}-${f}`}return""}catch(t){return console.error("Error al convertir hora notificaci√≥n:",a,t),""}},A=M(()=>{var s,l,b;let a=[];if(((l=(s=p.value)==null?void 0:s.faltantes)==null?void 0:l.length)>0)a=p.value.faltantes;else{const f=h();if(_.value===f&&((b=x.notificaciones)!=null&&b.faltantes))a=x.notificaciones.faltantes;else return[]}if(T.value==="todas")return a;if(T.value==="actual"){const f=I();return a.filter(L=>L.hora_notificacion?D(L.hora_notificacion)===f:!1)}return a.filter(f=>f.hora_notificacion?D(f.hora_notificacion)===T.value:!1)}),V=M(()=>{var s,l,b,f,v,L;let a=[];((l=(s=p.value)==null?void 0:s.faltantes)==null?void 0:l.length)>0?a=[...a,...p.value.faltantes]:(b=x.notificaciones)!=null&&b.faltantes&&(a=[...a,...x.notificaciones.faltantes]),((v=(f=p.value)==null?void 0:f.horneados)==null?void 0:v.length)>0?a=[...a,...p.value.horneados]:(L=x.notificaciones)!=null&&L.horneados&&(a=[...a,...x.notificaciones.horneados]);const t=a.filter(B=>B.estado==="en_espera"||!B.tiempo_inicio_horneado?!1:["horneando","vendido","desperdicio","retirado"].includes(B.estado));return console.log("üîç Control de Tiempo - Total notificaciones:",a.length),console.log("üîç Control de Tiempo - Filtradas por estado:",t.length),console.log("üîç Control de Tiempo - Estados encontrados:",[...new Set(a.map(B=>B.estado))]),t}),G=M(()=>{var a,t;return((t=(a=p.value)==null?void 0:a.faltantes)==null?void 0:t.length)||0}),J=async()=>{_.value&&(await E(_.value),te.get("/hornear",{fecha:_.value},{only:["pastesHorneados","fechaFiltro"],preserveState:!0,preserveScroll:!0}))},C=()=>{},E=async a=>{try{N.value=!0,p.value={faltantes:[],horneados:[]},await new Promise(s=>setTimeout(s,300));const t=await ae.post(route("control.produccion.notificaciones"),{fecha:a});t.data.success?p.value=t.data.notificaciones:(console.error("‚ùå Error en respuesta:",t.data.message),p.value={faltantes:[],horneados:[]})}catch(t){console.error("‚ùå Error al cargar notificaciones:",t),p.value={faltantes:[],horneados:[]}}finally{N.value=!1}};le(()=>{_.value=x.fechaFiltro||x.fechaActual||h(),_.value&&E(_.value)}),M(()=>A.value.filter(a=>a.tiempo_inicio_horneado).map(a=>({paste:a.paste.nombre,...m(a)}))),M(()=>{var a;return(a=x.notificaciones)!=null&&a.faltantes?x.notificaciones.faltantes.map(t=>({id:t.id,paste:t.paste,cantidad:t.cantidad,hora_notificacion:t.hora_notificacion,dia_notificacion:t.dia_notificacion,estado:t.estado,tiempo_inicio_horneado:t.tiempo_inicio_horneado,hora_ultima_venta:t.hora_ultima_venta,cantidad_vendida:t.cantidad_vendida,created_at:t.created_at})):[]}),M(()=>{var a;return(a=x.notificaciones)!=null&&a.horneados?x.notificaciones.horneados:[]});const m=a=>{if(!a.tiempo_inicio_horneado)return{promedio:0,ultima:"N/A",restante:"N/A"};try{const t=new Date(a.tiempo_inicio_horneado),s=new Date(a.created_at);if(isNaN(t.getTime())||isNaN(s.getTime()))return{promedio:0,ultima:"N/A",restante:"N/A"};const l=Math.max(0,t-s),b=Math.floor(l/(1e3*60));return{promedio:b,ultima:o(a.tiempo_inicio_horneado),restante:b>0?`${b} min`:"Completado"}}catch(t){return console.error("Error al calcular tiempo de reposici√≥n:",t),{promedio:0,ultima:"Error",restante:"Error"}}},R=a=>{if(!a.tiempo_inicio_horneado||!a.created_at)return"N/A";try{const t=new Date(a.created_at),s=new Date(a.tiempo_inicio_horneado);if(isNaN(t.getTime())||isNaN(s.getTime()))return"N/A";const l=t.toDateString(),b=s.toDateString();if(l!==b)return"Diferente d√≠a";const f=Math.max(0,s-t),v=Math.floor(f/(1e3*60));if(v===0)return"0 min";if(v>1440)return"Error de c√°lculo";if(v<60)return`${v} min`;{const L=Math.floor(v/60),B=v%60;return`${L}:${B.toString().padStart(2,"0")} hrs`}}catch(t){return console.error("Error al calcular tiempo de producci√≥n:",t),"Error"}},W=a=>{if(!a||typeof a!="string")return 0;try{const[t,s]=a.toLowerCase().split(" ");let[l,b]=t.split(":");return l=parseInt(l,10),l===12?l=s==="am"?0:12:s==="pm"&&(l=l+12),l}catch(t){return console.error("Error al convertir hora:",a,t),0}},w=()=>["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","S√°bado"][new Date().getDay()],u=M(()=>{var a;return((a=x.inventario)==null?void 0:a.filter(t=>["pastes","empanadas dulces","empanadas saladas"].includes(t.tipo)))||[]}),y=M(()=>{const a=new Map(u.value.map(s=>[s.id,s]));return(x.estimacionesHoy||[]).map(s=>{const l=a.get(s.inventario_id);if(!l)return null;const b=W(s.hora);return{id:`${l.id}-${s.hora}`,nombre:l.nombre,estimado:parseInt(s.cantidad),existente:l.cantidad,diferencia:l.cantidad-parseInt(s.cantidad),hora:s.hora,dia:s.dia,horaEnNumero:b,tipo:l.tipo}}).filter(Boolean)}),k=M(()=>y.value.filter(t=>t.dia===w())),j=M(()=>{const t=(new Date().getHours()+1)%24,s=k.value.filter(f=>(f.horaEnNumero||W(f.hora))===t),l=new Map(s.map(f=>[f.nombre,f]));return u.value.map(f=>{const v=l.get(f.nombre);return v||{id:`${f.id}-${t}:00`,nombre:f.nombre,estimado:0,existente:f.cantidad,diferencia:f.cantidad,hora:`${t}:00`,dia:w(),horaEnNumero:t,tipo:f.tipo}})}),F=M(()=>j.value.filter(t=>{const l=t.estimado*.7;return t.estimado>0&&t.existente<l}).map(t=>({id:t.id,paste:{nombre:t.nombre,tipo:t.tipo},cantidad:Math.abs(t.diferencia),hora_notificacion:t.hora,dia_notificacion:t.dia,estado:"pendiente",created_at:new Date().toISOString(),cantidad_horneada:0,cantidad_vendida:0,hora_ultima_venta:null,tiempo_inicio_horneado:null}))),X=H(!1);let Q=null;const se=async a=>{var t,s;if(!(X.value||!(a!=null&&a.length))){X.value=!0;try{await ae.post(route("notificaciones.registrar-batch"),{sucursal_id:(s=(t=x.auth)==null?void 0:t.user)==null?void 0:s.sucursal_id,notificaciones:a.map(l=>({notificacion_id:String(l.id),cantidad:l.cantidad}))})}catch(l){console.error("Error al registrar notificaciones en batch:",l)}finally{X.value=!1}}};pe(()=>F.value,a=>{Q&&clearTimeout(Q),Q=setTimeout(()=>{(a==null?void 0:a.length)>0&&se(a)},2e3)},{deep:!0});const de=a=>{if(!a.tiempo_inicio_horneado||!a.created_at)return"No iniciado";try{const t=new Date(a.created_at),s=new Date(a.tiempo_inicio_horneado);if(isNaN(t.getTime())||isNaN(s.getTime()))return"Fecha inv√°lida";const l=t.toDateString(),b=s.toDateString();if(l!==b)return"Diferente d√≠a";const f=Math.max(0,s-t),v=Math.floor(f/(1e3*60));if(v===0)return"0 min";if(v<60)return`${v} min`;{const L=Math.floor(v/60),B=v%60;return`${L}:${B.toString().padStart(2,"0")} hrs`}}catch(t){return console.error("Error al calcular tiempo de horneado:",t),"Error"}},ne=a=>{if(!a.created_at)return"N/A";try{const t=new Date(a.created_at);if(isNaN(t.getTime()))return"Fecha inv√°lida";if(!a.hora_ultima_venta){const L=new Date,B=Math.max(0,L-t),K=Math.floor(B/(1e3*60)),xe=t.toDateString(),ve=L.toDateString();if(xe!==ve)return"Diferente d√≠a";if(K>1440)return"Sin ventas del d√≠a";if(K<60)return`${K} min`;{const ge=Math.floor(K/60),ye=K%60;return`${ge}:${ye.toString().padStart(2,"0")} hrs`}}const s=new Date(a.hora_ultima_venta);if(isNaN(s.getTime()))return"Fecha de venta inv√°lida";const l=t.toDateString(),b=s.toDateString();if(l!==b)return"Diferente d√≠a";const f=Math.max(0,s-t),v=Math.floor(f/(1e3*60));if(v===0)return"0 min";if(v>1440)return"Sin ventas del d√≠a";if(v<60)return`${v} min`;{const L=Math.floor(v/60),B=v%60;return`${L}:${B.toString().padStart(2,"0")} hrs`}}catch(t){return console.error("Error al calcular tiempo de venta:",t),"Error"}},re=a=>{if(!a.tiempo_inicio_horneado||!a.created_at)return!1;try{const t=new Date(a.created_at),s=new Date(a.tiempo_inicio_horneado);if(isNaN(t.getTime())||isNaN(s.getTime()))return!1;const l=t.toDateString(),b=s.toDateString();if(l!==b)return!1;const f=s-t,v=Math.floor(f/(1e3*60));return v>=0&&v<=1440}catch(t){return console.error("Error al validar tiempo de producci√≥n:",t),!1}},n=a=>{if(!a)return"-";try{const t=new Date(a);return isNaN(t.getTime())?"Fecha inv√°lida":t.toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0,timeZone:"America/Mexico_City"})}catch(t){return console.error("Error al formatear hora:",a,t),"Error"}},o=a=>{if(!a)return"-";try{const t=new Date(a);return isNaN(t.getTime())?"Fecha inv√°lida":t.toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0,timeZone:"America/Mexico_City"})}catch(t){return console.error("Error al formatear fecha:",a,t),"Error"}},r=a=>`px-2 py-1 rounded-full text-xs font-medium ${{horneando:"bg-yellow-100 text-yellow-800 capitalize",retirado:"bg-blue-100 text-blue-800 capitalize",vendido:"bg-green-100 text-green-800 capitalize",desperdicio:"bg-red-100 text-red-800 capitalize",pendiente:"bg-gray-100 text-gray-800 capitalize",en_espera:"bg-green-100 text-green-800"}[a]}`;return(a,t)=>$.value?(d(),c("div",It,[e("div",At,[e("div",null,[t[4]||(t[4]=e("h2",{class:"text-xl font-semibold"},"Control de Producci√≥n",-1)),e("p",Vt,[t[3]||(t[3]=q(" Mostrando datos del d√≠a: ")),e("span",jt,i(_.value||"Cargando..."),1),N.value?(d(),c("span",Bt,t[2]||(t[2]=[e("div",{class:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-500 mr-1"},null,-1),q(" Actualizando... ")]))):O("",!0)])]),e("div",Rt,[e("div",Ot,[t[5]||(t[5]=e("label",{for:"fecha",class:"text-sm font-medium text-gray-700 inline-flex items-center gap-1"},[q(" Seleccionar d√≠a: "),e("span",{title:"Filtra el Control de Producci√≥n y los pastes horneados por esta fecha",class:"inline-flex items-center justify-center w-4 h-4 text-xs font-bold text-white bg-gray-400 rounded-full cursor-help"},"?")],-1)),Z(e("input",{type:"date",id:"fecha",max:h(),"onUpdate:modelValue":t[0]||(t[0]=s=>_.value=s),onChange:J,class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},null,40,Ut),[[ie,_.value]])]),e("div",qt,[t[6]||(t[6]=e("label",{for:"hora",class:"text-sm font-medium text-gray-700"},"Filtrar por hora:",-1)),Z(e("select",{id:"hora","onUpdate:modelValue":t[1]||(t[1]=s=>T.value=s),onChange:C,class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[(d(!0),c(P,null,z(g.value,s=>(d(),c("option",{key:s.value,value:s.value},i(s.label),9,Wt))),128))],544),[[me,T.value]])])])]),e("div",Gt,[e("div",Jt,[t[9]||(t[9]=e("h3",{class:"text-lg font-medium"},"Productos Faltantes - Control de Producci√≥n",-1)),e("div",Xt,[e("div",Zt,[e("span",Qt,i(A.value.length),1),t[7]||(t[7]=q(" de ")),e("span",Kt,i(G.value),1),q(" notificaciones para "+i(_.value),1)]),N.value?(d(),c("div",Yt,t[8]||(t[8]=[e("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"},null,-1),e("span",{class:"text-xs text-blue-600"},"Cargando...",-1)]))):O("",!0)])]),N.value?(d(),c("div",ea,[e("div",ta,[t[11]||(t[11]=e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"},null,-1)),e("div",aa,[t[10]||(t[10]=e("p",{class:"text-lg font-medium text-gray-700"},"Cargando notificaciones...",-1)),e("p",oa,"Obteniendo datos para "+i(_.value),1)])])])):A.value.length>0?(d(),c("div",sa,[e("table",na,[t[12]||(t[12]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Producto"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Faltante"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Horneada"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Vendida"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"D√≠a"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora Requerida"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo Horneado"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo Venta")])],-1)),e("tbody",ra,[(d(!0),c(P,null,z(A.value,s=>(d(),c("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",ia,[q(i(s.paste.nombre)+" ",1),e("span",la,i(s.paste.tipo),1)]),e("td",da,i(s.cantidad)+" unidades ",1),e("td",ca,i(s.cantidad_horneada?`${s.cantidad_horneada} unidades`:"-"),1),e("td",ua,i(s.cantidad_vendida?`${s.cantidad_vendida} unidades`:"-"),1),e("td",pa,i(s.dia_notificacion),1),e("td",ma,i(s.hora_notificacion),1),e("td",fa,[e("span",{class:oe(["px-2 py-1 text-xs font-medium rounded-full",s.estado==="pendiente"?"bg-red-100 text-red-800":s.estado==="horneando"?"bg-yellow-100 text-yellow-800":s.estado==="en_espera"?"bg-blue-100 text-blue-800":s.estado==="vendido"?"bg-green-100 text-green-800":s.estado==="desperdicio"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"])},i(s.estado==="pendiente"?"Sin hornear":s.estado==="horneando"?"Horneando":s.estado==="en_espera"?"En espera":s.estado==="vendido"?"Vendido":s.estado==="desperdicio"?"Desperdicio":s.estado),3)]),e("td",ha,i(de(s)),1),e("td",xa,i(ne(s)),1)]))),128))])])])):(d(),c("div",va,[e("div",ga,[t[13]||(t[13]=e("div",{class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),e("div",ya,[e("h3",ba,i(G.value===0?`Sin notificaciones para ${_.value}`:"Sin notificaciones para la hora seleccionada"),1),e("p",_a,i(G.value===0?"No se encontraron productos faltantes para esta fecha":"Cambia la hora del filtro para ver m√°s notificaciones"),1)])])]))]),e("div",wa,[e("div",$a,[t[15]||(t[15]=e("h3",{class:"text-lg font-medium"},"Control de Tiempo de Producci√≥n",-1)),e("div",Ma,[e("span",Da,i(V.value.length),1),t[14]||(t[14]=q(" notificaciones procesadas "))])]),e("div",ka,[e("table",Sa,[t[16]||(t[16]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Paste"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de notificaci√≥n"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de Producci√≥n"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo en meter producci√≥n"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado")])],-1)),e("tbody",Ca,[(d(!0),c(P,null,z(V.value,s=>(d(),c("tr",{key:s.id},[e("td",Ea,i(s.paste.nombre),1),e("td",Ha,i(n(s.created_at)),1),e("td",Ta,i(re(s)?n(s.tiempo_inicio_horneado):"-"),1),e("td",Na,i(R(s)),1),e("td",Fa,[e("span",{class:oe(r(s.estado))},i(s.estado),3)])]))),128))])])]),V.value.length===0?(d(),c("div",Pa,t[17]||(t[17]=[$e('<div class="flex flex-col items-center space-y-3"><div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center"><svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><div class="text-center"><p class="text-gray-500 text-lg">No hay notificaciones procesadas</p><p class="text-gray-400 text-sm mt-1">Solo se muestran notificaciones que han sido horneadas o procesadas</p></div></div>',1)]))):O("",!0)])])):O("",!0)}},za={class:"animate-pulse"},Ia={key:0,class:"mt-2"},Aa={class:"font-bold"},fe={__name:"NotificationPanel",props:{notifications:{type:Array,required:!0,default:()=>[]},isVisible:{type:Boolean,default:!1},type:{type:String,required:!0,validator:S=>["warning","info"].includes(S)},title:{type:String,required:!0}},emits:["toggle"],setup(S,{emit:x}){return console.log(S.notifications),(T,N)=>(d(),c("div",{class:oe(["p-4 border rounded shadow mb-4 size-fit cursor-pointer",{"bg-yellow-100":S.type==="warning","bg-blue-100":S.type==="info"}]),onClick:N[0]||(N[0]=p=>T.$emit("toggle"))},[e("h2",{class:oe(["text-lg font-bold text-center",{"text-yellow-800":S.type==="warning","text-blue-800":S.type==="info"}])},[q(i(S.type==="warning"?"‚ö†Ô∏è":"‚ÑπÔ∏è")+" "+i(S.title)+" ",1),e("span",za,"("+i(S.notifications.length)+")",1),q(" "+i(S.type==="warning"?"‚ö†Ô∏è":"‚ÑπÔ∏è"),1)],2),S.isVisible?(d(),c("ul",Ia,[(d(!0),c(P,null,z(S.notifications,p=>(d(),c("li",{key:p.id,class:"mb-2"},[e("span",null,[e("span",Aa,i(p.nombre),1),q(": "+i(S.type==="warning"?"Faltan":"Hay")+" "+i(S.type==="warning"?Math.abs(p.diferencia):p.diferencia)+" unidades para las "+i(p.hora)+" ",1),e("span",{class:oe(["text-sm",{"text-red-600":S.type==="warning","text-green-600":S.type==="info"}])}," ("+i(p.porcentaje)+"% del estimado) ",3)])]))),128))])):O("",!0)],2))}},Va={class:"container mx-auto p-4"},ja={class:"sm:flex justify-between flex-row text-sm"},Ba={class:"flex gap-3 sm:flex-row flex-col"},Ra={class:"mt-6"},Oa={__name:"Hornear",setup(S){const x=H(!1),_=H(!1),T=H(null),N=H(null),{props:p}=ee(),$=M(()=>{var y,k;const w=(y=p.auth)==null?void 0:y.user,u=w==null?void 0:w.roles;return u&&u.length>0&&((k=u[0])==null?void 0:k.name)==="admin"}),g=M(()=>p.inventario||[]),h=M(()=>p.estimacionesHoy||[]),I=()=>{const w=new Date;return{day:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","S√°bado"][w.getDay()].toLowerCase(),hour:w.getHours(),minutes:w.getMinutes()}},D=H(I());pe(()=>D.value.hour,w=>{w!==T.value&&(T.value=w,E.value.length>0&&(x.value=!0),m.value.length>0&&(_.value=!0))}),le(()=>{T.value=D.value.hour,N.value=setInterval(()=>{D.value=I()},1e3)}),he(()=>{N.value&&clearInterval(N.value)});const A=w=>{const[u,y]=w.toLowerCase().split(" ");let[k,j]=u.split(":").map(Number);return{hours:y==="pm"&&k!==12?k+12:y==="am"&&k===12?0:k,minutes:j}},V=M(()=>g.value.filter(w=>{var u;return["pastes","empanadas dulces","empanadas saladas"].includes((u=w.tipo)==null?void 0:u.toLowerCase())})),G=M(()=>{if(!h.value.length||!V.value.length)return console.log("No hay estimaciones o productos relevantes"),[];const w=new Map(V.value.map(y=>[y.id,y]));return h.value.map(y=>{const k=w.get(y.inventario_id);if(!k)return null;const{hours:j}=A(y.hora);return{id:`${k.id}-${y.hora}`,nombre:k.nombre,estimado:y.cantidad,existente:k.cantidad,diferencia:k.cantidad-y.cantidad,hora:y.hora,dia:y.dia.toLowerCase(),horaEnNumero:j,tipo:k.tipo}}).filter(Boolean).filter((y,k,j)=>k===j.findIndex(F=>F.id===y.id))}),J=M(()=>G.value.filter(u=>u.dia===D.value.day)),C=M(()=>{const u=(D.value.hour+1)%24,y=J.value.filter(F=>F.horaEnNumero===u),k=new Map(y.map(F=>[F.nombre,F]));return V.value.map(F=>{const X=k.get(F.nombre);return X||{id:`${F.id}-${u}:00`,nombre:F.nombre,estimado:0,existente:F.cantidad,diferencia:F.cantidad,hora:`${u}:00`,dia:D.value.day,horaEnNumero:u,tipo:F.tipo}})}),E=M(()=>C.value.filter(u=>{const k=u.estimado*.7;return u.estimado>0&&u.existente<k}).map(u=>({...u,porcentaje:u.estimado>0?Math.round(u.existente/u.estimado*100):0}))),m=M(()=>C.value.filter(u=>u.estimado>0&&u.diferencia>0||u.estimado===0&&u.existente>0).map(u=>({...u,porcentaje:u.estimado>0?Math.round(u.existente/u.estimado*100):100}))),R=()=>x.value=!x.value,W=()=>_.value=!_.value;return(w,u)=>{var y,k,j;return d(),c("div",Va,[e("div",ja,[u[0]||(u[0]=e("h1",{class:"text-2xl font-bold mb-4"},"Sistema de Horneado",-1)),e("div",Ba,[Y(fe,{notifications:E.value,"is-visible":x.value,type:"warning",title:"Faltantes",onToggle:R},null,8,["notifications","is-visible"]),Y(fe,{notifications:m.value,"is-visible":_.value,type:"info",title:"Excedentes",onToggle:W},null,8,["notifications","is-visible"])])]),e("div",Ra,[Y(zt),Y(La),((j=(k=(y=ue(p).auth)==null?void 0:y.user)==null?void 0:k.roles)==null?void 0:j[0])!=="supervisor"?(d(),ce(Oe,{key:0})):O("",!0),$.value?(d(),ce(ot,{key:1})):O("",!0)])])}}},Ua={class:"py-6"},qa={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 rounded-xl overflow-hidden"},Wa={class:"flex justify-between p-6 lg:p-8 bg-white border-b border-gray-200 rounded-2xl"},Qa={__name:"index",setup(S){return(x,_)=>(d(),ce(be,{title:"Tablero principal"},{default:Me(()=>[e("div",Ua,[e("div",qa,[e("div",Wa,[Y(Oa)])])])]),_:1}))}};export{Qa as default};
