import{S as U,_ as ve}from"./AppLayout-8Y73kmGt.js";import{Q as ae,d as N,p as w,o as l,e as d,a,F as L,h as I,t as r,f as q,x as re,i as ue,j as Y,l as pe,v as me,z as K,k as xe,b as Q,u as he,B as ge,y as de,g as Z,n as te,C as ye,D as _e,c as ce,w as be}from"./app-BQOY_4-T.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as $e}from"./createLucideIcon-4RGDYzBb.js";/**
 * @license lucide-vue-next v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=$e("Trash2Icon",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Me={class:"bg-white rounded-lg shadow-md overflow-hidden"},Se={class:"overflow-x-auto"},Ee={class:"min-w-full divide-y divide-gray-200"},ke={class:"bg-white divide-y divide-gray-200"},Ce={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},He={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Te={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ne={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Fe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Pe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Le={key:0},ze={class:"bg-gray-50"},Ie={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Ae={__name:"PastesHorneados",setup(E){const{props:v}=ae();N(v.pastesHorneados);const b=w(()=>{const g={};v.pastesHorneados.forEach(m=>{g[m.relleno]||(g[m.relleno]={totalPiezas:0,items:[]}),g[m.relleno].totalPiezas+=Number(m.piezas),g[m.relleno].items.push(m)});const M=[];return Object.keys(g).forEach(m=>{g[m].items.forEach((A,k)=>{M.push({...A,totalPiezas:g[m].totalPiezas,isFirst:k===0})})}),M}),C=w(()=>b.value.reduce((g,M)=>Number(g)+(M.isFirst?Number(M.totalPiezas):0),0)),D=g=>new Date(g).toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"America/Mexico_City"}),p=g=>new Date(g).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",timeZone:"America/Mexico_City"});return(g,M)=>(l(),d("div",null,[M[3]||(M[3]=a("h1",{class:"pb-4 pt-10 font-semibold text-xl"},"Pastes/Empanadas horneados de hoy",-1)),a("div",Me,[a("div",Se,[a("table",Ee,[M[2]||(M[2]=a("thead",{class:"bg-gray-50"},[a("tr",null,[a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Responsable"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Paste/Empanada"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Hora"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Día"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Piezas Horneadas"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Total del día")])],-1)),a("tbody",ke,[(l(!0),d(L,null,I(b.value,(m,A)=>{var k,V,z;return l(),d("tr",{key:A},[a("td",Ce,r((k=m==null?void 0:m.responsable)==null?void 0:k.name)+" "+r(((V=m==null?void 0:m.responsable)==null?void 0:V.apellido_p)||"")+" "+r(((z=m==null?void 0:m.responsable)==null?void 0:z.apellido_m)||""),1),a("td",He,r(m.relleno),1),a("td",Te,r(D(m.updated_at)),1),a("td",Ne,r(p(m.updated_at)),1),a("td",Fe,r(m.piezas),1),a("td",Pe,[m.isFirst?(l(),d("span",Le,r(m.totalPiezas),1)):q("",!0)])])}),128))]),a("tfoot",ze,[a("tr",null,[M[0]||(M[0]=a("td",{colspan:"3",class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},"Total de piezas horneadas:",-1)),a("td",Ie,r(C.value),1),M[1]||(M[1]=a("td",null,null,-1))])])])])])]))}},Ve=we(Ae,[["__scopeId","data-v-1a02fb88"]]),je={class:"pt-16"},Be={class:"max-w-7xl mx-auto space-y-6"},Re={class:"bg-white rounded-lg shadow p-6"},Oe={class:"text-2xl font-bold text-gray-900"},Ue={class:"mt-4"},qe=["value"],Je={key:0,class:"bg-white rounded-lg shadow overflow-x-auto"},We={class:"min-w-full divide-y divide-gray-200"},Xe={class:"bg-gray-50"},Ze={class:"bg-white divide-y divide-gray-200"},Ge={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Qe=["onUpdate:modelValue"],Ke={key:1,class:"w-full flex justify-end"},Ye={__name:"EstimacionPastes",setup(E){const{props:v}=ae(),b=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"],C=new Date().getDay(),D=b[C],p=N(D||"Lunes"),g=N(!1),M=[{value:"Lunes",label:"Lunes"},{value:"Martes",label:"Martes"},{value:"Miercoles",label:"Miércoles"},{value:"Jueves",label:"Jueves"},{value:"Viernes",label:"Viernes"},{value:"Sábado",label:"Sábado"},{value:"Domingo",label:"Domingo"}],m=["7:00 am","8:00 am","9:00 am","10:00 am","11:00 am","12:00 pm","1:00 pm","2:00 pm","3:00 pm","4:00 pm","5:00 pm","6:00 pm","7:00 pm","8:00 pm","9:00 pm"],A=w(()=>v.inventario.filter(f=>["pastes","empanadas dulces","empanadas saladas"].includes(f.tipo)).map(f=>f.nombre)),k=N({}),V=U.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:f=>{f.onmouseenter=U.stopTimer,f.onmouseleave=U.resumeTimer}}),z=()=>{const f={};return m.forEach(H=>{f[H]={},A.value.forEach(S=>{f[H][S]=0})}),f},B=()=>{g.value=!1,k.value=z(),v.estimaciones.filter(H=>H.dia===p.value).forEach(({hora:H,cantidad:S,inventario_id:R})=>{var y;const O=(y=v.inventario.find(c=>c.id===R))==null?void 0:y.nombre;O&&k.value[H]&&(k.value[H][O]=S)}),g.value=!0},J=()=>{K.post("/estimaciones",{estimaciones:k.value,dia:p.value},{preserveState:!1,preserveScroll:!0,onSuccess:()=>V.fire({icon:"success",title:"Estimaciones guardados exitosamente"}),onError:()=>V.fire({icon:"error",title:"Error al guardar las estimaciones"})})};return re(()=>{B()}),ue(p,()=>{B()}),(f,H)=>(l(),d("div",je,[a("div",Be,[a("header",Re,[a("h1",Oe,"Sistema de Control de Producción - Día: "+r(p.value),1),a("div",Ue,[Y(a("select",{"onUpdate:modelValue":H[0]||(H[0]=S=>p.value=S),class:"rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500"},[(l(),d(L,null,I(M,S=>a("option",{key:S.value,value:S.value},r(S.label),9,qe)),64))],512),[[pe,p.value]])])]),g.value?(l(),d("div",Je,[a("table",We,[a("thead",Xe,[a("tr",null,[H[1]||(H[1]=a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo",-1)),(l(!0),d(L,null,I(A.value,S=>(l(),d("th",{key:S,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},r(S),1))),128))])]),a("tbody",Ze,[(l(),d(L,null,I(m,S=>a("tr",{key:S},[a("td",Ge,r(S),1),(l(!0),d(L,null,I(A.value,R=>(l(),d("td",{key:R,class:"px-6 py-4 whitespace-nowrap"},[Y(a("input",{type:"number","onUpdate:modelValue":O=>k.value[S][R]=O,class:"w-20 rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500",min:"0"},null,8,Qe),[[me,k.value[S][R]]])]))),128))])),64))])])])):q("",!0),f.$page.props.auth.user.roles[0].name=="admin"?(l(),d("div",Ke,[a("button",{onClick:J,class:"px-3 py-2 bg-orange-500 rounded-lg text-white hover:bg-orange-400"}," Guardar ")])):q("",!0)])]))}},et={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},tt={class:"bg-white shadow rounded-lg p-6"},at={class:"mb-6"},ot={class:"list-disc pl-5"},st={class:"capitalize"},nt={class:"font-semibold"},rt={class:"list-disc pl-5"},it={class:"font-semibold"},lt={class:"bg-white shadow rounded-lg p-6"},dt=["value"],ct=["max"],ut=["disabled"],pt={key:0,class:"text-sm text-red-600 mt-2"},mt={key:0},ft={key:1},ht={class:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-4"},vt={class:"flex justify-between"},xt={class:"text-xl font-semibold mb-4"},gt=["onClick"],yt={key:0},_t={class:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 mb-4"},bt={key:1},wt=["disabled"],$t={class:"mt-8 bg-white shadow rounded-lg p-6"},Dt={key:0,class:"text-gray-500 text-center py-4"},Mt={key:1,class:"divide-y divide-gray-200"},St=["onClick"],Et={__name:"SistemaHorneado",setup(E){var se,ee;const{props:v}=ae(),b=v.inventario||[],C=N(v.hornos||[]),D=N(C.value.map(n=>({...n,horneando:n.estado||!1,pastesHorneando:n.pastesHorneando||[],tiempoInicio:n.tiempo_inicio?new Date(n.tiempo_inicio).getTime():0,tiempoFin:n.tiempo_fin?new Date(n.tiempo_fin).getTime():0,tiempoTranscurrido:0,timer:null,labeltime:"00:00"}))),p=N(9e5),g=N([]),M=()=>{if(g.value.length===0)return;const n=D.value.find(s=>!s.horneando);if(n){n.horneando=!0,n.pastesHorneando=[...g.value],g.value=[],n.tiempoInicio=Date.now(),n.tiempoFin=n.tiempoInicio+p.value;try{de.post("/iniciar-horneado",{horno_id:n.id,tiempo_inicio:n.tiempoInicio,tiempo_fin:n.tiempoFin,pastes_horneando:n.pastesHorneando,estado:!0}).then(s=>{console.log(s)}).catch(s=>{console.error("Error al iniciar el horneado:",s)}),U.fire({icon:"success",title:"Horneando",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500}),j(n.id)}catch(s){console.error("Error al iniciar el horneado:",s),U.fire({icon:"error",title:"Error al iniciar",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}}else G()},m=U.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:n=>{n.addEventListener("mouseenter",U.stopTimer),n.addEventListener("mouseleave",U.resumeTimer)}}),A=async n=>{const s=D.value.find(t=>t.id===n);if(!(!s||!s.horneando))try{clearInterval(s.timer);const t=[...s.pastesHorneando];s.horneando=!1,s.pastesHorneando=[],s.tiempoTranscurrido=0,s.labeltime="00:00",k();for(const e of t){const o=b.find(i=>i.nombre.toLowerCase()===e.nombre.toLowerCase()&&(i.tipo==="pastes"||i.tipo==="empanadas saladas"||i.tipo==="empanadas dulces"));if(o)try{await de.post("/api/control-produccion/horneado",{horno_id:n,paste_id:o.id,cantidad:e.cantidad})}catch(i){console.error(`Horno ${n} - Error al registrar producción para ${e.nombre}:`,i)}else console.error(`Horno ${n} - No se encontró el paste ${e.nombre} en el inventario`)}K.post("/hornear",{horno_id:n,pastes:t},{preserveScroll:!0,preserveState:!1,replace:!0,onSuccess:()=>{m.fire({icon:"success",title:"Horneado finalizado"})},onError:e=>{console.error(`Horno ${n} - Error al registrar el horneado:`,e),m.fire({icon:"error",title:"Error al registrar el horneado"})}})}catch(t){console.error(`Horno ${n} - Error en finalizarHorneado:`,t)}},k=()=>{new Audio("/sound/videoplayback.mp3").play().catch(s=>console.error("Error al reproducir el sonido:",s))},V=w(()=>b.filter(n=>n.tipo==="masa")),z=w(()=>b.filter(n=>n.tipo==="relleno")),B=w(()=>V.value.map(n=>{const s=D.value.filter(t=>t.horneando&&t.pastesHorneando.some(e=>e.masa===n.nombre)).reduce((t,e)=>t+e.pastesHorneando.find(o=>o.masa===n.nombre).cantidad,0);return{...n,cantidad:Math.max(0,n.cantidad-s)}})),J=w(()=>z.value.map(n=>{const s=D.value.filter(t=>t.horneando&&t.pastesHorneando.some(e=>e.nombre===n.nombre)).reduce((t,e)=>t+e.pastesHorneando.find(o=>o.nombre===n.nombre).cantidad,0);return{...n,cantidad:Math.max(0,n.cantidad-s)}})),f=N({masa:"",relleno:"",cantidad:1,sucursal_id:(ee=(se=v.auth)==null?void 0:se.user)==null?void 0:ee.sucursal_id}),H=n=>{const s={pastes:"bola","empanadas saladas":"salada","empanadas dulces":"dulce"},t=b.find(e=>(e.nombre.toLowerCase()===n.value.relleno.toLowerCase()||e.nombre.toLowerCase().startsWith(n.value.relleno.toLowerCase()))&&s[e.tipo.toLowerCase()]);return t?s[t.tipo.toLowerCase()]:"bola"},S=()=>{var o,i,x,h;const n=H(f).toLowerCase(),s=B.value.find(u=>u.nombre.toLowerCase()===n),t=J.value.find(u=>u.nombre.toLowerCase()===f.value.relleno.toLowerCase());if(!s||s.cantidad<=0){m.fire({icon:"error",title:"No hay suficiente masa disponible"});return}if(!t||t.cantidad<=0){m.fire({icon:"error",title:"No hay suficiente relleno disponible"});return}const e=Math.min(s.cantidad,t.cantidad);if(f.value.cantidad>e){m.fire({icon:"error",title:`Solo hay ${e} unidades disponibles (${s.cantidad} masa, ${t.cantidad} relleno)`});return}if(s&&t&&f.value.cantidad<=e){s.cantidad-=f.value.cantidad,t.cantidad-=f.value.cantidad;const u=g.value.find(T=>T.nombre===t.nombre);u?u.cantidad+=f.value.cantidad:c({id:Date.now(),masa:s.nombre,nombre:t.nombre,cantidad:f.value.cantidad,sucursal_id:(i=(o=v.auth)==null?void 0:o.user)==null?void 0:i.sucursal_id}),f.value={masa:"",relleno:"",cantidad:1,sucursal_id:(h=(x=v.auth)==null?void 0:x.user)==null?void 0:h.sucursal_id}}},R=w(()=>{const n=H(f).toLowerCase(),s=B.value.find(e=>e.nombre.toLowerCase()===n),t=J.value.find(e=>e.nombre===f.value.relleno);return!s||!t?0:Math.min(s.cantidad,t.cantidad)}),O=w(()=>{const n=H(f).toLowerCase(),s=B.value.find(o=>o.nombre.toLowerCase()===n),t=J.value.find(o=>o.nombre===f.value.relleno);if(!s||!t)return!1;const e=Math.min(s.cantidad,t.cantidad);return f.value.relleno&&f.value.cantidad>0&&f.value.cantidad<=e&&e>0});N("00:00");const y=n=>{if(n<=0)return"00:00";const s=Math.floor(n/1e3),t=Math.floor(s/60),e=s%60;return`${String(t).padStart(2,"0")}:${String(e).padStart(2,"0")}`},c=n=>{const s=b.find(t=>t.nombre.toLowerCase()===n.nombre.toLowerCase()&&(t.tipo==="pastes"||t.tipo==="empanadas saladas"||t.tipo==="empanadas dulces"));s?g.value.push({...n,paste_id:s.id}):console.error(`No se encontró el paste ${n.nombre} en el inventario`)},$=n=>{g.value=g.value.filter(s=>s.id!==n)},_=n=>{A(n).catch(s=>{console.error(`Error al finalizar horneado desde timer: ${s}`)})},j=n=>{const s=D.value.find(o=>o.id===n);if(!s)return;const e=s.tiempoFin-Date.now();if(e<=0){_(n);return}s.tiempoTranscurrido=p.value-e,s.labeltime=y(e),s.timer&&clearInterval(s.timer),s.timer=setInterval(()=>{const o=s.tiempoFin-Date.now();if(o<=0){clearInterval(s.timer),_(n);return}s.tiempoTranscurrido=p.value-o,s.labeltime=y(o)},1e3)},F=n=>{const s=D.value.find(o=>o.id===n);if(!s)return;const e=s.tiempoFin-Date.now();if(e<=0){_(n);return}s.tiempoTranscurrido=p.value-e,s.labeltime=y(e),s.timer&&clearInterval(s.timer),s.timer=setInterval(()=>{const o=s.tiempoFin-Date.now();if(o<=0){clearInterval(s.timer),_(n);return}s.tiempoTranscurrido=p.value-o,s.labeltime=y(o)},1e3)};re(()=>{D.value.forEach(n=>{n.timer&&clearInterval(n.timer)}),D.value.forEach(n=>{if(n.estado){const s=Date.now()-new Date(n.tiempo_inicio).getTime(),t=p.value-s;if(t<=0){_(n.id);return}n.tiempoFin=Date.now()+t,F(n.id)}})});const G=()=>{K.post("/crear-horno",{estado:!1,pastesHorneando:[]},{preserverScroll:!0,preserveState:!1,onSuccess:n=>{var s;C.value=(s=n==null?void 0:n.props)==null?void 0:s.hornos,g.value=[],D.value=C.value.map(t=>({...t,horneando:t.estado||!1,pastesHorneando:t.pastesHorneando||[],tiempoInicio:t.tiempo_inicio?new Date(t.tiempo_inicio).getTime():0,tiempoFin:t.tiempo_fin?new Date(t.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),U.fire({icon:"success",title:"Horno creado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:n=>{console.error("Error al crear el horno:",n),U.fire({icon:"error",title:"Error al crear horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})},oe=n=>{K.post("/eliminar-horno",{horno_id:n},{preserveScroll:!0,preserveState:!1,onSuccess:s=>{var t;C.value=(t=s==null?void 0:s.props)==null?void 0:t.hornos,D.value=C.value.map(e=>({...e,horneando:e.estado||!1,pastesHorneando:e.pastesHorneando||[],tiempoInicio:e.tiempo_inicio?new Date(e.tiempo_inicio).getTime():0,tiempoFin:e.tiempo_fin?new Date(e.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),U.fire({icon:"success",title:"Horno eliminado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:s=>{console.error("Error al eliminar el horno:",s),U.fire({icon:"error",title:"Error al eliminar horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})};return(n,s)=>(l(),d(L,null,[a("div",et,[a("div",tt,[s[4]||(s[4]=a("h2",{class:"text-xl font-semibold mb-4"},"Ingredientes Disponibles",-1)),a("div",at,[s[2]||(s[2]=a("h3",{class:"text-lg font-medium mb-2"},"Masas",-1)),a("ul",ot,[(l(!0),d(L,null,I(B.value,t=>(l(),d("li",{key:t.id,class:"flex justify-between"},[a("span",st,r(t.nombre),1),a("span",nt,r(t.cantidad)+" unidades",1)]))),128))])]),a("div",null,[s[3]||(s[3]=a("h3",{class:"text-lg font-medium mb-2"},"Rellenos",-1)),a("ul",rt,[(l(!0),d(L,null,I(J.value,t=>(l(),d("li",{key:t.id,class:"flex justify-between"},[a("span",null,r(t.nombre),1),a("span",it,r(t.cantidad)+" unidades",1)]))),128))])])]),a("div",lt,[s[8]||(s[8]=a("h2",{class:"text-xl font-semibold mb-4"},"Crear Nuevo Paste/Empanada",-1)),a("form",{onSubmit:xe(S,["prevent"]),class:"space-y-4"},[a("div",null,[s[6]||(s[6]=a("label",{for:"relleno",class:"block text-sm font-medium text-gray-700"},"Seleccionar Relleno",-1)),Y(a("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>f.value.relleno=t),id:"relleno",required:"",class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md"},[s[5]||(s[5]=a("option",{value:""},"Seleccione un relleno",-1)),(l(!0),d(L,null,I(z.value,t=>(l(),d("option",{key:t.id,value:t.nombre},r(t.nombre),9,dt))),128))],512),[[pe,f.value.relleno]])]),a("div",null,[s[7]||(s[7]=a("label",{for:"cantidad",class:"block text-sm font-medium text-gray-700"},"Cantidad",-1)),Y(a("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>f.value.cantidad=t),type:"number",id:"cantidad",required:"",min:"1",max:R.value,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 sm:text-sm"},null,8,ct),[[me,f.value.cantidad,void 0,{number:!0}]])]),a("button",{type:"submit",disabled:!O.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed"},r(O.value?"Asignar Unidades":"Sin ingredientes suficientes"),9,ut),f.value.relleno&&!O.value?(l(),d("div",pt,[R.value===0?(l(),d("span",mt,"No hay ingredientes disponibles")):(l(),d("span",ft,"Máximo disponible: "+r(R.value)+" unidades",1))])):q("",!0)],32)])]),a("div",ht,[(l(!0),d(L,null,I(D.value,(t,e)=>(l(),d("div",{key:t.id,class:"bg-white shadow rounded-lg p-6"},[a("div",vt,[a("h2",xt,"Horno "+r(e+1),1),!t.horneando&&C.value.length>1?(l(),d("button",{key:0,onClick:o=>oe(t.id),class:"flex items-center gap-2 bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"},[Q(he(De),{class:"w-4 h-4"})],8,gt)):q("",!0)]),t.horneando?(l(),d("div",yt,[s[9]||(s[9]=a("p",{class:"text-lg mb-2"},"Horneando grupo de pastes:",-1)),a("ul",null,[(l(!0),d(L,null,I(t.pastesHorneando,o=>(l(),d("li",{key:o.nombre},r(o.cantidad)+" "+r(o.nombre)+" - masa "+r(o.masa),1))),128))]),a("div",_t,[a("div",{class:"bg-orange-600 h-2.5 rounded-full transition-all duration-100",style:ge({width:`${t.tiempoTranscurrido/p.value*100}%`})},null,4)]),a("p",null,"Tiempo restante: "+r(t.labeltime),1)])):(l(),d("div",bt,[s[10]||(s[10]=a("p",{class:"text-lg mb-4"},"El horno está disponible",-1)),a("button",{onClick:M,disabled:!g.value.length,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Iniciar Horneado de Grupo ",8,wt)]))]))),128)),a("div",{class:"mt-4 h-full flex justify-center items-center"},[a("button",{onClick:G,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500"}," Crear Nuevo Horno ")])]),a("div",$t,[s[11]||(s[11]=a("h2",{class:"text-xl font-semibold mb-4"},"Grupos de Pastes por Hornear",-1)),g.value.length===0?(l(),d("div",Dt," No hay grupos de pastes en la cola de horneado ")):(l(),d("ul",Mt,[(l(!0),d(L,null,I(g.value,t=>(l(),d("li",{key:t.id,class:"py-4 flex justify-between items-center"},[a("span",null,r(t.cantidad)+" "+r(t.nombre)+" - masa "+r(t.masa),1),a("button",{onClick:e=>$(t.id),class:"bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"}," Cancelar ",8,St)]))),128))]))])],64))}},kt={key:0,class:"mt-8 bg-white shadow rounded-lg p-6"},Ct={class:"flex justify-between items-center mb-4"},Ht={class:"text-sm text-gray-600 mt-1"},Tt={class:"font-medium"},Nt={key:0,class:"ml-2 inline-flex items-center text-blue-600"},Ft={class:"flex items-center space-x-4"},Pt={class:"flex items-center space-x-2"},Lt=["max"],zt={class:"flex items-center space-x-2"},It=["value"],At={class:"mb-6"},Vt={class:"flex justify-between items-center mb-2"},jt={class:"flex items-center space-x-2"},Bt={class:"text-sm text-gray-600"},Rt={class:"font-medium"},Ot={class:"font-medium"},Ut={key:0,class:"flex items-center space-x-1"},qt={key:0,class:"text-center py-12"},Jt={class:"flex flex-col items-center space-y-4"},Wt={class:"text-center"},Xt={class:"text-sm text-gray-500"},Zt={key:1,class:"overflow-x-auto"},Gt={class:"min-w-full divide-y divide-gray-200"},Qt={class:"bg-white divide-y divide-gray-200"},Kt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 capitalize"},Yt={class:"text-xs text-gray-500 block capitalize"},ea={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ta={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},aa={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},oa={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize"},sa={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},na={class:"px-6 py-4 whitespace-nowrap"},ra={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ia={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},la={key:2,class:"text-center py-12"},da={class:"flex flex-col items-center space-y-4"},ca={class:"text-center"},ua={class:"text-lg font-medium text-gray-700"},pa={class:"text-sm text-gray-500 mt-1"},ma={class:"mt-8"},fa={class:"flex justify-between items-center mb-2"},ha={class:"text-sm text-gray-600"},va={class:"font-medium"},xa={class:"overflow-x-auto"},ga={class:"min-w-full divide-y divide-gray-200"},ya={class:"bg-white divide-y divide-gray-200"},_a={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},ba={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},wa={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},$a={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Da={class:"px-6 py-4 whitespace-nowrap capitalize"},Ma={key:0,class:"text-center py-8"},Sa={__name:"ControlProduccion",setup(E){const{props:v}=ae(),b=N(),C=N("actual"),D=N(!1),p=N({faltantes:[],horneados:[]}),g=w(()=>{var o,i;const t=(o=v.auth)==null?void 0:o.user,e=t==null?void 0:t.roles;return e&&e.length>0&&((i=e[0])==null?void 0:i.name)==="admin"}),M=N([{value:"todas",label:"Todas las horas"},{value:"actual",label:"Hora Siguiente"},{value:"7-am",label:"7:00 AM"},{value:"8-am",label:"8:00 AM"},{value:"9-am",label:"9:00 AM"},{value:"10-am",label:"10:00 AM"},{value:"11-am",label:"11:00 AM"},{value:"12-pm",label:"12:00 PM"},{value:"1-pm",label:"1:00 PM"},{value:"2-pm",label:"2:00 PM"},{value:"3-pm",label:"3:00 PM"},{value:"4-pm",label:"4:00 PM"},{value:"5-pm",label:"5:00 PM"},{value:"6-pm",label:"6:00 PM"},{value:"7-pm",label:"7:00 PM"},{value:"8-pm",label:"8:00 PM"},{value:"9-pm",label:"9:00 PM"},{value:"10-pm",label:"10:00 PM"},{value:"11-pm",label:"11:00 PM"}]),m=()=>{try{const t=new Date;return new Date(t.toLocaleString("en-US",{timeZone:"America/Mexico_City"})).toISOString().split("T")[0]}catch(t){return console.error("Error al obtener fecha México:",t),new Date().toISOString().split("T")[0]}},A=()=>{const t=new Date,e=new Date(t.getTime()+60*60*1e3),o=new Date(e);o.setMinutes(0,0,0);const i=o.getHours(),x=i>=12?"pm":"am";return`${i%12||12}-${x}`},k=t=>{if(!t||typeof t!="string")return"";try{if(t.includes("-"))return t;const e=t.match(/(\d+):(\d+)\s*(am|pm)/i);if(e){const[,o,i,x]=e;return`${parseInt(o)%12||12}-${x.toLowerCase()}`}if(t.includes(":")){const[o,i]=t.split(":"),x=parseInt(o),h=x>=12?"pm":"am";return`${x%12||12}-${h}`}return""}catch(e){return console.error("Error al convertir hora notificación:",t,e),""}},V=w(()=>{var o,i,x;let t=[];if(((i=(o=p.value)==null?void 0:o.faltantes)==null?void 0:i.length)>0)t=p.value.faltantes;else{const h=m();if(b.value===h&&((x=v.notificaciones)!=null&&x.faltantes))t=v.notificaciones.faltantes;else return[]}if(C.value==="todas")return t;if(C.value==="actual"){const h=A();return t.filter(T=>T.hora_notificacion?k(T.hora_notificacion)===h:!1)}return t.filter(h=>h.hora_notificacion?k(h.hora_notificacion)===C.value:!1)}),z=w(()=>{var o,i,x,h,u,T;let t=[];((i=(o=p.value)==null?void 0:o.faltantes)==null?void 0:i.length)>0?t=[...t,...p.value.faltantes]:(x=v.notificaciones)!=null&&x.faltantes&&(t=[...t,...v.notificaciones.faltantes]),((u=(h=p.value)==null?void 0:h.horneados)==null?void 0:u.length)>0?t=[...t,...p.value.horneados]:(T=v.notificaciones)!=null&&T.horneados&&(t=[...t,...v.notificaciones.horneados]);const e=t.filter(P=>P.estado==="en_espera"||!P.tiempo_inicio_horneado?!1:["horneando","vendido","desperdicio","retirado"].includes(P.estado));return console.log("🔍 Control de Tiempo - Total notificaciones:",t.length),console.log("🔍 Control de Tiempo - Filtradas por estado:",e.length),console.log("🔍 Control de Tiempo - Estados encontrados:",[...new Set(t.map(P=>P.estado))]),e}),B=w(()=>{var t,e;return((e=(t=p.value)==null?void 0:t.faltantes)==null?void 0:e.length)||0}),J=async()=>{b.value&&await H(b.value)},f=()=>{},H=async t=>{try{D.value=!0,p.value={faltantes:[],horneados:[]},await new Promise(o=>setTimeout(o,300));const e=await de.post(route("control.produccion.notificaciones"),{fecha:t});e.data.success?p.value=e.data.notificaciones:(console.error("❌ Error en respuesta:",e.data.message),p.value={faltantes:[],horneados:[]})}catch(e){console.error("❌ Error al cargar notificaciones:",e),p.value={faltantes:[],horneados:[]}}finally{D.value=!1}};re(()=>{b.value=v.fechaFiltro||v.fechaActual||m(),b.value&&H(b.value)}),w(()=>V.value.filter(t=>t.tiempo_inicio_horneado).map(t=>({paste:t.paste.nombre,...S(t)}))),w(()=>{var t;return(t=v.notificaciones)!=null&&t.faltantes?v.notificaciones.faltantes.map(e=>({id:e.id,paste:e.paste,cantidad:e.cantidad,hora_notificacion:e.hora_notificacion,dia_notificacion:e.dia_notificacion,estado:e.estado,tiempo_inicio_horneado:e.tiempo_inicio_horneado,hora_ultima_venta:e.hora_ultima_venta,cantidad_vendida:e.cantidad_vendida,created_at:e.created_at})):[]}),w(()=>{var t;return(t=v.notificaciones)!=null&&t.horneados?v.notificaciones.horneados:[]});const S=t=>{if(!t.tiempo_inicio_horneado)return{promedio:0,ultima:"N/A",restante:"N/A"};try{const e=new Date(t.tiempo_inicio_horneado),o=new Date(t.created_at);if(isNaN(e.getTime())||isNaN(o.getTime()))return{promedio:0,ultima:"N/A",restante:"N/A"};const i=Math.max(0,e-o),x=Math.floor(i/(1e3*60));return{promedio:x,ultima:n(t.tiempo_inicio_horneado),restante:x>0?`${x} min`:"Completado"}}catch(e){return console.error("Error al calcular tiempo de reposición:",e),{promedio:0,ultima:"Error",restante:"Error"}}},R=t=>{if(!t.tiempo_inicio_horneado||!t.created_at)return"N/A";try{const e=new Date(t.created_at),o=new Date(t.tiempo_inicio_horneado);if(isNaN(e.getTime())||isNaN(o.getTime()))return"N/A";const i=e.toDateString(),x=o.toDateString();if(i!==x)return"Diferente día";const h=Math.max(0,o-e),u=Math.floor(h/(1e3*60));if(u===0)return"0 min";if(u>1440)return"Error de cálculo";if(u<60)return`${u} min`;{const T=Math.floor(u/60),P=u%60;return`${T}:${P.toString().padStart(2,"0")} hrs`}}catch(e){return console.error("Error al calcular tiempo de producción:",e),"Error"}},O=t=>{if(!t||typeof t!="string")return 0;try{const[e,o]=t.toLowerCase().split(" ");let[i,x]=e.split(":");return i=parseInt(i,10),i===12?i=o==="am"?0:12:o==="pm"&&(i=i+12),i}catch(e){return console.error("Error al convertir hora:",t,e),0}},y=()=>["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"][new Date().getDay()],c=w(()=>{var t;return((t=v.inventario)==null?void 0:t.filter(e=>["pastes","empanadas dulces","empanadas saladas"].includes(e.tipo)))||[]}),$=w(()=>{const t=new Map(c.value.map(o=>[o.id,o]));return(v.estimacionesHoy||[]).map(o=>{const i=t.get(o.inventario_id);if(!i)return null;const x=O(o.hora);return{id:`${i.id}-${o.hora}`,nombre:i.nombre,estimado:parseInt(o.cantidad),existente:i.cantidad,diferencia:i.cantidad-parseInt(o.cantidad),hora:o.hora,dia:o.dia,horaEnNumero:x,tipo:i.tipo}}).filter(Boolean)}),_=w(()=>$.value.filter(e=>e.dia===y())),j=w(()=>{const e=(new Date().getHours()+1)%24,o=_.value.filter(h=>(h.horaEnNumero||O(h.hora))===e),i=new Map(o.map(h=>[h.nombre,h]));return c.value.map(h=>{const u=i.get(h.nombre);return u||{id:`${h.id}-${e}:00`,nombre:h.nombre,estimado:0,existente:h.cantidad,diferencia:h.cantidad,hora:`${e}:00`,dia:y(),horaEnNumero:e,tipo:h.tipo}})}),F=w(()=>j.value.filter(e=>{const i=e.estimado*.7;return e.estimado>0&&e.existente<i}).map(e=>({id:e.id,paste:{nombre:e.nombre,tipo:e.tipo},cantidad:Math.abs(e.diferencia),hora_notificacion:e.hora,dia_notificacion:e.dia,estado:"pendiente",created_at:new Date().toISOString(),cantidad_horneada:0,cantidad_vendida:0,hora_ultima_venta:null,tiempo_inicio_horneado:null})));ue(()=>F.value,t=>{t&&t.length>0&&t.forEach(async e=>{var h,u,T,P,X,ne;const o=`${e.id}`,i=e.cantidad,x=(u=(h=v.notificaciones)==null?void 0:h.faltantes)==null?void 0:u.find(W=>{const ie=typeof e.id=="string"?e.id:String(e.id),le=parseInt(ie.split("-")[0]);return W.paste_id===le&&W.hora_notificacion===e.hora_notificacion});x?x.cantidad!==i&&K.post(route("notificaciones.actualizar"),{sucursal_id:(ne=(X=v.auth)==null?void 0:X.user)==null?void 0:ne.sucursal_id,notificacion_id:o,cantidad:i},{preserveScroll:!0,onSuccess:W=>{},onError:W=>{console.error("Error al actualizar notificación:",W)}}):K.post(route("notificaciones.registrar"),{sucursal_id:(P=(T=v.auth)==null?void 0:T.user)==null?void 0:P.sucursal_id,notificacion_id:o,cantidad:i},{preserveScroll:!0,onSuccess:W=>{},onError:W=>{console.error("Error al registrar notificación:",W)}})})},{deep:!0});const G=t=>{if(!t.tiempo_inicio_horneado||!t.created_at)return"No iniciado";try{const e=new Date(t.created_at),o=new Date(t.tiempo_inicio_horneado);if(isNaN(e.getTime())||isNaN(o.getTime()))return"Fecha inválida";const i=e.toDateString(),x=o.toDateString();if(i!==x)return"Diferente día";const h=Math.max(0,o-e),u=Math.floor(h/(1e3*60));if(u===0)return"0 min";if(u<60)return`${u} min`;{const T=Math.floor(u/60),P=u%60;return`${T}:${P.toString().padStart(2,"0")} hrs`}}catch(e){return console.error("Error al calcular tiempo de horneado:",e),"Error"}},oe=t=>{if(!t.created_at)return"N/A";try{const e=new Date(t.created_at);if(isNaN(e.getTime()))return"Fecha inválida";if(!t.hora_ultima_venta){const T=new Date,P=Math.max(0,T-e),X=Math.floor(P/(1e3*60)),ne=e.toDateString(),W=T.toDateString();if(ne!==W)return"Diferente día";if(X>1440)return"Sin ventas del día";if(X<60)return`${X} min`;{const ie=Math.floor(X/60),le=X%60;return`${ie}:${le.toString().padStart(2,"0")} hrs`}}const o=new Date(t.hora_ultima_venta);if(isNaN(o.getTime()))return"Fecha de venta inválida";const i=e.toDateString(),x=o.toDateString();if(i!==x)return"Diferente día";const h=Math.max(0,o-e),u=Math.floor(h/(1e3*60));if(u===0)return"0 min";if(u>1440)return"Sin ventas del día";if(u<60)return`${u} min`;{const T=Math.floor(u/60),P=u%60;return`${T}:${P.toString().padStart(2,"0")} hrs`}}catch(e){return console.error("Error al calcular tiempo de venta:",e),"Error"}},se=t=>{if(!t.tiempo_inicio_horneado||!t.created_at)return!1;try{const e=new Date(t.created_at),o=new Date(t.tiempo_inicio_horneado);if(isNaN(e.getTime())||isNaN(o.getTime()))return!1;const i=e.toDateString(),x=o.toDateString();if(i!==x)return!1;const h=o-e,u=Math.floor(h/(1e3*60));return u>=0&&u<=1440}catch(e){return console.error("Error al validar tiempo de producción:",e),!1}},ee=t=>{if(!t)return"-";try{const e=new Date(t);return isNaN(e.getTime())?"Fecha inválida":e.toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0,timeZone:"America/Mexico_City"})}catch(e){return console.error("Error al formatear hora:",t,e),"Error"}},n=t=>{if(!t)return"-";try{const e=new Date(t);return isNaN(e.getTime())?"Fecha inválida":e.toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0,timeZone:"America/Mexico_City"})}catch(e){return console.error("Error al formatear fecha:",t,e),"Error"}},s=t=>`px-2 py-1 rounded-full text-xs font-medium ${{horneando:"bg-yellow-100 text-yellow-800 capitalize",retirado:"bg-blue-100 text-blue-800 capitalize",vendido:"bg-green-100 text-green-800 capitalize",desperdicio:"bg-red-100 text-red-800 capitalize",pendiente:"bg-gray-100 text-gray-800 capitalize",en_espera:"bg-green-100 text-green-800"}[t]}`;return(t,e)=>g.value?(l(),d("div",kt,[a("div",Ct,[a("div",null,[e[4]||(e[4]=a("h2",{class:"text-xl font-semibold"},"Control de Producción",-1)),a("p",Ht,[e[3]||(e[3]=Z(" Mostrando datos del día: ")),a("span",Tt,r(b.value||"Cargando..."),1),D.value?(l(),d("span",Nt,e[2]||(e[2]=[a("div",{class:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-500 mr-1"},null,-1),Z(" Actualizando... ")]))):q("",!0)])]),a("div",Ft,[a("div",Pt,[e[5]||(e[5]=a("label",{for:"fecha",class:"text-sm font-medium text-gray-700"},"Seleccionar día:",-1)),Y(a("input",{type:"date",id:"fecha",max:m(),"onUpdate:modelValue":e[0]||(e[0]=o=>b.value=o),onChange:J,class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},null,40,Lt),[[me,b.value]])]),a("div",zt,[e[6]||(e[6]=a("label",{for:"hora",class:"text-sm font-medium text-gray-700"},"Filtrar por hora:",-1)),Y(a("select",{id:"hora","onUpdate:modelValue":e[1]||(e[1]=o=>C.value=o),onChange:f,class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[(l(!0),d(L,null,I(M.value,o=>(l(),d("option",{key:o.value,value:o.value},r(o.label),9,It))),128))],544),[[pe,C.value]])])])]),a("div",At,[a("div",Vt,[e[9]||(e[9]=a("h3",{class:"text-lg font-medium"},"Productos Faltantes - Control de Producción",-1)),a("div",jt,[a("div",Bt,[a("span",Rt,r(V.value.length),1),e[7]||(e[7]=Z(" de ")),a("span",Ot,r(B.value),1),Z(" notificaciones para "+r(b.value),1)]),D.value?(l(),d("div",Ut,e[8]||(e[8]=[a("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"},null,-1),a("span",{class:"text-xs text-blue-600"},"Cargando...",-1)]))):q("",!0)])]),D.value?(l(),d("div",qt,[a("div",Jt,[e[11]||(e[11]=a("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"},null,-1)),a("div",Wt,[e[10]||(e[10]=a("p",{class:"text-lg font-medium text-gray-700"},"Cargando notificaciones...",-1)),a("p",Xt,"Obteniendo datos para "+r(b.value),1)])])])):V.value.length>0?(l(),d("div",Zt,[a("table",Gt,[e[12]||(e[12]=a("thead",{class:"bg-gray-50"},[a("tr",null,[a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Producto"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Faltante"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Horneada"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Vendida"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Día"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora Requerida"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo Horneado"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo Venta")])],-1)),a("tbody",Qt,[(l(!0),d(L,null,I(V.value,o=>(l(),d("tr",{key:o.id,class:"hover:bg-gray-50"},[a("td",Kt,[Z(r(o.paste.nombre)+" ",1),a("span",Yt,r(o.paste.tipo),1)]),a("td",ea,r(o.cantidad)+" unidades ",1),a("td",ta,r(o.cantidad_horneada?`${o.cantidad_horneada} unidades`:"-"),1),a("td",aa,r(o.cantidad_vendida?`${o.cantidad_vendida} unidades`:"-"),1),a("td",oa,r(o.dia_notificacion),1),a("td",sa,r(o.hora_notificacion),1),a("td",na,[a("span",{class:te(["px-2 py-1 text-xs font-medium rounded-full",o.estado==="pendiente"?"bg-red-100 text-red-800":o.estado==="horneando"?"bg-yellow-100 text-yellow-800":o.estado==="en_espera"?"bg-blue-100 text-blue-800":o.estado==="vendido"?"bg-green-100 text-green-800":o.estado==="desperdicio"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"])},r(o.estado==="pendiente"?"Sin hornear":o.estado==="horneando"?"Horneando":o.estado==="en_espera"?"En espera":o.estado==="vendido"?"Vendido":o.estado==="desperdicio"?"Desperdicio":o.estado),3)]),a("td",ra,r(G(o)),1),a("td",ia,r(oe(o)),1)]))),128))])])])):(l(),d("div",la,[a("div",da,[e[13]||(e[13]=a("div",{class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center"},[a("svg",{class:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),a("div",ca,[a("h3",ua,r(B.value===0?`Sin notificaciones para ${b.value}`:"Sin notificaciones para la hora seleccionada"),1),a("p",pa,r(B.value===0?"No se encontraron productos faltantes para esta fecha":"Cambia la hora del filtro para ver más notificaciones"),1)])])]))]),a("div",ma,[a("div",fa,[e[15]||(e[15]=a("h3",{class:"text-lg font-medium"},"Control de Tiempo de Producción",-1)),a("div",ha,[a("span",va,r(z.value.length),1),e[14]||(e[14]=Z(" notificaciones procesadas "))])]),a("div",xa,[a("table",ga,[e[16]||(e[16]=a("thead",{class:"bg-gray-50"},[a("tr",null,[a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Paste"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de notificación"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de Producción"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo en meter producción"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado")])],-1)),a("tbody",ya,[(l(!0),d(L,null,I(z.value,o=>(l(),d("tr",{key:o.id},[a("td",_a,r(o.paste.nombre),1),a("td",ba,r(ee(o.created_at)),1),a("td",wa,r(se(o)?ee(o.tiempo_inicio_horneado):"-"),1),a("td",$a,r(R(o)),1),a("td",Da,[a("span",{class:te(s(o.estado))},r(o.estado),3)])]))),128))])])]),z.value.length===0?(l(),d("div",Ma,e[17]||(e[17]=[ye('<div class="flex flex-col items-center space-y-3"><div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center"><svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><div class="text-center"><p class="text-gray-500 text-lg">No hay notificaciones procesadas</p><p class="text-gray-400 text-sm mt-1">Solo se muestran notificaciones que han sido horneadas o procesadas</p></div></div>',1)]))):q("",!0)])])):q("",!0)}},Ea={class:"animate-pulse"},ka={key:0,class:"mt-2"},Ca={class:"font-bold"},fe={__name:"NotificationPanel",props:{notifications:{type:Array,required:!0,default:()=>[]},isVisible:{type:Boolean,default:!1},type:{type:String,required:!0,validator:E=>["warning","info"].includes(E)},title:{type:String,required:!0}},emits:["toggle"],setup(E,{emit:v}){return console.log(E.notifications),(C,D)=>(l(),d("div",{class:te(["p-4 border rounded shadow mb-4 size-fit cursor-pointer",{"bg-yellow-100":E.type==="warning","bg-blue-100":E.type==="info"}]),onClick:D[0]||(D[0]=p=>C.$emit("toggle"))},[a("h2",{class:te(["text-lg font-bold text-center",{"text-yellow-800":E.type==="warning","text-blue-800":E.type==="info"}])},[Z(r(E.type==="warning"?"⚠️":"ℹ️")+" "+r(E.title)+" ",1),a("span",Ea,"("+r(E.notifications.length)+")",1),Z(" "+r(E.type==="warning"?"⚠️":"ℹ️"),1)],2),E.isVisible?(l(),d("ul",ka,[(l(!0),d(L,null,I(E.notifications,p=>(l(),d("li",{key:p.id,class:"mb-2"},[a("span",null,[a("span",Ca,r(p.nombre),1),Z(": "+r(E.type==="warning"?"Faltan":"Hay")+" "+r(E.type==="warning"?Math.abs(p.diferencia):p.diferencia)+" unidades para las "+r(p.hora)+" ",1),a("span",{class:te(["text-sm",{"text-red-600":E.type==="warning","text-green-600":E.type==="info"}])}," ("+r(p.porcentaje)+"% del estimado) ",3)])]))),128))])):q("",!0)],2))}},Ha={class:"container mx-auto p-4"},Ta={class:"sm:flex justify-between flex-row text-sm"},Na={class:"flex gap-3 sm:flex-row flex-col"},Fa={class:"mt-6"},Pa={__name:"Hornear",setup(E){const v=N(!1),b=N(!1),C=N(null),D=N(null),{props:p}=ae(),g=w(()=>{var $,_;const y=($=p.auth)==null?void 0:$.user,c=y==null?void 0:y.roles;return c&&c.length>0&&((_=c[0])==null?void 0:_.name)==="admin"}),M=w(()=>p.inventario||[]),m=w(()=>p.estimacionesHoy||[]),A=()=>{const y=new Date;return{day:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"][y.getDay()].toLowerCase(),hour:y.getHours(),minutes:y.getMinutes()}},k=N(A());ue(()=>k.value.hour,y=>{y!==C.value&&(C.value=y,H.value.length>0&&(v.value=!0),S.value.length>0&&(b.value=!0))}),re(()=>{C.value=k.value.hour,D.value=setInterval(()=>{k.value=A()},1e3)}),_e(()=>{D.value&&clearInterval(D.value)});const V=y=>{const[c,$]=y.toLowerCase().split(" ");let[_,j]=c.split(":").map(Number);return{hours:$==="pm"&&_!==12?_+12:$==="am"&&_===12?0:_,minutes:j}},z=w(()=>M.value.filter(y=>{var c;return["pastes","empanadas dulces","empanadas saladas"].includes((c=y.tipo)==null?void 0:c.toLowerCase())})),B=w(()=>{if(!m.value.length||!z.value.length)return console.log("No hay estimaciones o productos relevantes"),[];const y=new Map(z.value.map($=>[$.id,$]));return m.value.map($=>{const _=y.get($.inventario_id);if(!_)return null;const{hours:j}=V($.hora);return{id:`${_.id}-${$.hora}`,nombre:_.nombre,estimado:$.cantidad,existente:_.cantidad,diferencia:_.cantidad-$.cantidad,hora:$.hora,dia:$.dia.toLowerCase(),horaEnNumero:j,tipo:_.tipo}}).filter(Boolean).filter(($,_,j)=>_===j.findIndex(F=>F.id===$.id))}),J=w(()=>B.value.filter(c=>c.dia===k.value.day)),f=w(()=>{const c=(k.value.hour+1)%24,$=J.value.filter(F=>F.horaEnNumero===c),_=new Map($.map(F=>[F.nombre,F]));return z.value.map(F=>{const G=_.get(F.nombre);return G||{id:`${F.id}-${c}:00`,nombre:F.nombre,estimado:0,existente:F.cantidad,diferencia:F.cantidad,hora:`${c}:00`,dia:k.value.day,horaEnNumero:c,tipo:F.tipo}})}),H=w(()=>f.value.filter(c=>{const _=c.estimado*.7;return c.estimado>0&&c.existente<_}).map(c=>({...c,porcentaje:c.estimado>0?Math.round(c.existente/c.estimado*100):0}))),S=w(()=>f.value.filter(c=>c.estimado>0&&c.diferencia>0||c.estimado===0&&c.existente>0).map(c=>({...c,porcentaje:c.estimado>0?Math.round(c.existente/c.estimado*100):100}))),R=()=>v.value=!v.value,O=()=>b.value=!b.value;return(y,c)=>{var $,_,j;return l(),d("div",Ha,[a("div",Ta,[c[0]||(c[0]=a("h1",{class:"text-2xl font-bold mb-4"},"Sistema de Horneado",-1)),a("div",Na,[Q(fe,{notifications:H.value,"is-visible":v.value,type:"warning",title:"Faltantes",onToggle:R},null,8,["notifications","is-visible"]),Q(fe,{notifications:S.value,"is-visible":b.value,type:"info",title:"Excedentes",onToggle:O},null,8,["notifications","is-visible"])])]),a("div",Fa,[Q(Et),Q(Sa),((j=(_=($=he(p).auth)==null?void 0:$.user)==null?void 0:_.roles)==null?void 0:j[0])!=="supervisor"?(l(),ce(Ve,{key:0})):q("",!0),g.value?(l(),ce(Ye,{key:1})):q("",!0)])])}}},La={class:"py-6"},za={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 rounded-xl overflow-hidden"},Ia={class:"flex justify-between p-6 lg:p-8 bg-white border-b border-gray-200 rounded-2xl"},Ra={__name:"index",setup(E){return(v,b)=>(l(),ce(ve,{title:"Tablero principal"},{default:be(()=>[a("div",La,[a("div",za,[a("div",Ia,[Q(Pa)])])])]),_:1}))}};export{Ra as default};
