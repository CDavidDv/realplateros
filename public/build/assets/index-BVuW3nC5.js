import{S as L,_ as se}from"./AppLayout-DUCV0elm.js";import{Q as q,d as C,p as $,o as l,e as u,a as e,F as E,h as P,t as r,f as j,x as J,i as K,j as O,l as Y,v as ee,z as W,k as ne,b as U,u as oe,B as ie,y as te,g as G,n as Z,C as re,c as Q,w as le}from"./app-Dj_DImPJ.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as ce}from"./createLucideIcon-Hw39H2nZ.js";/**
 * @license lucide-vue-next v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=ce("Trash2Icon",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),pe={class:"bg-white rounded-lg shadow-md overflow-hidden"},me={class:"overflow-x-auto"},fe={class:"min-w-full divide-y divide-gray-200"},xe={class:"bg-white divide-y divide-gray-200"},ve={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},ge={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},he={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},_e={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ye={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},be={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},we={key:0},$e={class:"bg-gray-50"},De={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},ke={__name:"PastesHorneados",setup(k){const{props:f}=q();C(f.pastesHorneados);const M=$(()=>{const x={};f.pastesHorneados.forEach(p=>{x[p.relleno]||(x[p.relleno]={totalPiezas:0,items:[]}),x[p.relleno].totalPiezas+=Number(p.piezas),x[p.relleno].items.push(p)});const v=[];return Object.keys(x).forEach(p=>{x[p].items.forEach((F,H)=>{v.push({...F,totalPiezas:x[p].totalPiezas,isFirst:H===0})})}),v}),b=$(()=>M.value.reduce((x,v)=>Number(x)+(v.isFirst?Number(v.totalPiezas):0),0)),w=x=>new Date(x).toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"America/Mexico_City"}),g=x=>new Date(x).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",timeZone:"America/Mexico_City"});return(x,v)=>(l(),u("div",null,[v[3]||(v[3]=e("h1",{class:"pb-4 pt-10 font-semibold text-xl"},"Pastes/Empanadas horneados de hoy",-1)),e("div",pe,[e("div",me,[e("table",fe,[v[2]||(v[2]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Responsable"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Paste/Empanada"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Hora"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Día"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Piezas Horneadas"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Total del día")])],-1)),e("tbody",xe,[(l(!0),u(E,null,P(M.value,(p,F)=>{var H,N,z;return l(),u("tr",{key:F},[e("td",ve,r((H=p==null?void 0:p.responsable)==null?void 0:H.name)+" "+r(((N=p==null?void 0:p.responsable)==null?void 0:N.apellido_p)||"")+" "+r(((z=p==null?void 0:p.responsable)==null?void 0:z.apellido_m)||""),1),e("td",ge,r(p.relleno),1),e("td",he,r(w(p.updated_at)),1),e("td",_e,r(g(p.updated_at)),1),e("td",ye,r(p.piezas),1),e("td",be,[p.isFirst?(l(),u("span",we,r(p.totalPiezas),1)):j("",!0)])])}),128))]),e("tfoot",$e,[e("tr",null,[v[0]||(v[0]=e("td",{colspan:"3",class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},"Total de piezas horneadas:",-1)),e("td",De,r(b.value),1),v[1]||(v[1]=e("td",null,null,-1))])])])])])]))}},He=de(ke,[["__scopeId","data-v-1a02fb88"]]),Ce={class:"pt-16"},Me={class:"max-w-7xl mx-auto space-y-6"},Se={class:"bg-white rounded-lg shadow p-6"},Te={class:"text-2xl font-bold text-gray-900"},Ee={class:"mt-4"},Pe=["value"],Fe={key:0,class:"bg-white rounded-lg shadow overflow-x-auto"},ze={class:"min-w-full divide-y divide-gray-200"},Ne={class:"bg-gray-50"},Le={class:"bg-white divide-y divide-gray-200"},Ae={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ve=["onUpdate:modelValue"],Ie={key:1,class:"w-full flex justify-end"},Be={__name:"EstimacionPastes",setup(k){const{props:f}=q(),M=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"],b=new Date().getDay(),w=M[b],g=C(w||"Lunes"),x=C(!1),v=[{value:"Lunes",label:"Lunes"},{value:"Martes",label:"Martes"},{value:"Miercoles",label:"Miércoles"},{value:"Jueves",label:"Jueves"},{value:"Viernes",label:"Viernes"},{value:"Sábado",label:"Sábado"},{value:"Domingo",label:"Domingo"}],p=["7:00 am","8:00 am","9:00 am","10:00 am","11:00 am","12:00 pm","1:00 pm","2:00 pm","3:00 pm","4:00 pm","5:00 pm","6:00 pm","7:00 pm","8:00 pm","9:00 pm"],F=$(()=>f.inventario.filter(m=>["pastes","empanadas dulces","empanadas saladas"].includes(m.tipo)).map(m=>m.nombre)),H=C({}),N=L.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:m=>{m.onmouseenter=L.stopTimer,m.onmouseleave=L.resumeTimer}}),z=()=>{const m={};return p.forEach(S=>{m[S]={},F.value.forEach(D=>{m[S][D]=0})}),m},V=()=>{x.value=!1,H.value=z(),f.estimaciones.filter(S=>S.dia===g.value).forEach(({hora:S,cantidad:D,inventario_id:T})=>{var _;const I=(_=f.inventario.find(s=>s.id===T))==null?void 0:_.nombre;I&&H.value[S]&&(H.value[S][I]=D)}),x.value=!0},B=()=>{W.post("/estimaciones",{estimaciones:H.value,dia:g.value},{preserveState:!1,preserveScroll:!0,onSuccess:()=>N.fire({icon:"success",title:"Sobrantes guardados exitosamente"}),onError:()=>N.fire({icon:"error",title:"Error al guardar los sobrantes"})})};return J(()=>{V()}),K(g,()=>{V()}),(m,S)=>(l(),u("div",Ce,[e("div",Me,[e("header",Se,[e("h1",Te,"Sistema de Control de Producción - Día: "+r(g.value),1),e("div",Ee,[O(e("select",{"onUpdate:modelValue":S[0]||(S[0]=D=>g.value=D),class:"rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500"},[(l(),u(E,null,P(v,D=>e("option",{key:D.value,value:D.value},r(D.label),9,Pe)),64))],512),[[Y,g.value]])])]),x.value?(l(),u("div",Fe,[e("table",ze,[e("thead",Ne,[e("tr",null,[S[1]||(S[1]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo",-1)),(l(!0),u(E,null,P(F.value,D=>(l(),u("th",{key:D,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},r(D),1))),128))])]),e("tbody",Le,[(l(),u(E,null,P(p,D=>e("tr",{key:D},[e("td",Ae,r(D),1),(l(!0),u(E,null,P(F.value,T=>(l(),u("td",{key:T,class:"px-6 py-4 whitespace-nowrap"},[O(e("input",{type:"number","onUpdate:modelValue":I=>H.value[D][T]=I,class:"w-20 rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500",min:"0"},null,8,Ve),[[ee,H.value[D][T]]])]))),128))])),64))])])])):j("",!0),m.$page.props.auth.user.roles[0].name=="admin"?(l(),u("div",Ie,[e("button",{onClick:B,class:"px-3 py-2 bg-orange-500 rounded-lg text-white hover:bg-orange-400"}," Guardar ")])):j("",!0)])]))}},je={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Re={class:"bg-white shadow rounded-lg p-6"},Ue={class:"mb-6"},Oe={class:"list-disc pl-5"},Ze={class:"capitalize"},qe={class:"font-semibold"},Xe={class:"list-disc pl-5"},We={class:"font-semibold"},Ge={class:"bg-white shadow rounded-lg p-6"},Je=["value"],Qe=["max"],Ke=["disabled"],Ye={class:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-4"},et={class:"flex justify-between"},tt={class:"text-xl font-semibold mb-4"},at=["onClick"],ot={key:0},st={class:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 mb-4"},nt={key:1},it=["disabled"],rt={class:"mt-8 bg-white shadow rounded-lg p-6"},lt={key:0,class:"text-gray-500 text-center py-4"},dt={key:1,class:"divide-y divide-gray-200"},ct=["onClick"],ut={__name:"SistemaHorneado",setup(k){const{props:f}=q(),M=f.inventario,b=C(f.hornos||[]),w=C(b.value.map(a=>({...a,horneando:a.estado||!1,pastesHorneando:a.pastesHorneando||[],tiempoInicio:a.tiempo_inicio?new Date(a.tiempo_inicio).getTime():0,tiempoFin:a.tiempo_fin?new Date(a.tiempo_fin).getTime():0,tiempoTranscurrido:0,timer:null,labeltime:"00:00"}))),g=C(9e5),x=C([]),v=()=>{if(x.value.length===0)return;const a=w.value.find(t=>!t.horneando);if(a){a.horneando=!0,a.pastesHorneando=[...x.value],x.value=[],a.tiempoInicio=Date.now(),a.tiempoFin=a.tiempoInicio+g.value;try{te.post("/iniciar-horneado",{horno_id:a.id,tiempo_inicio:a.tiempoInicio,tiempo_fin:a.tiempoFin,pastes_horneando:a.pastesHorneando,estado:!0}).then(t=>{console.log(t)}).catch(t=>{console.error("Error al iniciar el horneado:",t)}),L.fire({icon:"success",title:"Horneando",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500}),d(a.id)}catch(t){console.error("Error al iniciar el horneado:",t),L.fire({icon:"error",title:"Error al iniciar",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}}else A()},p=L.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:a=>{a.addEventListener("mouseenter",L.stopTimer),a.addEventListener("mouseleave",L.resumeTimer)}}),F=async a=>{const t=w.value.find(i=>i.id===a);if(!(!t||!t.horneando))try{clearInterval(t.timer);const i=[...t.pastesHorneando];t.horneando=!1,t.pastesHorneando=[],t.tiempoTranscurrido=0,t.labeltime="00:00",H();for(const c of i){const y=M.find(R=>R.nombre.toLowerCase()===c.nombre.toLowerCase()&&(R.tipo==="pastes"||R.tipo==="empanadas saladas"||R.tipo==="empanadas dulces"));if(y)try{await te.post("/api/control-produccion/horneado",{horno_id:a,paste_id:y.id,cantidad:c.cantidad})}catch(R){console.error(`Horno ${a} - Error al registrar producción para ${c.nombre}:`,R)}else console.error(`Horno ${a} - No se encontró el paste ${c.nombre} en el inventario`)}W.post("/hornear",{horno_id:a,pastes:i},{preserveScroll:!0,preserveState:!1,replace:!0,onSuccess:()=>{p.fire({icon:"success",title:"Horneado finalizado"})},onError:c=>{console.error(`Horno ${a} - Error al registrar el horneado:`,c),p.fire({icon:"error",title:"Error al registrar el horneado"})}})}catch(i){console.error(`Horno ${a} - Error en finalizarHorneado:`,i)}},H=()=>{new Audio("/sound/videoplayback.mp3").play().catch(t=>console.error("Error al reproducir el sonido:",t))},N=$(()=>M.filter(a=>a.tipo==="masa")),z=$(()=>M.filter(a=>a.tipo==="relleno")),V=$(()=>N.value.map(a=>{const t=w.value.filter(i=>i.horneando&&i.pastesHorneando.some(c=>c.masa===a.nombre)).reduce((i,c)=>i+c.pastesHorneando.find(y=>y.masa===a.nombre).cantidad,0);return{...a,cantidad:a.cantidad-t}})),B=$(()=>z.value.map(a=>{const t=w.value.filter(i=>i.horneando&&i.pastesHorneando.some(c=>c.nombre===a.nombre)).reduce((i,c)=>i+c.pastesHorneando.find(y=>y.nombre===a.nombre).cantidad,0);return{...a,cantidad:a.cantidad-t}})),m=C({masa:"",relleno:"",cantidad:1,sucursal_id:f.auth.user.sucursal_id}),S=a=>{const t={pastes:"bola","empanadas saladas":"salada","empanadas dulces":"dulce"},i=f.inventario.find(c=>(c.nombre.toLowerCase()===a.value.relleno.toLowerCase()||c.nombre.toLowerCase().startsWith(a.value.relleno.toLowerCase()))&&t[c.tipo.toLowerCase()]);return i?t[i.tipo.toLowerCase()]:"bola"},D=()=>{const a=S(m).toLowerCase(),t=V.value.find(c=>c.nombre.toLowerCase()===a),i=B.value.find(c=>c.nombre.toLowerCase()===m.value.relleno.toLowerCase());if(!t||t.cantidad<=0){p.fire({icon:"error",title:"No hay suficiente masa disponible"});return}if(t&&i&&m.value.cantidad<=T.value){t.cantidad-=m.value.cantidad,i.cantidad-=m.value.cantidad;const c=x.value.find(y=>y.nombre===i.nombre);c?c.cantidad+=m.value.cantidad:s({id:Date.now(),masa:t.nombre,nombre:i.nombre,cantidad:m.value.cantidad,sucursal_id:f.auth.user.sucursal_id}),m.value={masa:"",relleno:"",cantidad:1,sucursal_id:f.auth.user.sucursal_id}}},T=$(()=>{const a=B.value.find(t=>t.nombre===m.value.relleno);return a?a.cantidad:1}),I=$(()=>m.value.relleno&&m.value.cantidad>0&&m.value.cantidad<=T.value);C("00:00");const _=a=>{if(a<=0)return"00:00";const t=Math.floor(a/1e3),i=Math.floor(t/60),c=t%60;return`${String(i).padStart(2,"0")}:${String(c).padStart(2,"0")}`},s=a=>{const t=M.find(i=>i.nombre.toLowerCase()===a.nombre.toLowerCase()&&(i.tipo==="pastes"||i.tipo==="empanadas saladas"||i.tipo==="empanadas dulces"));t?x.value.push({...a,paste_id:t.id}):console.error(`No se encontró el paste ${a.nombre} en el inventario`)},o=a=>{x.value=x.value.filter(t=>t.id!==a)},n=a=>{F(a).catch(t=>{console.error(`Error al finalizar horneado desde timer: ${t}`)})},d=a=>{const t=w.value.find(y=>y.id===a);if(!t)return;const c=t.tiempoFin-Date.now();if(c<=0){n(a);return}t.tiempoTranscurrido=g.value-c,t.labeltime=_(c),t.timer&&clearInterval(t.timer),t.timer=setInterval(()=>{const y=t.tiempoFin-Date.now();if(y<=0){clearInterval(t.timer),n(a);return}t.tiempoTranscurrido=g.value-y,t.labeltime=_(y)},1e3)},h=a=>{const t=w.value.find(y=>y.id===a);if(!t)return;const c=t.tiempoFin-Date.now();if(c<=0){n(a);return}t.tiempoTranscurrido=g.value-c,t.labeltime=_(c),t.timer&&clearInterval(t.timer),t.timer=setInterval(()=>{const y=t.tiempoFin-Date.now();if(y<=0){clearInterval(t.timer),n(a);return}t.tiempoTranscurrido=g.value-y,t.labeltime=_(y)},1e3)};J(()=>{w.value.forEach(a=>{a.timer&&clearInterval(a.timer)}),w.value.forEach(a=>{if(a.estado){const t=Date.now()-new Date(a.tiempo_inicio).getTime(),i=g.value-t;if(i<=0){n(a.id);return}a.tiempoFin=Date.now()+i,h(a.id)}})});const A=()=>{W.post("/crear-horno",{estado:!1,pastesHorneando:[]},{preserverScroll:!0,preserveState:!1,onSuccess:a=>{var t;b.value=(t=a==null?void 0:a.props)==null?void 0:t.hornos,x.value=[],w.value=b.value.map(i=>({...i,horneando:i.estado||!1,pastesHorneando:i.pastesHorneando||[],tiempoInicio:i.tiempo_inicio?new Date(i.tiempo_inicio).getTime():0,tiempoFin:i.tiempo_fin?new Date(i.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),L.fire({icon:"success",title:"Horno creado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:a=>{console.error("Error al crear el horno:",a),L.fire({icon:"error",title:"Error al crear horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})},X=a=>{W.post("/eliminar-horno",{horno_id:a},{preserveScroll:!0,preserveState:!1,onSuccess:t=>{var i;b.value=(i=t==null?void 0:t.props)==null?void 0:i.hornos,w.value=b.value.map(c=>({...c,horneando:c.estado||!1,pastesHorneando:c.pastesHorneando||[],tiempoInicio:c.tiempo_inicio?new Date(c.tiempo_inicio).getTime():0,tiempoFin:c.tiempo_fin?new Date(c.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),L.fire({icon:"success",title:"Horno eliminado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:t=>{console.error("Error al eliminar el horno:",t),L.fire({icon:"error",title:"Error al eliminar horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})};return(a,t)=>(l(),u(E,null,[e("div",je,[e("div",Re,[t[4]||(t[4]=e("h2",{class:"text-xl font-semibold mb-4"},"Ingredientes Disponibles",-1)),e("div",Ue,[t[2]||(t[2]=e("h3",{class:"text-lg font-medium mb-2"},"Masas",-1)),e("ul",Oe,[(l(!0),u(E,null,P(V.value,i=>(l(),u("li",{key:i.id,class:"flex justify-between"},[e("span",Ze,r(i.nombre),1),e("span",qe,r(i.cantidad)+" unidades",1)]))),128))])]),e("div",null,[t[3]||(t[3]=e("h3",{class:"text-lg font-medium mb-2"},"Rellenos",-1)),e("ul",Xe,[(l(!0),u(E,null,P(B.value,i=>(l(),u("li",{key:i.id,class:"flex justify-between"},[e("span",null,r(i.nombre),1),e("span",We,r(i.cantidad)+" unidades",1)]))),128))])])]),e("div",Ge,[t[8]||(t[8]=e("h2",{class:"text-xl font-semibold mb-4"},"Crear Nuevo Paste/Empanada",-1)),e("form",{onSubmit:ne(D,["prevent"]),class:"space-y-4"},[e("div",null,[t[6]||(t[6]=e("label",{for:"relleno",class:"block text-sm font-medium text-gray-700"},"Seleccionar Relleno",-1)),O(e("select",{"onUpdate:modelValue":t[0]||(t[0]=i=>m.value.relleno=i),id:"relleno",required:"",class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md"},[t[5]||(t[5]=e("option",{value:""},"Seleccione un relleno",-1)),(l(!0),u(E,null,P(z.value,i=>(l(),u("option",{key:i.id,value:i.nombre},r(i.nombre),9,Je))),128))],512),[[Y,m.value.relleno]])]),e("div",null,[t[7]||(t[7]=e("label",{for:"cantidad",class:"block text-sm font-medium text-gray-700"},"Cantidad",-1)),O(e("input",{"onUpdate:modelValue":t[1]||(t[1]=i=>m.value.cantidad=i),type:"number",id:"cantidad",required:"",min:"1",max:T.value,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 sm:text-sm"},null,8,Qe),[[ee,m.value.cantidad,void 0,{number:!0}]])]),e("button",{type:"submit",disabled:!I.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Asignar Unidades ",8,Ke)],32)])]),e("div",Ye,[(l(!0),u(E,null,P(w.value,(i,c)=>(l(),u("div",{key:i.id,class:"bg-white shadow rounded-lg p-6"},[e("div",et,[e("h2",tt,"Horno "+r(c+1),1),!i.horneando&&b.value.length>1?(l(),u("button",{key:0,onClick:y=>X(i.id),class:"flex items-center gap-2 bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"},[U(oe(ue),{class:"w-4 h-4"})],8,at)):j("",!0)]),i.horneando?(l(),u("div",ot,[t[9]||(t[9]=e("p",{class:"text-lg mb-2"},"Horneando grupo de pastes:",-1)),e("ul",null,[(l(!0),u(E,null,P(i.pastesHorneando,y=>(l(),u("li",{key:y.nombre},r(y.cantidad)+" "+r(y.nombre)+" - masa "+r(y.masa),1))),128))]),e("div",st,[e("div",{class:"bg-orange-600 h-2.5 rounded-full transition-all duration-100",style:ie({width:`${i.tiempoTranscurrido/g.value*100}%`})},null,4)]),e("p",null,"Tiempo restante: "+r(i.labeltime),1)])):(l(),u("div",nt,[t[10]||(t[10]=e("p",{class:"text-lg mb-4"},"El horno está disponible",-1)),e("button",{onClick:v,disabled:!x.value.length,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Iniciar Horneado de Grupo ",8,it)]))]))),128)),e("div",{class:"mt-4 h-full flex justify-center items-center"},[e("button",{onClick:A,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500"}," Crear Nuevo Horno ")])]),e("div",rt,[t[11]||(t[11]=e("h2",{class:"text-xl font-semibold mb-4"},"Grupos de Pastes por Hornear",-1)),x.value.length===0?(l(),u("div",lt," No hay grupos de pastes en la cola de horneado ")):(l(),u("ul",dt,[(l(!0),u(E,null,P(x.value,i=>(l(),u("li",{key:i.id,class:"py-4 flex justify-between items-center"},[e("span",null,r(i.cantidad)+" "+r(i.nombre)+" - masa "+r(i.masa),1),e("button",{onClick:c=>o(i.id),class:"bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"}," Cancelar ",8,ct)]))),128))]))])],64))}},pt={key:0,class:"mt-8 bg-white shadow rounded-lg p-6"},mt={class:"flex justify-between items-center mb-4"},ft={class:"flex items-center space-x-4"},xt={class:"flex items-center space-x-2"},vt={class:"flex items-center space-x-2"},gt=["value"],ht={class:"mb-6"},_t={class:"overflow-x-auto"},yt={class:"min-w-full divide-y divide-gray-200"},bt={class:"bg-white divide-y divide-gray-200"},wt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 capitalize"},$t={class:"text-xs text-gray-500 block capitalize"},Dt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},kt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ht={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ct={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize"},Mt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},St={class:"px-6 py-4 whitespace-nowrap"},Tt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Et={class:"mb-6"},Pt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ft={class:"font-medium"},zt={class:"mt-8"},Nt={class:"overflow-x-auto"},Lt={class:"min-w-full divide-y divide-gray-200"},At={class:"bg-white divide-y divide-gray-200"},Vt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},It={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Bt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},jt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Rt={class:"px-6 py-4 whitespace-nowrap capitalize"},Ut={__name:"ControlProduccion",setup(k){const{props:f}=q();C([]);const M=C([]);C([]);const b=$(()=>f.auth.user.roles[0].name==="admin");console.log(b.value);const w=C(new Date().toISOString().split("T")[0]),g=C("actual"),x=C([{value:"todas",label:"Todas las horas"},{value:"actual",label:"Hora Actual"},{value:"9-am",label:"9:00 AM"},{value:"10-am",label:"10:00 AM"},{value:"11-am",label:"11:00 AM"},{value:"12-pm",label:"12:00 PM"},{value:"1-pm",label:"1:00 PM"},{value:"2-pm",label:"2:00 PM"},{value:"3-pm",label:"3:00 PM"},{value:"4-pm",label:"4:00 PM"},{value:"5-pm",label:"5:00 PM"},{value:"6-pm",label:"6:00 PM"},{value:"7-pm",label:"7:00 PM"},{value:"8-pm",label:"8:00 PM"},{value:"9-pm",label:"9:00 PM"}]),v=s=>{const o=new Date(s),n=o.getHours();o.getMinutes();const d=n>=12?"pm":"am";return`${n%12||12}-${d}`},p=s=>{if(!s.tiempo_inicio_horneado||!s.created_at)return{promedio:0,ultima:"N/A",restante:"N/A"};const o=new Date(s.tiempo_inicio_horneado),n=new Date(s.created_at),d=Math.max(0,o-n),h=Math.floor(d/(1e3*60));return{promedio:h,ultima:T(s.tiempo_inicio_horneado),restante:h>0?`${h} min`:"Completado"}},F=s=>{if(!s.diferencia_notificacion_inicio||!s.created_at)return"N/A";const o=new Date(s.diferencia_notificacion_inicio),n=new Date(s.created_at),d=Math.max(0,o-n);return`${Math.floor(d/(1e3*60))} min`},H=()=>{const s=new Date(w.value+"T00:00:00-06:00"),o=new Date(w.value+"T23:59:59-06:00");return{inicio:s,fin:o}},N=s=>{const o=H();if(!o)return!0;const n=new Date(s),d=new Date(n.toLocaleString("en-US",{timeZone:"America/Mexico_City"})),h=new Date(o.inicio.toLocaleString("en-US",{timeZone:"America/Mexico_City"})),A=new Date(o.fin.toLocaleString("en-US",{timeZone:"America/Mexico_City"}));return d>=h&&d<=A},z=()=>{const s=new Date,o=new Date(s.toLocaleString("en-US",{timeZone:"America/Mexico_City"}));w.value=o.toISOString().split("T")[0]},V=s=>{if(s.estado&&s.estado!=="pendiente")return s.estado;if(s.estado==="pendiente"){const n=v(new Date);if(v(s.created_at)!==n)return"desperdicio"}return s.estado||"pendiente"},B=$(()=>{var n;if(!((n=f.notificaciones)!=null&&n.faltantes))return[];let o=f.notificaciones.faltantes.map(d=>({id:d.id,paste:d.paste,cantidad:d.cantidad,hora_notificacion:d.hora_notificacion,dia_notificacion:d.dia_notificacion,estado:V(d),tiempo_inicio_horneado:d.tiempo_inicio_horneado,hora_ultima_venta:d.hora_ultima_venta,cantidad_vendida:d.cantidad_vendida,diferencia_notificacion_inicio:d.diferencia_notificacion_inicio,created_at:d.created_at,cantidad_horneada:d.cantidad_horneada})).filter(d=>N(d.created_at));if(g.value==="todas")return o;if(g.value==="actual"){const h=v(new Date);return o.filter(A=>v(A.created_at)===h)}return o.filter(d=>v(d.created_at)===g.value)}),m=$(()=>{var s;return(s=f.notificaciones)!=null&&s.faltantes?f.notificaciones.faltantes.filter(o=>o.tiempo_inicio_horneado).map(o=>({paste:o.paste.nombre,...p(o)})):[]}),S=$(()=>{var s;return(s=f.notificaciones)!=null&&s.faltantes?f.notificaciones.faltantes.map(o=>({id:o.id,paste:o.paste,cantidad:o.cantidad,hora_notificacion:o.hora_notificacion,dia_notificacion:o.dia_notificacion,estado:o.estado,tiempo_inicio_horneado:o.tiempo_inicio_horneado,hora_ultima_venta:o.hora_ultima_venta,cantidad_vendida:o.cantidad_vendida,diferencia_notificacion_inicio:o.diferencia_notificacion_inicio,created_at:o.created_at})):[]});$(()=>{var s;return(s=f.notificaciones)!=null&&s.horneados?f.notificaciones.horneados:[]});const D=$(()=>S.value.map(o=>({paste:o.paste.nombre,recomendacion:"Producir",razon:`Faltan ${o.cantidad} unidades para las ${o.hora_notificacion}`})));K(()=>{var s;return(s=f.notificaciones)==null?void 0:s.faltantes},s=>{s&&(M.value=D.value)},{immediate:!0});const T=s=>s?new Date(s).toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:"America/Mexico_City"}):"-",I=s=>`px-2 py-1 rounded-full text-xs font-medium ${{horneando:"bg-yellow-100 text-yellow-800 capitalize",retirado:"bg-blue-100 text-blue-800 capitalize",vendido:"bg-green-100 text-green-800 capitalize",desperdicio:"bg-red-100 text-red-800 capitalize",pendiente:"bg-gray-100 text-gray-800 capitalize",en_espera:"bg-green-100 text-green-800"}[s]}`,_=$(()=>{var n;if(!((n=f.notificaciones)!=null&&n.horneados))return[];let o=f.notificaciones.horneados.map(d=>({...d,estado:V(d)})).filter(d=>N(d.created_at));if(g.value==="todas")return o;if(g.value==="actual"){const h=v(new Date);return o.filter(A=>v(A.created_at)===h)}return o.filter(d=>v(d.created_at)===g.value)});return J(()=>{z()}),(s,o)=>b.value?(l(),u("div",pt,[e("div",mt,[o[4]||(o[4]=e("h2",{class:"text-xl font-semibold"},"Control de Producción",-1)),e("div",ft,[e("div",xt,[o[2]||(o[2]=e("label",{for:"fecha",class:"text-sm font-medium text-gray-700"},"Seleccionar día:",-1)),O(e("input",{type:"date",id:"fecha","onUpdate:modelValue":o[0]||(o[0]=n=>w.value=n),class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},null,512),[[ee,w.value]])]),e("div",vt,[o[3]||(o[3]=e("label",{for:"hora",class:"text-sm font-medium text-gray-700"},"Filtrar por hora:",-1)),O(e("select",{id:"hora","onUpdate:modelValue":o[1]||(o[1]=n=>g.value=n),class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[(l(!0),u(E,null,P(x.value,n=>(l(),u("option",{key:n.value,value:n.value},r(n.label),9,gt))),128))],512),[[Y,g.value]])])])]),e("div",ht,[o[6]||(o[6]=e("h3",{class:"text-lg font-medium mb-2"},"Productos Faltantes",-1)),e("div",_t,[e("table",yt,[o[5]||(o[5]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Producto"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Faltante"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Horneada"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Vendida"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Día"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora Requerida"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Última Venta")])],-1)),e("tbody",bt,[(l(!0),u(E,null,P(B.value,n=>(l(),u("tr",{key:n.id,class:"hover:bg-gray-50"},[e("td",wt,[G(r(n.paste.nombre)+" ",1),e("span",$t,r(n.paste.tipo),1)]),e("td",Dt,r(n.cantidad)+" unidades ",1),e("td",kt,r(n.cantidad_horneada?`${n.cantidad_horneada} unidades`:"-"),1),e("td",Ht,r(n.cantidad_vendida?`${n.cantidad_vendida} unidades`:"-"),1),e("td",Ct,r(n.dia_notificacion),1),e("td",Mt,r(T(n.created_at)),1),e("td",St,[e("span",{class:Z(["px-2 py-1 text-xs font-medium rounded-full",n.estado==="pendiente"?"bg-red-100 text-red-800":n.estado==="horneando"?"bg-yellow-100 text-yellow-800":n.estado==="desperdicio"?"bg-red-100 text-red-800":"bg-green-100 text-green-800"])},r(n.estado==="pendiente"?"Sin hornear":n.estado==="desperdicio"?"Desperdicio":n.estado),3)]),e("td",Tt,r(n.estado==="pendiente"?"-":n.hora_ultima_venta?T(n.hora_ultima_venta):"Sin ventas"),1)]))),128))])])])]),e("div",Et,[o[7]||(o[7]=e("h3",{class:"text-lg font-medium mb-2"},"Tiempo de Reposición",-1)),e("div",Pt,[(l(!0),u(E,null,P(m.value,(n,d)=>(l(),u("div",{key:d,class:"bg-gray-50 p-4 rounded-lg"},[e("p",Ft,r(n.paste),1),e("p",null,"Tiempo promedio: "+r(n.promedio)+" minutos",1),e("p",null,"Última reposición: "+r(n.ultima),1),e("p",null,"Tiempo restante: "+r(n.restante),1)]))),128))])]),e("div",zt,[o[9]||(o[9]=e("h3",{class:"text-lg font-medium mb-2"},"Control de Tiempo de Producción",-1)),e("div",Nt,[e("table",Lt,[o[8]||(o[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Paste"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de notificación"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de Producción"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo en meter producción"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado")])],-1)),e("tbody",At,[(l(!0),u(E,null,P(_.value,n=>(l(),u("tr",{key:n.id},[e("td",Vt,r(n.paste.nombre),1),e("td",It,r(T(n.created_at)),1),e("td",Bt,r(T(n.tiempo_inicio_horneado)),1),e("td",jt,r(F(n)),1),e("td",Rt,[e("span",{class:Z(I(n.estado))},r(n.estado),3)])]))),128))])])])])])):j("",!0)}},Ot={class:"animate-pulse"},Zt={key:0,class:"mt-2"},qt={class:"font-bold"},ae={__name:"NotificationPanel",props:{notifications:{type:Array,required:!0},isVisible:{type:Boolean,default:!1},type:{type:String,required:!0,validator:k=>["warning","info"].includes(k)},title:{type:String,required:!0}},emits:["toggle"],setup(k){return(f,M)=>(l(),u("div",{class:Z(["p-4 border rounded shadow mb-4 size-fit cursor-pointer",{"bg-yellow-100":k.type==="warning","bg-blue-100":k.type==="info"}]),onClick:M[0]||(M[0]=b=>f.$emit("toggle"))},[e("h2",{class:Z(["text-lg font-bold text-center",{"text-yellow-800":k.type==="warning","text-blue-800":k.type==="info"}])},[G(r(k.type==="warning"?"⚠️":"ℹ️")+" "+r(k.title)+" ",1),e("span",Ot,"("+r(k.notifications.length)+")",1),G(" "+r(k.type==="warning"?"⚠️":"ℹ️"),1)],2),k.isVisible?(l(),u("ul",Zt,[(l(!0),u(E,null,P(k.notifications,b=>(l(),u("li",{key:b.id,class:"mb-2"},[e("span",null,[e("span",qt,r(b.nombre),1),G(": "+r(k.type==="warning"?"Faltan":"Hay")+" "+r(k.type==="warning"?Math.abs(b.diferencia):b.diferencia)+" unidades para las "+r(b.hora)+" ",1),e("span",{class:Z(["text-sm",{"text-red-600":k.type==="warning","text-green-600":k.type==="info"}])}," ("+r(b.porcentaje)+"% del estimado) ",3)])]))),128))])):j("",!0)],2))}},Xt={class:"container mx-auto p-4"},Wt={class:"sm:flex justify-between flex-row text-sm"},Gt={class:"flex gap-3 sm:flex-row flex-col"},Jt={class:"mt-6"},Qt={__name:"Hornear",setup(k){const f=C(!1),M=C(!1),b=C(null),w=C(null),{props:g}=q(),x=$(()=>g.auth.user.roles[0].name==="admin"),v=$(()=>g.inventario||[]),p=$(()=>g.estimacionesHoy||[]),F=()=>{const _=new Date;return{day:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"][_.getDay()].toLowerCase(),hour:_.getHours(),minutes:_.getMinutes()}},H=C(F());K(()=>H.value.hour,_=>{_!==b.value&&(b.value=_,S.value.length>0&&(f.value=!0),D.value.length>0&&(M.value=!0))}),J(()=>{b.value=H.value.hour,w.value=setInterval(()=>{H.value=F()},1e3)}),re(()=>{w.value&&clearInterval(w.value)});const N=_=>{const[s,o]=_.toLowerCase().split(" ");let[n,d]=s.split(":").map(Number);return{hours:o==="pm"&&n!==12?n+12:o==="am"&&n===12?0:n,minutes:d}},z=$(()=>v.value.filter(_=>{var s;return["pastes","empanadas dulces","empanadas saladas"].includes((s=_.tipo)==null?void 0:s.toLowerCase())})),V=$(()=>{if(!p.value.length||!z.value.length)return console.log("No hay estimaciones o productos relevantes"),[];const _=new Map(z.value.map(o=>[o.id,o]));return p.value.map(o=>{const n=_.get(o.inventario_id);if(!n)return null;const{hours:d}=N(o.hora);return{id:`${n.id}-${o.hora}`,nombre:n.nombre,estimado:o.cantidad,existente:n.cantidad,diferencia:n.cantidad-o.cantidad,hora:o.hora,dia:o.dia.toLowerCase(),horaEnNumero:d,tipo:n.tipo}}).filter(Boolean).filter((o,n,d)=>n===d.findIndex(h=>h.id===o.id))}),B=$(()=>V.value.filter(s=>s.dia===H.value.day)),m=$(()=>{const s=(H.value.hour+1)%24,o=B.value.filter(h=>h.horaEnNumero===s),n=new Map(o.map(h=>[h.nombre,h]));return z.value.map(h=>{const A=n.get(h.nombre);return A||{id:`${h.id}-${s}:00`,nombre:h.nombre,estimado:0,existente:h.cantidad,diferencia:h.cantidad,hora:`${s}:00`,dia:H.value.day,horaEnNumero:s,tipo:h.tipo}})}),S=$(()=>m.value.filter(s=>s.estimado>0&&s.diferencia<0).map(s=>({...s,porcentaje:s.estimado>0?Math.round(s.existente/s.estimado*100):0}))),D=$(()=>m.value.filter(s=>s.estimado>0&&s.diferencia>0||s.estimado===0&&s.existente>0).map(s=>({...s,porcentaje:s.estimado>0?Math.round(s.existente/s.estimado*100):100}))),T=()=>f.value=!f.value,I=()=>M.value=!M.value;return(_,s)=>(l(),u("div",Xt,[e("div",Wt,[s[0]||(s[0]=e("h1",{class:"text-2xl font-bold mb-4"},"Sistema de Horneado",-1)),e("div",Gt,[U(ae,{notifications:S.value,"is-visible":f.value,type:"warning",title:"Faltantes",onToggle:T},null,8,["notifications","is-visible"]),U(ae,{notifications:D.value,"is-visible":M.value,type:"info",title:"Excedentes",onToggle:I},null,8,["notifications","is-visible"])])]),e("div",Jt,[U(ut),U(Ut),oe(g).user.roles[0]!=="supervisor"?(l(),Q(He,{key:0})):j("",!0),x.value?(l(),Q(Be,{key:1})):j("",!0)])]))}},Kt={class:"py-6"},Yt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 rounded-xl overflow-hidden"},ea={class:"flex justify-between p-6 lg:p-8 bg-white border-b border-gray-200 rounded-2xl"},na={__name:"index",setup(k){return(f,M)=>(l(),Q(se,{title:"Tablero principal"},{default:le(()=>[e("div",Kt,[e("div",Yt,[e("div",ea,[U(Qt)])])])]),_:1}))}};export{na as default};
