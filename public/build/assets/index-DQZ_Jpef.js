import{S as U,_ as xe}from"./AppLayout-95KzA-8h.js";import{Q as Y,d as C,p as b,o as l,e as c,a,F as P,h as z,t as d,f as R,x as re,i as ne,j as K,l as de,v as ce,z as G,k as ve,b as X,u as me,B as ge,y as ue,g as oe,n as Q,C as _e,c as le,w as ye}from"./app-CtN4jI6a.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as we}from"./createLucideIcon-Cq3uK7X0.js";/**
 * @license lucide-vue-next v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=we("Trash2Icon",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),De={class:"bg-white rounded-lg shadow-md overflow-hidden"},Ee={class:"overflow-x-auto"},Se={class:"min-w-full divide-y divide-gray-200"},He={class:"bg-white divide-y divide-gray-200"},ke={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Me={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Ce={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Te={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ne={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Fe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Pe={key:0},ze={class:"bg-gray-50"},Ie={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Le={__name:"PastesHorneados",setup(H){const{props:v}=Y();C(v.pastesHorneados);const T=b(()=>{const h={};v.pastesHorneados.forEach(m=>{h[m.relleno]||(h[m.relleno]={totalPiezas:0,items:[]}),h[m.relleno].totalPiezas+=Number(m.piezas),h[m.relleno].items.push(m)});const E=[];return Object.keys(h).forEach(m=>{h[m].items.forEach((I,k)=>{E.push({...I,totalPiezas:h[m].totalPiezas,isFirst:k===0})})}),E}),N=b(()=>T.value.reduce((h,E)=>Number(h)+(E.isFirst?Number(E.totalPiezas):0),0)),$=h=>new Date(h).toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"America/Mexico_City"}),f=h=>new Date(h).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",timeZone:"America/Mexico_City"});return(h,E)=>(l(),c("div",null,[E[3]||(E[3]=a("h1",{class:"pb-4 pt-10 font-semibold text-xl"},"Pastes/Empanadas horneados de hoy",-1)),a("div",De,[a("div",Ee,[a("table",Se,[E[2]||(E[2]=a("thead",{class:"bg-gray-50"},[a("tr",null,[a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Responsable"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Paste/Empanada"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Hora"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Día"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Piezas Horneadas"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Total del día")])],-1)),a("tbody",He,[(l(!0),c(P,null,z(T.value,(m,I)=>{var k,q,A;return l(),c("tr",{key:I},[a("td",ke,d((k=m==null?void 0:m.responsable)==null?void 0:k.name)+" "+d(((q=m==null?void 0:m.responsable)==null?void 0:q.apellido_p)||"")+" "+d(((A=m==null?void 0:m.responsable)==null?void 0:A.apellido_m)||""),1),a("td",Me,d(m.relleno),1),a("td",Ce,d($(m.updated_at)),1),a("td",Te,d(f(m.updated_at)),1),a("td",Ne,d(m.piezas),1),a("td",Fe,[m.isFirst?(l(),c("span",Pe,d(m.totalPiezas),1)):R("",!0)])])}),128))]),a("tfoot",ze,[a("tr",null,[E[0]||(E[0]=a("td",{colspan:"3",class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},"Total de piezas horneadas:",-1)),a("td",Ie,d(N.value),1),E[1]||(E[1]=a("td",null,null,-1))])])])])])]))}},Ve=be(Le,[["__scopeId","data-v-1a02fb88"]]),Ae={class:"pt-16"},je={class:"max-w-7xl mx-auto space-y-6"},Be={class:"bg-white rounded-lg shadow p-6"},Oe={class:"text-2xl font-bold text-gray-900"},Ue={class:"mt-4"},Re=["value"],qe={key:0,class:"bg-white rounded-lg shadow overflow-x-auto"},Je={class:"min-w-full divide-y divide-gray-200"},We={class:"bg-gray-50"},Ge={class:"bg-white divide-y divide-gray-200"},Ze={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Xe=["onUpdate:modelValue"],Ke={key:1,class:"w-full flex justify-end"},Qe={__name:"EstimacionPastes",setup(H){const{props:v}=Y(),T=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"],N=new Date().getDay(),$=T[N],f=C($||"Lunes"),h=C(!1),E=[{value:"Lunes",label:"Lunes"},{value:"Martes",label:"Martes"},{value:"Miercoles",label:"Miércoles"},{value:"Jueves",label:"Jueves"},{value:"Viernes",label:"Viernes"},{value:"Sábado",label:"Sábado"},{value:"Domingo",label:"Domingo"}],m=["7:00 am","8:00 am","9:00 am","10:00 am","11:00 am","12:00 pm","1:00 pm","2:00 pm","3:00 pm","4:00 pm","5:00 pm","6:00 pm","7:00 pm","8:00 pm","9:00 pm"],I=b(()=>v.inventario.filter(p=>["pastes","empanadas dulces","empanadas saladas"].includes(p.tipo)).map(p=>p.nombre)),k=C({}),q=U.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:p=>{p.onmouseenter=U.stopTimer,p.onmouseleave=U.resumeTimer}}),A=()=>{const p={};return m.forEach(M=>{p[M]={},I.value.forEach(D=>{p[M][D]=0})}),p},J=()=>{h.value=!1,k.value=A(),v.estimaciones.filter(M=>M.dia===f.value).forEach(({hora:M,cantidad:D,inventario_id:j})=>{var g;const O=(g=v.inventario.find(u=>u.id===j))==null?void 0:g.nombre;O&&k.value[M]&&(k.value[M][O]=D)}),h.value=!0},L=()=>{G.post("/estimaciones",{estimaciones:k.value,dia:f.value},{preserveState:!1,preserveScroll:!0,onSuccess:()=>q.fire({icon:"success",title:"Estimaciones guardados exitosamente"}),onError:()=>q.fire({icon:"error",title:"Error al guardar las estimaciones"})})};return re(()=>{J()}),ne(f,()=>{J()}),(p,M)=>(l(),c("div",Ae,[a("div",je,[a("header",Be,[a("h1",Oe,"Sistema de Control de Producción - Día: "+d(f.value),1),a("div",Ue,[K(a("select",{"onUpdate:modelValue":M[0]||(M[0]=D=>f.value=D),class:"rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500"},[(l(),c(P,null,z(E,D=>a("option",{key:D.value,value:D.value},d(D.label),9,Re)),64))],512),[[de,f.value]])])]),h.value?(l(),c("div",qe,[a("table",Je,[a("thead",We,[a("tr",null,[M[1]||(M[1]=a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo",-1)),(l(!0),c(P,null,z(I.value,D=>(l(),c("th",{key:D,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},d(D),1))),128))])]),a("tbody",Ge,[(l(),c(P,null,z(m,D=>a("tr",{key:D},[a("td",Ze,d(D),1),(l(!0),c(P,null,z(I.value,j=>(l(),c("td",{key:j,class:"px-6 py-4 whitespace-nowrap"},[K(a("input",{type:"number","onUpdate:modelValue":O=>k.value[D][j]=O,class:"w-20 rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500",min:"0"},null,8,Xe),[[ce,k.value[D][j]]])]))),128))])),64))])])])):R("",!0),p.$page.props.auth.user.roles[0].name=="admin"?(l(),c("div",Ke,[a("button",{onClick:L,class:"px-3 py-2 bg-orange-500 rounded-lg text-white hover:bg-orange-400"}," Guardar ")])):R("",!0)])]))}},Ye={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},et={class:"bg-white shadow rounded-lg p-6"},tt={class:"mb-6"},at={class:"list-disc pl-5"},ot={class:"capitalize"},nt={class:"font-semibold"},rt={class:"list-disc pl-5"},st={class:"font-semibold"},it={class:"bg-white shadow rounded-lg p-6"},lt=["value"],dt=["max"],ct=["disabled"],ut={key:0,class:"text-sm text-red-600 mt-2"},pt={key:0},mt={key:1},ft={class:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-4"},ht={class:"flex justify-between"},xt={class:"text-xl font-semibold mb-4"},vt=["onClick"],gt={key:0},_t={class:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 mb-4"},yt={key:1},bt=["disabled"],wt={class:"mt-8 bg-white shadow rounded-lg p-6"},$t={key:0,class:"text-gray-500 text-center py-4"},Dt={key:1,class:"divide-y divide-gray-200"},Et=["onClick"],St={__name:"SistemaHorneado",setup(H){var te,ae;const{props:v}=Y(),T=v.inventario||[],N=C(v.hornos||[]),$=C(N.value.map(r=>({...r,horneando:r.estado||!1,pastesHorneando:r.pastesHorneando||[],tiempoInicio:r.tiempo_inicio?new Date(r.tiempo_inicio).getTime():0,tiempoFin:r.tiempo_fin?new Date(r.tiempo_fin).getTime():0,tiempoTranscurrido:0,timer:null,labeltime:"00:00"}))),f=C(9e5),h=C([]),E=()=>{if(h.value.length===0)return;const r=$.value.find(n=>!n.horneando);if(r){r.horneando=!0,r.pastesHorneando=[...h.value],h.value=[],r.tiempoInicio=Date.now(),r.tiempoFin=r.tiempoInicio+f.value;try{ue.post("/iniciar-horneado",{horno_id:r.id,tiempo_inicio:r.tiempoInicio,tiempo_fin:r.tiempoFin,pastes_horneando:r.pastesHorneando,estado:!0}).then(n=>{console.log(n)}).catch(n=>{console.error("Error al iniciar el horneado:",n)}),U.fire({icon:"success",title:"Horneando",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500}),V(r.id)}catch(n){console.error("Error al iniciar el horneado:",n),U.fire({icon:"error",title:"Error al iniciar",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}}else Z()},m=U.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:r=>{r.addEventListener("mouseenter",U.stopTimer),r.addEventListener("mouseleave",U.resumeTimer)}}),I=async r=>{const n=$.value.find(e=>e.id===r);if(!(!n||!n.horneando))try{clearInterval(n.timer);const e=[...n.pastesHorneando];n.horneando=!1,n.pastesHorneando=[],n.tiempoTranscurrido=0,n.labeltime="00:00",k();for(const t of e){const o=T.find(i=>i.nombre.toLowerCase()===t.nombre.toLowerCase()&&(i.tipo==="pastes"||i.tipo==="empanadas saladas"||i.tipo==="empanadas dulces"));if(o)try{await ue.post("/api/control-produccion/horneado",{horno_id:r,paste_id:o.id,cantidad:t.cantidad})}catch(i){console.error(`Horno ${r} - Error al registrar producción para ${t.nombre}:`,i)}else console.error(`Horno ${r} - No se encontró el paste ${t.nombre} en el inventario`)}G.post("/hornear",{horno_id:r,pastes:e},{preserveScroll:!0,preserveState:!1,replace:!0,onSuccess:()=>{m.fire({icon:"success",title:"Horneado finalizado"})},onError:t=>{console.error(`Horno ${r} - Error al registrar el horneado:`,t),m.fire({icon:"error",title:"Error al registrar el horneado"})}})}catch(e){console.error(`Horno ${r} - Error en finalizarHorneado:`,e)}},k=()=>{new Audio("/sound/videoplayback.mp3").play().catch(n=>console.error("Error al reproducir el sonido:",n))},q=b(()=>T.filter(r=>r.tipo==="masa")),A=b(()=>T.filter(r=>r.tipo==="relleno")),J=b(()=>q.value.map(r=>{const n=$.value.filter(e=>e.horneando&&e.pastesHorneando.some(t=>t.masa===r.nombre)).reduce((e,t)=>e+t.pastesHorneando.find(o=>o.masa===r.nombre).cantidad,0);return{...r,cantidad:Math.max(0,r.cantidad-n)}})),L=b(()=>A.value.map(r=>{const n=$.value.filter(e=>e.horneando&&e.pastesHorneando.some(t=>t.nombre===r.nombre)).reduce((e,t)=>e+t.pastesHorneando.find(o=>o.nombre===r.nombre).cantidad,0);return{...r,cantidad:Math.max(0,r.cantidad-n)}})),p=C({masa:"",relleno:"",cantidad:1,sucursal_id:(ae=(te=v.auth)==null?void 0:te.user)==null?void 0:ae.sucursal_id}),M=r=>{const n={pastes:"bola","empanadas saladas":"salada","empanadas dulces":"dulce"},e=T.find(t=>(t.nombre.toLowerCase()===r.value.relleno.toLowerCase()||t.nombre.toLowerCase().startsWith(r.value.relleno.toLowerCase()))&&n[t.tipo.toLowerCase()]);return e?n[e.tipo.toLowerCase()]:"bola"},D=()=>{var o,i,x,s;const r=M(p).toLowerCase(),n=J.value.find(y=>y.nombre.toLowerCase()===r),e=L.value.find(y=>y.nombre.toLowerCase()===p.value.relleno.toLowerCase());if(!n||n.cantidad<=0){m.fire({icon:"error",title:"No hay suficiente masa disponible"});return}if(!e||e.cantidad<=0){m.fire({icon:"error",title:"No hay suficiente relleno disponible"});return}const t=Math.min(n.cantidad,e.cantidad);if(p.value.cantidad>t){m.fire({icon:"error",title:`Solo hay ${t} unidades disponibles (${n.cantidad} masa, ${e.cantidad} relleno)`});return}if(n&&e&&p.value.cantidad<=t){n.cantidad-=p.value.cantidad,e.cantidad-=p.value.cantidad;const y=h.value.find(B=>B.nombre===e.nombre);y?y.cantidad+=p.value.cantidad:u({id:Date.now(),masa:n.nombre,nombre:e.nombre,cantidad:p.value.cantidad,sucursal_id:(i=(o=v.auth)==null?void 0:o.user)==null?void 0:i.sucursal_id}),p.value={masa:"",relleno:"",cantidad:1,sucursal_id:(s=(x=v.auth)==null?void 0:x.user)==null?void 0:s.sucursal_id}}},j=b(()=>{const r=M(p).toLowerCase(),n=J.value.find(t=>t.nombre.toLowerCase()===r),e=L.value.find(t=>t.nombre===p.value.relleno);return!n||!e?0:Math.min(n.cantidad,e.cantidad)}),O=b(()=>{const r=M(p).toLowerCase(),n=J.value.find(o=>o.nombre.toLowerCase()===r),e=L.value.find(o=>o.nombre===p.value.relleno);if(!n||!e)return!1;const t=Math.min(n.cantidad,e.cantidad);return p.value.relleno&&p.value.cantidad>0&&p.value.cantidad<=t&&t>0});C("00:00");const g=r=>{if(r<=0)return"00:00";const n=Math.floor(r/1e3),e=Math.floor(n/60),t=n%60;return`${String(e).padStart(2,"0")}:${String(t).padStart(2,"0")}`},u=r=>{const n=T.find(e=>e.nombre.toLowerCase()===r.nombre.toLowerCase()&&(e.tipo==="pastes"||e.tipo==="empanadas saladas"||e.tipo==="empanadas dulces"));n?h.value.push({...r,paste_id:n.id}):console.error(`No se encontró el paste ${r.nombre} en el inventario`)},w=r=>{h.value=h.value.filter(n=>n.id!==r)},_=r=>{I(r).catch(n=>{console.error(`Error al finalizar horneado desde timer: ${n}`)})},V=r=>{const n=$.value.find(o=>o.id===r);if(!n)return;const t=n.tiempoFin-Date.now();if(t<=0){_(r);return}n.tiempoTranscurrido=f.value-t,n.labeltime=g(t),n.timer&&clearInterval(n.timer),n.timer=setInterval(()=>{const o=n.tiempoFin-Date.now();if(o<=0){clearInterval(n.timer),_(r);return}n.tiempoTranscurrido=f.value-o,n.labeltime=g(o)},1e3)},F=r=>{const n=$.value.find(o=>o.id===r);if(!n)return;const t=n.tiempoFin-Date.now();if(t<=0){_(r);return}n.tiempoTranscurrido=f.value-t,n.labeltime=g(t),n.timer&&clearInterval(n.timer),n.timer=setInterval(()=>{const o=n.tiempoFin-Date.now();if(o<=0){clearInterval(n.timer),_(r);return}n.tiempoTranscurrido=f.value-o,n.labeltime=g(o)},1e3)};re(()=>{$.value.forEach(r=>{r.timer&&clearInterval(r.timer)}),$.value.forEach(r=>{if(r.estado){const n=Date.now()-new Date(r.tiempo_inicio).getTime(),e=f.value-n;if(e<=0){_(r.id);return}r.tiempoFin=Date.now()+e,F(r.id)}})});const Z=()=>{G.post("/crear-horno",{estado:!1,pastesHorneando:[]},{preserverScroll:!0,preserveState:!1,onSuccess:r=>{var n;N.value=(n=r==null?void 0:r.props)==null?void 0:n.hornos,h.value=[],$.value=N.value.map(e=>({...e,horneando:e.estado||!1,pastesHorneando:e.pastesHorneando||[],tiempoInicio:e.tiempo_inicio?new Date(e.tiempo_inicio).getTime():0,tiempoFin:e.tiempo_fin?new Date(e.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),U.fire({icon:"success",title:"Horno creado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:r=>{console.error("Error al crear el horno:",r),U.fire({icon:"error",title:"Error al crear horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})},ee=r=>{G.post("/eliminar-horno",{horno_id:r},{preserveScroll:!0,preserveState:!1,onSuccess:n=>{var e;N.value=(e=n==null?void 0:n.props)==null?void 0:e.hornos,$.value=N.value.map(t=>({...t,horneando:t.estado||!1,pastesHorneando:t.pastesHorneando||[],tiempoInicio:t.tiempo_inicio?new Date(t.tiempo_inicio).getTime():0,tiempoFin:t.tiempo_fin?new Date(t.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),U.fire({icon:"success",title:"Horno eliminado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:n=>{console.error("Error al eliminar el horno:",n),U.fire({icon:"error",title:"Error al eliminar horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})};return(r,n)=>(l(),c(P,null,[a("div",Ye,[a("div",et,[n[4]||(n[4]=a("h2",{class:"text-xl font-semibold mb-4"},"Ingredientes Disponibles",-1)),a("div",tt,[n[2]||(n[2]=a("h3",{class:"text-lg font-medium mb-2"},"Masas",-1)),a("ul",at,[(l(!0),c(P,null,z(J.value,e=>(l(),c("li",{key:e.id,class:"flex justify-between"},[a("span",ot,d(e.nombre),1),a("span",nt,d(e.cantidad)+" unidades",1)]))),128))])]),a("div",null,[n[3]||(n[3]=a("h3",{class:"text-lg font-medium mb-2"},"Rellenos",-1)),a("ul",rt,[(l(!0),c(P,null,z(L.value,e=>(l(),c("li",{key:e.id,class:"flex justify-between"},[a("span",null,d(e.nombre),1),a("span",st,d(e.cantidad)+" unidades",1)]))),128))])])]),a("div",it,[n[8]||(n[8]=a("h2",{class:"text-xl font-semibold mb-4"},"Crear Nuevo Paste/Empanada",-1)),a("form",{onSubmit:ve(D,["prevent"]),class:"space-y-4"},[a("div",null,[n[6]||(n[6]=a("label",{for:"relleno",class:"block text-sm font-medium text-gray-700"},"Seleccionar Relleno",-1)),K(a("select",{"onUpdate:modelValue":n[0]||(n[0]=e=>p.value.relleno=e),id:"relleno",required:"",class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md"},[n[5]||(n[5]=a("option",{value:""},"Seleccione un relleno",-1)),(l(!0),c(P,null,z(A.value,e=>(l(),c("option",{key:e.id,value:e.nombre},d(e.nombre),9,lt))),128))],512),[[de,p.value.relleno]])]),a("div",null,[n[7]||(n[7]=a("label",{for:"cantidad",class:"block text-sm font-medium text-gray-700"},"Cantidad",-1)),K(a("input",{"onUpdate:modelValue":n[1]||(n[1]=e=>p.value.cantidad=e),type:"number",id:"cantidad",required:"",min:"1",max:j.value,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 sm:text-sm"},null,8,dt),[[ce,p.value.cantidad,void 0,{number:!0}]])]),a("button",{type:"submit",disabled:!O.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed"},d(O.value?"Asignar Unidades":"Sin ingredientes suficientes"),9,ct),p.value.relleno&&!O.value?(l(),c("div",ut,[j.value===0?(l(),c("span",pt,"No hay ingredientes disponibles")):(l(),c("span",mt,"Máximo disponible: "+d(j.value)+" unidades",1))])):R("",!0)],32)])]),a("div",ft,[(l(!0),c(P,null,z($.value,(e,t)=>(l(),c("div",{key:e.id,class:"bg-white shadow rounded-lg p-6"},[a("div",ht,[a("h2",xt,"Horno "+d(t+1),1),!e.horneando&&N.value.length>1?(l(),c("button",{key:0,onClick:o=>ee(e.id),class:"flex items-center gap-2 bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"},[X(me($e),{class:"w-4 h-4"})],8,vt)):R("",!0)]),e.horneando?(l(),c("div",gt,[n[9]||(n[9]=a("p",{class:"text-lg mb-2"},"Horneando grupo de pastes:",-1)),a("ul",null,[(l(!0),c(P,null,z(e.pastesHorneando,o=>(l(),c("li",{key:o.nombre},d(o.cantidad)+" "+d(o.nombre)+" - masa "+d(o.masa),1))),128))]),a("div",_t,[a("div",{class:"bg-orange-600 h-2.5 rounded-full transition-all duration-100",style:ge({width:`${e.tiempoTranscurrido/f.value*100}%`})},null,4)]),a("p",null,"Tiempo restante: "+d(e.labeltime),1)])):(l(),c("div",yt,[n[10]||(n[10]=a("p",{class:"text-lg mb-4"},"El horno está disponible",-1)),a("button",{onClick:E,disabled:!h.value.length,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Iniciar Horneado de Grupo ",8,bt)]))]))),128)),a("div",{class:"mt-4 h-full flex justify-center items-center"},[a("button",{onClick:Z,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500"}," Crear Nuevo Horno ")])]),a("div",wt,[n[11]||(n[11]=a("h2",{class:"text-xl font-semibold mb-4"},"Grupos de Pastes por Hornear",-1)),h.value.length===0?(l(),c("div",$t," No hay grupos de pastes en la cola de horneado ")):(l(),c("ul",Dt,[(l(!0),c(P,null,z(h.value,e=>(l(),c("li",{key:e.id,class:"py-4 flex justify-between items-center"},[a("span",null,d(e.cantidad)+" "+d(e.nombre)+" - masa "+d(e.masa),1),a("button",{onClick:t=>w(e.id),class:"bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"}," Cancelar ",8,Et)]))),128))]))])],64))}},Ht={key:0,class:"mt-8 bg-white shadow rounded-lg p-6"},kt={class:"flex justify-between items-center mb-4"},Mt={class:"flex items-center space-x-4"},Ct={class:"flex items-center space-x-2"},Tt={class:"flex items-center space-x-2"},Nt=["value"],Ft={class:"mb-6"},Pt={key:0,class:"overflow-x-auto"},zt={class:"min-w-full divide-y divide-gray-200"},It={class:"bg-white divide-y divide-gray-200"},Lt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 capitalize"},Vt={class:"text-xs text-gray-500 block capitalize"},At={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},jt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Bt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ot={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize"},Ut={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Rt={class:"px-6 py-4 whitespace-nowrap"},qt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Jt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Wt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},Gt={class:"flex space-x-2"},Zt=["onClick"],Xt=["onClick"],Kt=["onClick"],Qt={key:1,class:"text-center py-8"},Yt={class:"mt-8"},ea={class:"overflow-x-auto"},ta={class:"min-w-full divide-y divide-gray-200"},aa={class:"bg-white divide-y divide-gray-200"},oa={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},na={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ra={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},sa={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ia={class:"px-6 py-4 whitespace-nowrap capitalize"},la={__name:"ControlProduccion",setup(H){const{props:v}=Y();console.log(v),C([]);const T=C([]);C([]);const N=b(()=>{var o,i;const e=(o=v.auth)==null?void 0:o.user,t=e==null?void 0:e.roles;return t&&t.length>0&&((i=t[0])==null?void 0:i.name)==="admin"}),$=C(new Date().toISOString().split("T")[0]),f=C("actual"),h=C([{value:"todas",label:"Todas las horas"},{value:"actual",label:"Hora Siguiente"},{value:"7-am",label:"7:00 AM"},{value:"8-am",label:"8:00 AM"},{value:"9-am",label:"9:00 AM"},{value:"10-am",label:"10:00 AM"},{value:"11-am",label:"11:00 AM"},{value:"12-pm",label:"12:00 PM"},{value:"1-pm",label:"1:00 PM"},{value:"2-pm",label:"2:00 PM"},{value:"3-pm",label:"3:00 PM"},{value:"4-pm",label:"4:00 PM"},{value:"5-pm",label:"5:00 PM"},{value:"6-pm",label:"6:00 PM"},{value:"7-pm",label:"7:00 PM"},{value:"8-pm",label:"8:00 PM"},{value:"9-pm",label:"9:00 PM"},{value:"10-pm",label:"10:00 PM"},{value:"11-pm",label:"11:00 PM"}]),E=e=>{if(!e||typeof e!="string")return"";try{if(e.includes("-"))return e;if(e.includes(":")){const[o,i]=e.split(":"),x=parseInt(o),s=x>=12?"pm":"am";return`${x%12||12}-${s}`}const t=e.match(/(\d+):(\d+)\s*(am|pm)/i);if(t){const[,o,i,x]=t;return`${parseInt(o)%12||12}-${x.toLowerCase()}`}return""}catch(t){return console.error("Error al convertir hora notificación:",e,t),""}},m=()=>{const e=new Date,t=new Date(e.getTime()+60*60*1e3),o=new Date(t);return o.setMinutes(0,0,0),I(o)},I=e=>{if(!e)return"";try{const t=new Date(e);if(isNaN(t.getTime()))return"";const o=t.getHours(),i=t.getMinutes(),x=o>=12?"pm":"am";return`${o%12||12}-${x}`}catch(t){return console.error("Error al obtener formato de hora:",e,t),""}},k=e=>{if(!e.tiempo_inicio_horneado)return{promedio:0,ultima:"N/A",restante:"N/A"};try{const t=new Date(e.tiempo_inicio_horneado),o=new Date(e.created_at);if(isNaN(t.getTime())||isNaN(o.getTime()))return{promedio:0,ultima:"N/A",restante:"N/A"};const i=Math.max(0,t-o),x=Math.floor(i/(1e3*60));return{promedio:x,ultima:D(e.tiempo_inicio_horneado),restante:x>0?`${x} min`:"Completado"}}catch(t){return console.error("Error al calcular tiempo de reposición:",t),{promedio:0,ultima:"Error",restante:"Error"}}},q=e=>{if(!e.tiempo_inicio_horneado||!e.created_at)return"N/A";try{const t=new Date(e.created_at),o=new Date(e.tiempo_inicio_horneado);if(isNaN(t.getTime())||isNaN(o.getTime()))return"N/A";const i=o-t,x=Math.floor(i/(1e3*60));return x<0?"0 min":`${x} min`}catch(t){return console.error("Error al calcular tiempo de producción:",t),"Error"}},A=e=>{if(!e.created_at)return!1;try{const t=new Date(e.created_at),o=new Date,i=t.toDateString(),x=o.toDateString();return i===x}catch(t){return console.error("Error al verificar fecha de notificación:",t),!1}},J=()=>{try{const e=new Date,t=new Date(e.toLocaleString("en-US",{timeZone:"America/Mexico_City"}));$.value=t.toISOString().split("T")[0]}catch(e){console.error("Error al actualizar fecha inicial:",e),$.value=new Date().toISOString().split("T")[0]}},L=b(()=>{var x;const e=Z.value,t=((x=v.notificaciones)==null?void 0:x.faltantes)||[],o=new Map;t.forEach(s=>{const y=`${s.paste_id}-${s.hora_notificacion}`;o.set(y,s)});const i=e.map(s=>{const B=`${(typeof s.id=="string"?s.id:String(s.id)).split("-")[0]}-${s.hora_notificacion}`,S=o.get(B);return S?{id:S.id,paste:S.paste||s.paste,cantidad:S.cantidad||s.cantidad,hora_notificacion:S.hora_notificacion||s.hora_notificacion,dia_notificacion:S.dia_notificacion||s.dia_notificacion,estado:S.estado||"pendiente",tiempo_inicio_horneado:S.tiempo_inicio_horneado,hora_ultima_venta:S.hora_ultima_venta,cantidad_vendida:S.cantidad_vendida||0,diferencia_notificacion_inicio:S.diferencia_notificacion_inicio,created_at:S.created_at||s.created_at,cantidad_horneada:S.cantidad_horneada||0}:s});if(t.forEach(s=>{const y=`${s.paste_id}-${s.hora_notificacion}`;i.some(S=>`${(typeof S.id=="string"?S.id:String(S.id)).split("-")[0]}-${S.hora_notificacion}`===y)||i.push({id:s.id,paste:s.paste,cantidad:s.cantidad,hora_notificacion:s.hora_notificacion,dia_notificacion:s.dia_notificacion,estado:s.estado||"pendiente",tiempo_inicio_horneado:s.tiempo_inicio_horneado,hora_ultima_venta:s.hora_ultima_venta,cantidad_vendida:s.cantidad_vendida||0,diferencia_notificacion_inicio:s.diferencia_notificacion_inicio,created_at:s.created_at,cantidad_horneada:s.cantidad_horneada||0})}),f.value==="todas")return i;if(f.value==="actual"){const s=m();return s?i.filter(y=>{const B=y.hora_notificacion;return B?E(B)===s:!1}):[]}return i.filter(s=>{const y=s.hora_notificacion;return y?E(y)===f.value:!1})});b(()=>L.value.filter(e=>e.tiempo_inicio_horneado).map(e=>({paste:e.paste.nombre,...k(e)})));const p=b(()=>{var e;return(e=v.notificaciones)!=null&&e.faltantes?v.notificaciones.faltantes.map(t=>({id:t.id,paste:t.paste,cantidad:t.cantidad,hora_notificacion:t.hora_notificacion,dia_notificacion:t.dia_notificacion,estado:t.estado,tiempo_inicio_horneado:t.tiempo_inicio_horneado,hora_ultima_venta:t.hora_ultima_venta,cantidad_vendida:t.cantidad_vendida,diferencia_notificacion_inicio:t.diferencia_notificacion_inicio,created_at:t.created_at})):[]});b(()=>{var e;return(e=v.notificaciones)!=null&&e.horneados?v.notificaciones.horneados:[]});const M=b(()=>p.value.map(t=>({paste:t.paste.nombre,recomendacion:"Producir",razon:`Faltan ${t.cantidad} unidades para las ${t.hora_notificacion}`})));ne(()=>{var e;return(e=v.notificaciones)==null?void 0:e.faltantes},e=>{e&&(T.value=M.value)},{immediate:!0});const D=e=>{if(!e)return"-";try{const t=new Date(e);return isNaN(t.getTime())?"Fecha inválida":t.toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:"America/Mexico_City"})}catch(t){return console.error("Error al formatear fecha:",e,t),"Error"}},j=e=>`px-2 py-1 rounded-full text-xs font-medium ${{horneando:"bg-yellow-100 text-yellow-800 capitalize",retirado:"bg-blue-100 text-blue-800 capitalize",vendido:"bg-green-100 text-green-800 capitalize",desperdicio:"bg-red-100 text-red-800 capitalize",pendiente:"bg-gray-100 text-gray-800 capitalize",en_espera:"bg-green-100 text-green-800"}[e]}`,O=b(()=>L.value.filter(e=>e.tiempo_inicio_horneado));b(()=>L.value.filter(e=>A(e))),re(()=>{J()});const g=e=>{if(!e||typeof e!="string")return 0;try{const[t,o]=e.toLowerCase().split(" ");let[i,x]=t.split(":");return i=parseInt(i,10),i===12?i=o==="am"?0:12:o==="pm"&&(i=i+12),i}catch(t){return console.error("Error al convertir hora:",e,t),0}},u=()=>["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"][new Date().getDay()],w=b(()=>{var e;return((e=v.inventario)==null?void 0:e.filter(t=>["pastes","empanadas dulces","empanadas saladas"].includes(t.tipo)))||[]}),_=b(()=>{const e=new Map(w.value.map(o=>[o.id,o]));return(v.estimacionesHoy||[]).map(o=>{const i=e.get(o.inventario_id);if(!i)return null;const x=g(o.hora);return{id:`${i.id}-${o.hora}`,nombre:i.nombre,estimado:parseInt(o.cantidad),existente:i.cantidad,diferencia:i.cantidad-parseInt(o.cantidad),hora:o.hora,dia:o.dia,horaEnNumero:x,tipo:i.tipo}}).filter(Boolean)}),V=b(()=>_.value.filter(t=>t.dia===u())),F=b(()=>{const t=(new Date().getHours()+1)%24,o=V.value.filter(s=>(s.horaEnNumero||g(s.hora))===t),i=new Map(o.map(s=>[s.nombre,s]));return w.value.map(s=>{const y=i.get(s.nombre);return y||{id:`${s.id}-${t}:00`,nombre:s.nombre,estimado:0,existente:s.cantidad,diferencia:s.cantidad,hora:`${t}:00`,dia:u(),horaEnNumero:t,tipo:s.tipo}})}),Z=b(()=>F.value.filter(t=>{const i=t.estimado*.7;return t.estimado>0&&t.existente<i}).map(t=>({id:t.id,paste:{nombre:t.nombre,tipo:t.tipo},cantidad:Math.abs(t.diferencia),hora_notificacion:t.hora,dia_notificacion:t.dia,estado:"pendiente",created_at:new Date().toISOString(),cantidad_horneada:0,cantidad_vendida:0,hora_ultima_venta:null,diferencia_notificacion_inicio:null})));ne(()=>Z.value,e=>{e&&e.length>0&&e.forEach(async t=>{var s,y,B,S,se,ie;const o=`${t.id}`,i=t.cantidad,x=(y=(s=v.notificaciones)==null?void 0:s.faltantes)==null?void 0:y.find(W=>{const fe=typeof t.id=="string"?t.id:String(t.id),he=parseInt(fe.split("-")[0]);return W.paste_id===he&&W.hora_notificacion===t.hora_notificacion});x?x.cantidad!==i&&G.post(route("notificaciones.actualizar"),{sucursal_id:(ie=(se=v.auth)==null?void 0:se.user)==null?void 0:ie.sucursal_id,notificacion_id:o,cantidad:i},{preserveScroll:!0,onSuccess:W=>{console.log("Notificación actualizada:",W)},onError:W=>{console.error("Error al actualizar notificación:",W)}}):G.post(route("notificaciones.registrar"),{sucursal_id:(S=(B=v.auth)==null?void 0:B.user)==null?void 0:S.sucursal_id,notificacion_id:o,cantidad:i},{preserveScroll:!0,onSuccess:W=>{console.log("Notificación registrada:",W)},onError:W=>{console.error("Error al registrar notificación:",W)}})})},{deep:!0});const ee=e=>{const t=new Date;G.post(route("control-produccion.iniciar-horneado"),{control_produccion_id:e.id,tiempo_inicio_horneado:t.toISOString(),cantidad_horneada:e.cantidad},{preserveScroll:!0,onSuccess:o=>{console.log("Horneado iniciado:",o),window.location.reload()},onError:o=>{console.error("Error al iniciar horneado:",o)}})},te=e=>{const t=new Date;G.post(route("control-produccion.finalizar-horneado"),{control_produccion_id:e.id,tiempo_fin_horneado:t.toISOString()},{preserveScroll:!0,onSuccess:o=>{console.log("Horneado finalizado:",o),window.location.reload()},onError:o=>{console.error("Error al finalizar horneado:",o)}})},ae=(e,t)=>{G.post(route("control-produccion.registrar-venta"),{control_produccion_id:e.id,cantidad_vendida:t},{preserveScroll:!0,onSuccess:o=>{console.log("Venta registrada:",o),window.location.reload()},onError:o=>{console.error("Error al registrar venta:",o)}})},r=e=>{if(!e.tiempo_inicio_horneado||!e.created_at)return"No iniciado";try{const t=new Date(e.created_at),o=new Date(e.tiempo_inicio_horneado);if(isNaN(t.getTime())||isNaN(o.getTime()))return"Fecha inválida";const i=o-t,x=Math.floor(i/(1e3*60));return x<0?"0 min":`${x} min`}catch(t){return console.error("Error al calcular tiempo de horneado:",t),"Error"}},n=e=>{if(!e.hora_ultima_venta)return"Sin ventas";try{const t=new Date(e.hora_ultima_venta),o=new Date;if(isNaN(t.getTime()))return"Fecha inválida";const i=new Date(e.created_at),x=new Date(e.hora_ultima_venta);if(i.toDateString()!==x.toDateString())return"Sin ventas del día";const s=o-t,y=Math.floor(s/(1e3*60));if(y<0)return"0 min";if(y<60)return`${y} min`;{const B=Math.floor(y/60),S=y%60;return`${B}h ${S}min`}}catch(t){return console.error("Error al calcular tiempo de venta:",t),"Error"}};return(e,t)=>N.value?(l(),c("div",Ht,[a("div",kt,[t[4]||(t[4]=a("h2",{class:"text-xl font-semibold"},"Control de Producción",-1)),a("div",Mt,[a("div",Ct,[t[2]||(t[2]=a("label",{for:"fecha",class:"text-sm font-medium text-gray-700"},"Seleccionar día:",-1)),K(a("input",{type:"date",id:"fecha","onUpdate:modelValue":t[0]||(t[0]=o=>$.value=o),class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},null,512),[[ce,$.value]])]),a("div",Tt,[t[3]||(t[3]=a("label",{for:"hora",class:"text-sm font-medium text-gray-700"},"Filtrar por hora:",-1)),K(a("select",{id:"hora","onUpdate:modelValue":t[1]||(t[1]=o=>f.value=o),class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[(l(!0),c(P,null,z(h.value,o=>(l(),c("option",{key:o.value,value:o.value},d(o.label),9,Nt))),128))],512),[[de,f.value]])])])]),a("div",Ft,[t[7]||(t[7]=a("h3",{class:"text-lg font-medium mb-2"},"Productos Faltantes (Hora Siguiente) - Control de Producción",-1)),L.value.length>0?(l(),c("div",Pt,[a("table",zt,[t[5]||(t[5]=a("thead",{class:"bg-gray-50"},[a("tr",null,[a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Producto"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Faltante"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Horneada"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Vendida"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Día"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora Requerida"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo Horneado"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo Venta"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Acciones")])],-1)),a("tbody",It,[(l(!0),c(P,null,z(L.value,o=>(l(),c("tr",{key:o.id,class:"hover:bg-gray-50"},[a("td",Lt,[oe(d(o.paste.nombre)+" ",1),a("span",Vt,d(o.paste.tipo),1)]),a("td",At,d(o.cantidad)+" unidades ",1),a("td",jt,d(o.cantidad_horneada?`${o.cantidad_horneada} unidades`:"-"),1),a("td",Bt,d(o.cantidad_vendida?`${o.cantidad_vendida} unidades`:"-"),1),a("td",Ot,d(o.dia_notificacion),1),a("td",Ut,d(o.hora_notificacion),1),a("td",Rt,[a("span",{class:Q(["px-2 py-1 text-xs font-medium rounded-full",o.estado==="pendiente"?"bg-red-100 text-red-800":o.estado==="horneando"?"bg-yellow-100 text-yellow-800":o.estado==="en_espera"?"bg-blue-100 text-blue-800":o.estado==="vendido"?"bg-green-100 text-green-800":o.estado==="desperdicio"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"])},d(o.estado==="pendiente"?"Sin hornear":o.estado==="horneando"?"Horneando":o.estado==="en_espera"?"En espera":o.estado==="vendido"?"Vendido":o.estado==="desperdicio"?"Desperdicio":o.estado),3)]),a("td",qt,d(r(o)),1),a("td",Jt,d(n(o)),1),a("td",Wt,[a("div",Gt,[o.estado==="pendiente"?(l(),c("button",{key:0,onClick:i=>ee(o),class:"bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-xs"}," Iniciar Horneado ",8,Zt)):R("",!0),o.estado==="horneando"?(l(),c("button",{key:1,onClick:i=>te(o),class:"bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs"}," Finalizar Horneado ",8,Xt)):R("",!0),o.estado==="en_espera"||o.estado==="horneando"?(l(),c("button",{key:2,onClick:i=>ae(o,1),class:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs"}," +1 Venta ",8,Kt)):R("",!0)])])]))),128))])])])):(l(),c("div",Qt,t[6]||(t[6]=[a("p",{class:"text-gray-500 text-lg"},"No hay productos faltantes para la hora siguiente",-1),a("p",{class:"text-gray-400 text-sm mt-2"},"Los faltantes se calculan en tiempo real basándose en el inventario y estimaciones",-1)])))]),a("div",Yt,[t[9]||(t[9]=a("h3",{class:"text-lg font-medium mb-2"},"Control de Tiempo de Producción",-1)),a("div",ea,[a("table",ta,[t[8]||(t[8]=a("thead",{class:"bg-gray-50"},[a("tr",null,[a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Paste"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de notificación"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de Producción"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo en meter producción"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado")])],-1)),a("tbody",aa,[(l(!0),c(P,null,z(O.value,o=>(l(),c("tr",{key:o.id},[a("td",oa,d(o.paste.nombre),1),a("td",na,d(D(o.created_at)),1),a("td",ra,d(D(o.tiempo_inicio_horneado)),1),a("td",sa,d(q(o)),1),a("td",ia,[a("span",{class:Q(j(o.estado))},d(o.estado),3)])]))),128))])])])])])):R("",!0)}},da={class:"animate-pulse"},ca={key:0,class:"mt-2"},ua={class:"font-bold"},pe={__name:"NotificationPanel",props:{notifications:{type:Array,required:!0,default:()=>[]},isVisible:{type:Boolean,default:!1},type:{type:String,required:!0,validator:H=>["warning","info"].includes(H)},title:{type:String,required:!0}},emits:["toggle"],setup(H,{emit:v}){return console.log(H.notifications),(N,$)=>(l(),c("div",{class:Q(["p-4 border rounded shadow mb-4 size-fit cursor-pointer",{"bg-yellow-100":H.type==="warning","bg-blue-100":H.type==="info"}]),onClick:$[0]||($[0]=f=>N.$emit("toggle"))},[a("h2",{class:Q(["text-lg font-bold text-center",{"text-yellow-800":H.type==="warning","text-blue-800":H.type==="info"}])},[oe(d(H.type==="warning"?"⚠️":"ℹ️")+" "+d(H.title)+" ",1),a("span",da,"("+d(H.notifications.length)+")",1),oe(" "+d(H.type==="warning"?"⚠️":"ℹ️"),1)],2),H.isVisible?(l(),c("ul",ca,[(l(!0),c(P,null,z(H.notifications,f=>(l(),c("li",{key:f.id,class:"mb-2"},[a("span",null,[a("span",ua,d(f.nombre),1),oe(": "+d(H.type==="warning"?"Faltan":"Hay")+" "+d(H.type==="warning"?Math.abs(f.diferencia):f.diferencia)+" unidades para las "+d(f.hora)+" ",1),a("span",{class:Q(["text-sm",{"text-red-600":H.type==="warning","text-green-600":H.type==="info"}])}," ("+d(f.porcentaje)+"% del estimado) ",3)])]))),128))])):R("",!0)],2))}},pa={class:"container mx-auto p-4"},ma={class:"sm:flex justify-between flex-row text-sm"},fa={class:"flex gap-3 sm:flex-row flex-col"},ha={class:"mt-6"},xa={__name:"Hornear",setup(H){const v=C(!1),T=C(!1),N=C(null),$=C(null),{props:f}=Y(),h=b(()=>{var w,_;const g=(w=f.auth)==null?void 0:w.user,u=g==null?void 0:g.roles;return u&&u.length>0&&((_=u[0])==null?void 0:_.name)==="admin"}),E=b(()=>f.inventario||[]),m=b(()=>f.estimacionesHoy||[]),I=()=>{const g=new Date;return{day:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"][g.getDay()].toLowerCase(),hour:g.getHours(),minutes:g.getMinutes()}},k=C(I());ne(()=>k.value.hour,g=>{g!==N.value&&(N.value=g,M.value.length>0&&(v.value=!0),D.value.length>0&&(T.value=!0))}),re(()=>{N.value=k.value.hour,$.value=setInterval(()=>{k.value=I()},1e3)}),_e(()=>{$.value&&clearInterval($.value)});const q=g=>{const[u,w]=g.toLowerCase().split(" ");let[_,V]=u.split(":").map(Number);return{hours:w==="pm"&&_!==12?_+12:w==="am"&&_===12?0:_,minutes:V}},A=b(()=>E.value.filter(g=>{var u;return["pastes","empanadas dulces","empanadas saladas"].includes((u=g.tipo)==null?void 0:u.toLowerCase())})),J=b(()=>{if(!m.value.length||!A.value.length)return console.log("No hay estimaciones o productos relevantes"),[];const g=new Map(A.value.map(w=>[w.id,w]));return m.value.map(w=>{const _=g.get(w.inventario_id);if(!_)return null;const{hours:V}=q(w.hora);return{id:`${_.id}-${w.hora}`,nombre:_.nombre,estimado:w.cantidad,existente:_.cantidad,diferencia:_.cantidad-w.cantidad,hora:w.hora,dia:w.dia.toLowerCase(),horaEnNumero:V,tipo:_.tipo}}).filter(Boolean).filter((w,_,V)=>_===V.findIndex(F=>F.id===w.id))}),L=b(()=>J.value.filter(u=>u.dia===k.value.day)),p=b(()=>{const u=(k.value.hour+1)%24,w=L.value.filter(F=>F.horaEnNumero===u),_=new Map(w.map(F=>[F.nombre,F]));return A.value.map(F=>{const Z=_.get(F.nombre);return Z||{id:`${F.id}-${u}:00`,nombre:F.nombre,estimado:0,existente:F.cantidad,diferencia:F.cantidad,hora:`${u}:00`,dia:k.value.day,horaEnNumero:u,tipo:F.tipo}})}),M=b(()=>p.value.filter(u=>{const _=u.estimado*.7;return u.estimado>0&&u.existente<_}).map(u=>({...u,porcentaje:u.estimado>0?Math.round(u.existente/u.estimado*100):0}))),D=b(()=>p.value.filter(u=>u.estimado>0&&u.diferencia>0||u.estimado===0&&u.existente>0).map(u=>({...u,porcentaje:u.estimado>0?Math.round(u.existente/u.estimado*100):100}))),j=()=>v.value=!v.value,O=()=>T.value=!T.value;return(g,u)=>{var w,_,V;return l(),c("div",pa,[a("div",ma,[u[0]||(u[0]=a("h1",{class:"text-2xl font-bold mb-4"},"Sistema de Horneado",-1)),a("div",fa,[X(pe,{notifications:M.value,"is-visible":v.value,type:"warning",title:"Faltantes",onToggle:j},null,8,["notifications","is-visible"]),X(pe,{notifications:D.value,"is-visible":T.value,type:"info",title:"Excedentes",onToggle:O},null,8,["notifications","is-visible"])])]),a("div",ha,[X(St),X(la),((V=(_=(w=me(f).auth)==null?void 0:w.user)==null?void 0:_.roles)==null?void 0:V[0])!=="supervisor"?(l(),le(Ve,{key:0})):R("",!0),h.value?(l(),le(Qe,{key:1})):R("",!0)])])}}},va={class:"py-6"},ga={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 rounded-xl overflow-hidden"},_a={class:"flex justify-between p-6 lg:p-8 bg-white border-b border-gray-200 rounded-2xl"},Da={__name:"index",setup(H){return(v,T)=>(l(),le(xe,{title:"Tablero principal"},{default:ye(()=>[a("div",va,[a("div",ga,[a("div",_a,[X(xa)])])])]),_:1}))}};export{Da as default};
