import{S as R,_ as fe}from"./AppLayout-C81WOEQ8.js";import{Q as te,d as N,p as y,o as l,e as d,a as o,F as P,h as I,t as i,f as J,x as re,i as ne,j as X,l as de,v as ce,z as G,k as he,b as Z,u as me,B as ve,y as ue,g as oe,n as ee,C as ge,c as le,w as xe}from"./app-BXBVsqPB.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as ye}from"./createLucideIcon-CD5Gxncp.js";/**
 * @license lucide-vue-next v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=ye("Trash2Icon",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),we={class:"bg-white rounded-lg shadow-md overflow-hidden"},$e={class:"overflow-x-auto"},De={class:"min-w-full divide-y divide-gray-200"},Se={class:"bg-white divide-y divide-gray-200"},Ee={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Me={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},He={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ke={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ne={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Te={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ce={key:0},Fe={class:"bg-gray-50"},Pe={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Ie={__name:"PastesHorneados",setup(M){const{props:v}=te();N(v.pastesHorneados);const T=y(()=>{const h={};v.pastesHorneados.forEach(m=>{h[m.relleno]||(h[m.relleno]={totalPiezas:0,items:[]}),h[m.relleno].totalPiezas+=Number(m.piezas),h[m.relleno].items.push(m)});const $=[];return Object.keys(h).forEach(m=>{h[m].items.forEach((z,H)=>{$.push({...z,totalPiezas:h[m].totalPiezas,isFirst:H===0})})}),$}),C=y(()=>T.value.reduce((h,$)=>Number(h)+($.isFirst?Number($.totalPiezas):0),0)),w=h=>new Date(h).toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"America/Mexico_City"}),f=h=>new Date(h).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",timeZone:"America/Mexico_City"});return(h,$)=>(l(),d("div",null,[$[3]||($[3]=o("h1",{class:"pb-4 pt-10 font-semibold text-xl"},"Pastes/Empanadas horneados de hoy",-1)),o("div",we,[o("div",$e,[o("table",De,[$[2]||($[2]=o("thead",{class:"bg-gray-50"},[o("tr",null,[o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Responsable"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Paste/Empanada"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Hora"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Día"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Piezas Horneadas"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Total del día")])],-1)),o("tbody",Se,[(l(!0),d(P,null,I(T.value,(m,z)=>{var H,U,A;return l(),d("tr",{key:z},[o("td",Ee,i((H=m==null?void 0:m.responsable)==null?void 0:H.name)+" "+i(((U=m==null?void 0:m.responsable)==null?void 0:U.apellido_p)||"")+" "+i(((A=m==null?void 0:m.responsable)==null?void 0:A.apellido_m)||""),1),o("td",Me,i(m.relleno),1),o("td",He,i(w(m.updated_at)),1),o("td",ke,i(f(m.updated_at)),1),o("td",Ne,i(m.piezas),1),o("td",Te,[m.isFirst?(l(),d("span",Ce,i(m.totalPiezas),1)):J("",!0)])])}),128))]),o("tfoot",Fe,[o("tr",null,[$[0]||($[0]=o("td",{colspan:"3",class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},"Total de piezas horneadas:",-1)),o("td",Pe,i(C.value),1),$[1]||($[1]=o("td",null,null,-1))])])])])])]))}},ze=_e(Ie,[["__scopeId","data-v-1a02fb88"]]),Le={class:"pt-16"},Ve={class:"max-w-7xl mx-auto space-y-6"},Ae={class:"bg-white rounded-lg shadow p-6"},je={class:"text-2xl font-bold text-gray-900"},Be={class:"mt-4"},Oe=["value"],Re={key:0,class:"bg-white rounded-lg shadow overflow-x-auto"},Ue={class:"min-w-full divide-y divide-gray-200"},qe={class:"bg-gray-50"},Je={class:"bg-white divide-y divide-gray-200"},We={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ze=["onUpdate:modelValue"],Ge={key:1,class:"w-full flex justify-end"},Xe={__name:"EstimacionPastes",setup(M){const{props:v}=te(),T=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"],C=new Date().getDay(),w=T[C],f=N(w||"Lunes"),h=N(!1),$=[{value:"Lunes",label:"Lunes"},{value:"Martes",label:"Martes"},{value:"Miercoles",label:"Miércoles"},{value:"Jueves",label:"Jueves"},{value:"Viernes",label:"Viernes"},{value:"Sábado",label:"Sábado"},{value:"Domingo",label:"Domingo"}],m=["7:00 am","8:00 am","9:00 am","10:00 am","11:00 am","12:00 pm","1:00 pm","2:00 pm","3:00 pm","4:00 pm","5:00 pm","6:00 pm","7:00 pm","8:00 pm","9:00 pm"],z=y(()=>v.inventario.filter(p=>["pastes","empanadas dulces","empanadas saladas"].includes(p.tipo)).map(p=>p.nombre)),H=N({}),U=R.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:p=>{p.onmouseenter=R.stopTimer,p.onmouseleave=R.resumeTimer}}),A=()=>{const p={};return m.forEach(k=>{p[k]={},z.value.forEach(D=>{p[k][D]=0})}),p},L=()=>{h.value=!1,H.value=A(),v.estimaciones.filter(k=>k.dia===f.value).forEach(({hora:k,cantidad:D,inventario_id:j})=>{var g;const B=(g=v.inventario.find(c=>c.id===j))==null?void 0:g.nombre;B&&H.value[k]&&(H.value[k][B]=D)}),h.value=!0},q=()=>{G.post("/estimaciones",{estimaciones:H.value,dia:f.value},{preserveState:!1,preserveScroll:!0,onSuccess:()=>U.fire({icon:"success",title:"Estimaciones guardados exitosamente"}),onError:()=>U.fire({icon:"error",title:"Error al guardar las estimaciones"})})};return re(()=>{L()}),ne(f,()=>{L()}),(p,k)=>(l(),d("div",Le,[o("div",Ve,[o("header",Ae,[o("h1",je,"Sistema de Control de Producción - Día: "+i(f.value),1),o("div",Be,[X(o("select",{"onUpdate:modelValue":k[0]||(k[0]=D=>f.value=D),class:"rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500"},[(l(),d(P,null,I($,D=>o("option",{key:D.value,value:D.value},i(D.label),9,Oe)),64))],512),[[de,f.value]])])]),h.value?(l(),d("div",Re,[o("table",Ue,[o("thead",qe,[o("tr",null,[k[1]||(k[1]=o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo",-1)),(l(!0),d(P,null,I(z.value,D=>(l(),d("th",{key:D,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},i(D),1))),128))])]),o("tbody",Je,[(l(),d(P,null,I(m,D=>o("tr",{key:D},[o("td",We,i(D),1),(l(!0),d(P,null,I(z.value,j=>(l(),d("td",{key:j,class:"px-6 py-4 whitespace-nowrap"},[X(o("input",{type:"number","onUpdate:modelValue":B=>H.value[D][j]=B,class:"w-20 rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500",min:"0"},null,8,Ze),[[ce,H.value[D][j]]])]))),128))])),64))])])])):J("",!0),p.$page.props.auth.user.roles[0].name=="admin"?(l(),d("div",Ge,[o("button",{onClick:q,class:"px-3 py-2 bg-orange-500 rounded-lg text-white hover:bg-orange-400"}," Guardar ")])):J("",!0)])]))}},Ke={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Qe={class:"bg-white shadow rounded-lg p-6"},Ye={class:"mb-6"},et={class:"list-disc pl-5"},tt={class:"capitalize"},at={class:"font-semibold"},ot={class:"list-disc pl-5"},nt={class:"font-semibold"},rt={class:"bg-white shadow rounded-lg p-6"},st=["value"],it=["max"],lt=["disabled"],dt={key:0,class:"text-sm text-red-600 mt-2"},ct={key:0},ut={key:1},pt={class:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-4"},mt={class:"flex justify-between"},ft={class:"text-xl font-semibold mb-4"},ht=["onClick"],vt={key:0},gt={class:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 mb-4"},xt={key:1},_t=["disabled"],yt={class:"mt-8 bg-white shadow rounded-lg p-6"},bt={key:0,class:"text-gray-500 text-center py-4"},wt={key:1,class:"divide-y divide-gray-200"},$t=["onClick"],Dt={__name:"SistemaHorneado",setup(M){var K,Q;const{props:v}=te(),T=v.inventario||[],C=N(v.hornos||[]),w=N(C.value.map(t=>({...t,horneando:t.estado||!1,pastesHorneando:t.pastesHorneando||[],tiempoInicio:t.tiempo_inicio?new Date(t.tiempo_inicio).getTime():0,tiempoFin:t.tiempo_fin?new Date(t.tiempo_fin).getTime():0,tiempoTranscurrido:0,timer:null,labeltime:"00:00"}))),f=N(9e5),h=N([]),$=()=>{if(h.value.length===0)return;const t=w.value.find(e=>!e.horneando);if(t){t.horneando=!0,t.pastesHorneando=[...h.value],h.value=[],t.tiempoInicio=Date.now(),t.tiempoFin=t.tiempoInicio+f.value;try{ue.post("/iniciar-horneado",{horno_id:t.id,tiempo_inicio:t.tiempoInicio,tiempo_fin:t.tiempoFin,pastes_horneando:t.pastesHorneando,estado:!0}).then(e=>{console.log(e)}).catch(e=>{console.error("Error al iniciar el horneado:",e)}),R.fire({icon:"success",title:"Horneando",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500}),V(t.id)}catch(e){console.error("Error al iniciar el horneado:",e),R.fire({icon:"error",title:"Error al iniciar",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}}else W()},m=R.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:t=>{t.addEventListener("mouseenter",R.stopTimer),t.addEventListener("mouseleave",R.resumeTimer)}}),z=async t=>{const e=w.value.find(a=>a.id===t);if(!(!e||!e.horneando))try{clearInterval(e.timer);const a=[...e.pastesHorneando];e.horneando=!1,e.pastesHorneando=[],e.tiempoTranscurrido=0,e.labeltime="00:00",H();for(const n of a){const s=T.find(u=>u.nombre.toLowerCase()===n.nombre.toLowerCase()&&(u.tipo==="pastes"||u.tipo==="empanadas saladas"||u.tipo==="empanadas dulces"));if(s)try{await ue.post("/api/control-produccion/horneado",{horno_id:t,paste_id:s.id,cantidad:n.cantidad})}catch(u){console.error(`Horno ${t} - Error al registrar producción para ${n.nombre}:`,u)}else console.error(`Horno ${t} - No se encontró el paste ${n.nombre} en el inventario`)}G.post("/hornear",{horno_id:t,pastes:a},{preserveScroll:!0,preserveState:!1,replace:!0,onSuccess:()=>{m.fire({icon:"success",title:"Horneado finalizado"})},onError:n=>{console.error(`Horno ${t} - Error al registrar el horneado:`,n),m.fire({icon:"error",title:"Error al registrar el horneado"})}})}catch(a){console.error(`Horno ${t} - Error en finalizarHorneado:`,a)}},H=()=>{new Audio("/sound/videoplayback.mp3").play().catch(e=>console.error("Error al reproducir el sonido:",e))},U=y(()=>T.filter(t=>t.tipo==="masa")),A=y(()=>T.filter(t=>t.tipo==="relleno")),L=y(()=>U.value.map(t=>{const e=w.value.filter(a=>a.horneando&&a.pastesHorneando.some(n=>n.masa===t.nombre)).reduce((a,n)=>a+n.pastesHorneando.find(s=>s.masa===t.nombre).cantidad,0);return{...t,cantidad:Math.max(0,t.cantidad-e)}})),q=y(()=>A.value.map(t=>{const e=w.value.filter(a=>a.horneando&&a.pastesHorneando.some(n=>n.nombre===t.nombre)).reduce((a,n)=>a+n.pastesHorneando.find(s=>s.nombre===t.nombre).cantidad,0);return{...t,cantidad:Math.max(0,t.cantidad-e)}})),p=N({masa:"",relleno:"",cantidad:1,sucursal_id:(Q=(K=v.auth)==null?void 0:K.user)==null?void 0:Q.sucursal_id}),k=t=>{const e={pastes:"bola","empanadas saladas":"salada","empanadas dulces":"dulce"},a=T.find(n=>(n.nombre.toLowerCase()===t.value.relleno.toLowerCase()||n.nombre.toLowerCase().startsWith(t.value.relleno.toLowerCase()))&&e[n.tipo.toLowerCase()]);return a?e[a.tipo.toLowerCase()]:"bola"},D=()=>{var s,u,r,S;const t=k(p).toLowerCase(),e=L.value.find(E=>E.nombre.toLowerCase()===t),a=q.value.find(E=>E.nombre.toLowerCase()===p.value.relleno.toLowerCase());if(!e||e.cantidad<=0){m.fire({icon:"error",title:"No hay suficiente masa disponible"});return}if(!a||a.cantidad<=0){m.fire({icon:"error",title:"No hay suficiente relleno disponible"});return}const n=Math.min(e.cantidad,a.cantidad);if(p.value.cantidad>n){m.fire({icon:"error",title:`Solo hay ${n} unidades disponibles (${e.cantidad} masa, ${a.cantidad} relleno)`});return}if(e&&a&&p.value.cantidad<=n){e.cantidad-=p.value.cantidad,a.cantidad-=p.value.cantidad;const E=h.value.find(_=>_.nombre===a.nombre);E?E.cantidad+=p.value.cantidad:c({id:Date.now(),masa:e.nombre,nombre:a.nombre,cantidad:p.value.cantidad,sucursal_id:(u=(s=v.auth)==null?void 0:s.user)==null?void 0:u.sucursal_id}),p.value={masa:"",relleno:"",cantidad:1,sucursal_id:(S=(r=v.auth)==null?void 0:r.user)==null?void 0:S.sucursal_id}}},j=y(()=>{const t=k(p).toLowerCase(),e=L.value.find(n=>n.nombre.toLowerCase()===t),a=q.value.find(n=>n.nombre===p.value.relleno);return!e||!a?0:Math.min(e.cantidad,a.cantidad)}),B=y(()=>{const t=k(p).toLowerCase(),e=L.value.find(s=>s.nombre.toLowerCase()===t),a=q.value.find(s=>s.nombre===p.value.relleno);if(!e||!a)return!1;const n=Math.min(e.cantidad,a.cantidad);return p.value.relleno&&p.value.cantidad>0&&p.value.cantidad<=n&&n>0});N("00:00");const g=t=>{if(t<=0)return"00:00";const e=Math.floor(t/1e3),a=Math.floor(e/60),n=e%60;return`${String(a).padStart(2,"0")}:${String(n).padStart(2,"0")}`},c=t=>{const e=T.find(a=>a.nombre.toLowerCase()===t.nombre.toLowerCase()&&(a.tipo==="pastes"||a.tipo==="empanadas saladas"||a.tipo==="empanadas dulces"));e?h.value.push({...t,paste_id:e.id}):console.error(`No se encontró el paste ${t.nombre} en el inventario`)},b=t=>{h.value=h.value.filter(e=>e.id!==t)},x=t=>{z(t).catch(e=>{console.error(`Error al finalizar horneado desde timer: ${e}`)})},V=t=>{const e=w.value.find(s=>s.id===t);if(!e)return;const n=e.tiempoFin-Date.now();if(n<=0){x(t);return}e.tiempoTranscurrido=f.value-n,e.labeltime=g(n),e.timer&&clearInterval(e.timer),e.timer=setInterval(()=>{const s=e.tiempoFin-Date.now();if(s<=0){clearInterval(e.timer),x(t);return}e.tiempoTranscurrido=f.value-s,e.labeltime=g(s)},1e3)},F=t=>{const e=w.value.find(s=>s.id===t);if(!e)return;const n=e.tiempoFin-Date.now();if(n<=0){x(t);return}e.tiempoTranscurrido=f.value-n,e.labeltime=g(n),e.timer&&clearInterval(e.timer),e.timer=setInterval(()=>{const s=e.tiempoFin-Date.now();if(s<=0){clearInterval(e.timer),x(t);return}e.tiempoTranscurrido=f.value-s,e.labeltime=g(s)},1e3)};re(()=>{w.value.forEach(t=>{t.timer&&clearInterval(t.timer)}),w.value.forEach(t=>{if(t.estado){const e=Date.now()-new Date(t.tiempo_inicio).getTime(),a=f.value-e;if(a<=0){x(t.id);return}t.tiempoFin=Date.now()+a,F(t.id)}})});const W=()=>{G.post("/crear-horno",{estado:!1,pastesHorneando:[]},{preserverScroll:!0,preserveState:!1,onSuccess:t=>{var e;C.value=(e=t==null?void 0:t.props)==null?void 0:e.hornos,h.value=[],w.value=C.value.map(a=>({...a,horneando:a.estado||!1,pastesHorneando:a.pastesHorneando||[],tiempoInicio:a.tiempo_inicio?new Date(a.tiempo_inicio).getTime():0,tiempoFin:a.tiempo_fin?new Date(a.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),R.fire({icon:"success",title:"Horno creado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:t=>{console.error("Error al crear el horno:",t),R.fire({icon:"error",title:"Error al crear horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})},ae=t=>{G.post("/eliminar-horno",{horno_id:t},{preserveScroll:!0,preserveState:!1,onSuccess:e=>{var a;C.value=(a=e==null?void 0:e.props)==null?void 0:a.hornos,w.value=C.value.map(n=>({...n,horneando:n.estado||!1,pastesHorneando:n.pastesHorneando||[],tiempoInicio:n.tiempo_inicio?new Date(n.tiempo_inicio).getTime():0,tiempoFin:n.tiempo_fin?new Date(n.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),R.fire({icon:"success",title:"Horno eliminado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:e=>{console.error("Error al eliminar el horno:",e),R.fire({icon:"error",title:"Error al eliminar horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})};return(t,e)=>(l(),d(P,null,[o("div",Ke,[o("div",Qe,[e[4]||(e[4]=o("h2",{class:"text-xl font-semibold mb-4"},"Ingredientes Disponibles",-1)),o("div",Ye,[e[2]||(e[2]=o("h3",{class:"text-lg font-medium mb-2"},"Masas",-1)),o("ul",et,[(l(!0),d(P,null,I(L.value,a=>(l(),d("li",{key:a.id,class:"flex justify-between"},[o("span",tt,i(a.nombre),1),o("span",at,i(a.cantidad)+" unidades",1)]))),128))])]),o("div",null,[e[3]||(e[3]=o("h3",{class:"text-lg font-medium mb-2"},"Rellenos",-1)),o("ul",ot,[(l(!0),d(P,null,I(q.value,a=>(l(),d("li",{key:a.id,class:"flex justify-between"},[o("span",null,i(a.nombre),1),o("span",nt,i(a.cantidad)+" unidades",1)]))),128))])])]),o("div",rt,[e[8]||(e[8]=o("h2",{class:"text-xl font-semibold mb-4"},"Crear Nuevo Paste/Empanada",-1)),o("form",{onSubmit:he(D,["prevent"]),class:"space-y-4"},[o("div",null,[e[6]||(e[6]=o("label",{for:"relleno",class:"block text-sm font-medium text-gray-700"},"Seleccionar Relleno",-1)),X(o("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>p.value.relleno=a),id:"relleno",required:"",class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md"},[e[5]||(e[5]=o("option",{value:""},"Seleccione un relleno",-1)),(l(!0),d(P,null,I(A.value,a=>(l(),d("option",{key:a.id,value:a.nombre},i(a.nombre),9,st))),128))],512),[[de,p.value.relleno]])]),o("div",null,[e[7]||(e[7]=o("label",{for:"cantidad",class:"block text-sm font-medium text-gray-700"},"Cantidad",-1)),X(o("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>p.value.cantidad=a),type:"number",id:"cantidad",required:"",min:"1",max:j.value,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 sm:text-sm"},null,8,it),[[ce,p.value.cantidad,void 0,{number:!0}]])]),o("button",{type:"submit",disabled:!B.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed"},i(B.value?"Asignar Unidades":"Sin ingredientes suficientes"),9,lt),p.value.relleno&&!B.value?(l(),d("div",dt,[j.value===0?(l(),d("span",ct,"No hay ingredientes disponibles")):(l(),d("span",ut,"Máximo disponible: "+i(j.value)+" unidades",1))])):J("",!0)],32)])]),o("div",pt,[(l(!0),d(P,null,I(w.value,(a,n)=>(l(),d("div",{key:a.id,class:"bg-white shadow rounded-lg p-6"},[o("div",mt,[o("h2",ft,"Horno "+i(n+1),1),!a.horneando&&C.value.length>1?(l(),d("button",{key:0,onClick:s=>ae(a.id),class:"flex items-center gap-2 bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"},[Z(me(be),{class:"w-4 h-4"})],8,ht)):J("",!0)]),a.horneando?(l(),d("div",vt,[e[9]||(e[9]=o("p",{class:"text-lg mb-2"},"Horneando grupo de pastes:",-1)),o("ul",null,[(l(!0),d(P,null,I(a.pastesHorneando,s=>(l(),d("li",{key:s.nombre},i(s.cantidad)+" "+i(s.nombre)+" - masa "+i(s.masa),1))),128))]),o("div",gt,[o("div",{class:"bg-orange-600 h-2.5 rounded-full transition-all duration-100",style:ve({width:`${a.tiempoTranscurrido/f.value*100}%`})},null,4)]),o("p",null,"Tiempo restante: "+i(a.labeltime),1)])):(l(),d("div",xt,[e[10]||(e[10]=o("p",{class:"text-lg mb-4"},"El horno está disponible",-1)),o("button",{onClick:$,disabled:!h.value.length,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Iniciar Horneado de Grupo ",8,_t)]))]))),128)),o("div",{class:"mt-4 h-full flex justify-center items-center"},[o("button",{onClick:W,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500"}," Crear Nuevo Horno ")])]),o("div",yt,[e[11]||(e[11]=o("h2",{class:"text-xl font-semibold mb-4"},"Grupos de Pastes por Hornear",-1)),h.value.length===0?(l(),d("div",bt," No hay grupos de pastes en la cola de horneado ")):(l(),d("ul",wt,[(l(!0),d(P,null,I(h.value,a=>(l(),d("li",{key:a.id,class:"py-4 flex justify-between items-center"},[o("span",null,i(a.cantidad)+" "+i(a.nombre)+" - masa "+i(a.masa),1),o("button",{onClick:n=>b(a.id),class:"bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"}," Cancelar ",8,$t)]))),128))]))])],64))}},St={key:0,class:"mt-8 bg-white shadow rounded-lg p-6"},Et={class:"flex justify-between items-center mb-4"},Mt={class:"flex items-center space-x-4"},Ht={class:"flex items-center space-x-2"},kt={class:"flex items-center space-x-2"},Nt=["value"],Tt={class:"mb-6"},Ct={key:0,class:"overflow-x-auto"},Ft={class:"min-w-full divide-y divide-gray-200"},Pt={class:"bg-white divide-y divide-gray-200"},It={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 capitalize"},zt={class:"text-xs text-gray-500 block capitalize"},Lt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Vt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},At={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},jt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize"},Bt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ot={class:"px-6 py-4 whitespace-nowrap"},Rt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ut={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},qt={key:1,class:"text-center py-8"},Jt={class:"mt-8"},Wt={class:"overflow-x-auto"},Zt={class:"min-w-full divide-y divide-gray-200"},Gt={class:"bg-white divide-y divide-gray-200"},Xt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Kt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Qt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Yt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ea={class:"px-6 py-4 whitespace-nowrap capitalize"},ta={__name:"ControlProduccion",setup(M){const{props:v}=te();console.log(v),N([]);const T=N([]);N([]);const C=y(()=>{var a,n;const t=(a=v.auth)==null?void 0:a.user,e=t==null?void 0:t.roles;return e&&e.length>0&&((n=e[0])==null?void 0:n.name)==="admin"}),w=N(new Date().toISOString().split("T")[0]),f=N("actual"),h=N([{value:"todas",label:"Todas las horas"},{value:"actual",label:"Hora Siguiente"},{value:"7-am",label:"7:00 AM"},{value:"8-am",label:"8:00 AM"},{value:"9-am",label:"9:00 AM"},{value:"10-am",label:"10:00 AM"},{value:"11-am",label:"11:00 AM"},{value:"12-pm",label:"12:00 PM"},{value:"1-pm",label:"1:00 PM"},{value:"2-pm",label:"2:00 PM"},{value:"3-pm",label:"3:00 PM"},{value:"4-pm",label:"4:00 PM"},{value:"5-pm",label:"5:00 PM"},{value:"6-pm",label:"6:00 PM"},{value:"7-pm",label:"7:00 PM"},{value:"8-pm",label:"8:00 PM"},{value:"9-pm",label:"9:00 PM"},{value:"10-pm",label:"10:00 PM"},{value:"11-pm",label:"11:00 PM"}]),$=t=>{if(!t||typeof t!="string")return"";try{if(t.includes("-"))return t;if(t.includes(":")){const[a,n]=t.split(":"),s=parseInt(a),u=s>=12?"pm":"am";return`${s%12||12}-${u}`}const e=t.match(/(\d+):(\d+)\s*(am|pm)/i);if(e){const[,a,n,s]=e;return`${parseInt(a)%12||12}-${s.toLowerCase()}`}return""}catch(e){return console.error("Error al convertir hora notificación:",t,e),""}},m=()=>{const t=new Date,e=new Date(t.getTime()+60*60*1e3),a=new Date(e);return a.setMinutes(0,0,0),z(a)},z=t=>{if(!t)return"";try{const e=new Date(t);if(isNaN(e.getTime()))return"";const a=e.getHours(),n=e.getMinutes(),s=a>=12?"pm":"am";return`${a%12||12}-${s}`}catch(e){return console.error("Error al obtener formato de hora:",t,e),""}},H=t=>{if(!t.tiempo_inicio_horneado)return{promedio:0,ultima:"N/A",restante:"N/A"};try{const e=new Date(t.tiempo_inicio_horneado),a=new Date(t.created_at);if(isNaN(e.getTime())||isNaN(a.getTime()))return{promedio:0,ultima:"N/A",restante:"N/A"};const n=Math.max(0,e-a),s=Math.floor(n/(1e3*60));return{promedio:s,ultima:k(t.tiempo_inicio_horneado),restante:s>0?`${s} min`:"Completado"}}catch(e){return console.error("Error al calcular tiempo de reposición:",e),{promedio:0,ultima:"Error",restante:"Error"}}},U=t=>{if(!t.tiempo_inicio_horneado||!t.created_at)return"N/A";try{const e=new Date(t.created_at),a=new Date(t.tiempo_inicio_horneado);if(isNaN(e.getTime())||isNaN(a.getTime()))return"N/A";const n=e.toDateString(),s=a.toDateString();if(n!==s)return"Diferente día";const u=a-e,r=Math.floor(u/(1e3*60));if(r<0)return"Error: Producción antes de notificación";if(r>1440)return"Error de cálculo";if(r<60)return`${r} min`;{const S=Math.floor(r/60),E=r%60;return`${S}:${E.toString().padStart(2,"0")} hrs`}}catch(e){return console.error("Error al calcular tiempo de producción:",e),"Error"}},A=()=>{try{const t=new Date,e=new Date(t.toLocaleString("en-US",{timeZone:"America/Mexico_City"}));w.value=e.toISOString().split("T")[0]}catch(t){console.error("Error al actualizar fecha inicial:",t),w.value=new Date().toISOString().split("T")[0]}},L=y(()=>{var u;const t=F.value,e=((u=v.notificaciones)==null?void 0:u.faltantes)||[];if(e.length>0){const r=e[0];console.log("Debug campos disponibles:",{campos:Object.keys(r),tiene_updated_at:"updated_at"in r,updated_at_valor:r.updated_at,tiene_hora_ultima_venta:"hora_ultima_venta"in r,hora_ultima_venta_valor:r.hora_ultima_venta})}const a=new Map;e.forEach(r=>{const S=`${r.paste_id}-${r.hora_notificacion}`;a.set(S,r)});const n=t.map(r=>{const E=`${(typeof r.id=="string"?r.id:String(r.id)).split("-")[0]}-${r.hora_notificacion}`,_=a.get(E);return _?{id:_.id,paste:_.paste||r.paste,cantidad:_.cantidad||r.cantidad,hora_notificacion:_.hora_notificacion||r.hora_notificacion,dia_notificacion:_.dia_notificacion||r.dia_notificacion,estado:_.estado||"pendiente",tiempo_inicio_horneado:_.tiempo_inicio_horneado,hora_ultima_venta:_.hora_ultima_venta,cantidad_vendida:_.cantidad_vendida||0,created_at:_.created_at||r.created_at,cantidad_horneada:_.cantidad_horneada||0,updated_at:_.updated_at}:r});e.forEach(r=>{const S=`${r.paste_id}-${r.hora_notificacion}`;n.some(_=>`${(typeof _.id=="string"?_.id:String(_.id)).split("-")[0]}-${_.hora_notificacion}`===S)||n.push({id:r.id,paste:r.paste,cantidad:r.cantidad,hora_notificacion:r.hora_notificacion,dia_notificacion:r.dia_notificacion,estado:r.estado||"pendiente",tiempo_inicio_horneado:r.tiempo_inicio_horneado,hora_ultima_venta:r.hora_ultima_venta,cantidad_vendida:r.cantidad_vendida||0,created_at:r.created_at,cantidad_horneada:r.cantidad_horneada||0})});let s;if(f.value==="todas")s=n;else if(f.value==="actual"){const r=m();if(!r)return[];s=n.filter(S=>{const E=S.hora_notificacion;return E?$(E)===r:!1})}else s=n.filter(r=>{const S=r.hora_notificacion;return S?$(S)===f.value:!1});return s.filter(r=>r.tiempo_inicio_horneado?K(r):!0)});y(()=>L.value.filter(t=>t.tiempo_inicio_horneado).map(t=>({paste:t.paste.nombre,...H(t)})));const q=y(()=>{var t;return(t=v.notificaciones)!=null&&t.faltantes?v.notificaciones.faltantes.map(e=>({id:e.id,paste:e.paste,cantidad:e.cantidad,hora_notificacion:e.hora_notificacion,dia_notificacion:e.dia_notificacion,estado:e.estado,tiempo_inicio_horneado:e.tiempo_inicio_horneado,hora_ultima_venta:e.hora_ultima_venta,cantidad_vendida:e.cantidad_vendida,created_at:e.created_at})):[]});y(()=>{var t;return(t=v.notificaciones)!=null&&t.horneados?v.notificaciones.horneados:[]});const p=y(()=>q.value.map(e=>({paste:e.paste.nombre,recomendacion:"Producir",razon:`Faltan ${e.cantidad} unidades para las ${e.hora_notificacion}`})));ne(()=>{var t;return(t=v.notificaciones)==null?void 0:t.faltantes},t=>{t&&(T.value=p.value)},{immediate:!0});const k=t=>{if(!t)return"-";try{const e=new Date(t);return isNaN(e.getTime())?"Fecha inválida":e.toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0,timeZone:"America/Mexico_City"})}catch(e){return console.error("Error al formatear fecha:",t,e),"Error"}},D=t=>`px-2 py-1 rounded-full text-xs font-medium ${{horneando:"bg-yellow-100 text-yellow-800 capitalize",retirado:"bg-blue-100 text-blue-800 capitalize",vendido:"bg-green-100 text-green-800 capitalize",desperdicio:"bg-red-100 text-red-800 capitalize",pendiente:"bg-gray-100 text-gray-800 capitalize",en_espera:"bg-green-100 text-green-800"}[t]}`,j=y(()=>L.value.filter(t=>{if(!t.tiempo_inicio_horneado||!t.created_at)return!1;try{const e=new Date(t.created_at),a=new Date(t.tiempo_inicio_horneado);if(isNaN(e.getTime())||isNaN(a.getTime()))return!1;const n=e.toDateString(),s=a.toDateString();if(n!==s)return!1;const u=a-e,r=Math.floor(u/(1e3*60));return r>=0&&r<=1440}catch(e){return console.error("Error al validar notificación:",e),!1}}));re(()=>{A()});const B=t=>{if(!t||typeof t!="string")return 0;try{const[e,a]=t.toLowerCase().split(" ");let[n,s]=e.split(":");return n=parseInt(n,10),n===12?n=a==="am"?0:12:a==="pm"&&(n=n+12),n}catch(e){return console.error("Error al convertir hora:",t,e),0}},g=()=>["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"][new Date().getDay()],c=y(()=>{var t;return((t=v.inventario)==null?void 0:t.filter(e=>["pastes","empanadas dulces","empanadas saladas"].includes(e.tipo)))||[]}),b=y(()=>{const t=new Map(c.value.map(a=>[a.id,a]));return(v.estimacionesHoy||[]).map(a=>{const n=t.get(a.inventario_id);if(!n)return null;const s=B(a.hora);return{id:`${n.id}-${a.hora}`,nombre:n.nombre,estimado:parseInt(a.cantidad),existente:n.cantidad,diferencia:n.cantidad-parseInt(a.cantidad),hora:a.hora,dia:a.dia,horaEnNumero:s,tipo:n.tipo}}).filter(Boolean)}),x=y(()=>b.value.filter(e=>e.dia===g())),V=y(()=>{const e=(new Date().getHours()+1)%24,a=x.value.filter(u=>(u.horaEnNumero||B(u.hora))===e),n=new Map(a.map(u=>[u.nombre,u]));return c.value.map(u=>{const r=n.get(u.nombre);return r||{id:`${u.id}-${e}:00`,nombre:u.nombre,estimado:0,existente:u.cantidad,diferencia:u.cantidad,hora:`${e}:00`,dia:g(),horaEnNumero:e,tipo:u.tipo}})}),F=y(()=>V.value.filter(e=>{const n=e.estimado*.7;return e.estimado>0&&e.existente<n}).map(e=>({id:e.id,paste:{nombre:e.nombre,tipo:e.tipo},cantidad:Math.abs(e.diferencia),hora_notificacion:e.hora,dia_notificacion:e.dia,estado:"pendiente",created_at:new Date().toISOString(),cantidad_horneada:0,cantidad_vendida:0,hora_ultima_venta:null,tiempo_inicio_horneado:null})));ne(()=>F.value,t=>{t&&t.length>0&&t.forEach(async e=>{var u,r,S,E,_,Y;const a=`${e.id}`,n=e.cantidad,s=(r=(u=v.notificaciones)==null?void 0:u.faltantes)==null?void 0:r.find(O=>{const se=typeof e.id=="string"?e.id:String(e.id),ie=parseInt(se.split("-")[0]);return O.paste_id===ie&&O.hora_notificacion===e.hora_notificacion});s?s.cantidad!==n&&G.post(route("notificaciones.actualizar"),{sucursal_id:(Y=(_=v.auth)==null?void 0:_.user)==null?void 0:Y.sucursal_id,notificacion_id:a,cantidad:n},{preserveScroll:!0,onSuccess:O=>{console.log("Notificación actualizada:",O)},onError:O=>{console.error("Error al actualizar notificación:",O)}}):G.post(route("notificaciones.registrar"),{sucursal_id:(E=(S=v.auth)==null?void 0:S.user)==null?void 0:E.sucursal_id,notificacion_id:a,cantidad:n},{preserveScroll:!0,onSuccess:O=>{console.log("Notificación registrada:",O)},onError:O=>{console.error("Error al registrar notificación:",O)}})})},{deep:!0});const W=t=>{if(!t.tiempo_inicio_horneado||!t.created_at)return"No iniciado";try{const e=new Date(t.created_at),a=new Date(t.tiempo_inicio_horneado);if(isNaN(e.getTime())||isNaN(a.getTime()))return"Fecha inválida";const n=e.toDateString(),s=a.toDateString();if(n!==s)return"Diferente día";const u=a-e,r=Math.floor(u/(1e3*60));if(r<0)return"Error: Horneado antes de notificación";if(r<60)return`${r} min`;{const S=Math.floor(r/60),E=r%60;return`${S}:${E.toString().padStart(2,"0")} hrs`}}catch(e){return console.error("Error al calcular tiempo de horneado:",e),"Error"}},ae=t=>{if(!t.created_at)return"N/A";try{const e=new Date(t.created_at);if(isNaN(e.getTime()))return"Fecha inválida";if(!t.hora_ultima_venta){const S=new Date,E=S-e,_=Math.floor(E/(1e3*60)),Y=e.toDateString(),O=S.toDateString();if(Y!==O)return"Diferente día";if(_>1440)return"Sin ventas del día";if(_<60)return`${_} min`;{const se=Math.floor(_/60),ie=_%60;return`${se}:${ie.toString().padStart(2,"0")} hrs`}}const a=new Date(t.hora_ultima_venta);if(isNaN(a.getTime()))return"Fecha de venta inválida";const n=e.toDateString(),s=a.toDateString();if(n!==s)return"Diferente día";const u=a-e,r=Math.floor(u/(1e3*60));if(r<0)return"Error: Venta antes de notificación";if(r>1440)return"Sin ventas del día";if(r<60)return`${r} min`;{const S=Math.floor(r/60),E=r%60;return`${S}:${E.toString().padStart(2,"0")} hrs`}}catch(e){return console.error("Error al calcular tiempo de venta:",e),"Error"}},K=t=>{if(!t.tiempo_inicio_horneado||!t.created_at)return!1;try{const e=new Date(t.created_at),a=new Date(t.tiempo_inicio_horneado);if(isNaN(e.getTime())||isNaN(a.getTime()))return!1;const n=e.toDateString(),s=a.toDateString();if(n!==s)return!1;const u=a-e,r=Math.floor(u/(1e3*60));return r>=0&&r<=1440}catch(e){return console.error("Error al validar tiempo de producción:",e),!1}},Q=t=>{if(!t)return"-";try{const e=new Date(t);return isNaN(e.getTime())?"Fecha inválida":e.toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0,timeZone:"America/Mexico_City"})}catch(e){return console.error("Error al formatear hora:",t,e),"Error"}};return(t,e)=>C.value?(l(),d("div",St,[o("div",Et,[e[4]||(e[4]=o("h2",{class:"text-xl font-semibold"},"Control de Producción",-1)),o("div",Mt,[o("div",Ht,[e[2]||(e[2]=o("label",{for:"fecha",class:"text-sm font-medium text-gray-700"},"Seleccionar día:",-1)),X(o("input",{type:"date",id:"fecha","onUpdate:modelValue":e[0]||(e[0]=a=>w.value=a),class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},null,512),[[ce,w.value]])]),o("div",kt,[e[3]||(e[3]=o("label",{for:"hora",class:"text-sm font-medium text-gray-700"},"Filtrar por hora:",-1)),X(o("select",{id:"hora","onUpdate:modelValue":e[1]||(e[1]=a=>f.value=a),class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[(l(!0),d(P,null,I(h.value,a=>(l(),d("option",{key:a.value,value:a.value},i(a.label),9,Nt))),128))],512),[[de,f.value]])])])]),o("div",Tt,[e[7]||(e[7]=o("h3",{class:"text-lg font-medium mb-2"},"Productos Faltantes (Hora Siguiente) - Control de Producción",-1)),L.value.length>0?(l(),d("div",Ct,[o("table",Ft,[e[5]||(e[5]=o("thead",{class:"bg-gray-50"},[o("tr",null,[o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Producto"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Faltante"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Horneada"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Vendida"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Día"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora Requerida"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo Horneado"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo Venta")])],-1)),o("tbody",Pt,[(l(!0),d(P,null,I(L.value,a=>(l(),d("tr",{key:a.id,class:"hover:bg-gray-50"},[o("td",It,[oe(i(a.paste.id)+" - "+i(a.paste.nombre)+" ",1),o("span",zt,i(a.paste.tipo),1)]),o("td",Lt,i(a.cantidad)+" unidades ",1),o("td",Vt,i(a.cantidad_horneada?`${a.cantidad_horneada} unidades`:"-"),1),o("td",At,i(a.cantidad_vendida?`${a.cantidad_vendida} unidades`:"-"),1),o("td",jt,i(a.dia_notificacion),1),o("td",Bt,i(a.hora_notificacion),1),o("td",Ot,[o("span",{class:ee(["px-2 py-1 text-xs font-medium rounded-full",a.estado==="pendiente"?"bg-red-100 text-red-800":a.estado==="horneando"?"bg-yellow-100 text-yellow-800":a.estado==="en_espera"?"bg-blue-100 text-blue-800":a.estado==="vendido"?"bg-green-100 text-green-800":a.estado==="desperdicio"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"])},i(a.estado==="pendiente"?"Sin hornear":a.estado==="horneando"?"Horneando":a.estado==="en_espera"?"En espera":a.estado==="vendido"?"Vendido":a.estado==="desperdicio"?"Desperdicio":a.estado),3)]),o("td",Rt,i(W(a)),1),o("td",Ut,i(ae(a)),1)]))),128))])])])):(l(),d("div",qt,e[6]||(e[6]=[o("p",{class:"text-gray-500 text-lg"},"No hay productos faltantes para la hora siguiente",-1),o("p",{class:"text-gray-400 text-sm mt-2"},"Los faltantes se calculan en tiempo real basándose en el inventario y estimaciones",-1)])))]),o("div",Jt,[e[9]||(e[9]=o("h3",{class:"text-lg font-medium mb-2"},"Control de Tiempo de Producción",-1)),o("div",Wt,[o("table",Zt,[e[8]||(e[8]=o("thead",{class:"bg-gray-50"},[o("tr",null,[o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Paste"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de notificación"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de Producción"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo en meter producción"),o("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado")])],-1)),o("tbody",Gt,[(l(!0),d(P,null,I(j.value,a=>(l(),d("tr",{key:a.id},[o("td",Xt,i(a.paste.nombre),1),o("td",Kt,i(Q(a.created_at)),1),o("td",Qt,i(K(a)?Q(a.tiempo_inicio_horneado):"-"),1),o("td",Yt,i(U(a)),1),o("td",ea,[o("span",{class:ee(D(a.estado))},i(a.estado),3)])]))),128))])])])])])):J("",!0)}},aa={class:"animate-pulse"},oa={key:0,class:"mt-2"},na={class:"font-bold"},pe={__name:"NotificationPanel",props:{notifications:{type:Array,required:!0,default:()=>[]},isVisible:{type:Boolean,default:!1},type:{type:String,required:!0,validator:M=>["warning","info"].includes(M)},title:{type:String,required:!0}},emits:["toggle"],setup(M,{emit:v}){return console.log(M.notifications),(C,w)=>(l(),d("div",{class:ee(["p-4 border rounded shadow mb-4 size-fit cursor-pointer",{"bg-yellow-100":M.type==="warning","bg-blue-100":M.type==="info"}]),onClick:w[0]||(w[0]=f=>C.$emit("toggle"))},[o("h2",{class:ee(["text-lg font-bold text-center",{"text-yellow-800":M.type==="warning","text-blue-800":M.type==="info"}])},[oe(i(M.type==="warning"?"⚠️":"ℹ️")+" "+i(M.title)+" ",1),o("span",aa,"("+i(M.notifications.length)+")",1),oe(" "+i(M.type==="warning"?"⚠️":"ℹ️"),1)],2),M.isVisible?(l(),d("ul",oa,[(l(!0),d(P,null,I(M.notifications,f=>(l(),d("li",{key:f.id,class:"mb-2"},[o("span",null,[o("span",na,i(f.nombre),1),oe(": "+i(M.type==="warning"?"Faltan":"Hay")+" "+i(M.type==="warning"?Math.abs(f.diferencia):f.diferencia)+" unidades para las "+i(f.hora)+" ",1),o("span",{class:ee(["text-sm",{"text-red-600":M.type==="warning","text-green-600":M.type==="info"}])}," ("+i(f.porcentaje)+"% del estimado) ",3)])]))),128))])):J("",!0)],2))}},ra={class:"container mx-auto p-4"},sa={class:"sm:flex justify-between flex-row text-sm"},ia={class:"flex gap-3 sm:flex-row flex-col"},la={class:"mt-6"},da={__name:"Hornear",setup(M){const v=N(!1),T=N(!1),C=N(null),w=N(null),{props:f}=te(),h=y(()=>{var b,x;const g=(b=f.auth)==null?void 0:b.user,c=g==null?void 0:g.roles;return c&&c.length>0&&((x=c[0])==null?void 0:x.name)==="admin"}),$=y(()=>f.inventario||[]),m=y(()=>f.estimacionesHoy||[]),z=()=>{const g=new Date;return{day:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"][g.getDay()].toLowerCase(),hour:g.getHours(),minutes:g.getMinutes()}},H=N(z());ne(()=>H.value.hour,g=>{g!==C.value&&(C.value=g,k.value.length>0&&(v.value=!0),D.value.length>0&&(T.value=!0))}),re(()=>{C.value=H.value.hour,w.value=setInterval(()=>{H.value=z()},1e3)}),ge(()=>{w.value&&clearInterval(w.value)});const U=g=>{const[c,b]=g.toLowerCase().split(" ");let[x,V]=c.split(":").map(Number);return{hours:b==="pm"&&x!==12?x+12:b==="am"&&x===12?0:x,minutes:V}},A=y(()=>$.value.filter(g=>{var c;return["pastes","empanadas dulces","empanadas saladas"].includes((c=g.tipo)==null?void 0:c.toLowerCase())})),L=y(()=>{if(!m.value.length||!A.value.length)return console.log("No hay estimaciones o productos relevantes"),[];const g=new Map(A.value.map(b=>[b.id,b]));return m.value.map(b=>{const x=g.get(b.inventario_id);if(!x)return null;const{hours:V}=U(b.hora);return{id:`${x.id}-${b.hora}`,nombre:x.nombre,estimado:b.cantidad,existente:x.cantidad,diferencia:x.cantidad-b.cantidad,hora:b.hora,dia:b.dia.toLowerCase(),horaEnNumero:V,tipo:x.tipo}}).filter(Boolean).filter((b,x,V)=>x===V.findIndex(F=>F.id===b.id))}),q=y(()=>L.value.filter(c=>c.dia===H.value.day)),p=y(()=>{const c=(H.value.hour+1)%24,b=q.value.filter(F=>F.horaEnNumero===c),x=new Map(b.map(F=>[F.nombre,F]));return A.value.map(F=>{const W=x.get(F.nombre);return W||{id:`${F.id}-${c}:00`,nombre:F.nombre,estimado:0,existente:F.cantidad,diferencia:F.cantidad,hora:`${c}:00`,dia:H.value.day,horaEnNumero:c,tipo:F.tipo}})}),k=y(()=>p.value.filter(c=>{const x=c.estimado*.7;return c.estimado>0&&c.existente<x}).map(c=>({...c,porcentaje:c.estimado>0?Math.round(c.existente/c.estimado*100):0}))),D=y(()=>p.value.filter(c=>c.estimado>0&&c.diferencia>0||c.estimado===0&&c.existente>0).map(c=>({...c,porcentaje:c.estimado>0?Math.round(c.existente/c.estimado*100):100}))),j=()=>v.value=!v.value,B=()=>T.value=!T.value;return(g,c)=>{var b,x,V;return l(),d("div",ra,[o("div",sa,[c[0]||(c[0]=o("h1",{class:"text-2xl font-bold mb-4"},"Sistema de Horneado",-1)),o("div",ia,[Z(pe,{notifications:k.value,"is-visible":v.value,type:"warning",title:"Faltantes",onToggle:j},null,8,["notifications","is-visible"]),Z(pe,{notifications:D.value,"is-visible":T.value,type:"info",title:"Excedentes",onToggle:B},null,8,["notifications","is-visible"])])]),o("div",la,[Z(Dt),Z(ta),((V=(x=(b=me(f).auth)==null?void 0:b.user)==null?void 0:x.roles)==null?void 0:V[0])!=="supervisor"?(l(),le(ze,{key:0})):J("",!0),h.value?(l(),le(Xe,{key:1})):J("",!0)])])}}},ca={class:"py-6"},ua={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 rounded-xl overflow-hidden"},pa={class:"flex justify-between p-6 lg:p-8 bg-white border-b border-gray-200 rounded-2xl"},ga={__name:"index",setup(M){return(v,T)=>(l(),le(fe,{title:"Tablero principal"},{default:xe(()=>[o("div",ca,[o("div",ua,[o("div",pa,[Z(da)])])])]),_:1}))}};export{ga as default};
