import{S as A,_ as H}from"./AppLayout-CEywEcjZ.js";import{Q as q,d as c,p as R,o,e as a,a as e,j as _,v as J,F as k,h as y,t as i,f as p,u as B,l as j,n as Q,z as V,b as M,w as z,A as G,B as K,c as P}from"./app-D6XDrZJc.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"container mx-auto"},X={key:0,class:"text-2xl font-bold mb-4"},Y={key:1,class:"text-2xl font-bold mb-4"},Z={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ee={class:"bg-white shadow rounded-lg p-6"},te={class:"flex gap-8 justify-between"},se=["placeholder"],oe={class:"text-lg font-semibold mb-2 text-gray-700 capitalize"},le={class:"min-w-full"},ae={key:0,class:"text-left"},ne={key:1,class:"text-left"},ie={class:"flex flex-col w-full"},re={class:"pl-6 text-sm text-gray-500"},de={key:0},ue={class:"hidden sm:block"},ce={key:1},pe=["onClick","disabled"],ve=["onClick","disabled"],fe={key:0,class:"bg-white w-full shadow rounded-lg p-6"},xe={key:0,class:"text-xl font-semibold mb-4"},me={key:1,class:"text-xl font-semibold mb-4"},be={key:2,class:"w-full flex flex-col gap-2 py-5"},ge={class:"w-full flex justify-between"},_e={key:0,class:"text-lg font-bold text-gray-600"},he=["value"],ke={class:"w-full flex justify-between"},ye={key:0,class:"text-lg w-full font-bold text-gray-600"},we=["value"],$e={class:"min-w-full"},Ce={key:0,class:"text-left"},je={class:"pl-6 text-sm text-gray-500"},Te={key:0},Se=["onClick"],Ae={key:3,class:"flex justify-end mt-4 gap-2"},Be={key:0,class:"text-lg font-bold"},Ee=["disabled"],Ve=["disabled"],Pe={__name:"SalesPanel",setup(x){const{props:u}=q(),d=c(u.auth.user.es_almacen),n=u.inventario,r=c([]),b=c(0),w=c(0),h=c(""),g=c("efectivo"),$=c(!1),v=c(!1),T=c(),F=c(u.sucursales.filter(l=>l.nombre!=="almacen")),N=c(u.trabajadores);c(u.estimacionesHoy),d.value?T.value=u.categorias.map(l=>l.tipo):T.value=["pastes","empanadas saladas","empanadas dulces","bebida","extras"];const D=l=>n.filter(t=>t.nombre==="-"?"":t.tipo===l&&t.nombre.toLowerCase().includes(h.value.toLowerCase())),E=l=>{if(l.cantidad<=0)return;const t=r.value.find(s=>s.id===l.id);t?t.ticketQuantity++:r.value.push({...l,ticketQuantity:1}),l.cantidad--},L=l=>{const t=r.value.findIndex(s=>s.id===l);if(t!==-1){const s=r.value[t];s.ticketQuantity>1?s.ticketQuantity--:r.value.splice(t,1),n.find(f=>f.id===s.id).cantidad++}},S=R(()=>r.value.reduce((l,t)=>l+t.precio*t.ticketQuantity,0)),m=(l,t)=>{A.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:s=>{s.onmouseenter=A.stopTimer,s.onmouseleave=A.resumeTimer}}).fire({icon:l,title:t})},U=()=>{v.value||r.value.length===0||(v.value=!0,V.post("/ventas",{productos:r.value,total:S.value,metodo_pago:g.value,factura:$.value},{preserveScroll:!0,onSuccess:l=>{console.log("props: ",l),setTimeout(()=>{var t,s;console.log("a.props.venta?.idVentaDia || a.props.ticket_id: ",((t=l.props.venta)==null?void 0:t.idVentaDia)||l.props.ticket_id),C(((s=l.props.venta)==null?void 0:s.idVentaDia)||l.props.ticket_id),n.value=l.props.inventario,r.value=[],h.value="",g.value="efectivo",$.value=!1,m("success","Registrado correctamente"),v.value=!1},500)},onError:l=>{console.error("Error al enviar el pedido:",l),m("error","Error al registrar"),v.value=!1}}))},I=()=>{if(!(v.value||r.value.length===0)){if(b.value===0){m("error","Seleccione una sucursal");return}v.value=!0,V.post("/asignar",{productos:r.value,sucursal_id:b.value,trabajador_id:w.value,total:"-",metodo_pago:"-"},{preserveScroll:!0,onSuccess:l=>{r.value.unshift({id:l.props.ticket_id||0,nombre:"Asignación ticket no.",detalle:`Sucursal: ${b.value}`,ticketQuantity:l.props.ticket_id||0,precio:0,sucursal_id:0,tipo:"asignacion"}),C(l.props.ticket_id),C(l.props.ticket_id),C(l.props.ticket_id),n.value=l.props.inventario,r.value=[],h.value="",b.value=0,w.value=0,g.value="efectivo",m("success","Registrado correctamente"),v.value=!1},onError:l=>{console.error("Error al enviar el pedido:",l),m("error","Error al registrar"),v.value=!1}})}},C=l=>{console.log(r.value),fetch("https://print.test/print-ticket",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productos:r.value,total:S.value||"-",metodo_pago:g.value||"-",ticket_id:l})}).then(t=>{t.success&&m("success","Ticket impreso correctamente")}).catch(t=>{console.error("Error en la impresión del ticket:",t),m("error","Error al imprimir el ticket")})};return(l,t)=>(o(),a("div",W,[d.value?(o(),a("h1",X,"Tablero de Asignación")):(o(),a("h1",Y,"Tablero de Ventas")),e("div",Z,[e("div",ee,[e("div",te,[t[5]||(t[5]=e("h2",{class:"text-xl font-semibold mb-4"},"Inventario",-1)),_(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>h.value=s),placeholder:[d.value?"Buscar en almacén...":"Buscar en inventario..."],class:"w-6/12 p-2 mb-4 border rounded"},null,8,se),[[J,h.value]])]),(o(!0),a(k,null,y(T.value,s=>(o(),a("div",{key:s,class:"mb-6 overflow-scroll md:overflow-hidden"},[e("h3",oe,i(s),1),e("table",le,[e("thead",null,[e("tr",null,[t[6]||(t[6]=e("th",{class:"text-left"},"Nombre",-1)),d.value?p("",!0):(o(),a("th",ae,"Precio")),t[7]||(t[7]=e("th",{class:"text-left hidden sm:block"},"Disponible",-1)),B(u).user.roles[0]!=="supervisor"?(o(),a("th",ne,"Acción")):p("",!0)])]),e("tbody",null,[(o(!0),a(k,null,y(D(s),f=>(o(),a("tr",{key:f.id},[e("td",ie,[e("p",null,i(f.nombre),1),e("p",re,i(f.detalle),1)]),d.value?p("",!0):(o(),a("td",de,"$"+i(f.precio),1)),e("td",ue,i(f.cantidad),1),B(u).user.roles[0]!=="supervisor"?(o(),a("td",ce,[d.value?(o(),a("button",{key:0,onClick:O=>E(f),disabled:f.cantidad===0,class:"px-3 py-1 bg-orange-500 text-white rounded hover:bg-orange-600 disabled:opacity-50"}," Asignar ",8,pe)):(o(),a("button",{key:1,onClick:O=>E(f),disabled:f.cantidad===0,class:"px-3 py-1 bg-orange-500 text-white rounded hover:bg-orange-600 disabled:opacity-50"}," Agregar ",8,ve))])):p("",!0)]))),128))])])]))),128))]),B(u).user.roles[0]!=="supervisor"?(o(),a("div",fe,[d.value?(o(),a("h2",xe,"Ticket de Asignación")):(o(),a("h2",me,"Ticket de Venta")),d.value?(o(),a("div",be,[e("div",ge,[d.value?(o(),a("span",_e," Sucursal a la que se asignará ")):p("",!0),_(e("select",{class:"w-fit","onUpdate:modelValue":t[1]||(t[1]=s=>b.value=s)},[(o(!0),a(k,null,y(F.value,s=>(o(),a("option",{key:s.id,value:s.id},i(s.nombre),9,he))),128))],512),[[j,b.value]])]),e("div",ke,[d.value?(o(),a("span",ye," Asignar responsable ")):p("",!0),_(e("select",{class:"w-fit","onUpdate:modelValue":t[2]||(t[2]=s=>w.value=s)},[t[8]||(t[8]=e("option",{value:"0"},"No asignar",-1)),(o(!0),a(k,null,y(N.value,s=>(o(),a("option",{key:s.id,value:s.id},i(s.name),9,we))),128))],512),[[j,w.value]])])])):p("",!0),e("table",$e,[e("thead",null,[e("tr",null,[t[9]||(t[9]=e("th",{class:"text-left"},"Producto",-1)),t[10]||(t[10]=e("th",{class:"text-left"},"Cantidad",-1)),d.value?p("",!0):(o(),a("th",Ce,"Precio")),t[11]||(t[11]=e("th",{class:"text-left"},"Acción",-1))])]),e("tbody",null,[(o(!0),a(k,null,y(r.value,s=>(o(),a("tr",{key:s.id},[e("td",null,[e("p",null,i(s.nombre),1),e("p",je,i(s.detalle),1)]),e("td",null,i(s.ticketQuantity),1),d.value?p("",!0):(o(),a("td",Te,"$"+i((s.precio*s.ticketQuantity).toFixed(2)),1)),e("td",null,[e("button",{onClick:f=>L(s.id),class:"px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600"}," Quitar ",8,Se)])]))),128))])]),d.value?p("",!0):(o(),a("div",Ae,[_(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>$.value=s),class:"rounded"},t[12]||(t[12]=[e("option",{value:"false"},"No facturado",-1),e("option",{value:"true"},"Facturado",-1)]),512),[[j,$.value]]),_(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>g.value=s),class:"rounded"},t[13]||(t[13]=[e("option",{value:"efectivo"},"Efectivo",-1),e("option",{value:"tarjeta"},"Tarjeta",-1)]),512),[[j,g.value]])])),e("div",{class:Q(["mt-4 flex  items-center",d.value?"justify-end":"justify-between"])},[d.value?p("",!0):(o(),a("span",Be,"Total: $"+i(S.value.toFixed(2)),1)),d.value?(o(),a("button",{key:2,onClick:I,disabled:r.value.length===0||v.value,class:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50"},i(v.value?"Procesando...":"Completar Asignacin"),9,Ve)):(o(),a("button",{key:1,onClick:U,disabled:r.value.length===0||v.value,class:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50"},i(v.value?"Procesando...":"Completar Venta"),9,Ee))],2)])):p("",!0)])]))}},Qe={class:"bg-white shadow rounded-lg p-4 mb-4"},Me={class:"flex items-center space-x-3"},ze={key:0,class:"flex-shrink-0"},Fe={key:1,class:"flex-shrink-0"},Ne={class:"text-sm text-gray-600"},De={key:0,class:"font-medium text-yellow-700"},Le={key:1,class:"font-medium text-green-700"},Ue={class:"mt-4 pt-4 border-t border-gray-200"},Ie={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Oe={class:"bg-red-50 rounded-lg p-3 border border-red-200"},He={class:"flex items-center justify-between"},qe={class:"text-2xl font-bold text-red-700"},Re={class:"text-xs text-red-600 mt-1"},Je={class:"bg-yellow-50 rounded-lg p-3 border border-yellow-200"},Ge={class:"flex items-center justify-between"},Ke={class:"text-2xl font-bold text-yellow-700"},We={class:"text-xs text-yellow-600 mt-1"},Xe={class:"bg-blue-50 rounded-lg p-3 border border-blue-200"},Ye={class:"flex items-center justify-between"},Ze={class:"text-2xl font-bold text-blue-700"},et={class:"text-xs text-blue-600 mt-1"},tt={__name:"EstadoPastes",props:{contadores:{type:Object,required:!0,default:()=>({pendiente:{cantidad:0,total_unidades:0},horneando:{cantidad:0,total_unidades:0},en_espera:{cantidad:0,total_unidades:0}})}},setup(x){const u=c(!1);return(d,n)=>(o(),a("div",Qe,[e("div",{class:"flex items-center justify-between cursor-pointer",onClick:n[0]||(n[0]=r=>u.value=!u.value)},[e("div",Me,[x.contadores.pendiente.cantidad>0?(o(),a("div",ze,n[1]||(n[1]=[e("svg",{class:"h-6 w-6 text-yellow-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)]))):(o(),a("div",Fe,n[2]||(n[2]=[e("svg",{class:"h-6 w-6 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]))),e("div",null,[n[3]||(n[3]=e("h3",{class:"text-lg font-semibold text-gray-900"}," Estado de Produccion ",-1)),e("p",Ne,[x.contadores.pendiente.cantidad>0?(o(),a("span",De,i(x.contadores.pendiente.cantidad)+" notificacion(es) pendiente(s) de hornear ",1)):(o(),a("span",Le," Sin notificaciones pendientes "))])])]),e("button",{class:Q(["text-gray-400 hover:text-gray-600 transition-transform duration-200",{"rotate-180":u.value}])},n[4]||(n[4]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1)]),2)]),M(K,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 -translate-y-2","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-2"},{default:z(()=>[_(e("div",Ue,[e("div",Ie,[e("div",Oe,[e("div",He,[e("div",null,[n[5]||(n[5]=e("p",{class:"text-xs text-red-600 font-medium uppercase"},"Sin hornear",-1)),e("p",qe,i(x.contadores.pendiente.cantidad),1),e("p",Re,i(x.contadores.pendiente.total_unidades)+" unidades ",1)]),n[6]||(n[6]=e("div",{class:"bg-red-100 rounded-full p-2"},[e("svg",{class:"h-6 w-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])]),e("div",Je,[e("div",Ge,[e("div",null,[n[7]||(n[7]=e("p",{class:"text-xs text-yellow-600 font-medium uppercase"},"Horneando",-1)),e("p",Ke,i(x.contadores.horneando.cantidad),1),e("p",We,i(x.contadores.horneando.total_unidades)+" unidades ",1)]),n[8]||(n[8]=e("div",{class:"bg-yellow-100 rounded-full p-2"},[e("svg",{class:"h-6 w-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"})])],-1))])]),e("div",Xe,[e("div",Ye,[e("div",null,[n[9]||(n[9]=e("p",{class:"text-xs text-blue-600 font-medium uppercase"},"En espera",-1)),e("p",Ze,i(x.contadores.en_espera.cantidad),1),e("p",et,i(x.contadores.en_espera.total_unidades)+" unidades ",1)]),n[10]||(n[10]=e("div",{class:"bg-blue-100 rounded-full p-2"},[e("svg",{class:"h-6 w-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])])]),n[11]||(n[11]=e("div",{class:"mt-3 text-xs text-gray-500 text-center"}," Para ver detalles completos, visita la seccion de Hornear ",-1))],512),[[G,u.value]])]),_:1})]))}},st={class:"py-6 px-2"},ot={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},lt={class:"bg-white overflow-hidden shadow-xl rounded-lg"},at={class:"p-6 lg:p-8 bg-white"},dt={__name:"index",setup(x){return(u,d)=>(o(),P(H,{title:"Tablero principal"},{default:z(()=>[e("div",st,[e("div",ot,[e("div",lt,[e("div",at,[u.$page.props.contadorEstados?(o(),P(tt,{key:0,contadores:u.$page.props.contadorEstados},null,8,["contadores"])):p("",!0),M(Pe)])])])])]),_:1}))}};export{dt as default};
