import{S,_ as z}from"./AppLayout-CeGVjGgL.js";import{Q as D,d as v,p as L,o as l,e as a,a as t,j as w,v as O,F as h,h as m,t as i,f as c,u as j,l as $,n as M,z as E,c as R,w as q,b as H}from"./app-B1dNaRzi.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"container mx-auto"},G={key:0,class:"text-2xl font-bold mb-4"},K={key:1,class:"text-2xl font-bold mb-4"},W={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},X={class:"bg-white shadow rounded-lg p-6"},Y={class:"flex gap-8 justify-between"},Z=["placeholder"],ee={class:"text-lg font-semibold mb-2 text-gray-700 capitalize"},te={class:"min-w-full"},se={key:0,class:"text-left"},oe={key:1,class:"text-left"},le={class:"flex flex-col w-full"},ae={class:"pl-6 text-sm text-gray-500"},ne={key:0},re={class:"hidden sm:block"},ie={key:1},de=["onClick","disabled"],ue=["onClick","disabled"],ce={key:0,class:"bg-white w-full shadow rounded-lg p-6"},ve={key:0,class:"text-xl font-semibold mb-4"},pe={key:1,class:"text-xl font-semibold mb-4"},_e={key:2,class:"w-full flex flex-col gap-2 py-5"},fe={class:"w-full flex justify-between"},be={key:0,class:"text-lg font-bold text-gray-600"},ge=["value"],he={class:"w-full flex justify-between"},me={key:0,class:"text-lg w-full font-bold text-gray-600"},xe=["value"],ke={class:"min-w-full"},ye={key:0,class:"text-left"},we={class:"pl-6 text-sm text-gray-500"},Te={key:0},Ce=["onClick"],Se={key:3,class:"flex justify-end mt-4"},je={key:0,class:"text-lg font-bold"},$e=["disabled"],Ae=["disabled"],Ee={__name:"SalesPanel",setup(Q){const{props:p}=D(),r=v(p.user.roles[0]==="almacen"),x=p.inventario,n=v([]),f=v(0),k=v(0),g=v(""),b=v("efectivo"),d=v(!1),T=v(),V=v(p.sucursales.filter(o=>o.nombre!=="almacen")),P=v(p.trabajadores);v(p.estimacionesHoy),r.value?T.value=p.categorias.map(o=>o.tipo):T.value=["pastes","empanadas saladas","empanadas dulces","bebida","extras"];const B=o=>x.filter(e=>e.nombre==="-"?"":e.tipo===o&&e.nombre.toLowerCase().includes(g.value.toLowerCase())),A=o=>{if(o.cantidad<=0)return;const e=n.value.find(s=>s.id===o.id);e?e.ticketQuantity++:n.value.push({...o,ticketQuantity:1}),o.cantidad--},F=o=>{const e=n.value.findIndex(s=>s.id===o);if(e!==-1){const s=n.value[e];s.ticketQuantity>1?s.ticketQuantity--:n.value.splice(e,1),x.find(u=>u.id===s.id).cantidad++}},C=L(()=>n.value.reduce((o,e)=>o+e.precio*e.ticketQuantity,0)),_=(o,e)=>{S.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:s=>{s.onmouseenter=S.stopTimer,s.onmouseleave=S.resumeTimer}}).fire({icon:o,title:e})},N=()=>{d.value||n.value.length===0||(d.value=!0,E.post("/ventas",{productos:n.value,total:C.value,metodo_pago:b.value},{preserveScroll:!0,onSuccess:o=>{console.log(o.props),setTimeout(()=>{y(o.props.ticket_id),x.value=o.props.inventario,n.value=[],g.value="",b.value="efectivo",_("success","Registrado correctamente"),d.value=!1},2e3)},onError:o=>{console.error("Error al enviar el pedido:",o),_("error","Error al registrar"),d.value=!1}}))},I=()=>{if(!(d.value||n.value.length===0)){if(f.value===0){_("error","Seleccione una sucursal");return}d.value=!0,E.post("/asignar",{productos:n.value,sucursal_id:f.value,trabajador_id:k.value,total:"-",metodo_pago:"-"},{preserveScroll:!0,onSuccess:o=>{n.value.unshift({id:o.props.ticket_id||0,nombre:"Asignación ticket no.",detalle:`Sucursal: ${f.value}`,ticketQuantity:o.props.ticket_id||0,precio:0,sucursal_id:0,tipo:"asignacion"}),y(o.props.ticket_id),y(o.props.ticket_id),y(o.props.ticket_id),x.value=o.props.inventario,n.value=[],g.value="",f.value=0,k.value=0,b.value="efectivo",_("success","Registrado correctamente"),d.value=!1},onError:o=>{console.error("Error al enviar el pedido:",o),_("error","Error al registrar"),d.value=!1}})}},y=o=>{console.log(n.value),fetch("https://print.test/print-ticket",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productos:n.value,total:C.value||"-",metodo_pago:b.value||"-",ticket_id:o})}).then(e=>{e.success&&_("success","Ticket impreso correctamente")}).catch(e=>{console.error("Error en la impresión del ticket:",e),_("error","Error al imprimir el ticket")})};return(o,e)=>(l(),a("div",J,[r.value?(l(),a("h1",G,"Tablero de Asignación")):(l(),a("h1",K,"Tablero de Ventas")),t("div",W,[t("div",X,[t("div",Y,[e[4]||(e[4]=t("h2",{class:"text-xl font-semibold mb-4"},"Inventario",-1)),w(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),placeholder:[r.value?"Buscar en almacén...":"Buscar en inventario..."],class:"w-6/12 p-2 mb-4 border rounded"},null,8,Z),[[O,g.value]])]),(l(!0),a(h,null,m(T.value,s=>(l(),a("div",{key:s,class:"mb-6 overflow-scroll md:overflow-hidden"},[t("h3",ee,i(s),1),t("table",te,[t("thead",null,[t("tr",null,[e[5]||(e[5]=t("th",{class:"text-left"},"Nombre",-1)),r.value?c("",!0):(l(),a("th",se,"Precio")),e[6]||(e[6]=t("th",{class:"text-left hidden sm:block"},"Disponible",-1)),j(p).user.roles[0]!=="supervisor"?(l(),a("th",oe,"Acción")):c("",!0)])]),t("tbody",null,[(l(!0),a(h,null,m(B(s),u=>(l(),a("tr",{key:u.id},[t("td",le,[t("p",null,i(u.nombre),1),t("p",ae,i(u.detalle),1)]),r.value?c("",!0):(l(),a("td",ne,"$"+i(u.precio),1)),t("td",re,i(u.cantidad),1),j(p).user.roles[0]!=="supervisor"?(l(),a("td",ie,[r.value?(l(),a("button",{key:0,onClick:U=>A(u),disabled:u.cantidad===0,class:"px-3 py-1 bg-orange-500 text-white rounded hover:bg-orange-600 disabled:opacity-50"}," Asignar ",8,de)):(l(),a("button",{key:1,onClick:U=>A(u),disabled:u.cantidad===0,class:"px-3 py-1 bg-orange-500 text-white rounded hover:bg-orange-600 disabled:opacity-50"}," Agregar ",8,ue))])):c("",!0)]))),128))])])]))),128))]),j(p).user.roles[0]!=="supervisor"?(l(),a("div",ce,[r.value?(l(),a("h2",ve,"Ticket de Asignación")):(l(),a("h2",pe,"Ticket de Venta")),r.value?(l(),a("div",_e,[t("div",fe,[r.value?(l(),a("span",be," Sucursal a la que se asignará ")):c("",!0),w(t("select",{class:"w-fit","onUpdate:modelValue":e[1]||(e[1]=s=>f.value=s)},[(l(!0),a(h,null,m(V.value,s=>(l(),a("option",{key:s.id,value:s.id},i(s.nombre),9,ge))),128))],512),[[$,f.value]])]),t("div",he,[r.value?(l(),a("span",me," Asignar responsable ")):c("",!0),w(t("select",{class:"w-fit","onUpdate:modelValue":e[2]||(e[2]=s=>k.value=s)},[e[7]||(e[7]=t("option",{value:"0"},"No asignar",-1)),(l(!0),a(h,null,m(P.value,s=>(l(),a("option",{key:s.id,value:s.id},i(s.name),9,xe))),128))],512),[[$,k.value]])])])):c("",!0),t("table",ke,[t("thead",null,[t("tr",null,[e[8]||(e[8]=t("th",{class:"text-left"},"Producto",-1)),e[9]||(e[9]=t("th",{class:"text-left"},"Cantidad",-1)),r.value?c("",!0):(l(),a("th",ye,"Precio")),e[10]||(e[10]=t("th",{class:"text-left"},"Acción",-1))])]),t("tbody",null,[(l(!0),a(h,null,m(n.value,s=>(l(),a("tr",{key:s.id},[t("td",null,[t("p",null,i(s.nombre),1),t("p",we,i(s.detalle),1)]),t("td",null,i(s.ticketQuantity),1),r.value?c("",!0):(l(),a("td",Te,"$"+i((s.precio*s.ticketQuantity).toFixed(2)),1)),t("td",null,[t("button",{onClick:u=>F(s.id),class:"px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600"}," Quitar ",8,Ce)])]))),128))])]),r.value?c("",!0):(l(),a("div",Se,[w(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>b.value=s),class:"rounded"},e[11]||(e[11]=[t("option",{value:"efectivo"},"Efectivo",-1),t("option",{value:"tarjeta"},"Tarjeta",-1)]),512),[[$,b.value]])])),t("div",{class:M(["mt-4 flex  items-center",r.value?"justify-end":"justify-between"])},[r.value?c("",!0):(l(),a("span",je,"Total: $"+i(C.value.toFixed(2)),1)),r.value?(l(),a("button",{key:2,onClick:I,disabled:n.value.length===0||d.value,class:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50"},i(d.value?"Procesando...":"Completar Asignacin"),9,Ae)):(l(),a("button",{key:1,onClick:N,disabled:n.value.length===0||d.value,class:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50"},i(d.value?"Procesando...":"Completar Venta"),9,$e))],2)])):c("",!0)])]))}},Qe={class:"py-6 px-2"},Ve={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},Pe={class:"bg-white overflow-hidden shadow-xl rounded-lg"},Be={class:"flex justify-between p-6 lg:p-8 bg-white border-b border-gray-200"},Ue={__name:"index",setup(Q){return(p,r)=>(l(),R(z,{title:"Tablero principal"},{default:q(()=>[t("div",Qe,[t("div",Ve,[t("div",Pe,[t("div",Be,[H(Ee)])])])])]),_:1}))}};export{Ue as default};
