import{Q as P,d as h,k as T,o as l,e as i,a as e,F as S,h as N,n as F,t as p,f as m,l as f,q as v,s as $,C as L,u as D,i as z,y as M,D as O,b as R,c as H,w as Q}from"./app-BXg8wGGQ.js";import{S as w}from"./sweetalert2.esm.all-BGf-Fe8G.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as K}from"./AppLayout-CmLnYeFg.js";const W={class:"min-h-screen pt-10"},X={class:"max-w-5xl mx-auto bg-white rounded-lg p-1"},Y={class:"border-b border-gray-200 overflow-scroll"},Z={class:"-mb-px flex space-x-8"},ee=["onClick"],te={class:"mt-6 overflow-scroll"},oe={class:"min-w-full divide-y divide-gray-200"},se={key:0,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},re={key:1,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},ae={key:2,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},ne={key:3,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},le={key:4,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},ie={key:5,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},de={class:"bg-white divide-y divide-gray-200"},ue={key:0},ce={class:"px-6 py-4 whitespace-nowrap"},pe={key:0,class:"flex gap-2"},me=["onUpdate:modelValue"],ge=["onClick"],fe={class:"ml-5 text-sm text-gray-500"},be={key:0,class:"px-6 py-4"},ve={key:1,class:"px-6 py-4"},xe=["onUpdate:modelValue","onInput"],ye={key:2,class:"px-6 py-4 font-medium"},_e={key:3,class:"px-6 py-4"},he={key:4,class:"px-6 py-4"},we={key:5,class:"px-6 py-4"},ke=["onUpdate:modelValue"],Ce={key:0,class:"mt-6 flex justify-end"},$e=["disabled"],Ee={key:1,class:"mt-6 flex justify-end"},Se=["disabled"],Ie=["disabled"],Ve={__name:"RegistroInventario",setup(G){const g=w.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:t=>{t.onmouseenter=w.stopTimer,t.onmouseleave=w.resumeTimer}});async function x(){try{c.value=!0;const t={sobrantes:k.value.filter(o=>o.existe>0).map(o=>({inventario_id:o.id,sucursal_id:a.sucursal_id,nombre:o.nombre,cantidad:o.existe}))};$.post("/sobrantes",t,{preserveScroll:!0,preserveState:!0,onSuccess:()=>{g.fire({icon:"success",title:"Sobrantes guardados exitosamente"})},onError:o=>{console.error("Error al guardar sobrantes:",o),g.fire({icon:"error",title:"Error al guardar los sobrantes"})}})}catch(t){console.error("Error al guardar sobrantes:",t),g.fire({icon:"error",title:"Error al guardar los sobrantes"})}finally{c.value=!1}}const{props:a}=P(),r=h("bebida"),c=h(!1),y=h(a.gastos||[]);function b(){y.value.push({nombre:"",costo:0})}function I(t){y.value.splice(t,1)}const V=[{id:"bebida",name:"Bebidas"},{id:"masa",name:"Tortillas y Bolas"},{id:"extras",name:"Extras"},{id:"relleno",name:"Rellenos"},{id:"pastes",name:"Pastes Empanadas"},{id:"gastos",name:"Gastos generales"},{id:"sobrantes",name:"Sobrantes"}],k=h(a.inventario.map(t=>{var o,d;return{...t,existe:((o=a==null?void 0:a.registros[t.id-1])==null?void 0:o.existe)||(t==null?void 0:t.existe)||0,entra:0,total:null,sobra:(d=a==null?void 0:a.registros[t.id-1])==null?void 0:d.existe,costo:(t==null?void 0:t.costo)||0}})),C=T(()=>r.value==="bebida"||r.value==="extras"||r.value==="pastes"),u=T(()=>r.value==="gastos"?y.value:r.value==="pastes"||r.value==="sobrantes"?k.value.filter(t=>t.tipo==="pastes"||t.tipo==="empanadas saladas"||t.tipo==="empanadas dulces"):k.value.filter(t=>t.tipo===r.value));function s(t){const o=a.ventas.find(d=>d.producto_id===t);return o?o.total_vendido:0}function n(t){return U(t)+(s(t)||0)+t.entra}function E(t){return n(t)-s(t.id)}function A(t){t.total=(t.existe||0)+(t.entra||0);const o=s(t.id);t.sobra=t.total-o}function U(t){const o=s(t.id);return t.cantidad+Number(o)}async function j(){try{c.value=!0;const t={gastos:y.value.map(o=>({id:o.id||null,sucursal_id:o.sucursal_id||0,nombre:o.nombre,costo:o.costo||0}))};$.post("/gastos",t,{preserveScroll:!0,preserveState:!1,onSuccess:o=>{g.fire({icon:"success",title:"Gastos guardados exitosamente"}),r.value="gastos",y.value=o.props.gastos},onError:o=>{console.error("Error al guardar:",o),g.fire({icon:"error",title:"Error al guardar los gastos"})}})}catch(t){console.error("Error al guardar:",t),g.fire({icon:"error",title:"Error al guardar los gastos"})}finally{c.value=!1}}async function q(){try{c.value=!0;const t={productos:k.value.map(o=>({id:o.id,existe:o.existe||0,entra:o.entra||0,total:n(o),vende:Number(s(o.id)),costo:o.costo||0,sobra:E(o)}))};$.post("/registro",{registros:t},{preserveScroll:!0,preserveState:!1,replace:!0,onSuccess:()=>{console.log("Registro guardado exitosamente")},onError:o=>{console.error("Error al guardar:",o)}}),g.fire({icon:"success",title:"Registro guardado exitosamente"})}catch(t){console.error("Error al guardar:",t),g.fire({icon:"error",title:"Error al guardar el registro"})}finally{c.value=!1}}return(t,o)=>(l(),i("div",W,[e("div",X,[o[1]||(o[1]=e("div",{class:"mb-6 border-b pb-4"},[e("div",{class:"flex justify-between items-center"},[e("h1",{class:"text-2xl font-bold text-gray-900"},"Registro de Inventario"),e("div",{class:"flex gap-4 items-center"})])],-1)),e("div",Y,[e("nav",Z,[(l(),i(S,null,N(V,d=>e("button",{key:d.id,onClick:B=>r.value=d.id,class:F(["whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm",r.value===d.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},p(d.name),11,ee)),64))])]),e("div",te,[e("table",oe,[e("thead",null,[e("tr",null,[o[0]||(o[0]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Nombre",-1)),r.value==="gastos"?(l(),i("th",se," Costo ")):m("",!0),r.value!=="gastos"&&r.value!=="sobrantes"?(l(),i("th",re," Existe ")):m("",!0),r.value!=="gastos"&&r.value!=="sobrantes"?(l(),i("th",ae," Entra ")):m("",!0),r.value!=="gastos"&&r.value!=="sobrantes"?(l(),i("th",ne," Total ")):m("",!0),C.value?(l(),i("th",le," Vendidos ")):m("",!0),r.value!=="gastos"?(l(),i("th",ie," Sobra ")):m("",!0)])]),e("tbody",de,[r.value==="gastos"?(l(),i("tr",ue,[e("td",{colspan:"2",class:"px-6 py-4"},[e("button",{onClick:b,class:"text-blue-600 hover:text-blue-800"}," + Agregar nuevo gasto ")])])):m("",!0),(l(!0),i(S,null,N(u.value,(d,B)=>(l(),i("tr",{key:B},[e("td",ce,[r.value==="gastos"?(l(),i("div",pe,[f(e("input",{type:"text","onUpdate:modelValue":_=>d.nombre=_,class:"w-48 rounded-md border-gray-300 shadow-sm",placeholder:"Nombre del gasto"},null,8,me),[[v,d.nombre]]),e("button",{onClick:_=>I(B),class:"text-red-600 hover:text-red-800"}," × ",8,ge)])):(l(),i(S,{key:1},[e("h1",null,p(d.nombre),1),e("span",fe,p(d.detalle),1)],64))]),r.value!=="gastos"&&r.value!=="sobrantes"?(l(),i("td",be,p(U(d)),1)):m("",!0),r.value!=="gastos"&&r.value!=="sobrantes"?(l(),i("td",ve,[f(e("input",{"onUpdate:modelValue":_=>d.entra=_,type:"number",min:"0",placeholder:"0",class:"w-20 rounded-md border-gray-300 shadow-sm text-center",onInput:_=>A(d)},null,40,xe),[[v,d.entra,void 0,{number:!0}]])])):m("",!0),r.value!=="gastos"&&r.value!=="sobrantes"?(l(),i("td",ye,p(n(d)),1)):m("",!0),C.value&&r.value!=="sobrantes"?(l(),i("td",_e,p(s(d.id)),1)):m("",!0),r.value!=="gastos"?(l(),i("td",he,p(E(d)),1)):m("",!0),r.value==="gastos"&&r.value!=="sobrantes"?(l(),i("td",we,[f(e("input",{"onUpdate:modelValue":_=>d.costo=_,type:"number",min:"0",placeholder:"0",class:"w-20 rounded-md border-gray-300 shadow-sm text-center"},null,8,ke),[[v,d.costo,void 0,{number:!0}]])])):m("",!0)]))),128))])])]),r.value==="sobrantes"?(l(),i("div",Ce,[e("button",{onClick:x,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",disabled:c.value},p(c.value?"Guardando...":"Guardar Sobrantes"),9,$e)])):(l(),i("div",Ee,[r.value==="gastos"?(l(),i("button",{key:0,onClick:j,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",disabled:c.value},p(c.value?"Guardando...":"Guardar Gastos"),9,Se)):(l(),i("button",{key:1,onClick:q,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",disabled:c.value},p(c.value?"Guardando...":"Guardar Registro"),9,Ie))]))])]))}},Be=J(Ve,[["__scopeId","data-v-2be4e85b"]]),Te={class:"container mx-auto p-8 md:p-10"},Ne={key:0,class:"flex flex-col md:flex-row gap-10 w-full"},Ge={class:"md:w-4/12 w-full"},Ue={class:"bg-white shadow rounded-lg p-6 mb-6"},De={class:"text-xl font-semibold mb-4"},Pe={class:"flex justify-end space-x-2"},Re={type:"submit",class:"px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500"},Ae={class:"md:w-8/12 w-full"},je={class:"mb-4"},qe={class:"bg-white shadow rounded-lg overflow-scroll h-screen"},Fe={class:"min-w-full divide-y divide-gray-200"},Le={class:"bg-white divide-y divide-gray-200"},ze={class:"py-1 px-2 whitespace bg-gray-50"},Me={class:"py-1 px-2 whitespace-nowrap"},Oe={class:"py-1 px-2 whitespace bg-gray-50"},He={class:"py-1 px-2 whitespace-nowrap"},Qe={class:"py-1 px-2 whitespace-nowrap bg-gray-50"},Je={class:"py-1 px-2 whitespace-nowrap text-sm font-medium flex flex-col gap-1 place-items-center"},Ke=["onClick"],We=["onClick"],Xe={__name:"Inventario",setup(G){const{props:g}=P(),x=h(g.inventario),a=L({id:null,nombre:"",detalle:"",tipo:"",cantidad:0,precio:0}),r=h(!1),c=h(""),y=T(()=>x.value.filter(u=>u.nombre.toLowerCase().includes(c.value.toLowerCase())||u.tipo.toLowerCase().includes(c.value.toLowerCase()))),b=w.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:u=>{u.onmouseenter=w.stopTimer,u.onmouseleave=w.resumeTimer}}),I=()=>{r.value?$.put(`/inventario/${a.id}`,{nombre:a.nombre,detalle:a.detalle,tipo:a.tipo,cantidad:a.cantidad,precio:a.precio},{preserveScroll:!0,preserveState:!1,replace:!0,onSuccess:u=>{b.fire({icon:"success",title:"Actualizado correctamente"}),x.value=u.props.inventario,C()},onError:u=>{b.fire({icon:"error",title:"Hubo un problema al actualizar el ítem"})}}):$.post("/inventario",{nombre:a.nombre,detalle:a.detalle,tipo:a.tipo,cantidad:a.cantidad,precio:a.precio},{preserveScroll:!0,preserveState:!1,replace:!0,onSuccess:u=>{b.fire({icon:"success",title:"Agregado correctamente"}),x.value=u.props.inventario,C()},onError:u=>{b.fire({icon:"error",title:"Hubo un problema al agregar el ítem"})}})},V=u=>{Object.assign(a,u),r.value=!0},k=u=>{w.fire({title:"¿Estás seguro?",text:"¡No podrás revertir esto!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#e66f23",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminarlo",cancelButtonText:"Cancelar"}).then(s=>{s.isConfirmed&&$.delete(`/inventario/${u}`,{preserveScroll:!0,preserveState:!1,replace:!0,onSuccess:n=>{b.fire({icon:"success",title:"Eliminado correctamente"}),x.value=n.props.inventario},onError:n=>{b.fire({icon:"error",title:"Hubo un problema al eliminar el ítem"})}})})},C=()=>{Object.assign(a,{id:null,nombre:"",detalle:"",tipo:"",cantidad:0,precio:0}),r.value=!1};return(u,s)=>(l(),i("div",Te,[s[14]||(s[14]=e("h1",{class:"text-2xl font-bold mb-4"},"Gestión de Inventario",-1)),D(g).user.roles[0]==="admin"||D(g).user.roles[0]==="sucursal"?(l(),i("div",Ne,[e("div",Ge,[e("div",Ue,[e("h2",De,p(r.value?"Editar Item":"Agregar Nuevo Item"),1),e("form",{onSubmit:z(I,["prevent"]),class:"space-y-4"},[e("div",null,[s[7]||(s[7]=e("label",{for:"itemName",class:"block text-sm font-medium text-gray-700"},"Nombre del Item",-1)),f(e("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>a.nombre=n),id:"itemName",type:"text",required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-300 focus:ring focus:ring-orange-200 focus:ring-opacity-50"},null,512),[[v,a.nombre]])]),e("div",null,[s[9]||(s[9]=e("label",{for:"itemCategory",class:"block text-sm font-medium text-gray-700"},"Categoría",-1)),f(e("select",{"onUpdate:modelValue":s[1]||(s[1]=n=>a.tipo=n),id:"itemCategory",required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-300 focus:ring focus:ring-orange-200 focus:ring-opacity-50"},s[8]||(s[8]=[O('<option value="relleno">Rellenos</option><option value="pastes">Pastes</option><option value="empanadas saladas">Empanadas saladas</option><option value="empanadas dulces">Empanadas dulces</option><option value="bebida">Bebidas</option><option value="masa">Masa</option><option value="extras">Extras</option>',7)]),512),[[M,a.tipo]])]),e("div",null,[s[10]||(s[10]=e("label",{for:"itemDetalle",class:"block text-sm font-medium text-gray-700"},"Detalle del item",-1)),f(e("input",{"onUpdate:modelValue":s[2]||(s[2]=n=>a.detalle=n),id:"itemDetalle",type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-300 focus:ring focus:ring-orange-200 focus:ring-opacity-50"},null,512),[[v,a.detalle]])]),e("div",null,[s[11]||(s[11]=e("label",{for:"itemQuantity",class:"block text-sm font-medium text-gray-700"},"Cantidad",-1)),f(e("input",{"onUpdate:modelValue":s[3]||(s[3]=n=>a.cantidad=n),id:"itemQuantity",type:"number",required:"",min:"0",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-300 focus:ring focus:ring-orange-200 focus:ring-opacity-50"},null,512),[[v,a.cantidad,void 0,{number:!0}]])]),e("div",null,[s[12]||(s[12]=e("label",{for:"itemPrice",class:"block text-sm font-medium text-gray-700"},"Precio Unitario",-1)),f(e("input",{"onUpdate:modelValue":s[4]||(s[4]=n=>a.precio=n),id:"itemPrice",type:"number",required:"",min:"0",step:"0.01",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-300 focus:ring focus:ring-orange-200 focus:ring-opacity-50"},null,512),[[v,a.precio,void 0,{number:!0}]])]),e("div",Pe,[e("button",{type:"button",onClick:C,class:"px-4 py-2 border border-transparent text-sm font-medium rounded-md text-gray-700 bg-gray-200 hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500"}," Cancelar "),e("button",Re,p(r.value?"Actualizar":"Agregar"),1)])],32)])]),e("div",Ae,[e("div",je,[f(e("input",{"onUpdate:modelValue":s[5]||(s[5]=n=>c.value=n),type:"text",placeholder:"Buscar en el inventario...",class:"w-full px-4 py-2 rounded-md border-gray-300 shadow-sm focus:border-orange-300 focus:ring focus:ring-orange-200 focus:ring-opacity-50",onInput:s[6]||(s[6]=(...n)=>u.searchInventory&&u.searchInventory(...n))},null,544),[[v,c.value]])]),e("div",qe,[e("table",Fe,[s[13]||(s[13]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nombre"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Categoría"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Detalle"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Existentes"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Precio"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Acciones")])],-1)),e("tbody",Le,[(l(!0),i(S,null,N(y.value,n=>(l(),i("tr",{key:n.id,class:"text-center"},[e("td",ze,p(n.nombre),1),e("td",Me,p(n.tipo),1),e("td",Oe,p(n.detalle),1),e("td",He,p(n.cantidad),1),e("td",Qe,"$"+p(n.precio),1),e("td",Je,[e("button",{onClick:E=>V(n),class:"bg-orange-600 py-1 px-2 text-white rounded-lg hover:bg-orange-900 mr-2"},"Editar",8,Ke),e("button",{onClick:E=>k(n.id),class:"bg-red-600 py-1 px-2 text-white rounded-lg hover:bg-red-900"},"Eliminar",8,We)])]))),128))])])])])])):m("",!0),R(Be)]))}},Ye={class:"py-6 px-2"},Ze={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},et={class:"bg-white overflow-hidden shadow-xl rounded-lg py-2"},at={__name:"index",setup(G){return(g,x)=>(l(),H(K,{title:"Tablero principal"},{default:Q(()=>[e("div",Ye,[e("div",Ze,[e("div",et,[R(Xe)])])])]),_:1}))}};export{at as default};
