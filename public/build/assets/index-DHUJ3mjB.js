import{S as F,_ as te}from"./AppLayout-zK6UA_er.js";import{Q as J,d,i as U,o as n,e as l,a as e,n as _,f as b,j as u,v as N,k as f,F as h,h as w,t as a,l as oe,m as j,u as se,c as ae,w as ne,b as le}from"./app-CcF9ETXU.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"relative px-6 py-8 bg-white shadow-lg sm:rounded-3xl sm:p-12"},ie={class:"flex border-b border-gray-200 mb-6"},de={key:0},ue={class:"mb-4 bg-gray-50 p-4 rounded-lg"},ce={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},pe=["value"],xe={class:"mt-4 flex justify-end"},be=["disabled"],ge={key:0},me={key:1},fe={class:"overflow-x-auto"},ve={class:"min-w-full bg-white border border-gray-200 rounded-lg"},ye={class:"px-4 py-3 border-b"},_e={class:"text-sm font-medium text-gray-900"},he={class:"text-xs text-gray-500"},we={class:"px-4 py-3 border-b text-sm text-gray-700"},ke={class:"px-4 py-3 border-b text-sm text-gray-700"},Se={class:"px-4 py-3 border-b"},Ce={class:"px-4 py-3 border-b text-sm text-gray-700"},Te={class:"px-4 py-3 border-b"},Fe={key:0,class:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800"},Ne=["onClick"],Ve={key:0},$e={key:1},Ae={class:"mb-6 bg-gray-50 p-4 rounded-lg"},Ue={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},je=["value"],Be=["value"],De={class:"mt-4 flex justify-end"},Pe=["disabled"],Ie={key:0},Ee={key:1},Me={class:"mb-6 grid grid-cols-2 md:grid-cols-4 gap-4"},Oe={class:"bg-blue-50 p-4 rounded-lg border border-blue-200"},He={class:"text-2xl font-bold text-blue-800"},ze={class:"bg-yellow-50 p-4 rounded-lg border border-yellow-200"},Ge={class:"text-2xl font-bold text-yellow-800"},Le={class:"text-sm text-yellow-600"},Qe={class:"bg-green-50 p-4 rounded-lg border border-green-200"},Xe={class:"text-2xl font-bold text-green-800"},qe={class:"text-sm text-green-600"},Je={class:"bg-purple-50 p-4 rounded-lg border border-purple-200"},Ke={class:"text-2xl font-bold text-purple-800"},Re={class:"overflow-x-auto"},We={class:"min-w-full bg-white border border-gray-200 rounded-lg"},Ye={class:"px-4 py-3 border-b"},Ze={class:"text-sm font-medium text-gray-900"},et={class:"text-xs text-gray-500"},tt={class:"px-4 py-3 border-b text-sm text-gray-700"},ot={class:"px-4 py-3 border-b text-sm text-gray-700"},st={class:"px-4 py-3 border-b"},at={class:"px-4 py-3 border-b"},nt={class:"px-4 py-3 border-b text-sm text-gray-700"},lt=["title"],rt={key:1},it={key:0},dt={key:0,class:"mt-4 flex justify-center items-center space-x-2"},ut=["disabled"],ct={class:"text-sm text-gray-600"},pt=["disabled"],xt={class:"mt-2 text-center text-sm text-gray-500"},B=20,bt={__name:"ActividadPersonal",setup(K){const{props:c}=J(),D=d(c.usuarios||[]),V=d(c.sucursales||[]),v=d(c.actividades||[]),x=d(c.resumen||{}),g=d("actividades"),P=U(()=>{var t,m;return(((m=(t=c.auth)==null?void 0:t.user)==null?void 0:m.roles)||[]).some(y=>(y.name||y)==="admin")}),$=d([]),k=d(!1),r=d({fecha_inicio:new Date().toISOString().split("T")[0],fecha_fin:new Date().toISOString().split("T")[0],sucursal_id:null,tipo:null,atendida:null}),I=async()=>{k.value=!0;try{const s={};r.value.fecha_inicio&&(s.fecha_inicio=r.value.fecha_inicio),r.value.fecha_fin&&(s.fecha_fin=r.value.fecha_fin),r.value.sucursal_id&&(s.sucursal_id=r.value.sucursal_id),r.value.tipo&&(s.tipo=r.value.tipo),r.value.atendida!==null&&(s.atendida=r.value.atendida);const t=await j.get("/api/notificaciones-personal",{params:s});$.value=t.data.notificaciones}catch(s){console.error("Error al cargar notificaciones:",s),F.fire({icon:"error",title:"Error",text:"No se pudieron cargar las notificaciones",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3})}finally{k.value=!1}},R=async s=>{try{await j.post(`/api/notificaciones-personal/${s.id}/atender`),s.atendida=!0,F.fire({icon:"success",title:"Atendida",toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3})}catch{F.fire({icon:"error",title:"Error",text:"No se pudo marcar como atendida",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3})}},W=s=>({faltante:"bg-red-100 text-red-800",excedente:"bg-yellow-100 text-yellow-800",horneado:"bg-orange-100 text-orange-800"})[s]||"bg-gray-100 text-gray-800",i=d({fecha_inicio:c.fechaInicio||new Date().toISOString().split("T")[0],fecha_fin:c.fechaFin||new Date().toISOString().split("T")[0],sucursal_id:null,usuario_id:null,tipo_actividad:null}),S=d(!1),p=d(1),C=U(()=>Math.ceil(v.value.length/B)),E=U(()=>{const s=(p.value-1)*B,t=s+B;return v.value.slice(s,t)}),Y=async()=>{S.value=!0,p.value=1;try{const s=await j.post("/actividad-personal/filtro",i.value);v.value=s.data.actividades,x.value=s.data.resumen}catch(s){console.error("Error al filtrar:",s),F.fire({icon:"error",title:"Error",text:"No se pudieron cargar las actividades",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3})}finally{S.value=!1}},M=s=>new Intl.NumberFormat("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}).format(s),Z=s=>({produccion:"bg-orange-100 text-orange-800",venta:"bg-green-100 text-green-800",asistencia:"bg-purple-100 text-purple-800",inventario:"bg-blue-100 text-blue-800",gasto:"bg-red-100 text-red-800",corte_caja:"bg-gray-100 text-gray-800"})[s]||"bg-gray-100 text-gray-800",ee=(s,t)=>s==="venta"?t==="manual"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800":s==="asistencia"?t==="entrada"?"bg-green-100 text-green-800":"bg-red-100 text-red-800":s==="produccion"&&{pendiente:"bg-yellow-100 text-yellow-800",horneando:"bg-orange-100 text-orange-800",en_espera:"bg-blue-100 text-blue-800",vendido:"bg-green-100 text-green-800"}[t]||"bg-gray-100 text-gray-800";return(s,t)=>{var m,y,O,H,z,G,L,Q,X;return n(),l("div",re,[t[38]||(t[38]=e("h1",{class:"text-3xl font-semibold mb-6 text-center"},"Actividad del Personal",-1)),e("div",ie,[e("button",{onClick:t[0]||(t[0]=o=>g.value="actividades"),class:_([g.value==="actividades"?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700","px-6 py-3 text-sm font-medium border-b-2 transition-colors"])}," Actividades ",2),P.value?(n(),l("button",{key:0,onClick:t[1]||(t[1]=o=>{g.value="notificaciones",I()}),class:_([g.value==="notificaciones"?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700","px-6 py-3 text-sm font-medium border-b-2 transition-colors"])}," Notificaciones de Turno ",2)):b("",!0)]),g.value==="notificaciones"&&P.value?(n(),l("div",de,[e("div",ue,[e("div",ce,[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha Inicio",-1)),u(e("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=o=>r.value.fecha_inicio=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},null,512),[[N,r.value.fecha_inicio]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha Fin",-1)),u(e("input",{type:"date","onUpdate:modelValue":t[3]||(t[3]=o=>r.value.fecha_fin=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},null,512),[[N,r.value.fecha_fin]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Sucursal",-1)),u(e("select",{"onUpdate:modelValue":t[4]||(t[4]=o=>r.value.sucursal_id=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},[t[16]||(t[16]=e("option",{value:null},"Todas",-1)),(n(!0),l(h,null,w(V.value,o=>(n(),l("option",{key:o.id,value:o.id},a(o.nombre),9,pe))),128))],512),[[f,r.value.sucursal_id]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tipo",-1)),u(e("select",{"onUpdate:modelValue":t[5]||(t[5]=o=>r.value.tipo=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},t[18]||(t[18]=[e("option",{value:null},"Todos",-1),e("option",{value:"faltante"},"Faltante",-1),e("option",{value:"excedente"},"Excedente",-1),e("option",{value:"horneado"},"Horneado",-1)]),512),[[f,r.value.tipo]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Estado",-1)),u(e("select",{"onUpdate:modelValue":t[6]||(t[6]=o=>r.value.atendida=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},t[20]||(t[20]=[e("option",{value:null},"Todos",-1),e("option",{value:"0"},"Sin atender",-1),e("option",{value:"1"},"Atendidas",-1)]),512),[[f,r.value.atendida]])])]),e("div",xe,[e("button",{onClick:I,disabled:k.value,class:"bg-orange-500 text-white px-6 py-2 rounded-md hover:bg-orange-600 transition-colors disabled:opacity-50"},[k.value?(n(),l("span",ge,"Cargando...")):(n(),l("span",me,"Filtrar"))],8,be)])]),e("div",fe,[e("table",ve,[t[23]||(t[23]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Fecha/Hora"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Trabajador"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Sucursal"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Tipo"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"DescripciÃ³n"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Atendida")])],-1)),e("tbody",null,[(n(!0),l(h,null,w($.value,o=>(n(),l("tr",{key:o.id,class:"hover:bg-gray-50 transition-colors"},[e("td",ye,[e("div",_e,a(o.fecha),1),e("div",he,a(o.hora),1)]),e("td",we,a(o.trabajador),1),e("td",ke,a(o.sucursal),1),e("td",Se,[e("span",{class:_([W(o.tipo),"px-2 py-1 text-xs font-medium rounded-full"])},a(o.tipo),3)]),e("td",Ce,a(o.descripcion),1),e("td",Te,[o.atendida?(n(),l("span",Fe," Atendida ")):(n(),l("button",{key:1,onClick:A=>R(o),class:"px-3 py-1 text-xs font-medium bg-orange-500 text-white rounded-full hover:bg-orange-600 transition-colors"}," Atender ",8,Ne))])]))),128)),$.value.length===0?(n(),l("tr",Ve,t[22]||(t[22]=[e("td",{colspan:"6",class:"px-4 py-8 text-center text-gray-500"}," No se encontraron notificaciones para los filtros seleccionados ",-1)]))):b("",!0)])])])])):b("",!0),g.value==="actividades"?(n(),l("div",$e,[e("div",Ae,[e("div",Ue,[e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha Inicio",-1)),u(e("input",{type:"date","onUpdate:modelValue":t[7]||(t[7]=o=>i.value.fecha_inicio=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},null,512),[[N,i.value.fecha_inicio]])]),e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha Fin",-1)),u(e("input",{type:"date","onUpdate:modelValue":t[8]||(t[8]=o=>i.value.fecha_fin=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},null,512),[[N,i.value.fecha_fin]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Sucursal",-1)),u(e("select",{"onUpdate:modelValue":t[9]||(t[9]=o=>i.value.sucursal_id=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},[t[26]||(t[26]=e("option",{value:null},"Todas las sucursales",-1)),(n(!0),l(h,null,w(V.value,o=>(n(),l("option",{key:o.id,value:o.id},a(o.nombre),9,je))),128))],512),[[f,i.value.sucursal_id]])]),e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Usuario",-1)),u(e("select",{"onUpdate:modelValue":t[10]||(t[10]=o=>i.value.usuario_id=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},[t[28]||(t[28]=e("option",{value:null},"Todos los usuarios",-1)),(n(!0),l(h,null,w(D.value,o=>(n(),l("option",{key:o.id,value:o.id},a(o.nombre_completo),9,Be))),128))],512),[[f,i.value.usuario_id]])]),e("div",null,[t[31]||(t[31]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tipo",-1)),u(e("select",{"onUpdate:modelValue":t[11]||(t[11]=o=>i.value.tipo_actividad=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},t[30]||(t[30]=[oe('<option>Todos los tipos</option><option value="produccion">Produccion</option><option value="venta">Ventas</option><option value="asistencia">Asistencia</option><option value="inventario">Inventario</option><option value="gasto">Gastos</option><option value="corte_caja">Corte de Caja</option>',7)]),512),[[f,i.value.tipo_actividad]])])]),e("div",De,[e("button",{onClick:Y,disabled:S.value,class:"bg-orange-500 text-white px-6 py-2 rounded-md hover:bg-orange-600 transition-colors duration-200 disabled:opacity-50"},[S.value?(n(),l("span",Ie,"Cargando...")):(n(),l("span",Ee,"Filtrar"))],8,Pe)])]),e("div",Me,[e("div",Oe,[t[32]||(t[32]=e("div",{class:"text-sm text-blue-600 font-medium"},"Total Actividades",-1)),e("div",He,a(x.value.total_actividades),1)]),e("div",ze,[t[33]||(t[33]=e("div",{class:"text-sm text-yellow-600 font-medium"},"Ventas Manuales",-1)),e("div",Ge,a(((y=(m=x.value.ventas)==null?void 0:m.manuales)==null?void 0:y.cantidad)||0),1),e("div",Le,"$"+a(M(((H=(O=x.value.ventas)==null?void 0:O.manuales)==null?void 0:H.total)||0)),1)]),e("div",Qe,[t[34]||(t[34]=e("div",{class:"text-sm text-green-600 font-medium"},"Ventas Sistema (POS)",-1)),e("div",Xe,a(((G=(z=x.value.ventas)==null?void 0:z.sistema)==null?void 0:G.cantidad)||0),1),e("div",qe,"$"+a(M(((Q=(L=x.value.ventas)==null?void 0:L.sistema)==null?void 0:Q.total)||0)),1)]),e("div",Je,[t[35]||(t[35]=e("div",{class:"text-sm text-purple-600 font-medium"},"Asistencias",-1)),e("div",Ke,a(((X=x.value.por_tipo)==null?void 0:X.asistencia)||0),1)])]),e("div",Re,[e("table",We,[t[37]||(t[37]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Fecha/Hora"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Usuario"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Sucursal"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Tipo"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Subtipo"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Detalles")])],-1)),e("tbody",null,[(n(!0),l(h,null,w(E.value,o=>{var A,q;return n(),l("tr",{key:o.id,class:"hover:bg-gray-50 transition-colors"},[e("td",Ye,[e("div",Ze,a(o.fecha),1),e("div",et,a(o.hora),1)]),e("td",tt,a(o.usuario),1),e("td",ot,a(o.sucursal),1),e("td",st,[e("span",{class:_([Z(o.tipo),"px-2 py-1 text-xs font-medium rounded-full"])},a(o.tipo_label),3)]),e("td",at,[e("span",{class:_([ee(o.tipo,o.subtipo),"px-2 py-1 text-xs font-medium rounded-full"])},a(o.subtipo_label),3)]),e("td",nt,[o.tipo==="venta"&&((q=(A=o.extra)==null?void 0:A.productos)!=null&&q.length)?(n(),l("span",{key:0,title:o.extra.productos.map(T=>`${T.nombre} x${T.cantidad} = $${(T.cantidad*T.precio_unitario).toFixed(2)}`).join(`
`),class:"cursor-help underline decoration-dotted"},a(o.detalles),9,lt)):(n(),l("span",rt,a(o.detalles),1))])])}),128)),v.value.length===0?(n(),l("tr",it,t[36]||(t[36]=[e("td",{colspan:"6",class:"px-4 py-8 text-center text-gray-500"}," No se encontraron actividades para los filtros seleccionados ",-1)]))):b("",!0)])])]),C.value>1?(n(),l("div",dt,[e("button",{onClick:t[12]||(t[12]=o=>p.value=Math.max(1,p.value-1)),disabled:p.value===1,class:"px-3 py-1 border rounded-md disabled:opacity-50 hover:bg-gray-100"}," Anterior ",8,ut),e("span",ct," Pagina "+a(p.value)+" de "+a(C.value),1),e("button",{onClick:t[13]||(t[13]=o=>p.value=Math.min(C.value,p.value+1)),disabled:p.value===C.value,class:"px-3 py-1 border rounded-md disabled:opacity-50 hover:bg-gray-100"}," Siguiente ",8,pt)])):b("",!0),e("div",xt," Mostrando "+a(E.value.length)+" de "+a(v.value.length)+" actividades ",1)])):b("",!0)])}}},gt={class:"py-6"},mt={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 p-2 md:p-8"},ft={class:"bg-white overflow-hidden shadow-xl rounded-xl"},ht={__name:"index",setup(K){const{props:c}=J();return(D,V)=>se(c).user.roles[0]!=="trabajador"?(n(),ae(te,{key:0,title:"Actividad Personal"},{default:ne(()=>[e("div",gt,[e("div",mt,[e("div",ft,[le(bt)])])])]),_:1})):b("",!0)}};export{ht as default};
