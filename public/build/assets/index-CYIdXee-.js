import{S as R,_ as me}from"./AppLayout-Bj6Smw6L.js";import{Q as ee,d as H,p as _,o as d,e as l,a,F as P,h as F,t as i,f as Z,x as ne,i as oe,j as Q,l as re,v as ie,z as K,k as fe,b as G,u as ce,B as he,y as de,g as ae,n as Y,C as ve,c as se,w as ge}from"./app-BcjbxpGc.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as _e}from"./createLucideIcon--s4ZiDIM.js";/**
 * @license lucide-vue-next v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=_e("Trash2Icon",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),be={class:"bg-white rounded-lg shadow-md overflow-hidden"},we={class:"overflow-x-auto"},$e={class:"min-w-full divide-y divide-gray-200"},De={class:"bg-white divide-y divide-gray-200"},Se={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Ee={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Me={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},He={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ke={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Te={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ce={key:0},Ne={class:"bg-gray-50"},Pe={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Fe={__name:"PastesHorneados",setup(S){const{props:v}=ee();H(v.pastesHorneados);const k=_(()=>{const h={};v.pastesHorneados.forEach(m=>{h[m.relleno]||(h[m.relleno]={totalPiezas:0,items:[]}),h[m.relleno].totalPiezas+=Number(m.piezas),h[m.relleno].items.push(m)});const $=[];return Object.keys(h).forEach(m=>{h[m].items.forEach((z,E)=>{$.push({...z,totalPiezas:h[m].totalPiezas,isFirst:E===0})})}),$}),T=_(()=>k.value.reduce((h,$)=>Number(h)+($.isFirst?Number($.totalPiezas):0),0)),b=h=>new Date(h).toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"America/Mexico_City"}),f=h=>new Date(h).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",timeZone:"America/Mexico_City"});return(h,$)=>(d(),l("div",null,[$[3]||($[3]=a("h1",{class:"pb-4 pt-10 font-semibold text-xl"},"Pastes/Empanadas horneados de hoy",-1)),a("div",be,[a("div",we,[a("table",$e,[$[2]||($[2]=a("thead",{class:"bg-gray-50"},[a("tr",null,[a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Responsable"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Paste/Empanada"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Hora"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Día"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Piezas Horneadas"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Total del día")])],-1)),a("tbody",De,[(d(!0),l(P,null,F(k.value,(m,z)=>{var E,U,A;return d(),l("tr",{key:z},[a("td",Se,i((E=m==null?void 0:m.responsable)==null?void 0:E.name)+" "+i(((U=m==null?void 0:m.responsable)==null?void 0:U.apellido_p)||"")+" "+i(((A=m==null?void 0:m.responsable)==null?void 0:A.apellido_m)||""),1),a("td",Ee,i(m.relleno),1),a("td",Me,i(b(m.updated_at)),1),a("td",He,i(f(m.updated_at)),1),a("td",ke,i(m.piezas),1),a("td",Te,[m.isFirst?(d(),l("span",Ce,i(m.totalPiezas),1)):Z("",!0)])])}),128))]),a("tfoot",Ne,[a("tr",null,[$[0]||($[0]=a("td",{colspan:"3",class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},"Total de piezas horneadas:",-1)),a("td",Pe,i(T.value),1),$[1]||($[1]=a("td",null,null,-1))])])])])])]))}},ze=xe(Fe,[["__scopeId","data-v-1a02fb88"]]),Ie={class:"pt-16"},Le={class:"max-w-7xl mx-auto space-y-6"},Ve={class:"bg-white rounded-lg shadow p-6"},Ae={class:"text-2xl font-bold text-gray-900"},je={class:"mt-4"},Be=["value"],Oe={key:0,class:"bg-white rounded-lg shadow overflow-x-auto"},Re={class:"min-w-full divide-y divide-gray-200"},Ue={class:"bg-gray-50"},qe={class:"bg-white divide-y divide-gray-200"},Ze={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Je=["onUpdate:modelValue"],We={key:1,class:"w-full flex justify-end"},Xe={__name:"EstimacionPastes",setup(S){const{props:v}=ee(),k=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"],T=new Date().getDay(),b=k[T],f=H(b||"Lunes"),h=H(!1),$=[{value:"Lunes",label:"Lunes"},{value:"Martes",label:"Martes"},{value:"Miercoles",label:"Miércoles"},{value:"Jueves",label:"Jueves"},{value:"Viernes",label:"Viernes"},{value:"Sábado",label:"Sábado"},{value:"Domingo",label:"Domingo"}],m=["7:00 am","8:00 am","9:00 am","10:00 am","11:00 am","12:00 pm","1:00 pm","2:00 pm","3:00 pm","4:00 pm","5:00 pm","6:00 pm","7:00 pm","8:00 pm","9:00 pm"],z=_(()=>v.inventario.filter(p=>["pastes","empanadas dulces","empanadas saladas"].includes(p.tipo)).map(p=>p.nombre)),E=H({}),U=R.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:p=>{p.onmouseenter=R.stopTimer,p.onmouseleave=R.resumeTimer}}),A=()=>{const p={};return m.forEach(M=>{p[M]={},z.value.forEach(D=>{p[M][D]=0})}),p},I=()=>{h.value=!1,E.value=A(),v.estimaciones.filter(M=>M.dia===f.value).forEach(({hora:M,cantidad:D,inventario_id:j})=>{var g;const B=(g=v.inventario.find(c=>c.id===j))==null?void 0:g.nombre;B&&E.value[M]&&(E.value[M][B]=D)}),h.value=!0},q=()=>{K.post("/estimaciones",{estimaciones:E.value,dia:f.value},{preserveState:!1,preserveScroll:!0,onSuccess:()=>U.fire({icon:"success",title:"Estimaciones guardados exitosamente"}),onError:()=>U.fire({icon:"error",title:"Error al guardar las estimaciones"})})};return ne(()=>{I()}),oe(f,()=>{I()}),(p,M)=>(d(),l("div",Ie,[a("div",Le,[a("header",Ve,[a("h1",Ae,"Sistema de Control de Producción - Día: "+i(f.value),1),a("div",je,[Q(a("select",{"onUpdate:modelValue":M[0]||(M[0]=D=>f.value=D),class:"rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500"},[(d(),l(P,null,F($,D=>a("option",{key:D.value,value:D.value},i(D.label),9,Be)),64))],512),[[re,f.value]])])]),h.value?(d(),l("div",Oe,[a("table",Re,[a("thead",Ue,[a("tr",null,[M[1]||(M[1]=a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo",-1)),(d(!0),l(P,null,F(z.value,D=>(d(),l("th",{key:D,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},i(D),1))),128))])]),a("tbody",qe,[(d(),l(P,null,F(m,D=>a("tr",{key:D},[a("td",Ze,i(D),1),(d(!0),l(P,null,F(z.value,j=>(d(),l("td",{key:j,class:"px-6 py-4 whitespace-nowrap"},[Q(a("input",{type:"number","onUpdate:modelValue":B=>E.value[D][j]=B,class:"w-20 rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500",min:"0"},null,8,Je),[[ie,E.value[D][j]]])]))),128))])),64))])])])):Z("",!0),p.$page.props.auth.user.roles[0].name=="admin"?(d(),l("div",We,[a("button",{onClick:q,class:"px-3 py-2 bg-orange-500 rounded-lg text-white hover:bg-orange-400"}," Guardar ")])):Z("",!0)])]))}},Ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ke={class:"bg-white shadow rounded-lg p-6"},Qe={class:"mb-6"},Ye={class:"list-disc pl-5"},et={class:"capitalize"},tt={class:"font-semibold"},at={class:"list-disc pl-5"},ot={class:"font-semibold"},nt={class:"bg-white shadow rounded-lg p-6"},st=["value"],rt=["max"],it=["disabled"],dt={key:0,class:"text-sm text-red-600 mt-2"},lt={key:0},ct={key:1},ut={class:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-4"},pt={class:"flex justify-between"},mt={class:"text-xl font-semibold mb-4"},ft=["onClick"],ht={key:0},vt={class:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 mb-4"},gt={key:1},xt=["disabled"],_t={class:"mt-8 bg-white shadow rounded-lg p-6"},yt={key:0,class:"text-gray-500 text-center py-4"},bt={key:1,class:"divide-y divide-gray-200"},wt=["onClick"],$t={__name:"SistemaHorneado",setup(S){var X,n;const{props:v}=ee(),k=v.inventario||[],T=H(v.hornos||[]),b=H(T.value.map(e=>({...e,horneando:e.estado||!1,pastesHorneando:e.pastesHorneando||[],tiempoInicio:e.tiempo_inicio?new Date(e.tiempo_inicio).getTime():0,tiempoFin:e.tiempo_fin?new Date(e.tiempo_fin).getTime():0,tiempoTranscurrido:0,timer:null,labeltime:"00:00"}))),f=H(9e5),h=H([]),$=()=>{if(h.value.length===0)return;const e=b.value.find(t=>!t.horneando);if(e){e.horneando=!0,e.pastesHorneando=[...h.value],h.value=[],e.tiempoInicio=Date.now(),e.tiempoFin=e.tiempoInicio+f.value;try{de.post("/iniciar-horneado",{horno_id:e.id,tiempo_inicio:e.tiempoInicio,tiempo_fin:e.tiempoFin,pastes_horneando:e.pastesHorneando,estado:!0}).then(t=>{console.log(t)}).catch(t=>{console.error("Error al iniciar el horneado:",t)}),R.fire({icon:"success",title:"Horneando",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500}),L(e.id)}catch(t){console.error("Error al iniciar el horneado:",t),R.fire({icon:"error",title:"Error al iniciar",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}}else J()},m=R.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:e=>{e.addEventListener("mouseenter",R.stopTimer),e.addEventListener("mouseleave",R.resumeTimer)}}),z=async e=>{const t=b.value.find(o=>o.id===e);if(!(!t||!t.horneando))try{clearInterval(t.timer);const o=[...t.pastesHorneando];t.horneando=!1,t.pastesHorneando=[],t.tiempoTranscurrido=0,t.labeltime="00:00",E();for(const r of o){const s=k.find(u=>u.nombre.toLowerCase()===r.nombre.toLowerCase()&&(u.tipo==="pastes"||u.tipo==="empanadas saladas"||u.tipo==="empanadas dulces"));if(s)try{await de.post("/api/control-produccion/horneado",{horno_id:e,paste_id:s.id,cantidad:r.cantidad})}catch(u){console.error(`Horno ${e} - Error al registrar producción para ${r.nombre}:`,u)}else console.error(`Horno ${e} - No se encontró el paste ${r.nombre} en el inventario`)}K.post("/hornear",{horno_id:e,pastes:o},{preserveScroll:!0,preserveState:!1,replace:!0,onSuccess:()=>{m.fire({icon:"success",title:"Horneado finalizado"})},onError:r=>{console.error(`Horno ${e} - Error al registrar el horneado:`,r),m.fire({icon:"error",title:"Error al registrar el horneado"})}})}catch(o){console.error(`Horno ${e} - Error en finalizarHorneado:`,o)}},E=()=>{new Audio("/sound/videoplayback.mp3").play().catch(t=>console.error("Error al reproducir el sonido:",t))},U=_(()=>k.filter(e=>e.tipo==="masa")),A=_(()=>k.filter(e=>e.tipo==="relleno")),I=_(()=>U.value.map(e=>{const t=b.value.filter(o=>o.horneando&&o.pastesHorneando.some(r=>r.masa===e.nombre)).reduce((o,r)=>o+r.pastesHorneando.find(s=>s.masa===e.nombre).cantidad,0);return{...e,cantidad:Math.max(0,e.cantidad-t)}})),q=_(()=>A.value.map(e=>{const t=b.value.filter(o=>o.horneando&&o.pastesHorneando.some(r=>r.nombre===e.nombre)).reduce((o,r)=>o+r.pastesHorneando.find(s=>s.nombre===e.nombre).cantidad,0);return{...e,cantidad:Math.max(0,e.cantidad-t)}})),p=H({masa:"",relleno:"",cantidad:1,sucursal_id:(n=(X=v.auth)==null?void 0:X.user)==null?void 0:n.sucursal_id}),M=e=>{const t={pastes:"bola","empanadas saladas":"salada","empanadas dulces":"dulce"},o=k.find(r=>(r.nombre.toLowerCase()===e.value.relleno.toLowerCase()||r.nombre.toLowerCase().startsWith(e.value.relleno.toLowerCase()))&&t[r.tipo.toLowerCase()]);return o?t[o.tipo.toLowerCase()]:"bola"},D=()=>{var s,u,V,w;const e=M(p).toLowerCase(),t=I.value.find(N=>N.nombre.toLowerCase()===e),o=q.value.find(N=>N.nombre.toLowerCase()===p.value.relleno.toLowerCase());if(!t||t.cantidad<=0){m.fire({icon:"error",title:"No hay suficiente masa disponible"});return}if(!o||o.cantidad<=0){m.fire({icon:"error",title:"No hay suficiente relleno disponible"});return}const r=Math.min(t.cantidad,o.cantidad);if(p.value.cantidad>r){m.fire({icon:"error",title:`Solo hay ${r} unidades disponibles (${t.cantidad} masa, ${o.cantidad} relleno)`});return}if(t&&o&&p.value.cantidad<=r){t.cantidad-=p.value.cantidad,o.cantidad-=p.value.cantidad;const N=h.value.find(W=>W.nombre===o.nombre);N?N.cantidad+=p.value.cantidad:c({id:Date.now(),masa:t.nombre,nombre:o.nombre,cantidad:p.value.cantidad,sucursal_id:(u=(s=v.auth)==null?void 0:s.user)==null?void 0:u.sucursal_id}),p.value={masa:"",relleno:"",cantidad:1,sucursal_id:(w=(V=v.auth)==null?void 0:V.user)==null?void 0:w.sucursal_id}}},j=_(()=>{const e=M(p).toLowerCase(),t=I.value.find(r=>r.nombre.toLowerCase()===e),o=q.value.find(r=>r.nombre===p.value.relleno);return!t||!o?0:Math.min(t.cantidad,o.cantidad)}),B=_(()=>{const e=M(p).toLowerCase(),t=I.value.find(s=>s.nombre.toLowerCase()===e),o=q.value.find(s=>s.nombre===p.value.relleno);if(!t||!o)return!1;const r=Math.min(t.cantidad,o.cantidad);return p.value.relleno&&p.value.cantidad>0&&p.value.cantidad<=r&&r>0});H("00:00");const g=e=>{if(e<=0)return"00:00";const t=Math.floor(e/1e3),o=Math.floor(t/60),r=t%60;return`${String(o).padStart(2,"0")}:${String(r).padStart(2,"0")}`},c=e=>{const t=k.find(o=>o.nombre.toLowerCase()===e.nombre.toLowerCase()&&(o.tipo==="pastes"||o.tipo==="empanadas saladas"||o.tipo==="empanadas dulces"));t?h.value.push({...e,paste_id:t.id}):console.error(`No se encontró el paste ${e.nombre} en el inventario`)},y=e=>{h.value=h.value.filter(t=>t.id!==e)},x=e=>{z(e).catch(t=>{console.error(`Error al finalizar horneado desde timer: ${t}`)})},L=e=>{const t=b.value.find(s=>s.id===e);if(!t)return;const r=t.tiempoFin-Date.now();if(r<=0){x(e);return}t.tiempoTranscurrido=f.value-r,t.labeltime=g(r),t.timer&&clearInterval(t.timer),t.timer=setInterval(()=>{const s=t.tiempoFin-Date.now();if(s<=0){clearInterval(t.timer),x(e);return}t.tiempoTranscurrido=f.value-s,t.labeltime=g(s)},1e3)},C=e=>{const t=b.value.find(s=>s.id===e);if(!t)return;const r=t.tiempoFin-Date.now();if(r<=0){x(e);return}t.tiempoTranscurrido=f.value-r,t.labeltime=g(r),t.timer&&clearInterval(t.timer),t.timer=setInterval(()=>{const s=t.tiempoFin-Date.now();if(s<=0){clearInterval(t.timer),x(e);return}t.tiempoTranscurrido=f.value-s,t.labeltime=g(s)},1e3)};ne(()=>{b.value.forEach(e=>{e.timer&&clearInterval(e.timer)}),b.value.forEach(e=>{if(e.estado){const t=Date.now()-new Date(e.tiempo_inicio).getTime(),o=f.value-t;if(o<=0){x(e.id);return}e.tiempoFin=Date.now()+o,C(e.id)}})});const J=()=>{K.post("/crear-horno",{estado:!1,pastesHorneando:[]},{preserverScroll:!0,preserveState:!1,onSuccess:e=>{var t;T.value=(t=e==null?void 0:e.props)==null?void 0:t.hornos,h.value=[],b.value=T.value.map(o=>({...o,horneando:o.estado||!1,pastesHorneando:o.pastesHorneando||[],tiempoInicio:o.tiempo_inicio?new Date(o.tiempo_inicio).getTime():0,tiempoFin:o.tiempo_fin?new Date(o.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),R.fire({icon:"success",title:"Horno creado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:e=>{console.error("Error al crear el horno:",e),R.fire({icon:"error",title:"Error al crear horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})},te=e=>{K.post("/eliminar-horno",{horno_id:e},{preserveScroll:!0,preserveState:!1,onSuccess:t=>{var o;T.value=(o=t==null?void 0:t.props)==null?void 0:o.hornos,b.value=T.value.map(r=>({...r,horneando:r.estado||!1,pastesHorneando:r.pastesHorneando||[],tiempoInicio:r.tiempo_inicio?new Date(r.tiempo_inicio).getTime():0,tiempoFin:r.tiempo_fin?new Date(r.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),R.fire({icon:"success",title:"Horno eliminado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:t=>{console.error("Error al eliminar el horno:",t),R.fire({icon:"error",title:"Error al eliminar horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})};return(e,t)=>(d(),l(P,null,[a("div",Ge,[a("div",Ke,[t[4]||(t[4]=a("h2",{class:"text-xl font-semibold mb-4"},"Ingredientes Disponibles",-1)),a("div",Qe,[t[2]||(t[2]=a("h3",{class:"text-lg font-medium mb-2"},"Masas",-1)),a("ul",Ye,[(d(!0),l(P,null,F(I.value,o=>(d(),l("li",{key:o.id,class:"flex justify-between"},[a("span",et,i(o.nombre),1),a("span",tt,i(o.cantidad)+" unidades",1)]))),128))])]),a("div",null,[t[3]||(t[3]=a("h3",{class:"text-lg font-medium mb-2"},"Rellenos",-1)),a("ul",at,[(d(!0),l(P,null,F(q.value,o=>(d(),l("li",{key:o.id,class:"flex justify-between"},[a("span",null,i(o.nombre),1),a("span",ot,i(o.cantidad)+" unidades",1)]))),128))])])]),a("div",nt,[t[8]||(t[8]=a("h2",{class:"text-xl font-semibold mb-4"},"Crear Nuevo Paste/Empanada",-1)),a("form",{onSubmit:fe(D,["prevent"]),class:"space-y-4"},[a("div",null,[t[6]||(t[6]=a("label",{for:"relleno",class:"block text-sm font-medium text-gray-700"},"Seleccionar Relleno",-1)),Q(a("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>p.value.relleno=o),id:"relleno",required:"",class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md"},[t[5]||(t[5]=a("option",{value:""},"Seleccione un relleno",-1)),(d(!0),l(P,null,F(A.value,o=>(d(),l("option",{key:o.id,value:o.nombre},i(o.nombre),9,st))),128))],512),[[re,p.value.relleno]])]),a("div",null,[t[7]||(t[7]=a("label",{for:"cantidad",class:"block text-sm font-medium text-gray-700"},"Cantidad",-1)),Q(a("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>p.value.cantidad=o),type:"number",id:"cantidad",required:"",min:"1",max:j.value,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 sm:text-sm"},null,8,rt),[[ie,p.value.cantidad,void 0,{number:!0}]])]),a("button",{type:"submit",disabled:!B.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed"},i(B.value?"Asignar Unidades":"Sin ingredientes suficientes"),9,it),p.value.relleno&&!B.value?(d(),l("div",dt,[j.value===0?(d(),l("span",lt,"No hay ingredientes disponibles")):(d(),l("span",ct,"Máximo disponible: "+i(j.value)+" unidades",1))])):Z("",!0)],32)])]),a("div",ut,[(d(!0),l(P,null,F(b.value,(o,r)=>(d(),l("div",{key:o.id,class:"bg-white shadow rounded-lg p-6"},[a("div",pt,[a("h2",mt,"Horno "+i(r+1),1),!o.horneando&&T.value.length>1?(d(),l("button",{key:0,onClick:s=>te(o.id),class:"flex items-center gap-2 bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"},[G(ce(ye),{class:"w-4 h-4"})],8,ft)):Z("",!0)]),o.horneando?(d(),l("div",ht,[t[9]||(t[9]=a("p",{class:"text-lg mb-2"},"Horneando grupo de pastes:",-1)),a("ul",null,[(d(!0),l(P,null,F(o.pastesHorneando,s=>(d(),l("li",{key:s.nombre},i(s.cantidad)+" "+i(s.nombre)+" - masa "+i(s.masa),1))),128))]),a("div",vt,[a("div",{class:"bg-orange-600 h-2.5 rounded-full transition-all duration-100",style:he({width:`${o.tiempoTranscurrido/f.value*100}%`})},null,4)]),a("p",null,"Tiempo restante: "+i(o.labeltime),1)])):(d(),l("div",gt,[t[10]||(t[10]=a("p",{class:"text-lg mb-4"},"El horno está disponible",-1)),a("button",{onClick:$,disabled:!h.value.length,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Iniciar Horneado de Grupo ",8,xt)]))]))),128)),a("div",{class:"mt-4 h-full flex justify-center items-center"},[a("button",{onClick:J,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500"}," Crear Nuevo Horno ")])]),a("div",_t,[t[11]||(t[11]=a("h2",{class:"text-xl font-semibold mb-4"},"Grupos de Pastes por Hornear",-1)),h.value.length===0?(d(),l("div",yt," No hay grupos de pastes en la cola de horneado ")):(d(),l("ul",bt,[(d(!0),l(P,null,F(h.value,o=>(d(),l("li",{key:o.id,class:"py-4 flex justify-between items-center"},[a("span",null,i(o.cantidad)+" "+i(o.nombre)+" - masa "+i(o.masa),1),a("button",{onClick:r=>y(o.id),class:"bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"}," Cancelar ",8,wt)]))),128))]))])],64))}},Dt={key:0,class:"mt-8 bg-white shadow rounded-lg p-6"},St={class:"flex justify-between items-center mb-4"},Et={class:"flex items-center space-x-4"},Mt={class:"flex items-center space-x-2"},Ht={class:"flex items-center space-x-2"},kt=["value"],Tt={class:"mb-6"},Ct={key:0,class:"overflow-x-auto"},Nt={class:"min-w-full divide-y divide-gray-200"},Pt={class:"bg-white divide-y divide-gray-200"},Ft={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 capitalize"},zt={class:"text-xs text-gray-500 block capitalize"},It={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Lt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Vt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},At={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize"},jt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Bt={class:"px-6 py-4 whitespace-nowrap"},Ot={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Rt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ut={key:1,class:"text-center py-8"},qt={class:"mt-8"},Zt={class:"overflow-x-auto"},Jt={class:"min-w-full divide-y divide-gray-200"},Wt={class:"bg-white divide-y divide-gray-200"},Xt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Gt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Kt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Qt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Yt={class:"px-6 py-4 whitespace-nowrap capitalize"},ea={__name:"ControlProduccion",setup(S){const{props:v}=ee();console.log(v),H([]);const k=H([]);H([]);const T=_(()=>{var t,o;const n=(t=v.auth)==null?void 0:t.user,e=n==null?void 0:n.roles;return e&&e.length>0&&((o=e[0])==null?void 0:o.name)==="admin"}),b=H(new Date().toISOString().split("T")[0]),f=H("actual"),h=H([{value:"todas",label:"Todas las horas"},{value:"actual",label:"Hora Siguiente"},{value:"7-am",label:"7:00 AM"},{value:"8-am",label:"8:00 AM"},{value:"9-am",label:"9:00 AM"},{value:"10-am",label:"10:00 AM"},{value:"11-am",label:"11:00 AM"},{value:"12-pm",label:"12:00 PM"},{value:"1-pm",label:"1:00 PM"},{value:"2-pm",label:"2:00 PM"},{value:"3-pm",label:"3:00 PM"},{value:"4-pm",label:"4:00 PM"},{value:"5-pm",label:"5:00 PM"},{value:"6-pm",label:"6:00 PM"},{value:"7-pm",label:"7:00 PM"},{value:"8-pm",label:"8:00 PM"},{value:"9-pm",label:"9:00 PM"},{value:"10-pm",label:"10:00 PM"},{value:"11-pm",label:"11:00 PM"}]),$=n=>{if(!n||typeof n!="string")return"";try{if(n.includes("-"))return n;if(n.includes(":")){const[t,o]=n.split(":"),r=parseInt(t),s=r>=12?"pm":"am";return`${r%12||12}-${s}`}const e=n.match(/(\d+):(\d+)\s*(am|pm)/i);if(e){const[,t,o,r]=e;return`${parseInt(t)%12||12}-${r.toLowerCase()}`}return""}catch(e){return console.error("Error al convertir hora notificación:",n,e),""}},m=()=>{const n=new Date,e=new Date(n.getTime()+60*60*1e3),t=new Date(e);return t.setMinutes(0,0,0),z(t)},z=n=>{if(!n)return"";try{const e=new Date(n);if(isNaN(e.getTime()))return"";const t=e.getHours(),o=e.getMinutes(),r=t>=12?"pm":"am";return`${t%12||12}-${r}`}catch(e){return console.error("Error al obtener formato de hora:",n,e),""}},E=n=>{if(!n.tiempo_inicio_horneado)return{promedio:0,ultima:"N/A",restante:"N/A"};try{const e=new Date(n.tiempo_inicio_horneado),t=new Date(n.created_at);if(isNaN(e.getTime())||isNaN(t.getTime()))return{promedio:0,ultima:"N/A",restante:"N/A"};const o=Math.max(0,e-t),r=Math.floor(o/(1e3*60));return{promedio:r,ultima:M(n.tiempo_inicio_horneado),restante:r>0?`${r} min`:"Completado"}}catch(e){return console.error("Error al calcular tiempo de reposición:",e),{promedio:0,ultima:"Error",restante:"Error"}}},U=n=>{if(!n.tiempo_inicio_horneado||!n.created_at)return"N/A";try{const e=new Date(n.created_at),t=new Date(n.tiempo_inicio_horneado);if(isNaN(e.getTime())||isNaN(t.getTime()))return"N/A";const o=e.toDateString(),r=t.toDateString();if(o!==r)return"Diferente día";const s=t-e,u=Math.floor(s/(1e3*60));return u<0?"Error: Producción antes de notificación":u>1440?"Error de cálculo":`${u} min`}catch(e){return console.error("Error al calcular tiempo de producción:",e),"Error"}},A=()=>{try{const n=new Date,e=new Date(n.toLocaleString("en-US",{timeZone:"America/Mexico_City"}));b.value=e.toISOString().split("T")[0]}catch(n){console.error("Error al actualizar fecha inicial:",n),b.value=new Date().toISOString().split("T")[0]}},I=_(()=>{var r;const n=C.value,e=((r=v.notificaciones)==null?void 0:r.faltantes)||[];console.log("Debug notificacionesFiltradas:",{notificacionesCalculadas:n.length,notificacionesRegistradas:e.length,muestraRegistradas:e.slice(0,2).map(s=>{var u;return{id:s.id,nombre:(u=s.paste)==null?void 0:u.nombre,hora_ultima_venta:s.hora_ultima_venta,cantidad_vendida:s.cantidad_vendida,cantidad_horneada:s.cantidad_horneada,estado:s.estado}})});const t=new Map;e.forEach(s=>{const u=`${s.paste_id}-${s.hora_notificacion}`;t.set(u,s)});const o=n.map(s=>{const V=`${(typeof s.id=="string"?s.id:String(s.id)).split("-")[0]}-${s.hora_notificacion}`,w=t.get(V);return w?{id:w.id,paste:w.paste||s.paste,cantidad:w.cantidad||s.cantidad,hora_notificacion:w.hora_notificacion||s.hora_notificacion,dia_notificacion:w.dia_notificacion||s.dia_notificacion,estado:w.estado||"pendiente",tiempo_inicio_horneado:w.tiempo_inicio_horneado,hora_ultima_venta:w.hora_ultima_venta,cantidad_vendida:w.cantidad_vendida||0,created_at:w.created_at||s.created_at,cantidad_horneada:w.cantidad_horneada||0}:s});if(e.forEach(s=>{const u=`${s.paste_id}-${s.hora_notificacion}`;o.some(w=>`${(typeof w.id=="string"?w.id:String(w.id)).split("-")[0]}-${w.hora_notificacion}`===u)||o.push({id:s.id,paste:s.paste,cantidad:s.cantidad,hora_notificacion:s.hora_notificacion,dia_notificacion:s.dia_notificacion,estado:s.estado||"pendiente",tiempo_inicio_horneado:s.tiempo_inicio_horneado,hora_ultima_venta:s.hora_ultima_venta,cantidad_vendida:s.cantidad_vendida||0,created_at:s.created_at,cantidad_horneada:s.cantidad_horneada||0})}),f.value==="todas")return o;if(f.value==="actual"){const s=m();return s?o.filter(u=>{const V=u.hora_notificacion;return V?$(V)===s:!1}):[]}return o.filter(s=>{const u=s.hora_notificacion;return u?$(u)===f.value:!1})});_(()=>I.value.filter(n=>n.tiempo_inicio_horneado).map(n=>({paste:n.paste.nombre,...E(n)})));const q=_(()=>{var n;return(n=v.notificaciones)!=null&&n.faltantes?v.notificaciones.faltantes.map(e=>({id:e.id,paste:e.paste,cantidad:e.cantidad,hora_notificacion:e.hora_notificacion,dia_notificacion:e.dia_notificacion,estado:e.estado,tiempo_inicio_horneado:e.tiempo_inicio_horneado,hora_ultima_venta:e.hora_ultima_venta,cantidad_vendida:e.cantidad_vendida,created_at:e.created_at})):[]});_(()=>{var n;return(n=v.notificaciones)!=null&&n.horneados?v.notificaciones.horneados:[]});const p=_(()=>q.value.map(e=>({paste:e.paste.nombre,recomendacion:"Producir",razon:`Faltan ${e.cantidad} unidades para las ${e.hora_notificacion}`})));oe(()=>{var n;return(n=v.notificaciones)==null?void 0:n.faltantes},n=>{n&&(k.value=p.value)},{immediate:!0});const M=n=>{if(!n)return"-";try{const e=new Date(n);return isNaN(e.getTime())?"Fecha inválida":e.toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0,timeZone:"America/Mexico_City"})}catch(e){return console.error("Error al formatear fecha:",n,e),"Error"}},D=n=>`px-2 py-1 rounded-full text-xs font-medium ${{horneando:"bg-yellow-100 text-yellow-800 capitalize",retirado:"bg-blue-100 text-blue-800 capitalize",vendido:"bg-green-100 text-green-800 capitalize",desperdicio:"bg-red-100 text-red-800 capitalize",pendiente:"bg-gray-100 text-gray-800 capitalize",en_espera:"bg-green-100 text-green-800"}[n]}`,j=_(()=>I.value.filter(n=>n.tiempo_inicio_horneado));ne(()=>{A()});const B=n=>{if(!n||typeof n!="string")return 0;try{const[e,t]=n.toLowerCase().split(" ");let[o,r]=e.split(":");return o=parseInt(o,10),o===12?o=t==="am"?0:12:t==="pm"&&(o=o+12),o}catch(e){return console.error("Error al convertir hora:",n,e),0}},g=()=>["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"][new Date().getDay()],c=_(()=>{var n;return((n=v.inventario)==null?void 0:n.filter(e=>["pastes","empanadas dulces","empanadas saladas"].includes(e.tipo)))||[]}),y=_(()=>{const n=new Map(c.value.map(t=>[t.id,t]));return(v.estimacionesHoy||[]).map(t=>{const o=n.get(t.inventario_id);if(!o)return null;const r=B(t.hora);return{id:`${o.id}-${t.hora}`,nombre:o.nombre,estimado:parseInt(t.cantidad),existente:o.cantidad,diferencia:o.cantidad-parseInt(t.cantidad),hora:t.hora,dia:t.dia,horaEnNumero:r,tipo:o.tipo}}).filter(Boolean)}),x=_(()=>y.value.filter(e=>e.dia===g())),L=_(()=>{const e=(new Date().getHours()+1)%24,t=x.value.filter(s=>(s.horaEnNumero||B(s.hora))===e),o=new Map(t.map(s=>[s.nombre,s]));return c.value.map(s=>{const u=o.get(s.nombre);return u||{id:`${s.id}-${e}:00`,nombre:s.nombre,estimado:0,existente:s.cantidad,diferencia:s.cantidad,hora:`${e}:00`,dia:g(),horaEnNumero:e,tipo:s.tipo}})}),C=_(()=>L.value.filter(e=>{const o=e.estimado*.7;return e.estimado>0&&e.existente<o}).map(e=>({id:e.id,paste:{nombre:e.nombre,tipo:e.tipo},cantidad:Math.abs(e.diferencia),hora_notificacion:e.hora,dia_notificacion:e.dia,estado:"pendiente",created_at:new Date().toISOString(),cantidad_horneada:0,cantidad_vendida:0,hora_ultima_venta:null,tiempo_inicio_horneado:null})));oe(()=>C.value,n=>{n&&n.length>0&&n.forEach(async e=>{var s,u,V,w,N,W;const t=`${e.id}`,o=e.cantidad,r=(u=(s=v.notificaciones)==null?void 0:s.faltantes)==null?void 0:u.find(O=>{const ue=typeof e.id=="string"?e.id:String(e.id),pe=parseInt(ue.split("-")[0]);return O.paste_id===pe&&O.hora_notificacion===e.hora_notificacion});r?r.cantidad!==o&&K.post(route("notificaciones.actualizar"),{sucursal_id:(W=(N=v.auth)==null?void 0:N.user)==null?void 0:W.sucursal_id,notificacion_id:t,cantidad:o},{preserveScroll:!0,onSuccess:O=>{console.log("Notificación actualizada:",O)},onError:O=>{console.error("Error al actualizar notificación:",O)}}):K.post(route("notificaciones.registrar"),{sucursal_id:(w=(V=v.auth)==null?void 0:V.user)==null?void 0:w.sucursal_id,notificacion_id:t,cantidad:o},{preserveScroll:!0,onSuccess:O=>{console.log("Notificación registrada:",O)},onError:O=>{console.error("Error al registrar notificación:",O)}})})},{deep:!0});const J=n=>{if(!n.tiempo_inicio_horneado||!n.created_at)return"No iniciado";try{const e=new Date(n.created_at),t=new Date(n.tiempo_inicio_horneado);if(isNaN(e.getTime())||isNaN(t.getTime()))return"Fecha inválida";const o=e.toDateString(),r=t.toDateString();if(o!==r)return"Diferente día";const s=t-e,u=Math.floor(s/(1e3*60));return u<0?"Error: Horneado antes de notificación":`${u} min`}catch(e){return console.error("Error al calcular tiempo de horneado:",e),"Error"}},te=n=>{var e;if(!n.hora_ultima_venta)return console.log("Sin hora_ultima_venta:",n),"Sin ventas";try{const t=new Date(n.hora_ultima_venta),o=new Date;if(isNaN(t.getTime()))return"Fecha inválida";const r=new Date(n.created_at),s=new Date(n.hora_ultima_venta);if(console.log("Debug calcularTiempoVenta:",{producto:(e=n.paste)==null?void 0:e.nombre,hora_ultima_venta:n.hora_ultima_venta,fecha_notificacion:r.toDateString(),fecha_venta:s.toDateString(),fecha_actual:o.toDateString(),cantidad_vendida:n.cantidad_vendida,cantidad_horneada:n.cantidad_horneada}),r.toDateString()!==s.toDateString())return"Sin ventas del día";const u=o.toDateString();if(s.toDateString()!==u)return"Sin ventas del día";const w=o-t,N=Math.floor(w/(1e3*60));if(N<0)return"0 min";if(N>1440)return"Sin ventas del día";if(N<60)return`${N} min`;{const W=Math.floor(N/60),O=N%60;return`${W}h ${O}min`}}catch(t){return console.error("Error al calcular tiempo de venta:",t),"Error"}},X=n=>{if(!n)return"-";try{if(n.includes("-")&&n.includes(":")){const e=new Date(n);if(!isNaN(e.getTime()))return e.toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0,timeZone:"America/Mexico_City"})}if(n.includes(":")&&!n.includes("-")){const e=n.match(/(\d+):(\d+)\s*(am|pm)/i);if(e){const[,t,o,r]=e,s=parseInt(t),u=parseInt(o);if(!isNaN(s)&&!isNaN(u))return new Date(2e3,0,1,s,u,0).toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0,timeZone:"America/Mexico_City"})}}return n}catch(e){return console.error("Error al formatear hora:",n,e),n}};return(n,e)=>T.value?(d(),l("div",Dt,[a("div",St,[e[4]||(e[4]=a("h2",{class:"text-xl font-semibold"},"Control de Producción",-1)),a("div",Et,[a("div",Mt,[e[2]||(e[2]=a("label",{for:"fecha",class:"text-sm font-medium text-gray-700"},"Seleccionar día:",-1)),Q(a("input",{type:"date",id:"fecha","onUpdate:modelValue":e[0]||(e[0]=t=>b.value=t),class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},null,512),[[ie,b.value]])]),a("div",Ht,[e[3]||(e[3]=a("label",{for:"hora",class:"text-sm font-medium text-gray-700"},"Filtrar por hora:",-1)),Q(a("select",{id:"hora","onUpdate:modelValue":e[1]||(e[1]=t=>f.value=t),class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[(d(!0),l(P,null,F(h.value,t=>(d(),l("option",{key:t.value,value:t.value},i(t.label),9,kt))),128))],512),[[re,f.value]])])])]),a("div",Tt,[e[7]||(e[7]=a("h3",{class:"text-lg font-medium mb-2"},"Productos Faltantes (Hora Siguiente) - Control de Producción",-1)),I.value.length>0?(d(),l("div",Ct,[a("table",Nt,[e[5]||(e[5]=a("thead",{class:"bg-gray-50"},[a("tr",null,[a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Producto"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Faltante"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Horneada"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Vendida"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Día"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora Requerida"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo Horneado"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo Venta")])],-1)),a("tbody",Pt,[(d(!0),l(P,null,F(I.value,t=>(d(),l("tr",{key:t.id,class:"hover:bg-gray-50"},[a("td",Ft,[ae(i(t.paste.nombre)+" ",1),a("span",zt,i(t.paste.tipo),1)]),a("td",It,i(t.cantidad)+" unidades ",1),a("td",Lt,i(t.cantidad_horneada?`${t.cantidad_horneada} unidades`:"-"),1),a("td",Vt,i(t.cantidad_vendida?`${t.cantidad_vendida} unidades`:"-"),1),a("td",At,i(t.dia_notificacion),1),a("td",jt,i(X(t.hora_notificacion)),1),a("td",Bt,[a("span",{class:Y(["px-2 py-1 text-xs font-medium rounded-full",t.estado==="pendiente"?"bg-red-100 text-red-800":t.estado==="horneando"?"bg-yellow-100 text-yellow-800":t.estado==="en_espera"?"bg-blue-100 text-blue-800":t.estado==="vendido"?"bg-green-100 text-green-800":t.estado==="desperdicio"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"])},i(t.estado==="pendiente"?"Sin hornear":t.estado==="horneando"?"Horneando":t.estado==="en_espera"?"En espera":t.estado==="vendido"?"Vendido":t.estado==="desperdicio"?"Desperdicio":t.estado),3)]),a("td",Ot,i(J(t)),1),a("td",Rt,i(te(t)),1)]))),128))])])])):(d(),l("div",Ut,e[6]||(e[6]=[a("p",{class:"text-gray-500 text-lg"},"No hay productos faltantes para la hora siguiente",-1),a("p",{class:"text-gray-400 text-sm mt-2"},"Los faltantes se calculan en tiempo real basándose en el inventario y estimaciones",-1)])))]),a("div",qt,[e[9]||(e[9]=a("h3",{class:"text-lg font-medium mb-2"},"Control de Tiempo de Producción",-1)),a("div",Zt,[a("table",Jt,[e[8]||(e[8]=a("thead",{class:"bg-gray-50"},[a("tr",null,[a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Paste"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de notificación"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de Producción"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo en meter producción"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado")])],-1)),a("tbody",Wt,[(d(!0),l(P,null,F(j.value,t=>(d(),l("tr",{key:t.id},[a("td",Xt,i(t.paste.nombre),1),a("td",Gt,i(X(t.created_at)),1),a("td",Kt,i(X(t.tiempo_inicio_horneado)),1),a("td",Qt,i(U(t)),1),a("td",Yt,[a("span",{class:Y(D(t.estado))},i(t.estado),3)])]))),128))])])])])])):Z("",!0)}},ta={class:"animate-pulse"},aa={key:0,class:"mt-2"},oa={class:"font-bold"},le={__name:"NotificationPanel",props:{notifications:{type:Array,required:!0,default:()=>[]},isVisible:{type:Boolean,default:!1},type:{type:String,required:!0,validator:S=>["warning","info"].includes(S)},title:{type:String,required:!0}},emits:["toggle"],setup(S,{emit:v}){return console.log(S.notifications),(T,b)=>(d(),l("div",{class:Y(["p-4 border rounded shadow mb-4 size-fit cursor-pointer",{"bg-yellow-100":S.type==="warning","bg-blue-100":S.type==="info"}]),onClick:b[0]||(b[0]=f=>T.$emit("toggle"))},[a("h2",{class:Y(["text-lg font-bold text-center",{"text-yellow-800":S.type==="warning","text-blue-800":S.type==="info"}])},[ae(i(S.type==="warning"?"⚠️":"ℹ️")+" "+i(S.title)+" ",1),a("span",ta,"("+i(S.notifications.length)+")",1),ae(" "+i(S.type==="warning"?"⚠️":"ℹ️"),1)],2),S.isVisible?(d(),l("ul",aa,[(d(!0),l(P,null,F(S.notifications,f=>(d(),l("li",{key:f.id,class:"mb-2"},[a("span",null,[a("span",oa,i(f.nombre),1),ae(": "+i(S.type==="warning"?"Faltan":"Hay")+" "+i(S.type==="warning"?Math.abs(f.diferencia):f.diferencia)+" unidades para las "+i(f.hora)+" ",1),a("span",{class:Y(["text-sm",{"text-red-600":S.type==="warning","text-green-600":S.type==="info"}])}," ("+i(f.porcentaje)+"% del estimado) ",3)])]))),128))])):Z("",!0)],2))}},na={class:"container mx-auto p-4"},sa={class:"sm:flex justify-between flex-row text-sm"},ra={class:"flex gap-3 sm:flex-row flex-col"},ia={class:"mt-6"},da={__name:"Hornear",setup(S){const v=H(!1),k=H(!1),T=H(null),b=H(null),{props:f}=ee(),h=_(()=>{var y,x;const g=(y=f.auth)==null?void 0:y.user,c=g==null?void 0:g.roles;return c&&c.length>0&&((x=c[0])==null?void 0:x.name)==="admin"}),$=_(()=>f.inventario||[]),m=_(()=>f.estimacionesHoy||[]),z=()=>{const g=new Date;return{day:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"][g.getDay()].toLowerCase(),hour:g.getHours(),minutes:g.getMinutes()}},E=H(z());oe(()=>E.value.hour,g=>{g!==T.value&&(T.value=g,M.value.length>0&&(v.value=!0),D.value.length>0&&(k.value=!0))}),ne(()=>{T.value=E.value.hour,b.value=setInterval(()=>{E.value=z()},1e3)}),ve(()=>{b.value&&clearInterval(b.value)});const U=g=>{const[c,y]=g.toLowerCase().split(" ");let[x,L]=c.split(":").map(Number);return{hours:y==="pm"&&x!==12?x+12:y==="am"&&x===12?0:x,minutes:L}},A=_(()=>$.value.filter(g=>{var c;return["pastes","empanadas dulces","empanadas saladas"].includes((c=g.tipo)==null?void 0:c.toLowerCase())})),I=_(()=>{if(!m.value.length||!A.value.length)return console.log("No hay estimaciones o productos relevantes"),[];const g=new Map(A.value.map(y=>[y.id,y]));return m.value.map(y=>{const x=g.get(y.inventario_id);if(!x)return null;const{hours:L}=U(y.hora);return{id:`${x.id}-${y.hora}`,nombre:x.nombre,estimado:y.cantidad,existente:x.cantidad,diferencia:x.cantidad-y.cantidad,hora:y.hora,dia:y.dia.toLowerCase(),horaEnNumero:L,tipo:x.tipo}}).filter(Boolean).filter((y,x,L)=>x===L.findIndex(C=>C.id===y.id))}),q=_(()=>I.value.filter(c=>c.dia===E.value.day)),p=_(()=>{const c=(E.value.hour+1)%24,y=q.value.filter(C=>C.horaEnNumero===c),x=new Map(y.map(C=>[C.nombre,C]));return A.value.map(C=>{const J=x.get(C.nombre);return J||{id:`${C.id}-${c}:00`,nombre:C.nombre,estimado:0,existente:C.cantidad,diferencia:C.cantidad,hora:`${c}:00`,dia:E.value.day,horaEnNumero:c,tipo:C.tipo}})}),M=_(()=>p.value.filter(c=>{const x=c.estimado*.7;return c.estimado>0&&c.existente<x}).map(c=>({...c,porcentaje:c.estimado>0?Math.round(c.existente/c.estimado*100):0}))),D=_(()=>p.value.filter(c=>c.estimado>0&&c.diferencia>0||c.estimado===0&&c.existente>0).map(c=>({...c,porcentaje:c.estimado>0?Math.round(c.existente/c.estimado*100):100}))),j=()=>v.value=!v.value,B=()=>k.value=!k.value;return(g,c)=>{var y,x,L;return d(),l("div",na,[a("div",sa,[c[0]||(c[0]=a("h1",{class:"text-2xl font-bold mb-4"},"Sistema de Horneado",-1)),a("div",ra,[G(le,{notifications:M.value,"is-visible":v.value,type:"warning",title:"Faltantes",onToggle:j},null,8,["notifications","is-visible"]),G(le,{notifications:D.value,"is-visible":k.value,type:"info",title:"Excedentes",onToggle:B},null,8,["notifications","is-visible"])])]),a("div",ia,[G($t),G(ea),((L=(x=(y=ce(f).auth)==null?void 0:y.user)==null?void 0:x.roles)==null?void 0:L[0])!=="supervisor"?(d(),se(ze,{key:0})):Z("",!0),h.value?(d(),se(Xe,{key:1})):Z("",!0)])])}}},la={class:"py-6"},ca={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 rounded-xl overflow-hidden"},ua={class:"flex justify-between p-6 lg:p-8 bg-white border-b border-gray-200 rounded-2xl"},va={__name:"index",setup(S){return(v,k)=>(d(),se(me,{title:"Tablero principal"},{default:ge(()=>[a("div",la,[a("div",ca,[a("div",ua,[G(da)])])])]),_:1}))}};export{va as default};
