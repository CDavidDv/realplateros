import{S as N,_ as se}from"./AppLayout-Be4yZaTz.js";import{Q as q,d as H,p as b,o as l,e as c,a as e,F as E,h as T,t as r,x as W,i as Q,j as U,l as K,v as Y,f as I,z as X,k as ne,b as R,u as oe,B as ie,y as te,g as J,n as Z,C as re,c as G,w as le}from"./app-BPPY7M4f.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as ce}from"./createLucideIcon-CyFx9nRX.js";/**
 * @license lucide-vue-next v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=ce("Trash2Icon",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),pe={class:"bg-white rounded-lg shadow-md overflow-hidden"},me={class:"overflow-x-auto"},fe={class:"min-w-full divide-y divide-gray-200"},ve={class:"bg-white divide-y divide-gray-200"},xe={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},ge={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},he={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ye={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},_e={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},be={class:"bg-gray-50"},we={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},$e={__name:"PastesHorneados",setup(w){const{props:v}=q(),C=H(v.pastesHorneados),y=b(()=>C.value.reduce((m,S)=>m+Number(S.piezas||0),0)),$=m=>new Date(m).toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"America/Mexico_City"}),g=m=>new Date(m).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",timeZone:"America/Mexico_City"});return(m,S)=>(l(),c("div",null,[S[2]||(S[2]=e("h1",{class:"pb-4 pt-10 font-semibold text-xl"},"Pastes/Empanadas horneados de hoy",-1)),e("div",pe,[e("div",me,[e("table",fe,[S[1]||(S[1]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Responsable"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Paste/Empanada"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Hora"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Día"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Piezas Horneadas")])],-1)),e("tbody",ve,[(l(!0),c(E,null,T(C.value,(f,z)=>{var k,A,F;return l(),c("tr",{key:z},[e("td",xe,r(((k=f==null?void 0:f.responsable)==null?void 0:k.name)||"N/A")+" "+r(((A=f==null?void 0:f.responsable)==null?void 0:A.apellido_p)||"")+" "+r(((F=f==null?void 0:f.responsable)==null?void 0:F.apellido_m)||""),1),e("td",ge,r(f.relleno),1),e("td",he,r($(f.updated_at)),1),e("td",ye,r(g(f.updated_at)),1),e("td",_e,r(f.piezas),1)])}),128))]),e("tfoot",be,[e("tr",null,[S[0]||(S[0]=e("td",{colspan:"4",class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},"Total de piezas horneadas:",-1)),e("td",we,r(y.value),1)])])])])])]))}},De=de($e,[["__scopeId","data-v-007bf37a"]]),He={class:"pt-16"},ke={class:"max-w-7xl mx-auto space-y-6"},Ce={class:"bg-white rounded-lg shadow p-6"},Se={class:"text-2xl font-bold text-gray-900"},Me={class:"mt-4"},Ee=["value"],Te={key:0,class:"bg-white rounded-lg shadow overflow-x-auto"},Pe={class:"min-w-full divide-y divide-gray-200"},Fe={class:"bg-gray-50"},Le={class:"bg-white divide-y divide-gray-200"},ze={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ne=["onUpdate:modelValue"],Ae={key:1,class:"w-full flex justify-end"},Ve={__name:"EstimacionPastes",setup(w){const{props:v}=q(),C=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"],y=new Date().getDay(),$=C[y],g=H($||"Lunes"),m=H(!1),S=[{value:"Lunes",label:"Lunes"},{value:"Martes",label:"Martes"},{value:"Miercoles",label:"Miércoles"},{value:"Jueves",label:"Jueves"},{value:"Viernes",label:"Viernes"},{value:"Sábado",label:"Sábado"},{value:"Domingo",label:"Domingo"}],f=["7:00 am","8:00 am","9:00 am","10:00 am","11:00 am","12:00 pm","1:00 pm","2:00 pm","3:00 pm","4:00 pm","5:00 pm","6:00 pm","7:00 pm","8:00 pm","9:00 pm"],z=b(()=>v.inventario.filter(p=>["pastes","empanadas dulces","empanadas saladas"].includes(p.tipo)).map(p=>p.nombre)),k=H({}),A=N.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:p=>{p.onmouseenter=N.stopTimer,p.onmouseleave=N.resumeTimer}}),F=()=>{const p={};return f.forEach(D=>{p[D]={},z.value.forEach(_=>{p[D][_]=0})}),p},V=()=>{m.value=!1,k.value=F(),v.estimaciones.filter(D=>D.dia===g.value).forEach(({hora:D,cantidad:_,inventario_id:L})=>{var s;const u=(s=v.inventario.find(a=>a.id===L))==null?void 0:s.nombre;u&&k.value[D]&&(k.value[D][u]=_)}),m.value=!0},B=()=>{X.post("/estimaciones",{estimaciones:k.value,dia:g.value},{preserveState:!1,preserveScroll:!0,onSuccess:()=>A.fire({icon:"success",title:"Sobrantes guardados exitosamente"}),onError:()=>A.fire({icon:"error",title:"Error al guardar los sobrantes"})})};return W(()=>{V()}),Q(g,()=>{V()}),(p,D)=>(l(),c("div",He,[e("div",ke,[e("header",Ce,[e("h1",Se,"Sistema de Control de Producción - Día: "+r(g.value),1),e("div",Me,[U(e("select",{"onUpdate:modelValue":D[0]||(D[0]=_=>g.value=_),class:"rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500"},[(l(),c(E,null,T(S,_=>e("option",{key:_.value,value:_.value},r(_.label),9,Ee)),64))],512),[[K,g.value]])])]),m.value?(l(),c("div",Te,[e("table",Pe,[e("thead",Fe,[e("tr",null,[D[1]||(D[1]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo",-1)),(l(!0),c(E,null,T(z.value,_=>(l(),c("th",{key:_,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},r(_),1))),128))])]),e("tbody",Le,[(l(),c(E,null,T(f,_=>e("tr",{key:_},[e("td",ze,r(_),1),(l(!0),c(E,null,T(z.value,L=>(l(),c("td",{key:L,class:"px-6 py-4 whitespace-nowrap"},[U(e("input",{type:"number","onUpdate:modelValue":u=>k.value[_][L]=u,class:"w-20 rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500",min:"0"},null,8,Ne),[[Y,k.value[_][L]]])]))),128))])),64))])])])):I("",!0),p.$page.props.auth.user.roles[0].name=="admin"?(l(),c("div",Ae,[e("button",{onClick:B,class:"px-3 py-2 bg-orange-500 rounded-lg text-white hover:bg-orange-400"}," Guardar ")])):I("",!0)])]))}},Be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ie={class:"bg-white shadow rounded-lg p-6"},je={class:"mb-6"},Re={class:"list-disc pl-5"},Ue={class:"capitalize"},Oe={class:"font-semibold"},Ze={class:"list-disc pl-5"},qe={class:"font-semibold"},Xe={class:"bg-white shadow rounded-lg p-6"},Je=["value"],We=["max"],Ge=["disabled"],Qe={class:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-4"},Ke={class:"flex justify-between"},Ye={class:"text-xl font-semibold mb-4"},et=["onClick"],tt={key:0},at={class:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 mb-4"},ot={key:1},st=["disabled"],nt={class:"mt-8 bg-white shadow rounded-lg p-6"},it={key:0,class:"text-gray-500 text-center py-4"},rt={key:1,class:"divide-y divide-gray-200"},lt=["onClick"],dt={__name:"SistemaHorneado",setup(w){const{props:v}=q(),C=v.inventario,y=H(v.hornos||[]),$=H(y.value.map(o=>({...o,horneando:o.estado||!1,pastesHorneando:o.pastesHorneando||[],tiempoInicio:o.tiempo_inicio?new Date(o.tiempo_inicio).getTime():0,tiempoFin:o.tiempo_fin?new Date(o.tiempo_fin).getTime():0,tiempoTranscurrido:0,timer:null,labeltime:"00:00"}))),g=H(9e5),m=H([]),S=()=>{if(m.value.length===0)return;const o=$.value.find(t=>!t.horneando);if(o){o.horneando=!0,o.pastesHorneando=[...m.value],m.value=[],o.tiempoInicio=Date.now(),o.tiempoFin=o.tiempoInicio+g.value;try{te.post("/iniciar-horneado",{horno_id:o.id,tiempo_inicio:o.tiempoInicio,tiempo_fin:o.tiempoFin,pastes_horneando:o.pastesHorneando,estado:!0}).then(t=>{console.log(t)}).catch(t=>{console.error("Error al iniciar el horneado:",t)}),N.fire({icon:"success",title:"Horneando",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500}),P(o.id)}catch(t){console.error("Error al iniciar el horneado:",t),N.fire({icon:"error",title:"Error al iniciar",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}}else O()},f=N.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:o=>{o.addEventListener("mouseenter",N.stopTimer),o.addEventListener("mouseleave",N.resumeTimer)}}),z=async o=>{const t=$.value.find(n=>n.id===o);if(!(!t||!t.horneando))try{clearInterval(t.timer);const n=[...t.pastesHorneando];t.horneando=!1,t.pastesHorneando=[],t.tiempoTranscurrido=0,t.labeltime="00:00",k();for(const d of n){const h=C.find(j=>j.nombre.toLowerCase()===d.nombre.toLowerCase()&&(j.tipo==="pastes"||j.tipo==="empanadas saladas"||j.tipo==="empanadas dulces"));if(h)try{await te.post("/api/control-produccion/horneado",{horno_id:o,paste_id:h.id,cantidad:d.cantidad})}catch(j){console.error(`Horno ${o} - Error al registrar producción para ${d.nombre}:`,j)}else console.error(`Horno ${o} - No se encontró el paste ${d.nombre} en el inventario`)}X.post("/hornear",{horno_id:o,pastes:n},{preserveScroll:!0,preserveState:!1,replace:!0,onSuccess:()=>{f.fire({icon:"success",title:"Horneado finalizado"})},onError:d=>{console.error(`Horno ${o} - Error al registrar el horneado:`,d),f.fire({icon:"error",title:"Error al registrar el horneado"})}})}catch(n){console.error(`Horno ${o} - Error en finalizarHorneado:`,n)}},k=()=>{new Audio("/sound/videoplayback.mp3").play().catch(t=>console.error("Error al reproducir el sonido:",t))},A=b(()=>C.filter(o=>o.tipo==="masa")),F=b(()=>C.filter(o=>o.tipo==="relleno")),V=b(()=>A.value.map(o=>{const t=$.value.filter(n=>n.horneando&&n.pastesHorneando.some(d=>d.masa===o.nombre)).reduce((n,d)=>n+d.pastesHorneando.find(h=>h.masa===o.nombre).cantidad,0);return{...o,cantidad:o.cantidad-t}})),B=b(()=>F.value.map(o=>{const t=$.value.filter(n=>n.horneando&&n.pastesHorneando.some(d=>d.nombre===o.nombre)).reduce((n,d)=>n+d.pastesHorneando.find(h=>h.nombre===o.nombre).cantidad,0);return{...o,cantidad:o.cantidad-t}})),p=H({masa:"",relleno:"",cantidad:1,sucursal_id:v.auth.user.sucursal_id}),D=o=>{const t={pastes:"bola","empanadas saladas":"salada","empanadas dulces":"dulce"},n=v.inventario.find(d=>(d.nombre.toLowerCase()===o.value.relleno.toLowerCase()||d.nombre.toLowerCase().startsWith(o.value.relleno.toLowerCase()))&&t[d.tipo.toLowerCase()]);return n?t[n.tipo.toLowerCase()]:"bola"},_=()=>{const o=D(p).toLowerCase(),t=V.value.find(d=>d.nombre.toLowerCase()===o),n=B.value.find(d=>d.nombre.toLowerCase()===p.value.relleno.toLowerCase());if(!t||t.cantidad<=0){f.fire({icon:"error",title:"No hay suficiente masa disponible"});return}if(t&&n&&p.value.cantidad<=L.value){t.cantidad-=p.value.cantidad,n.cantidad-=p.value.cantidad;const d=m.value.find(h=>h.nombre===n.nombre);d?d.cantidad+=p.value.cantidad:a({id:Date.now(),masa:t.nombre,nombre:n.nombre,cantidad:p.value.cantidad,sucursal_id:v.auth.user.sucursal_id}),p.value={masa:"",relleno:"",cantidad:1,sucursal_id:v.auth.user.sucursal_id}}},L=b(()=>{const o=B.value.find(t=>t.nombre===p.value.relleno);return o?o.cantidad:1}),u=b(()=>p.value.relleno&&p.value.cantidad>0&&p.value.cantidad<=L.value);H("00:00");const s=o=>{if(o<=0)return"00:00";const t=Math.floor(o/1e3),n=Math.floor(t/60),d=t%60;return`${String(n).padStart(2,"0")}:${String(d).padStart(2,"0")}`},a=o=>{const t=C.find(n=>n.nombre.toLowerCase()===o.nombre.toLowerCase()&&(n.tipo==="pastes"||n.tipo==="empanadas saladas"||n.tipo==="empanadas dulces"));t?m.value.push({...o,paste_id:t.id}):console.error(`No se encontró el paste ${o.nombre} en el inventario`)},i=o=>{m.value=m.value.filter(t=>t.id!==o)},x=o=>{z(o).catch(t=>{console.error(`Error al finalizar horneado desde timer: ${t}`)})},P=o=>{const t=$.value.find(h=>h.id===o);if(!t)return;const d=t.tiempoFin-Date.now();if(d<=0){x(o);return}t.tiempoTranscurrido=g.value-d,t.labeltime=s(d),t.timer&&clearInterval(t.timer),t.timer=setInterval(()=>{const h=t.tiempoFin-Date.now();if(h<=0){clearInterval(t.timer),x(o);return}t.tiempoTranscurrido=g.value-h,t.labeltime=s(h)},1e3)},M=o=>{const t=$.value.find(h=>h.id===o);if(!t)return;const d=t.tiempoFin-Date.now();if(d<=0){x(o);return}t.tiempoTranscurrido=g.value-d,t.labeltime=s(d),t.timer&&clearInterval(t.timer),t.timer=setInterval(()=>{const h=t.tiempoFin-Date.now();if(h<=0){clearInterval(t.timer),x(o);return}t.tiempoTranscurrido=g.value-h,t.labeltime=s(h)},1e3)};W(()=>{$.value.forEach(o=>{o.timer&&clearInterval(o.timer)}),$.value.forEach(o=>{if(o.estado){const t=Date.now()-new Date(o.tiempo_inicio).getTime(),n=g.value-t;if(n<=0){x(o.id);return}o.tiempoFin=Date.now()+n,M(o.id)}})});const O=()=>{X.post("/crear-horno",{estado:!1,pastesHorneando:[]},{preserverScroll:!0,preserveState:!1,onSuccess:o=>{var t;y.value=(t=o==null?void 0:o.props)==null?void 0:t.hornos,m.value=[],$.value=y.value.map(n=>({...n,horneando:n.estado||!1,pastesHorneando:n.pastesHorneando||[],tiempoInicio:n.tiempo_inicio?new Date(n.tiempo_inicio).getTime():0,tiempoFin:n.tiempo_fin?new Date(n.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),N.fire({icon:"success",title:"Horno creado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:o=>{console.error("Error al crear el horno:",o),N.fire({icon:"error",title:"Error al crear horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})},ee=o=>{X.post("/eliminar-horno",{horno_id:o},{preserveScroll:!0,preserveState:!1,onSuccess:t=>{var n;y.value=(n=t==null?void 0:t.props)==null?void 0:n.hornos,$.value=y.value.map(d=>({...d,horneando:d.estado||!1,pastesHorneando:d.pastesHorneando||[],tiempoInicio:d.tiempo_inicio?new Date(d.tiempo_inicio).getTime():0,tiempoFin:d.tiempo_fin?new Date(d.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),N.fire({icon:"success",title:"Horno eliminado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:t=>{console.error("Error al eliminar el horno:",t),N.fire({icon:"error",title:"Error al eliminar horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})};return(o,t)=>(l(),c(E,null,[e("div",Be,[e("div",Ie,[t[4]||(t[4]=e("h2",{class:"text-xl font-semibold mb-4"},"Ingredientes Disponibles",-1)),e("div",je,[t[2]||(t[2]=e("h3",{class:"text-lg font-medium mb-2"},"Masas",-1)),e("ul",Re,[(l(!0),c(E,null,T(V.value,n=>(l(),c("li",{key:n.id,class:"flex justify-between"},[e("span",Ue,r(n.nombre),1),e("span",Oe,r(n.cantidad)+" unidades",1)]))),128))])]),e("div",null,[t[3]||(t[3]=e("h3",{class:"text-lg font-medium mb-2"},"Rellenos",-1)),e("ul",Ze,[(l(!0),c(E,null,T(B.value,n=>(l(),c("li",{key:n.id,class:"flex justify-between"},[e("span",null,r(n.nombre),1),e("span",qe,r(n.cantidad)+" unidades",1)]))),128))])])]),e("div",Xe,[t[8]||(t[8]=e("h2",{class:"text-xl font-semibold mb-4"},"Crear Nuevo Paste/Empanada",-1)),e("form",{onSubmit:ne(_,["prevent"]),class:"space-y-4"},[e("div",null,[t[6]||(t[6]=e("label",{for:"relleno",class:"block text-sm font-medium text-gray-700"},"Seleccionar Relleno",-1)),U(e("select",{"onUpdate:modelValue":t[0]||(t[0]=n=>p.value.relleno=n),id:"relleno",required:"",class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md"},[t[5]||(t[5]=e("option",{value:""},"Seleccione un relleno",-1)),(l(!0),c(E,null,T(F.value,n=>(l(),c("option",{key:n.id,value:n.nombre},r(n.nombre),9,Je))),128))],512),[[K,p.value.relleno]])]),e("div",null,[t[7]||(t[7]=e("label",{for:"cantidad",class:"block text-sm font-medium text-gray-700"},"Cantidad",-1)),U(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>p.value.cantidad=n),type:"number",id:"cantidad",required:"",min:"1",max:L.value,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 sm:text-sm"},null,8,We),[[Y,p.value.cantidad,void 0,{number:!0}]])]),e("button",{type:"submit",disabled:!u.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Asignar Unidades ",8,Ge)],32)])]),e("div",Qe,[(l(!0),c(E,null,T($.value,(n,d)=>(l(),c("div",{key:n.id,class:"bg-white shadow rounded-lg p-6"},[e("div",Ke,[e("h2",Ye,"Horno "+r(d+1),1),!n.horneando&&y.value.length>1?(l(),c("button",{key:0,onClick:h=>ee(n.id),class:"flex items-center gap-2 bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"},[R(oe(ue),{class:"w-4 h-4"})],8,et)):I("",!0)]),n.horneando?(l(),c("div",tt,[t[9]||(t[9]=e("p",{class:"text-lg mb-2"},"Horneando grupo de pastes:",-1)),e("ul",null,[(l(!0),c(E,null,T(n.pastesHorneando,h=>(l(),c("li",{key:h.nombre},r(h.cantidad)+" "+r(h.nombre)+" - masa "+r(h.masa),1))),128))]),e("div",at,[e("div",{class:"bg-orange-600 h-2.5 rounded-full transition-all duration-100",style:ie({width:`${n.tiempoTranscurrido/g.value*100}%`})},null,4)]),e("p",null,"Tiempo restante: "+r(n.labeltime),1)])):(l(),c("div",ot,[t[10]||(t[10]=e("p",{class:"text-lg mb-4"},"El horno está disponible",-1)),e("button",{onClick:S,disabled:!m.value.length,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Iniciar Horneado de Grupo ",8,st)]))]))),128)),e("div",{class:"mt-4 h-full flex justify-center items-center"},[e("button",{onClick:O,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500"}," Crear Nuevo Horno ")])]),e("div",nt,[t[11]||(t[11]=e("h2",{class:"text-xl font-semibold mb-4"},"Grupos de Pastes por Hornear",-1)),m.value.length===0?(l(),c("div",it," No hay grupos de pastes en la cola de horneado ")):(l(),c("ul",rt,[(l(!0),c(E,null,T(m.value,n=>(l(),c("li",{key:n.id,class:"py-4 flex justify-between items-center"},[e("span",null,r(n.cantidad)+" "+r(n.nombre)+" - masa "+r(n.masa),1),e("button",{onClick:d=>i(n.id),class:"bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"}," Cancelar ",8,lt)]))),128))]))])],64))}},ct={key:0,class:"mt-8 bg-white shadow rounded-lg p-6"},ut={class:"flex justify-between items-center mb-4"},pt={class:"flex items-center space-x-4"},mt={class:"flex items-center space-x-2"},ft={class:"flex items-center space-x-2"},vt=["value"],xt={class:"mb-6"},gt={class:"overflow-x-auto"},ht={class:"min-w-full divide-y divide-gray-200"},yt={class:"bg-white divide-y divide-gray-200"},_t={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 capitalize"},bt={class:"text-xs text-gray-500 block capitalize"},wt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},$t={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Dt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ht={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize"},kt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ct={class:"px-6 py-4 whitespace-nowrap"},St={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Mt={class:"mb-6"},Et={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Tt={class:"font-medium"},Pt={class:"mt-8"},Ft={class:"overflow-x-auto"},Lt={class:"min-w-full divide-y divide-gray-200"},zt={class:"bg-white divide-y divide-gray-200"},Nt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},At={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Vt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Bt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},It={class:"px-6 py-4 whitespace-nowrap capitalize"},jt={__name:"ControlProduccion",setup(w){const{props:v}=q();H([]);const C=H([]),y=H([]);H([]);const $=b(()=>v.auth.user.roles[0].name==="admin");console.log($.value);const g=H(new Date().toISOString().split("T")[0]),m=H("actual"),S=H([{value:"todas",label:"Todas las horas"},{value:"actual",label:"Hora Actual"},{value:"9-am",label:"9:00 AM"},{value:"10-am",label:"10:00 AM"},{value:"11-am",label:"11:00 AM"},{value:"12-pm",label:"12:00 PM"},{value:"1-pm",label:"1:00 PM"},{value:"2-pm",label:"2:00 PM"},{value:"3-pm",label:"3:00 PM"},{value:"4-pm",label:"4:00 PM"},{value:"5-pm",label:"5:00 PM"},{value:"6-pm",label:"6:00 PM"},{value:"7-pm",label:"7:00 PM"},{value:"8-pm",label:"8:00 PM"},{value:"9-pm",label:"9:00 PM"}]),f=u=>{const s=new Date(u),a=s.getHours();s.getMinutes();const i=a>=12?"pm":"am";return`${a%12||12}-${i}`},z=()=>{const u=new Date(g.value+"T00:00:00-06:00"),s=new Date(g.value+"T23:59:59-06:00");return{inicio:u,fin:s}},k=u=>{const s=z();if(!s)return!0;const a=new Date(u),i=new Date(a.toLocaleString("en-US",{timeZone:"America/Mexico_City"})),x=new Date(s.inicio.toLocaleString("en-US",{timeZone:"America/Mexico_City"})),P=new Date(s.fin.toLocaleString("en-US",{timeZone:"America/Mexico_City"}));return i>=x&&i<=P},A=()=>{const u=new Date,s=new Date(u.toLocaleString("en-US",{timeZone:"America/Mexico_City"}));g.value=s.toISOString().split("T")[0]},F=u=>{if(u.estado==="pendiente")return"pendiente";const a=f(new Date);return f(u.created_at)!==a?"desperdicio":u.estado},V=b(()=>{var a;if(!((a=v.notificaciones)!=null&&a.faltantes))return[];let s=v.notificaciones.faltantes.map(i=>({id:i.id,paste:i.paste,cantidad:i.cantidad,hora_notificacion:i.hora_notificacion,dia_notificacion:i.dia_notificacion,estado:F(i),tiempo_inicio_horneado:i.tiempo_inicio_horneado,hora_ultima_venta:i.hora_ultima_venta,cantidad_vendida:i.cantidad_vendida,diferencia_notificacion_inicio:i.diferencia_notificacion_inicio,created_at:i.created_at,cantidad_horneada:i.cantidad_horneada})).filter(i=>k(i.created_at));if(m.value==="todas")return s;if(m.value==="actual"){const x=f(new Date);return s.filter(P=>f(P.created_at)===x)}return s.filter(i=>f(i.created_at)===m.value)}),B=b(()=>{var u;return(u=v.notificaciones)!=null&&u.faltantes?v.notificaciones.faltantes.map(s=>({id:s.id,paste:s.paste,cantidad:s.cantidad,hora_notificacion:s.hora_notificacion,dia_notificacion:s.dia_notificacion,estado:s.estado,tiempo_inicio_horneado:s.tiempo_inicio_horneado,hora_ultima_venta:s.hora_ultima_venta,cantidad_vendida:s.cantidad_vendida,diferencia_notificacion_inicio:s.diferencia_notificacion_inicio,created_at:s.created_at})):[]});b(()=>{var u;return(u=v.notificaciones)!=null&&u.horneados?v.notificaciones.horneados:[]});const p=b(()=>B.value.map(s=>({paste:s.paste.nombre,recomendacion:"Producir",razon:`Faltan ${s.cantidad} unidades para las ${s.hora_notificacion}`})));Q(()=>{var u;return(u=v.notificaciones)==null?void 0:u.faltantes},u=>{u&&(y.value=p.value)},{immediate:!0});const D=u=>u?new Date(u).toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:"America/Mexico_City"}):"-",_=u=>`px-2 py-1 rounded-full text-xs font-medium ${{horneando:"bg-yellow-100 text-yellow-800 capitalize",retirado:"bg-blue-100 text-blue-800 capitalize",vendido:"bg-green-100 text-green-800 capitalize",desperdicio:"bg-red-100 text-red-800 capitalize",pendiente:"bg-gray-100 text-gray-800 capitalize",en_espera:"bg-green-100 text-green-800"}[u]}`,L=b(()=>{var a;if(!((a=v.notificaciones)!=null&&a.horneados))return[];let s=v.notificaciones.horneados.filter(i=>k(i.created_at));if(m.value==="todas")return s;if(m.value==="actual"){const x=f(new Date);return s.filter(P=>f(P.created_at)===x)}return s.filter(i=>f(i.created_at)===m.value)});return W(()=>{A()}),(u,s)=>$.value?(l(),c("div",ct,[e("div",ut,[s[4]||(s[4]=e("h2",{class:"text-xl font-semibold"},"Control de Producción",-1)),e("div",pt,[e("div",mt,[s[2]||(s[2]=e("label",{for:"fecha",class:"text-sm font-medium text-gray-700"},"Seleccionar día:",-1)),U(e("input",{type:"date",id:"fecha","onUpdate:modelValue":s[0]||(s[0]=a=>g.value=a),class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},null,512),[[Y,g.value]])]),e("div",ft,[s[3]||(s[3]=e("label",{for:"hora",class:"text-sm font-medium text-gray-700"},"Filtrar por hora:",-1)),U(e("select",{id:"hora","onUpdate:modelValue":s[1]||(s[1]=a=>m.value=a),class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[(l(!0),c(E,null,T(S.value,a=>(l(),c("option",{key:a.value,value:a.value},r(a.label),9,vt))),128))],512),[[K,m.value]])])])]),e("div",xt,[s[6]||(s[6]=e("h3",{class:"text-lg font-medium mb-2"},"Productos Faltantes",-1)),e("div",gt,[e("table",ht,[s[5]||(s[5]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Producto"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Faltante"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Horneada"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Vendida"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Día"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora Requerida"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Última Venta")])],-1)),e("tbody",yt,[(l(!0),c(E,null,T(V.value,a=>(l(),c("tr",{key:a.id,class:"hover:bg-gray-50"},[e("td",_t,[J(r(a.paste.nombre)+" ",1),e("span",bt,r(a.paste.tipo),1)]),e("td",wt,r(a.cantidad)+" unidades ",1),e("td",$t,r(a.cantidad_horneada?`${a.cantidad_horneada} unidades`:"-"),1),e("td",Dt,r(a.cantidad_vendida?`${a.cantidad_vendida} unidades`:"-"),1),e("td",Ht,r(a.dia_notificacion),1),e("td",kt,r(D(a.created_at)),1),e("td",Ct,[e("span",{class:Z(["px-2 py-1 text-xs font-medium rounded-full",a.estado==="pendiente"?"bg-red-100 text-red-800":a.estado==="horneando"?"bg-yellow-100 text-yellow-800":a.estado==="desperdicio"?"bg-red-100 text-red-800":"bg-green-100 text-green-800"])},r(a.estado==="pendiente"?"Sin hornear":a.estado==="desperdicio"?"Desperdicio":a.estado),3)]),e("td",St,r(a.estado==="pendiente"?"-":a.hora_ultima_venta?D(a.hora_ultima_venta):"Sin ventas"),1)]))),128))])])])]),e("div",Mt,[s[7]||(s[7]=e("h3",{class:"text-lg font-medium mb-2"},"Tiempo de Reposición",-1)),e("div",Et,[(l(!0),c(E,null,T(C.value,(a,i)=>(l(),c("div",{key:i,class:"bg-gray-50 p-4 rounded-lg"},[e("p",Tt,r(a.paste),1),e("p",null,"Tiempo promedio: "+r(a.promedio)+" minutos",1),e("p",null,"Última reposición: "+r(a.ultima),1)]))),128))])]),e("div",Pt,[s[9]||(s[9]=e("h3",{class:"text-lg font-medium mb-2"},"Control de Tiempo de Producción",-1)),e("div",Ft,[e("table",Lt,[s[8]||(s[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Paste"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de notificación"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de Producción"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo en meter producción"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado")])],-1)),e("tbody",zt,[(l(!0),c(E,null,T(L.value,a=>(l(),c("tr",{key:a.id},[e("td",Nt,r(a.paste.nombre),1),e("td",At,r(D(a.created_at)),1),e("td",Vt,r(D(a.tiempo_inicio_horneado)),1),e("td",Bt,r(Math.round((new Date(a.diferencia_notificacion_inicio)-new Date(a.created_at))/6e4))+" min",1),e("td",It,[e("span",{class:Z(_(a.estado))},r(a.estado),3)])]))),128))])])])])])):I("",!0)}},Rt={class:"animate-pulse"},Ut={key:0,class:"mt-2"},Ot={class:"font-bold"},ae={__name:"NotificationPanel",props:{notifications:{type:Array,required:!0},isVisible:{type:Boolean,default:!1},type:{type:String,required:!0,validator:w=>["warning","info"].includes(w)},title:{type:String,required:!0}},emits:["toggle"],setup(w){return(v,C)=>(l(),c("div",{class:Z(["p-4 border rounded shadow mb-4 size-fit cursor-pointer",{"bg-yellow-100":w.type==="warning","bg-blue-100":w.type==="info"}]),onClick:C[0]||(C[0]=y=>v.$emit("toggle"))},[e("h2",{class:Z(["text-lg font-bold text-center",{"text-yellow-800":w.type==="warning","text-blue-800":w.type==="info"}])},[J(r(w.type==="warning"?"⚠️":"ℹ️")+" "+r(w.title)+" ",1),e("span",Rt,"("+r(w.notifications.length)+")",1),J(" "+r(w.type==="warning"?"⚠️":"ℹ️"),1)],2),w.isVisible?(l(),c("ul",Ut,[(l(!0),c(E,null,T(w.notifications,y=>(l(),c("li",{key:y.id,class:"mb-2"},[e("span",null,[e("span",Ot,r(y.nombre),1),J(": "+r(w.type==="warning"?"Faltan":"Hay")+" "+r(w.type==="warning"?Math.abs(y.diferencia):y.diferencia)+" unidades para las "+r(y.hora)+" ",1),e("span",{class:Z(["text-sm",{"text-red-600":w.type==="warning","text-green-600":w.type==="info"}])}," ("+r(y.porcentaje)+"% del estimado) ",3)])]))),128))])):I("",!0)],2))}},Zt={class:"container mx-auto p-4"},qt={class:"sm:flex justify-between flex-row text-sm"},Xt={class:"flex gap-3 sm:flex-row flex-col"},Jt={class:"mt-6"},Wt={__name:"Hornear",setup(w){const v=H(!1),C=H(!1),y=H(null),$=H(null),{props:g}=q(),m=b(()=>g.auth.user.roles[0].name==="admin"),S=b(()=>g.inventario||[]),f=b(()=>g.estimacionesHoy||[]),z=()=>{const s=new Date;return{day:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"][s.getDay()].toLowerCase(),hour:s.getHours(),minutes:s.getMinutes()}},k=H(z());Q(()=>k.value.hour,s=>{s!==y.value&&(y.value=s,D.value.length>0&&(v.value=!0),_.value.length>0&&(C.value=!0))}),W(()=>{y.value=k.value.hour,$.value=setInterval(()=>{k.value=z()},1e3)}),re(()=>{$.value&&clearInterval($.value)});const A=s=>{const[a,i]=s.toLowerCase().split(" ");let[x,P]=a.split(":").map(Number);return{hours:i==="pm"&&x!==12?x+12:i==="am"&&x===12?0:x,minutes:P}},F=b(()=>S.value.filter(s=>{var a;return["pastes","empanadas dulces","empanadas saladas"].includes((a=s.tipo)==null?void 0:a.toLowerCase())})),V=b(()=>{if(!f.value.length||!F.value.length)return console.log("No hay estimaciones o productos relevantes"),[];const s=new Map(F.value.map(i=>[i.id,i]));return f.value.map(i=>{const x=s.get(i.inventario_id);if(!x)return null;const{hours:P}=A(i.hora);return{id:`${x.id}-${i.hora}`,nombre:x.nombre,estimado:i.cantidad,existente:x.cantidad,diferencia:x.cantidad-i.cantidad,hora:i.hora,dia:i.dia.toLowerCase(),horaEnNumero:P,tipo:x.tipo}}).filter(Boolean).filter((i,x,P)=>x===P.findIndex(M=>M.id===i.id))}),B=b(()=>V.value.filter(a=>a.dia===k.value.day)),p=b(()=>{const a=(k.value.hour+1)%24,i=B.value.filter(M=>M.horaEnNumero===a),x=new Map(i.map(M=>[M.nombre,M]));return F.value.map(M=>{const O=x.get(M.nombre);return O||{id:`${M.id}-${a}:00`,nombre:M.nombre,estimado:0,existente:M.cantidad,diferencia:M.cantidad,hora:`${a}:00`,dia:k.value.day,horaEnNumero:a,tipo:M.tipo}})}),D=b(()=>p.value.filter(a=>a.estimado>0&&a.diferencia<0).map(a=>({...a,porcentaje:a.estimado>0?Math.round(a.existente/a.estimado*100):0}))),_=b(()=>p.value.filter(a=>a.estimado>0&&a.diferencia>0||a.estimado===0&&a.existente>0).map(a=>({...a,porcentaje:a.estimado>0?Math.round(a.existente/a.estimado*100):100}))),L=()=>v.value=!v.value,u=()=>C.value=!C.value;return(s,a)=>(l(),c("div",Zt,[e("div",qt,[a[0]||(a[0]=e("h1",{class:"text-2xl font-bold mb-4"},"Sistema de Horneado",-1)),e("div",Xt,[R(ae,{notifications:D.value,"is-visible":v.value,type:"warning",title:"Faltantes",onToggle:L},null,8,["notifications","is-visible"]),R(ae,{notifications:_.value,"is-visible":C.value,type:"info",title:"Excedentes",onToggle:u},null,8,["notifications","is-visible"])])]),e("div",Jt,[R(dt),R(jt),oe(g).user.roles[0]!=="supervisor"?(l(),G(De,{key:0})):I("",!0),m.value?(l(),G(Ve,{key:1})):I("",!0)])]))}},Gt={class:"py-6"},Qt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 rounded-xl overflow-hidden"},Kt={class:"flex justify-between p-6 lg:p-8 bg-white border-b border-gray-200 rounded-2xl"},oa={__name:"index",setup(w){return(v,C)=>(l(),G(se,{title:"Tablero principal"},{default:le(()=>[e("div",Gt,[e("div",Qt,[e("div",Kt,[R(Wt)])])])]),_:1}))}};export{oa as default};
