import{Q as B,d as i,s as M,x as N,c as O,w as U,o as n,a as e,g as C,j as _,k as D,l as A,e as u,h as T,F as j,t as l,n as b,f as g,y as H}from"./app-rvPNrf7l.js";import{_ as L}from"./AppLayout-DnASnLZc.js";import{C as m,r as E}from"./chart-BZcJGg0T.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"py-6"},$={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 p-2 md:p-8"},z={class:"bg-white overflow-hidden shadow-xl rounded-xl p-6"},Q={class:"bg-gray-50 p-4 rounded-lg mb-6"},q={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},G=["value"],J={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},K={class:"bg-green-50 border border-green-200 rounded-lg p-4"},W={class:"text-3xl font-bold text-green-800"},X={class:"bg-amber-50 border border-amber-200 rounded-lg p-4"},Y={class:"text-3xl font-bold text-amber-800"},Z={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},ee={class:"bg-white border border-gray-200 rounded-lg p-4"},te={key:0,class:"text-center text-gray-400 py-4 text-sm"},se={class:"bg-white border border-gray-200 rounded-lg p-4"},oe={key:0,class:"text-center text-gray-400 py-4 text-sm"},ae={class:"bg-white border border-gray-200 rounded-lg p-4 mb-6"},re={key:0,class:"text-center text-gray-400 py-4 text-sm"},le={class:"overflow-x-auto"},ne={class:"min-w-full bg-white border border-gray-200 rounded-lg"},de={class:"px-4 py-3 border-b text-sm"},ie={class:"px-4 py-3 border-b"},ue={class:"px-4 py-3 border-b text-sm"},ce={class:"px-4 py-3 border-b text-sm font-medium"},pe={class:"px-4 py-3 border-b text-sm"},be={class:"px-4 py-3 border-b text-sm"},ge={key:0},ye={__name:"HojaCorte",setup(me){var w,k,S;m.register(...E);const{props:d}=B(),y=i(d.movimientos||[]),c=i(d.resumen||{total_ingresos:0,total_salidas:0,balance:0}),a=i(d.graficas||{por_dia:[],top_productos:[],por_sucursal:[]}),F=i(d.sucursales||[]),r=i({fecha_inicio:((w=d.filtros)==null?void 0:w.fecha_inicio)||new Date().toISOString().split("T")[0],fecha_fin:((k=d.filtros)==null?void 0:k.fecha_fin)||new Date().toISOString().split("T")[0],sucursal_id:((S=d.filtros)==null?void 0:S.sucursal_id)||""}),x=i(null),f=i(null),v=i(null);let p={};const P=()=>{H.get("/almacen/hoja-corte",r.value,{preserveScroll:!0})},V=()=>{const s=new URLSearchParams({fecha_inicio:r.value.fecha_inicio,fecha_fin:r.value.fecha_fin,...r.value.sucursal_id?{sucursal_id:r.value.sucursal_id}:{}});window.location.href=`/almacen/hoja-corte/export?${s.toString()}`},h=()=>{Object.values(p).forEach(s=>s.destroy()),p={},x.value&&a.value.por_dia.length>0&&(p.porDia=new m(x.value,{type:"line",data:{labels:a.value.por_dia.map(s=>s.fecha),datasets:[{label:"Ingresos",data:a.value.por_dia.map(s=>s.ingresos),borderColor:"#10b981",backgroundColor:"rgba(16,185,129,0.1)",tension:.3,fill:!0},{label:"Salidas",data:a.value.por_dia.map(s=>s.salidas),borderColor:"#f59e0b",backgroundColor:"rgba(245,158,11,0.1)",tension:.3,fill:!0}]},options:{responsive:!0,plugins:{legend:{position:"top"}}}})),f.value&&a.value.top_productos.length>0&&(p.topProductos=new m(f.value,{type:"bar",data:{labels:a.value.top_productos.map(s=>s.producto),datasets:[{label:"Cantidad total",data:a.value.top_productos.map(s=>s.total),backgroundColor:"#6366f1"}]},options:{responsive:!0,indexAxis:"y",plugins:{legend:{display:!1}}}})),v.value&&a.value.por_sucursal.length>0&&(p.porSucursal=new m(v.value,{type:"bar",data:{labels:a.value.por_sucursal.map(s=>s.sucursal),datasets:[{label:"Salidas",data:a.value.por_sucursal.map(s=>s.total),backgroundColor:"#f59e0b"}]},options:{responsive:!0,plugins:{legend:{display:!1}}}}))};return M(()=>{h()}),N(()=>d.graficas,s=>{a.value=s,h()}),(s,t)=>(n(),O(L,{title:"Hoja de Corte Almacén"},{default:U(()=>[e("div",R,[e("div",$,[e("div",z,[t[14]||(t[14]=e("h1",{class:"text-2xl font-bold mb-6 text-gray-800"},"Hoja de Corte - Almacén",-1)),e("div",Q,[e("div",q,[e("div",null,[t[3]||(t[3]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 inline-flex items-center gap-1"},[C(" Fecha Inicio "),e("span",{title:"Rango de fechas para ver movimientos de inventario",class:"inline-flex items-center justify-center w-4 h-4 text-xs font-bold text-white bg-gray-400 rounded-full cursor-help"},"?")],-1)),_(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=o=>r.value.fecha_inicio=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},null,512),[[D,r.value.fecha_inicio]])]),e("div",null,[t[4]||(t[4]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha Fin",-1)),_(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=o=>r.value.fecha_fin=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},null,512),[[D,r.value.fecha_fin]])]),e("div",null,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 inline-flex items-center gap-1"},[C(" Sucursal (salidas) "),e("span",{title:"Filtra las salidas por sucursal de destino. Los ingresos siempre muestran los del almacén",class:"inline-flex items-center justify-center w-4 h-4 text-xs font-bold text-white bg-gray-400 rounded-full cursor-help"},"?")],-1)),_(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>r.value.sucursal_id=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},[t[5]||(t[5]=e("option",{value:""},"Todas las sucursales",-1)),(n(!0),u(j,null,T(F.value,o=>(n(),u("option",{key:o.id,value:o.id},l(o.nombre),9,G))),128))],512),[[A,r.value.sucursal_id]])]),e("div",{class:"flex items-end gap-2"},[e("button",{onClick:P,class:"flex-1 bg-orange-500 text-white px-4 py-2 rounded-md hover:bg-orange-600 transition-colors"}," Filtrar "),e("button",{onClick:V,class:"flex-1 bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors"}," Descargar CSV ")])])]),e("div",J,[e("div",K,[t[7]||(t[7]=e("div",{class:"text-sm text-green-600 font-medium"},"Total Ingresos",-1)),e("div",W,l(c.value.total_ingresos),1)]),e("div",X,[t[8]||(t[8]=e("div",{class:"text-sm text-amber-600 font-medium"},"Total Salidas",-1)),e("div",Y,l(c.value.total_salidas),1)]),e("div",{class:b([c.value.balance>=0?"bg-blue-50 border-blue-200":"bg-red-50 border-red-200","border rounded-lg p-4"])},[e("div",{class:b([c.value.balance>=0?"text-blue-600":"text-red-600","text-sm font-medium"])},"Balance",2),e("div",{class:b([c.value.balance>=0?"text-blue-800":"text-red-800","text-3xl font-bold"])},l(c.value.balance),3)],2)]),e("div",Z,[e("div",ee,[t[9]||(t[9]=e("h3",{class:"font-semibold text-gray-700 mb-2"},"Movimientos por Día",-1)),e("canvas",{ref_key:"chartPorDia",ref:x},null,512),a.value.por_dia.length===0?(n(),u("p",te,"Sin datos")):g("",!0)]),e("div",se,[t[10]||(t[10]=e("h3",{class:"font-semibold text-gray-700 mb-2"},"Top Productos",-1)),e("canvas",{ref_key:"chartTopProductos",ref:f},null,512),a.value.top_productos.length===0?(n(),u("p",oe,"Sin datos")):g("",!0)])]),e("div",ae,[t[11]||(t[11]=e("h3",{class:"font-semibold text-gray-700 mb-2"},"Distribución por Sucursal Destino",-1)),e("canvas",{ref_key:"chartPorSucursal",ref:v,style:{"max-height":"250px"}},null,512),a.value.por_sucursal.length===0?(n(),u("p",re,"Sin datos")):g("",!0)]),e("div",le,[e("table",ne,[t[13]||(t[13]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Fecha"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Tipo"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Producto"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Cantidad"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Origen/Destino"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Trabajador")])],-1)),e("tbody",null,[(n(!0),u(j,null,T(y.value,(o,I)=>(n(),u("tr",{key:I,class:"hover:bg-gray-50 transition-colors"},[e("td",de,l(o.fecha),1),e("td",ie,[e("span",{class:b([o.tipo==="Ingreso"?"bg-green-100 text-green-800":"bg-amber-100 text-amber-800","px-2 py-1 text-xs font-medium rounded-full"])},l(o.tipo),3)]),e("td",ue,l(o.producto),1),e("td",ce,l(o.cantidad),1),e("td",pe,l(o.origen_destino),1),e("td",be,l(o.trabajador),1)]))),128)),y.value.length===0?(n(),u("tr",ge,t[12]||(t[12]=[e("td",{colspan:"6",class:"px-4 py-8 text-center text-gray-500"}," No se encontraron movimientos para el periodo seleccionado ",-1)]))):g("",!0)])])])])])])]),_:1}))}};export{ye as default};
