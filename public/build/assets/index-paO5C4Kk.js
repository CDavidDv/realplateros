import{d as p,s as ut,x as it,c as xt,w as pt,o as l,a as t,j,k as rt,l as gt,e as d,h as F,F as E,t as o,f as v,p as mt,y as ft,n as _}from"./app-BgiExzjV.js";import{_ as bt}from"./AppLayout-7fJ73Oua.js";import{C as S,r as yt}from"./chart-BZcJGg0T.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ht={class:"py-6 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto"},vt={class:"bg-white rounded-lg shadow p-4 mb-6"},_t={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},wt=["value"],kt={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},Ct={class:"bg-gradient-to-br from-yellow-400 to-orange-500 rounded-lg shadow p-4 text-white"},jt={class:"flex items-center justify-between"},Ft={class:"text-xl font-bold truncate"},Et={class:"text-sm opacity-90"},St={class:"bg-gradient-to-br from-blue-400 to-blue-600 rounded-lg shadow p-4 text-white"},Vt={class:"flex items-center justify-between"},Dt={class:"text-xl font-bold truncate"},Bt={class:"text-sm opacity-90"},Mt={class:"bg-gradient-to-br from-red-400 to-red-600 rounded-lg shadow p-4 text-white"},At={class:"flex items-center justify-between"},Ht={class:"text-xl font-bold truncate"},Nt={class:"text-sm opacity-90"},Pt={class:"bg-gradient-to-br from-purple-400 to-purple-600 rounded-lg shadow p-4 text-white"},$t={class:"flex items-center justify-between"},It={class:"text-xl font-bold"},Rt={class:"text-sm opacity-90"},Tt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6"},zt={class:"bg-white rounded-lg shadow p-4"},Lt={class:"h-80"},Ot={class:"bg-white rounded-lg shadow p-4"},Ut={class:"h-80"},Gt={class:"bg-white rounded-lg shadow overflow-hidden"},Wt={class:"overflow-x-auto"},Zt={class:"min-w-full divide-y divide-gray-200"},qt={class:"bg-white divide-y divide-gray-200"},Jt={class:"px-4 py-3 whitespace-nowrap"},Kt={class:"px-4 py-3 whitespace-nowrap"},Qt={class:"text-sm font-medium text-gray-900"},Xt={class:"text-xs text-gray-500"},Yt={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-700"},te={class:"px-4 py-3 whitespace-nowrap text-center"},ee={class:"px-4 py-3 whitespace-nowrap text-center text-sm text-gray-700"},se={class:"px-4 py-3 whitespace-nowrap text-center text-sm text-gray-700"},oe={class:"px-4 py-3 whitespace-nowrap text-center text-sm text-gray-700"},ae={class:"px-4 py-3 whitespace-nowrap text-center text-sm text-gray-700"},ne={class:"px-4 py-3 whitespace-nowrap text-center"},ie=["onClick"],re={key:0},le={class:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},de={class:"px-6 py-4 border-b border-gray-200 flex justify-between items-center"},ce={class:"text-lg font-semibold text-gray-900"},ue={key:0,class:"p-6"},xe={class:"mb-6"},pe={class:"text-gray-600"},ge={class:"text-gray-600"},me={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"},fe={class:"bg-gray-50 rounded-lg p-3 text-center"},be={class:"text-2xl font-bold text-indigo-600"},ye={class:"bg-gray-50 rounded-lg p-3 text-center"},he={class:"text-2xl font-bold text-blue-600"},ve={class:"bg-gray-50 rounded-lg p-3 text-center"},_e={class:"text-2xl font-bold text-red-600"},we={class:"bg-gray-50 rounded-lg p-3 text-center"},ke={class:"text-2xl font-bold text-purple-600"},Ce={class:"max-h-64 overflow-y-auto"},je={class:"text-sm font-medium text-gray-900"},Fe={class:"text-xs text-gray-500"},Ee={class:"text-xs text-gray-400"},Se={key:0,class:"text-gray-500 text-center py-4"},He={__name:"index",props:{ranking:Array,mejores:Object,estadisticas:Object,configuracion:Array,sucursales:Array,filtros:Object},setup(n){var N,P,$;S.register(...yt);const c=n,m=p(((N=c.filtros)==null?void 0:N.fecha_inicio)||""),f=p(((P=c.filtros)==null?void 0:P.fecha_fin)||""),b=p((($=c.filtros)==null?void 0:$.sucursal_id)||""),V=p(null),D=p(null);let w=null,k=null;const i=p(null),C=p(!1),lt=()=>{ft.get(route("evaluacion-empleados"),{fecha_inicio:m.value,fecha_fin:f.value,sucursal_id:b.value||void 0},{preserveState:!0,preserveScroll:!0})},dt=async a=>{try{const r=await(await fetch(`/evaluacion-empleados/${a}?fecha_inicio=${m.value}&fecha_fin=${f.value}`)).json();r.success&&(i.value=r,C.value=!0)}catch(e){console.error("Error al obtener detalle:",e)}},B=()=>{C.value=!1,i.value=null},ct=()=>{const a=new URLSearchParams({fecha_inicio:m.value,fecha_fin:f.value});b.value&&a.append("sucursal_id",b.value),window.location.href=`/evaluacion-empleados/exportar?${a.toString()}`},M=()=>{var r,x;w&&w.destroy();const a=(r=V.value)==null?void 0:r.getContext("2d");if(!a||!((x=c.ranking)!=null&&x.length))return;const e=c.ranking.slice(0,10);w=new S(a,{type:"bar",data:{labels:e.map(u=>u.nombre.split(" ")[0]),datasets:[{label:"Puntos Totales",data:e.map(u=>u.total_puntos),backgroundColor:["#FFD700","#C0C0C0","#CD7F32","#4F46E5","#4F46E5","#4F46E5","#4F46E5","#4F46E5","#4F46E5","#4F46E5"],borderRadius:8}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"Top 10 Empleados",font:{size:16,weight:"bold"}}},scales:{y:{beginAtZero:!0}}}})},A=()=>{var y,h;k&&k.destroy();const a=(y=D.value)==null?void 0:y.getContext("2d");if(!a||!((h=c.estadisticas)!=null&&h.puntos_por_concepto))return;const e=Object.entries(c.estadisticas.puntos_por_concepto),r=e.map(([g])=>H(g)),x=e.map(([,g])=>Math.abs(g.total)),u=["#10B981","#3B82F6","#F59E0B","#8B5CF6","#EC4899","#EF4444","#6366F1"];k=new S(a,{type:"doughnut",data:{labels:r,datasets:[{data:x,backgroundColor:u.slice(0,r.length),borderWidth:2,borderColor:"#fff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:15}},title:{display:!0,text:"Distribucion por Concepto",font:{size:16,weight:"bold"}}}}})},H=a=>({check_in:"Check-in",venta:"Ventas",horneado:"Horneados",notificacion_atendida:"Notif. Atendidas",notificacion_no_atendida:"Notif. No Atendidas",sobrante:"Sobrantes",corte_caja:"Corte Caja"})[a]||a;return ut(()=>{M(),A()}),it(()=>c.ranking,()=>{M()},{deep:!0}),it(()=>c.estadisticas,()=>{A()},{deep:!0}),(a,e)=>(l(),xt(bt,{title:"Evaluacion de Empleados"},{default:pt(()=>{var r,x,u,y,h,g,I,R,T,z,L,O,U,G,W,Z,q,J,K,Q,X,Y,tt,et,st,ot,at,nt;return[t("div",ht,[e[24]||(e[24]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-gray-900"},"Evaluacion de Empleados"),t("p",{class:"text-gray-600"},"Sistema de puntos para medir desempeno del personal")],-1)),t("div",vt,[t("div",_t,[t("div",null,[e[3]||(e[3]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha Inicio",-1)),j(t("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=s=>m.value=s),class:"w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[rt,m.value]])]),t("div",null,[e[4]||(e[4]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha Fin",-1)),j(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=s=>f.value=s),class:"w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[rt,f.value]])]),t("div",null,[e[6]||(e[6]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Sucursal",-1)),j(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>b.value=s),class:"w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},[e[5]||(e[5]=t("option",{value:""},"Todas las sucursales",-1)),(l(!0),d(E,null,F(n.sucursales,s=>(l(),d("option",{key:s.id,value:s.id},o(s.nombre),9,wt))),128))],512),[[gt,b.value]])]),t("div",{class:"flex items-end gap-2"},[t("button",{onClick:lt,class:"flex-1 bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition"}," Filtrar "),t("button",{onClick:ct,class:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition"}," CSV ")])])]),t("div",kt,[t("div",Ct,[t("div",jt,[t("div",null,[e[7]||(e[7]=t("p",{class:"text-sm opacity-90"},"Mejor Empleado",-1)),t("p",Ft,o(((x=(r=n.mejores)==null?void 0:r.mejor_general)==null?void 0:x.nombre)||"-"),1),t("p",Et,o(((y=(u=n.mejores)==null?void 0:u.mejor_general)==null?void 0:y.total_puntos)||0)+" puntos ",1)]),e[8]||(e[8]=t("div",{class:"text-4xl"},"ðŸ†",-1))])]),t("div",St,[t("div",Vt,[t("div",null,[e[9]||(e[9]=t("p",{class:"text-sm opacity-90"},"Mas Ventas",-1)),t("p",Dt,o(((g=(h=n.mejores)==null?void 0:h.mas_ventas)==null?void 0:g.nombre)||"-"),1),t("p",Bt,o(((R=(I=n.mejores)==null?void 0:I.mas_ventas)==null?void 0:R.total_ventas)||0)+" ventas ",1)]),e[10]||(e[10]=t("div",{class:"text-4xl"},"ðŸ’°",-1))])]),t("div",Mt,[t("div",At,[t("div",null,[e[11]||(e[11]=t("p",{class:"text-sm opacity-90"},"Mas Horneados",-1)),t("p",Ht,o(((z=(T=n.mejores)==null?void 0:T.mas_horneados)==null?void 0:z.nombre)||"-"),1),t("p",Nt,o(((O=(L=n.mejores)==null?void 0:L.mas_horneados)==null?void 0:O.total_horneados)||0)+" lotes ",1)]),e[12]||(e[12]=t("div",{class:"text-4xl"},"ðŸ”¥",-1))])]),t("div",Pt,[t("div",$t,[t("div",null,[e[13]||(e[13]=t("p",{class:"text-sm opacity-90"},"Promedio Horas",-1)),t("p",It,o(((U=n.estadisticas)==null?void 0:U.promedio_horas_trabajadas)||0)+"h ",1),t("p",Rt,o(((G=n.estadisticas)==null?void 0:G.total_empleados)||0)+" empleados ",1)]),e[14]||(e[14]=t("div",{class:"text-4xl"},"ðŸ•‘",-1))])])]),t("div",Tt,[t("div",zt,[t("div",Lt,[t("canvas",{ref_key:"barChart",ref:V},null,512)])]),t("div",Ot,[t("div",Ut,[t("canvas",{ref_key:"pieChart",ref:D},null,512)])])]),t("div",Gt,[e[17]||(e[17]=t("div",{class:"px-4 py-3 border-b border-gray-200"},[t("h3",{class:"text-lg font-semibold text-gray-900"},"Ranking de Empleados")],-1)),t("div",Wt,[t("table",Zt,[e[16]||(e[16]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"#"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Empleado"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Sucursal"),t("th",{class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase"},"Puntos"),t("th",{class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase"},"Ventas"),t("th",{class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase"},"Horneados"),t("th",{class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase"},"Notif."),t("th",{class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase"},"Horas"),t("th",{class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase"},"Acciones")])],-1)),t("tbody",qt,[(l(!0),d(E,null,F(n.ranking,s=>(l(),d("tr",{key:s.user_id,class:_({"bg-yellow-50":s.posicion===1,"bg-gray-50":s.posicion===2,"bg-orange-50":s.posicion===3})},[t("td",Jt,[t("span",{class:_({"text-yellow-600 font-bold text-lg":s.posicion===1,"text-gray-500 font-semibold":s.posicion===2,"text-orange-600 font-semibold":s.posicion===3,"text-gray-700":s.posicion>3})},o(s.posicion===1?"ðŸ†":s.posicion===2?"ðŸ¥ˆ":s.posicion===3?"ðŸ¥‰":s.posicion),3)]),t("td",Kt,[t("div",Qt,o(s.nombre),1),t("div",Xt,o(s.email),1)]),t("td",Yt,o(s.sucursal),1),t("td",te,[t("span",{class:_(["px-2 py-1 text-sm font-semibold rounded-full",s.total_puntos>=0?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},o(s.total_puntos),3)]),t("td",ee,o(s.total_ventas),1),t("td",se,o(s.total_horneados),1),t("td",oe,o(s.notificaciones_atendidas),1),t("td",ae,o(s.horas_trabajadas)+"h ",1),t("td",ne,[t("button",{onClick:Ve=>dt(s.user_id),class:"text-indigo-600 hover:text-indigo-900 text-sm font-medium"}," Ver detalle ",8,ie)])],2))),128)),(W=n.ranking)!=null&&W.length?v("",!0):(l(),d("tr",re,e[15]||(e[15]=[t("td",{colspan:"9",class:"px-4 py-8 text-center text-gray-500"}," No hay datos para mostrar en el rango de fechas seleccionado. ",-1)])))])])])]),C.value?(l(),d("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:mt(B,["self"])},[t("div",le,[t("div",de,[t("h3",ce," Detalle de "+o((q=(Z=i.value)==null?void 0:Z.empleado)==null?void 0:q.nombre),1),t("button",{onClick:B,class:"text-gray-400 hover:text-gray-600"},e[18]||(e[18]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),i.value?(l(),d("div",ue,[t("div",xe,[t("p",pe,o((J=i.value.empleado)==null?void 0:J.email),1),t("p",ge,"Sucursal: "+o((K=i.value.empleado)==null?void 0:K.sucursal),1)]),t("div",me,[t("div",fe,[t("p",be,o(((Q=i.value.metricas)==null?void 0:Q.total_puntos)||0),1),e[19]||(e[19]=t("p",{class:"text-xs text-gray-500"},"Puntos Totales",-1))]),t("div",ye,[t("p",he,o(((Y=(X=i.value.metricas)==null?void 0:X.resumen)==null?void 0:Y.ventas)||0),1),e[20]||(e[20]=t("p",{class:"text-xs text-gray-500"},"Ventas",-1))]),t("div",ve,[t("p",_e,o(((et=(tt=i.value.metricas)==null?void 0:tt.resumen)==null?void 0:et.horneados)||0),1),e[21]||(e[21]=t("p",{class:"text-xs text-gray-500"},"Horneados",-1))]),t("div",we,[t("p",ke,o(((st=i.value.metricas)==null?void 0:st.horas_trabajadas)||0)+"h",1),e[22]||(e[22]=t("p",{class:"text-xs text-gray-500"},"Horas",-1))])]),t("div",null,[e[23]||(e[23]=t("h4",{class:"font-semibold text-gray-900 mb-3"},"Historial de Puntos",-1)),t("div",Ce,[(l(!0),d(E,null,F((ot=i.value.metricas)==null?void 0:ot.historial,s=>(l(),d("div",{key:s.id,class:"flex justify-between items-center py-2 border-b border-gray-100"},[t("div",null,[t("p",je,o(H(s.concepto)),1),t("p",Fe,o(s.descripcion||"-"),1),t("p",Ee,o(new Date(s.created_at).toLocaleString()),1)]),t("span",{class:_(["px-2 py-1 text-sm font-semibold rounded-full",s.puntos>=0?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},o(s.puntos>=0?"+":"")+o(s.puntos),3)]))),128)),(nt=(at=i.value.metricas)==null?void 0:at.historial)!=null&&nt.length?v("",!0):(l(),d("p",Se," Sin historial de puntos "))])])])):v("",!0)])])):v("",!0)])]}),_:1}))}};export{He as default};
