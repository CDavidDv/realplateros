import{S as L,_ as se}from"./AppLayout-D2FoCG1C.js";import{Q as q,d as C,p as w,o as l,e as d,a as e,F as T,h as P,t as i,f as j,x as G,i as Q,j as U,l as K,v as Y,z as X,k as ne,b as I,u as ie,B as re,y as J,g as W,n as Z,C as le,c as oe,w as de}from"./app-BpD1maa0.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as ue}from"./createLucideIcon-1s72_Ae1.js";/**
 * @license lucide-vue-next v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=ue("Trash2Icon",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),me={class:"bg-white rounded-lg shadow-md overflow-hidden"},fe={class:"overflow-x-auto"},xe={class:"min-w-full divide-y divide-gray-200"},ve={class:"bg-white divide-y divide-gray-200"},ge={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},he={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},ye={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},_e={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},be={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},we={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},$e={key:0},De={class:"bg-gray-50"},ke={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},He={__name:"PastesHorneados",setup(D){const{props:x}=q();C(x.pastesHorneados);const S=w(()=>{const m={};x.pastesHorneados.forEach(c=>{m[c.relleno]||(m[c.relleno]={totalPiezas:0,items:[]}),m[c.relleno].totalPiezas+=Number(c.piezas),m[c.relleno].items.push(c)});const _=[];return Object.keys(m).forEach(c=>{m[c].items.forEach((M,$)=>{_.push({...M,totalPiezas:m[c].totalPiezas,isFirst:$===0})})}),_}),y=w(()=>S.value.reduce((m,_)=>Number(m)+(_.isFirst?Number(_.totalPiezas):0),0)),k=m=>new Date(m).toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"America/Mexico_City"}),g=m=>new Date(m).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",timeZone:"America/Mexico_City"});return(m,_)=>(l(),d("div",null,[_[3]||(_[3]=e("h1",{class:"pb-4 pt-10 font-semibold text-xl"},"Pastes/Empanadas horneados de hoy",-1)),e("div",me,[e("div",fe,[e("table",xe,[_[2]||(_[2]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Responsable"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Paste/Empanada"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Hora"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Día"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Piezas Horneadas"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Total del día")])],-1)),e("tbody",ve,[(l(!0),d(T,null,P(S.value,(c,M)=>{var $,N,z;return l(),d("tr",{key:M},[e("td",ge,i(($=c==null?void 0:c.responsable)==null?void 0:$.name)+" "+i(((N=c==null?void 0:c.responsable)==null?void 0:N.apellido_p)||"")+" "+i(((z=c==null?void 0:c.responsable)==null?void 0:z.apellido_m)||""),1),e("td",he,i(c.relleno),1),e("td",ye,i(k(c.updated_at)),1),e("td",_e,i(g(c.updated_at)),1),e("td",be,i(c.piezas),1),e("td",we,[c.isFirst?(l(),d("span",$e,i(c.totalPiezas),1)):j("",!0)])])}),128))]),e("tfoot",De,[e("tr",null,[_[0]||(_[0]=e("td",{colspan:"3",class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},"Total de piezas horneadas:",-1)),e("td",ke,i(y.value),1),_[1]||(_[1]=e("td",null,null,-1))])])])])])]))}},Ce=ce(He,[["__scopeId","data-v-07cf8e5d"]]),Se={class:"pt-16"},Me={class:"max-w-7xl mx-auto space-y-6"},Ee={class:"bg-white rounded-lg shadow p-6"},Te={class:"text-2xl font-bold text-gray-900"},Pe={class:"mt-4"},Fe=["value"],ze={key:0,class:"bg-white rounded-lg shadow overflow-x-auto"},Le={class:"min-w-full divide-y divide-gray-200"},Ne={class:"bg-gray-50"},Ae={class:"bg-white divide-y divide-gray-200"},Ve={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Be=["onUpdate:modelValue"],Ie={key:1,class:"w-full flex justify-end"},je={__name:"EstimacionPastes",setup(D){const{props:x}=q(),S=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"],y=new Date().getDay(),k=S[y],g=C(k||"Lunes"),m=C(!1),_=[{value:"Lunes",label:"Lunes"},{value:"Martes",label:"Martes"},{value:"Miercoles",label:"Miércoles"},{value:"Jueves",label:"Jueves"},{value:"Viernes",label:"Viernes"},{value:"Sábado",label:"Sábado"},{value:"Domingo",label:"Domingo"}],c=["7:00 am","8:00 am","9:00 am","10:00 am","11:00 am","12:00 pm","1:00 pm","2:00 pm","3:00 pm","4:00 pm","5:00 pm","6:00 pm","7:00 pm","8:00 pm","9:00 pm"],M=w(()=>x.inventario.filter(H=>["pastes","empanadas dulces","empanadas saladas"].includes(H.tipo)).map(H=>H.nombre)),$=C({}),N=L.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:H=>{H.onmouseenter=L.stopTimer,H.onmouseleave=L.resumeTimer}}),z=()=>{const H={};return c.forEach(f=>{H[f]={},M.value.forEach(b=>{H[f][b]=0})}),H},V=()=>{m.value=!1,$.value=z(),x.estimaciones.filter(f=>f.dia===g.value).forEach(({hora:f,cantidad:b,inventario_id:A})=>{var s;const u=(s=x.inventario.find(a=>a.id===A))==null?void 0:s.nombre;u&&$.value[f]&&($.value[f][u]=b)}),m.value=!0},B=()=>{X.post("/estimaciones",{estimaciones:$.value,dia:g.value},{preserveState:!1,preserveScroll:!0,onSuccess:()=>N.fire({icon:"success",title:"Sobrantes guardados exitosamente"}),onError:()=>N.fire({icon:"error",title:"Error al guardar los sobrantes"})})};return G(()=>{V()}),Q(g,()=>{V()}),(H,f)=>(l(),d("div",Se,[e("div",Me,[e("header",Ee,[e("h1",Te,"Sistema de Control de Producción - Día: "+i(g.value),1),e("div",Pe,[U(e("select",{"onUpdate:modelValue":f[0]||(f[0]=b=>g.value=b),class:"rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500"},[(l(),d(T,null,P(_,b=>e("option",{key:b.value,value:b.value},i(b.label),9,Fe)),64))],512),[[K,g.value]])])]),m.value?(l(),d("div",ze,[e("table",Le,[e("thead",Ne,[e("tr",null,[f[1]||(f[1]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo",-1)),(l(!0),d(T,null,P(M.value,b=>(l(),d("th",{key:b,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},i(b),1))),128))])]),e("tbody",Ae,[(l(),d(T,null,P(c,b=>e("tr",{key:b},[e("td",Ve,i(b),1),(l(!0),d(T,null,P(M.value,A=>(l(),d("td",{key:A,class:"px-6 py-4 whitespace-nowrap"},[U(e("input",{type:"number","onUpdate:modelValue":u=>$.value[b][A]=u,class:"w-20 rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500",min:"0"},null,8,Be),[[Y,$.value[b][A]]])]))),128))])),64))])])])):j("",!0),H.$page.props.auth.user.roles[0].name=="admin"?(l(),d("div",Ie,[e("button",{onClick:B,class:"px-3 py-2 bg-orange-500 rounded-lg text-white hover:bg-orange-400"}," Guardar ")])):j("",!0)])]))}},Re={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ue={class:"bg-white shadow rounded-lg p-6"},Oe={class:"mb-6"},Ze={class:"list-disc pl-5"},qe={class:"capitalize"},Xe={class:"font-semibold"},We={class:"list-disc pl-5"},Ge={class:"font-semibold"},Je={class:"bg-white shadow rounded-lg p-6"},Qe=["value"],Ke=["max"],Ye=["disabled"],et={class:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-4"},tt={class:"flex justify-between"},at={class:"text-xl font-semibold mb-4"},ot=["onClick"],st={key:0},nt={class:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 mb-4"},it={key:1},rt=["disabled"],lt={class:"mt-8 bg-white shadow rounded-lg p-6"},dt={key:0,class:"text-gray-500 text-center py-4"},ct={key:1,class:"divide-y divide-gray-200"},ut=["onClick"],pt={__name:"SistemaHorneado",setup(D){const{props:x}=q(),S=x.inventario,y=C(x.hornos||[]),k=C(y.value.map(o=>({...o,horneando:o.estado||!1,pastesHorneando:o.pastesHorneando||[],tiempoInicio:o.tiempo_inicio?new Date(o.tiempo_inicio).getTime():0,tiempoFin:o.tiempo_fin?new Date(o.tiempo_fin).getTime():0,tiempoTranscurrido:0,timer:null,labeltime:"00:00"}))),g=C(9e5),m=C([]),_=()=>{if(m.value.length===0)return;const o=k.value.find(t=>!t.horneando);if(o){o.horneando=!0,o.pastesHorneando=[...m.value],m.value=[],o.tiempoInicio=Date.now(),o.tiempoFin=o.tiempoInicio+g.value;try{J.post("/iniciar-horneado",{horno_id:o.id,tiempo_inicio:o.tiempoInicio,tiempo_fin:o.tiempoFin,pastes_horneando:o.pastesHorneando,estado:!0}).then(t=>{console.log(t)}).catch(t=>{console.error("Error al iniciar el horneado:",t)}),L.fire({icon:"success",title:"Horneando",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500}),F(o.id)}catch(t){console.error("Error al iniciar el horneado:",t),L.fire({icon:"error",title:"Error al iniciar",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}}else O()},c=L.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:o=>{o.addEventListener("mouseenter",L.stopTimer),o.addEventListener("mouseleave",L.resumeTimer)}}),M=async o=>{const t=k.value.find(n=>n.id===o);if(!(!t||!t.horneando))try{if($(t)){clearInterval(t.timer);const p=[...t.pastesHorneando];t.horneando=!1,t.pastesHorneando=[],t.tiempoTranscurrido=0,t.labeltime="00:00",N();for(const v of p){const te=S.find(R=>R.nombre.toLowerCase()===v.nombre.toLowerCase()&&(R.tipo==="pastes"||R.tipo==="empanadas saladas"||R.tipo==="empanadas dulces"));if(te)try{await J.post("/api/control-produccion/horneado",{horno_id:o,paste_id:te.id,cantidad:v.cantidad})}catch(R){console.error(`Horno ${o} - Error al registrar producción para ${v.nombre}:`,R)}else console.error(`Horno ${o} - No se encontró el paste ${v.nombre} en el inventario`)}X.post("/hornear",{horno_id:o,pastes:p},{preserveScroll:!0,preserveState:!1,replace:!0,onSuccess:()=>{c.fire({icon:"success",title:"Horneado finalizado"})},onError:v=>{console.error(`Horno ${o} - Error al registrar el horneado:`,v),c.fire({icon:"error",title:"Error al registrar el horneado"})}})}}catch(n){console.error(`Horno ${o} - Error en finalizarHorneado:`,n)}},$=async o=>{try{return(await J.post("/check-estado",{horno_id:o.id,pastes:o.pastesHorneando})).data.estado}catch(t){return console.error(`Horno ${o.id} - Error al obtener el estado del horno:`,t),!1}},N=()=>{new Audio("/sound/videoplayback.mp3").play().catch(t=>console.error("Error al reproducir el sonido:",t))},z=w(()=>S.filter(o=>o.tipo==="masa")),V=w(()=>S.filter(o=>o.tipo==="relleno")),B=w(()=>z.value.map(o=>{const t=k.value.filter(n=>n.horneando&&n.pastesHorneando.some(p=>p.masa===o.nombre)).reduce((n,p)=>n+p.pastesHorneando.find(v=>v.masa===o.nombre).cantidad,0);return{...o,cantidad:o.cantidad-t}})),H=w(()=>V.value.map(o=>{const t=k.value.filter(n=>n.horneando&&n.pastesHorneando.some(p=>p.nombre===o.nombre)).reduce((n,p)=>n+p.pastesHorneando.find(v=>v.nombre===o.nombre).cantidad,0);return{...o,cantidad:o.cantidad-t}})),f=C({masa:"",relleno:"",cantidad:1,sucursal_id:x.auth.user.sucursal_id}),b=o=>{const t={pastes:"bola","empanadas saladas":"salada","empanadas dulces":"dulce"},n=x.inventario.find(p=>(p.nombre.toLowerCase()===o.value.relleno.toLowerCase()||p.nombre.toLowerCase().startsWith(o.value.relleno.toLowerCase()))&&t[p.tipo.toLowerCase()]);return n?t[n.tipo.toLowerCase()]:"bola"},A=()=>{const o=b(f).toLowerCase(),t=B.value.find(p=>p.nombre.toLowerCase()===o),n=H.value.find(p=>p.nombre.toLowerCase()===f.value.relleno.toLowerCase());if(!t||t.cantidad<=0){c.fire({icon:"error",title:"No hay suficiente masa disponible"});return}if(t&&n&&f.value.cantidad<=u.value){t.cantidad-=f.value.cantidad,n.cantidad-=f.value.cantidad;const p=m.value.find(v=>v.nombre===n.nombre);p?p.cantidad+=f.value.cantidad:r({id:Date.now(),masa:t.nombre,nombre:n.nombre,cantidad:f.value.cantidad,sucursal_id:x.auth.user.sucursal_id}),f.value={masa:"",relleno:"",cantidad:1,sucursal_id:x.auth.user.sucursal_id}}},u=w(()=>{const o=H.value.find(t=>t.nombre===f.value.relleno);return o?o.cantidad:1}),s=w(()=>f.value.relleno&&f.value.cantidad>0&&f.value.cantidad<=u.value);C("00:00");const a=o=>{if(o<=0)return"00:00";const t=Math.floor(o/1e3),n=Math.floor(t/60),p=t%60;return`${String(n).padStart(2,"0")}:${String(p).padStart(2,"0")}`},r=o=>{const t=S.find(n=>n.nombre.toLowerCase()===o.nombre.toLowerCase()&&(n.tipo==="pastes"||n.tipo==="empanadas saladas"||n.tipo==="empanadas dulces"));t?m.value.push({...o,paste_id:t.id}):console.error(`No se encontró el paste ${o.nombre} en el inventario`)},h=o=>{m.value=m.value.filter(t=>t.id!==o)},F=o=>{const t=k.value.find(v=>v.id===o);if(!t)return;const p=t.tiempoFin-Date.now();if(p<=0){M(o);return}t.tiempoTranscurrido=g.value-p,t.labeltime=a(p),t.timer&&clearInterval(t.timer),t.timer=setInterval(()=>{const v=t.tiempoFin-Date.now();if(v<=0){clearInterval(t.timer),M(o);return}t.tiempoTranscurrido=g.value-v,t.labeltime=a(v)},1e3)},E=o=>{const t=k.value.find(v=>v.id===o);if(!t)return;const p=t.tiempoFin-Date.now();if(p<=0){M(o);return}t.tiempoTranscurrido=g.value-p,t.labeltime=a(p),t.timer&&clearInterval(t.timer),t.timer=setInterval(()=>{const v=t.tiempoFin-Date.now();if(v<=0){clearInterval(t.timer),M(o);return}t.tiempoTranscurrido=g.value-v,t.labeltime=a(v)},1e3)};G(()=>{k.value.forEach(o=>{o.timer&&clearInterval(o.timer)}),k.value.forEach(o=>{if(o.estado){const t=Date.now()-new Date(o.tiempo_inicio).getTime(),n=g.value-t;if(n<=0){M(o.id);return}o.tiempoFin=Date.now()+n,E(o.id)}})});const O=()=>{X.post("/crear-horno",{estado:!1,pastesHorneando:[]},{preserverScroll:!0,preserveState:!1,onSuccess:o=>{var t;y.value=(t=o==null?void 0:o.props)==null?void 0:t.hornos,m.value=[],k.value=y.value.map(n=>({...n,horneando:n.estado||!1,pastesHorneando:n.pastesHorneando||[],tiempoInicio:n.tiempo_inicio?new Date(n.tiempo_inicio).getTime():0,tiempoFin:n.tiempo_fin?new Date(n.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),L.fire({icon:"success",title:"Horno creado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:o=>{console.error("Error al crear el horno:",o),L.fire({icon:"error",title:"Error al crear horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})},ee=o=>{X.post("/eliminar-horno",{horno_id:o},{preserveScroll:!0,preserveState:!1,onSuccess:t=>{var n;y.value=(n=t==null?void 0:t.props)==null?void 0:n.hornos,k.value=y.value.map(p=>({...p,horneando:p.estado||!1,pastesHorneando:p.pastesHorneando||[],tiempoInicio:p.tiempo_inicio?new Date(p.tiempo_inicio).getTime():0,tiempoFin:p.tiempo_fin?new Date(p.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),L.fire({icon:"success",title:"Horno eliminado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:t=>{console.error("Error al eliminar el horno:",t),L.fire({icon:"error",title:"Error al eliminar horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})};return(o,t)=>(l(),d(T,null,[e("div",Re,[e("div",Ue,[t[4]||(t[4]=e("h2",{class:"text-xl font-semibold mb-4"},"Ingredientes Disponibles",-1)),e("div",Oe,[t[2]||(t[2]=e("h3",{class:"text-lg font-medium mb-2"},"Masas",-1)),e("ul",Ze,[(l(!0),d(T,null,P(B.value,n=>(l(),d("li",{key:n.id,class:"flex justify-between"},[e("span",qe,i(n.nombre),1),e("span",Xe,i(n.cantidad)+" unidades",1)]))),128))])]),e("div",null,[t[3]||(t[3]=e("h3",{class:"text-lg font-medium mb-2"},"Rellenos",-1)),e("ul",We,[(l(!0),d(T,null,P(H.value,n=>(l(),d("li",{key:n.id,class:"flex justify-between"},[e("span",null,i(n.nombre),1),e("span",Ge,i(n.cantidad)+" unidades",1)]))),128))])])]),e("div",Je,[t[8]||(t[8]=e("h2",{class:"text-xl font-semibold mb-4"},"Crear Nuevo Paste/Empanada",-1)),e("form",{onSubmit:ne(A,["prevent"]),class:"space-y-4"},[e("div",null,[t[6]||(t[6]=e("label",{for:"relleno",class:"block text-sm font-medium text-gray-700"},"Seleccionar Relleno",-1)),U(e("select",{"onUpdate:modelValue":t[0]||(t[0]=n=>f.value.relleno=n),id:"relleno",required:"",class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md"},[t[5]||(t[5]=e("option",{value:""},"Seleccione un relleno",-1)),(l(!0),d(T,null,P(V.value,n=>(l(),d("option",{key:n.id,value:n.nombre},i(n.nombre),9,Qe))),128))],512),[[K,f.value.relleno]])]),e("div",null,[t[7]||(t[7]=e("label",{for:"cantidad",class:"block text-sm font-medium text-gray-700"},"Cantidad",-1)),U(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>f.value.cantidad=n),type:"number",id:"cantidad",required:"",min:"1",max:u.value,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 sm:text-sm"},null,8,Ke),[[Y,f.value.cantidad,void 0,{number:!0}]])]),e("button",{type:"submit",disabled:!s.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Asignar Unidades ",8,Ye)],32)])]),e("div",et,[(l(!0),d(T,null,P(k.value,(n,p)=>(l(),d("div",{key:n.id,class:"bg-white shadow rounded-lg p-6"},[e("div",tt,[e("h2",at,"Horno "+i(p+1),1),!n.horneando&&y.value.length>1?(l(),d("button",{key:0,onClick:v=>ee(n.id),class:"flex items-center gap-2 bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"},[I(ie(pe),{class:"w-4 h-4"})],8,ot)):j("",!0)]),n.horneando?(l(),d("div",st,[t[9]||(t[9]=e("p",{class:"text-lg mb-2"},"Horneando grupo de pastes:",-1)),e("ul",null,[(l(!0),d(T,null,P(n.pastesHorneando,v=>(l(),d("li",{key:v.nombre},i(v.cantidad)+" "+i(v.nombre)+" - masa "+i(v.masa),1))),128))]),e("div",nt,[e("div",{class:"bg-orange-600 h-2.5 rounded-full transition-all duration-100",style:re({width:`${n.tiempoTranscurrido/g.value*100}%`})},null,4)]),e("p",null,"Tiempo restante: "+i(n.labeltime),1)])):(l(),d("div",it,[t[10]||(t[10]=e("p",{class:"text-lg mb-4"},"El horno está disponible",-1)),e("button",{onClick:_,disabled:!m.value.length,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Iniciar Horneado de Grupo ",8,rt)]))]))),128)),e("div",{class:"mt-4 h-full flex justify-center items-center"},[e("button",{onClick:O,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500"}," Crear Nuevo Horno ")])]),e("div",lt,[t[11]||(t[11]=e("h2",{class:"text-xl font-semibold mb-4"},"Grupos de Pastes por Hornear",-1)),m.value.length===0?(l(),d("div",dt," No hay grupos de pastes en la cola de horneado ")):(l(),d("ul",ct,[(l(!0),d(T,null,P(m.value,n=>(l(),d("li",{key:n.id,class:"py-4 flex justify-between items-center"},[e("span",null,i(n.cantidad)+" "+i(n.nombre)+" - masa "+i(n.masa),1),e("button",{onClick:p=>h(n.id),class:"bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"}," Cancelar ",8,ut)]))),128))]))])],64))}},mt={key:0,class:"mt-8 bg-white shadow rounded-lg p-6"},ft={class:"flex justify-between items-center mb-4"},xt={class:"flex items-center space-x-4"},vt={class:"flex items-center space-x-2"},gt={class:"flex items-center space-x-2"},ht=["value"],yt={class:"mb-6"},_t={class:"overflow-x-auto"},bt={class:"min-w-full divide-y divide-gray-200"},wt={class:"bg-white divide-y divide-gray-200"},$t={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 capitalize"},Dt={class:"text-xs text-gray-500 block capitalize"},kt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ht={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ct={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},St={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize"},Mt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Et={class:"px-6 py-4 whitespace-nowrap"},Tt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Pt={class:"mb-6"},Ft={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},zt={class:"font-medium"},Lt={class:"mt-8"},Nt={class:"overflow-x-auto"},At={class:"min-w-full divide-y divide-gray-200"},Vt={class:"bg-white divide-y divide-gray-200"},Bt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},It={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},jt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Rt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ut={class:"px-6 py-4 whitespace-nowrap capitalize"},Ot={__name:"ControlProduccion",setup(D){const{props:x}=q();C([]);const S=C([]),y=C([]);C([]);const k=w(()=>x.auth.user.roles[0].name==="admin");console.log(k.value);const g=C(new Date().toISOString().split("T")[0]),m=C("actual"),_=C([{value:"todas",label:"Todas las horas"},{value:"actual",label:"Hora Actual"},{value:"9-am",label:"9:00 AM"},{value:"10-am",label:"10:00 AM"},{value:"11-am",label:"11:00 AM"},{value:"12-pm",label:"12:00 PM"},{value:"1-pm",label:"1:00 PM"},{value:"2-pm",label:"2:00 PM"},{value:"3-pm",label:"3:00 PM"},{value:"4-pm",label:"4:00 PM"},{value:"5-pm",label:"5:00 PM"},{value:"6-pm",label:"6:00 PM"},{value:"7-pm",label:"7:00 PM"},{value:"8-pm",label:"8:00 PM"},{value:"9-pm",label:"9:00 PM"}]),c=u=>{const s=new Date(u),a=s.getHours();s.getMinutes();const r=a>=12?"pm":"am";return`${a%12||12}-${r}`},M=()=>{const u=new Date(g.value+"T00:00:00-06:00"),s=new Date(g.value+"T23:59:59-06:00");return{inicio:u,fin:s}},$=u=>{const s=M();if(!s)return!0;const a=new Date(u),r=new Date(a.toLocaleString("en-US",{timeZone:"America/Mexico_City"})),h=new Date(s.inicio.toLocaleString("en-US",{timeZone:"America/Mexico_City"})),F=new Date(s.fin.toLocaleString("en-US",{timeZone:"America/Mexico_City"}));return r>=h&&r<=F},N=()=>{const u=new Date,s=new Date(u.toLocaleString("en-US",{timeZone:"America/Mexico_City"}));g.value=s.toISOString().split("T")[0]},z=u=>{if(u.estado==="pendiente")return"pendiente";const a=c(new Date);return c(u.created_at)!==a?"desperdicio":u.estado},V=w(()=>{var a;if(!((a=x.notificaciones)!=null&&a.faltantes))return[];let s=x.notificaciones.faltantes.map(r=>({id:r.id,paste:r.paste,cantidad:r.cantidad,hora_notificacion:r.hora_notificacion,dia_notificacion:r.dia_notificacion,estado:z(r),tiempo_inicio_horneado:r.tiempo_inicio_horneado,hora_ultima_venta:r.hora_ultima_venta,cantidad_vendida:r.cantidad_vendida,diferencia_notificacion_inicio:r.diferencia_notificacion_inicio,created_at:r.created_at,cantidad_horneada:r.cantidad_horneada})).filter(r=>$(r.created_at));if(m.value==="todas")return s;if(m.value==="actual"){const h=c(new Date);return s.filter(F=>c(F.created_at)===h)}return s.filter(r=>c(r.created_at)===m.value)}),B=w(()=>{var u;return(u=x.notificaciones)!=null&&u.faltantes?x.notificaciones.faltantes.map(s=>({id:s.id,paste:s.paste,cantidad:s.cantidad,hora_notificacion:s.hora_notificacion,dia_notificacion:s.dia_notificacion,estado:s.estado,tiempo_inicio_horneado:s.tiempo_inicio_horneado,hora_ultima_venta:s.hora_ultima_venta,cantidad_vendida:s.cantidad_vendida,diferencia_notificacion_inicio:s.diferencia_notificacion_inicio,created_at:s.created_at})):[]});w(()=>{var u;return(u=x.notificaciones)!=null&&u.horneados?x.notificaciones.horneados:[]});const H=w(()=>B.value.map(s=>({paste:s.paste.nombre,recomendacion:"Producir",razon:`Faltan ${s.cantidad} unidades para las ${s.hora_notificacion}`})));Q(()=>{var u;return(u=x.notificaciones)==null?void 0:u.faltantes},u=>{u&&(y.value=H.value)},{immediate:!0});const f=u=>u?new Date(u).toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:"America/Mexico_City"}):"-",b=u=>`px-2 py-1 rounded-full text-xs font-medium ${{horneando:"bg-yellow-100 text-yellow-800 capitalize",retirado:"bg-blue-100 text-blue-800 capitalize",vendido:"bg-green-100 text-green-800 capitalize",desperdicio:"bg-red-100 text-red-800 capitalize",pendiente:"bg-gray-100 text-gray-800 capitalize",en_espera:"bg-green-100 text-green-800"}[u]}`,A=w(()=>{var a;if(!((a=x.notificaciones)!=null&&a.horneados))return[];let s=x.notificaciones.horneados.filter(r=>$(r.created_at));if(m.value==="todas")return s;if(m.value==="actual"){const h=c(new Date);return s.filter(F=>c(F.created_at)===h)}return s.filter(r=>c(r.created_at)===m.value)});return G(()=>{N()}),(u,s)=>k.value?(l(),d("div",mt,[e("div",ft,[s[4]||(s[4]=e("h2",{class:"text-xl font-semibold"},"Control de Producción",-1)),e("div",xt,[e("div",vt,[s[2]||(s[2]=e("label",{for:"fecha",class:"text-sm font-medium text-gray-700"},"Seleccionar día:",-1)),U(e("input",{type:"date",id:"fecha","onUpdate:modelValue":s[0]||(s[0]=a=>g.value=a),class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},null,512),[[Y,g.value]])]),e("div",gt,[s[3]||(s[3]=e("label",{for:"hora",class:"text-sm font-medium text-gray-700"},"Filtrar por hora:",-1)),U(e("select",{id:"hora","onUpdate:modelValue":s[1]||(s[1]=a=>m.value=a),class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[(l(!0),d(T,null,P(_.value,a=>(l(),d("option",{key:a.value,value:a.value},i(a.label),9,ht))),128))],512),[[K,m.value]])])])]),e("div",yt,[s[6]||(s[6]=e("h3",{class:"text-lg font-medium mb-2"},"Productos Faltantes",-1)),e("div",_t,[e("table",bt,[s[5]||(s[5]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Producto"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Faltante"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Horneada"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Vendida"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Día"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora Requerida"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Última Venta")])],-1)),e("tbody",wt,[(l(!0),d(T,null,P(V.value,a=>(l(),d("tr",{key:a.id,class:"hover:bg-gray-50"},[e("td",$t,[W(i(a.paste.nombre)+" ",1),e("span",Dt,i(a.paste.tipo),1)]),e("td",kt,i(a.cantidad)+" unidades ",1),e("td",Ht,i(a.cantidad_horneada?`${a.cantidad_horneada} unidades`:"-"),1),e("td",Ct,i(a.cantidad_vendida?`${a.cantidad_vendida} unidades`:"-"),1),e("td",St,i(a.dia_notificacion),1),e("td",Mt,i(f(a.created_at)),1),e("td",Et,[e("span",{class:Z(["px-2 py-1 text-xs font-medium rounded-full",a.estado==="pendiente"?"bg-red-100 text-red-800":a.estado==="horneando"?"bg-yellow-100 text-yellow-800":a.estado==="desperdicio"?"bg-red-100 text-red-800":"bg-green-100 text-green-800"])},i(a.estado==="pendiente"?"Sin hornear":a.estado==="desperdicio"?"Desperdicio":a.estado),3)]),e("td",Tt,i(a.estado==="pendiente"?"-":a.hora_ultima_venta?f(a.hora_ultima_venta):"Sin ventas"),1)]))),128))])])])]),e("div",Pt,[s[7]||(s[7]=e("h3",{class:"text-lg font-medium mb-2"},"Tiempo de Reposición",-1)),e("div",Ft,[(l(!0),d(T,null,P(S.value,(a,r)=>(l(),d("div",{key:r,class:"bg-gray-50 p-4 rounded-lg"},[e("p",zt,i(a.paste),1),e("p",null,"Tiempo promedio: "+i(a.promedio)+" minutos",1),e("p",null,"Última reposición: "+i(a.ultima),1)]))),128))])]),e("div",Lt,[s[9]||(s[9]=e("h3",{class:"text-lg font-medium mb-2"},"Control de Tiempo de Producción",-1)),e("div",Nt,[e("table",At,[s[8]||(s[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Paste"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de notificación"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de Producción"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo en meter producción"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado")])],-1)),e("tbody",Vt,[(l(!0),d(T,null,P(A.value,a=>(l(),d("tr",{key:a.id},[e("td",Bt,i(a.paste.nombre),1),e("td",It,i(f(a.created_at)),1),e("td",jt,i(f(a.tiempo_inicio_horneado)),1),e("td",Rt,i(Math.round((new Date(a.diferencia_notificacion_inicio)-new Date(a.created_at))/6e4))+" min",1),e("td",Ut,[e("span",{class:Z(b(a.estado))},i(a.estado),3)])]))),128))])])])])])):j("",!0)}},Zt={class:"animate-pulse"},qt={key:0,class:"mt-2"},Xt={class:"font-bold"},ae={__name:"NotificationPanel",props:{notifications:{type:Array,required:!0},isVisible:{type:Boolean,default:!1},type:{type:String,required:!0,validator:D=>["warning","info"].includes(D)},title:{type:String,required:!0}},emits:["toggle"],setup(D){return(x,S)=>(l(),d("div",{class:Z(["p-4 border rounded shadow mb-4 size-fit cursor-pointer",{"bg-yellow-100":D.type==="warning","bg-blue-100":D.type==="info"}]),onClick:S[0]||(S[0]=y=>x.$emit("toggle"))},[e("h2",{class:Z(["text-lg font-bold text-center",{"text-yellow-800":D.type==="warning","text-blue-800":D.type==="info"}])},[W(i(D.type==="warning"?"⚠️":"ℹ️")+" "+i(D.title)+" ",1),e("span",Zt,"("+i(D.notifications.length)+")",1),W(" "+i(D.type==="warning"?"⚠️":"ℹ️"),1)],2),D.isVisible?(l(),d("ul",qt,[(l(!0),d(T,null,P(D.notifications,y=>(l(),d("li",{key:y.id,class:"mb-2"},[e("span",null,[e("span",Xt,i(y.nombre),1),W(": "+i(D.type==="warning"?"Faltan":"Hay")+" "+i(D.type==="warning"?Math.abs(y.diferencia):y.diferencia)+" unidades para las "+i(y.hora)+" ",1),e("span",{class:Z(["text-sm",{"text-red-600":D.type==="warning","text-green-600":D.type==="info"}])}," ("+i(y.porcentaje)+"% del estimado) ",3)])]))),128))])):j("",!0)],2))}},Wt={class:"container mx-auto p-4"},Gt={class:"sm:flex justify-between flex-row text-sm"},Jt={class:"flex gap-3 sm:flex-row flex-col"},Qt={class:"mt-6"},Kt={__name:"Hornear",setup(D){const x=C(!1),S=C(!1),y=C(null),k=C(null),{props:g}=q(),m=w(()=>g.auth.user.roles[0].name==="admin"),_=w(()=>g.inventario||[]),c=w(()=>g.estimacionesHoy||[]),M=()=>{const s=new Date;return{day:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"][s.getDay()].toLowerCase(),hour:s.getHours(),minutes:s.getMinutes()}},$=C(M());Q(()=>$.value.hour,s=>{s!==y.value&&(y.value=s,f.value.length>0&&(x.value=!0),b.value.length>0&&(S.value=!0))}),G(()=>{y.value=$.value.hour,k.value=setInterval(()=>{$.value=M()},1e3)}),le(()=>{k.value&&clearInterval(k.value)});const N=s=>{const[a,r]=s.toLowerCase().split(" ");let[h,F]=a.split(":").map(Number);return{hours:r==="pm"&&h!==12?h+12:r==="am"&&h===12?0:h,minutes:F}},z=w(()=>_.value.filter(s=>{var a;return["pastes","empanadas dulces","empanadas saladas"].includes((a=s.tipo)==null?void 0:a.toLowerCase())})),V=w(()=>{if(!c.value.length||!z.value.length)return console.log("No hay estimaciones o productos relevantes"),[];const s=new Map(z.value.map(r=>[r.id,r]));return c.value.map(r=>{const h=s.get(r.inventario_id);if(!h)return null;const{hours:F}=N(r.hora);return{id:`${h.id}-${r.hora}`,nombre:h.nombre,estimado:r.cantidad,existente:h.cantidad,diferencia:h.cantidad-r.cantidad,hora:r.hora,dia:r.dia.toLowerCase(),horaEnNumero:F,tipo:h.tipo}}).filter(Boolean).filter((r,h,F)=>h===F.findIndex(E=>E.id===r.id))}),B=w(()=>V.value.filter(a=>a.dia===$.value.day)),H=w(()=>{const a=($.value.hour+1)%24,r=B.value.filter(E=>E.horaEnNumero===a),h=new Map(r.map(E=>[E.nombre,E]));return z.value.map(E=>{const O=h.get(E.nombre);return O||{id:`${E.id}-${a}:00`,nombre:E.nombre,estimado:0,existente:E.cantidad,diferencia:E.cantidad,hora:`${a}:00`,dia:$.value.day,horaEnNumero:a,tipo:E.tipo}})}),f=w(()=>H.value.filter(a=>a.estimado>0&&a.diferencia<0).map(a=>({...a,porcentaje:a.estimado>0?Math.round(a.existente/a.estimado*100):0}))),b=w(()=>H.value.filter(a=>a.estimado>0&&a.diferencia>0||a.estimado===0&&a.existente>0).map(a=>({...a,porcentaje:a.estimado>0?Math.round(a.existente/a.estimado*100):100}))),A=()=>x.value=!x.value,u=()=>S.value=!S.value;return(s,a)=>(l(),d("div",Wt,[e("div",Gt,[a[0]||(a[0]=e("h1",{class:"text-2xl font-bold mb-4"},"Sistema de Horneado",-1)),e("div",Jt,[I(ae,{notifications:f.value,"is-visible":x.value,type:"warning",title:"Faltantes",onToggle:A},null,8,["notifications","is-visible"]),I(ae,{notifications:b.value,"is-visible":S.value,type:"info",title:"Excedentes",onToggle:u},null,8,["notifications","is-visible"])])]),e("div",Qt,[I(pt),I(Ot),I(Ce),m.value?(l(),oe(je,{key:0})):j("",!0)])]))}},Yt={class:"py-6"},ea={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 rounded-xl overflow-hidden"},ta={class:"flex justify-between p-6 lg:p-8 bg-white border-b border-gray-200 rounded-2xl"},ia={__name:"index",setup(D){return(x,S)=>(l(),oe(se,{title:"Tablero principal"},{default:de(()=>[e("div",Yt,[e("div",ea,[e("div",ta,[I(Kt)])])])]),_:1}))}};export{ia as default};
