import{S as V,_ as se}from"./AppLayout-KpDhhx57.js";import{Q as q,d as S,p as w,o as l,e as c,a as e,F as T,h as P,t as i,f as I,x as G,i as Q,j as U,l as K,v as Y,z as X,k as ne,b as R,u as oe,B as ie,y as te,g as W,n as Z,C as re,c as J,w as le}from"./app-DuFUp6nE.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as ce}from"./createLucideIcon-Dr4M-LNv.js";/**
 * @license lucide-vue-next v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=ce("Trash2Icon",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),pe={class:"bg-white rounded-lg shadow-md overflow-hidden"},me={class:"overflow-x-auto"},fe={class:"min-w-full divide-y divide-gray-200"},xe={class:"bg-white divide-y divide-gray-200"},ve={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},ge={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},he={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ye={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},be={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},_e={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},we={key:0},$e={class:"bg-gray-50"},De={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},ke={__name:"PastesHorneados",setup($){const{props:x}=q(),M=S(x.pastesHorneados);console.log(M.value);const b=w(()=>{const k={};x.pastesHorneados.forEach(p=>{k[p.relleno]||(k[p.relleno]={totalPiezas:0,items:[]}),k[p.relleno].totalPiezas+=Number(p.piezas),k[p.relleno].items.push(p)});const m=[];return Object.keys(k).forEach(p=>{k[p].items.forEach((H,z)=>{m.push({...H,totalPiezas:k[p].totalPiezas,isFirst:z===0})})}),m}),D=w(()=>b.value.reduce((k,m)=>Number(k)+(m.isFirst?Number(m.totalPiezas):0),0)),h=k=>new Date(k).toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"America/Mexico_City"}),g=k=>new Date(k).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",timeZone:"America/Mexico_City"});return(k,m)=>(l(),c("div",null,[m[3]||(m[3]=e("h1",{class:"pb-4 pt-10 font-semibold text-xl"},"Pastes/Empanadas horneados de hoy",-1)),e("div",pe,[e("div",me,[e("table",fe,[m[2]||(m[2]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Responsable"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Paste/Empanada"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Hora"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Día"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Piezas Horneadas"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Total del día")])],-1)),e("tbody",xe,[(l(!0),c(T,null,P(b.value,(p,H)=>{var z,L,A;return l(),c("tr",{key:H},[e("td",ve,i((z=p==null?void 0:p.responsable)==null?void 0:z.name)+" "+i(((L=p==null?void 0:p.responsable)==null?void 0:L.apellido_p)||"")+" "+i(((A=p==null?void 0:p.responsable)==null?void 0:A.apellido_m)||""),1),e("td",ge,i(p.relleno),1),e("td",he,i(h(p.updated_at)),1),e("td",ye,i(g(p.updated_at)),1),e("td",be,i(p.piezas),1),e("td",_e,[p.isFirst?(l(),c("span",we,i(p.totalPiezas),1)):I("",!0)])])}),128))]),e("tfoot",$e,[e("tr",null,[m[0]||(m[0]=e("td",{colspan:"3",class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},"Total de piezas horneadas:",-1)),e("td",De,i(D.value),1),m[1]||(m[1]=e("td",null,null,-1))])])])])])]))}},He=de(ke,[["__scopeId","data-v-24733b1a"]]),Ce={class:"pt-16"},Se={class:"max-w-7xl mx-auto space-y-6"},Me={class:"bg-white rounded-lg shadow p-6"},Ee={class:"text-2xl font-bold text-gray-900"},Te={class:"mt-4"},Pe=["value"],Fe={key:0,class:"bg-white rounded-lg shadow overflow-x-auto"},ze={class:"min-w-full divide-y divide-gray-200"},Le={class:"bg-gray-50"},Ne={class:"bg-white divide-y divide-gray-200"},Ae={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ve=["onUpdate:modelValue"],Be={key:1,class:"w-full flex justify-end"},Ie={__name:"EstimacionPastes",setup($){const{props:x}=q(),M=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"],b=new Date().getDay(),D=M[b],h=S(D||"Lunes"),g=S(!1),k=[{value:"Lunes",label:"Lunes"},{value:"Martes",label:"Martes"},{value:"Miercoles",label:"Miércoles"},{value:"Jueves",label:"Jueves"},{value:"Viernes",label:"Viernes"},{value:"Sábado",label:"Sábado"},{value:"Domingo",label:"Domingo"}],m=["7:00 am","8:00 am","9:00 am","10:00 am","11:00 am","12:00 pm","1:00 pm","2:00 pm","3:00 pm","4:00 pm","5:00 pm","6:00 pm","7:00 pm","8:00 pm","9:00 pm"],p=w(()=>x.inventario.filter(f=>["pastes","empanadas dulces","empanadas saladas"].includes(f.tipo)).map(f=>f.nombre)),H=S({}),z=V.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:f=>{f.onmouseenter=V.stopTimer,f.onmouseleave=V.resumeTimer}}),L=()=>{const f={};return m.forEach(C=>{f[C]={},p.value.forEach(_=>{f[C][_]=0})}),f},A=()=>{g.value=!1,H.value=L(),x.estimaciones.filter(C=>C.dia===h.value).forEach(({hora:C,cantidad:_,inventario_id:N})=>{var s;const u=(s=x.inventario.find(a=>a.id===N))==null?void 0:s.nombre;u&&H.value[C]&&(H.value[C][u]=_)}),g.value=!0},B=()=>{X.post("/estimaciones",{estimaciones:H.value,dia:h.value},{preserveState:!1,preserveScroll:!0,onSuccess:()=>z.fire({icon:"success",title:"Sobrantes guardados exitosamente"}),onError:()=>z.fire({icon:"error",title:"Error al guardar los sobrantes"})})};return G(()=>{A()}),Q(h,()=>{A()}),(f,C)=>(l(),c("div",Ce,[e("div",Se,[e("header",Me,[e("h1",Ee,"Sistema de Control de Producción - Día: "+i(h.value),1),e("div",Te,[U(e("select",{"onUpdate:modelValue":C[0]||(C[0]=_=>h.value=_),class:"rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500"},[(l(),c(T,null,P(k,_=>e("option",{key:_.value,value:_.value},i(_.label),9,Pe)),64))],512),[[K,h.value]])])]),g.value?(l(),c("div",Fe,[e("table",ze,[e("thead",Le,[e("tr",null,[C[1]||(C[1]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo",-1)),(l(!0),c(T,null,P(p.value,_=>(l(),c("th",{key:_,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},i(_),1))),128))])]),e("tbody",Ne,[(l(),c(T,null,P(m,_=>e("tr",{key:_},[e("td",Ae,i(_),1),(l(!0),c(T,null,P(p.value,N=>(l(),c("td",{key:N,class:"px-6 py-4 whitespace-nowrap"},[U(e("input",{type:"number","onUpdate:modelValue":u=>H.value[_][N]=u,class:"w-20 rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500",min:"0"},null,8,Ve),[[Y,H.value[_][N]]])]))),128))])),64))])])])):I("",!0),f.$page.props.auth.user.roles[0].name=="admin"?(l(),c("div",Be,[e("button",{onClick:B,class:"px-3 py-2 bg-orange-500 rounded-lg text-white hover:bg-orange-400"}," Guardar ")])):I("",!0)])]))}},je={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Re={class:"bg-white shadow rounded-lg p-6"},Ue={class:"mb-6"},Oe={class:"list-disc pl-5"},Ze={class:"capitalize"},qe={class:"font-semibold"},Xe={class:"list-disc pl-5"},We={class:"font-semibold"},Ge={class:"bg-white shadow rounded-lg p-6"},Je=["value"],Qe=["max"],Ke=["disabled"],Ye={class:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-4"},et={class:"flex justify-between"},tt={class:"text-xl font-semibold mb-4"},at=["onClick"],ot={key:0},st={class:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 mb-4"},nt={key:1},it=["disabled"],rt={class:"mt-8 bg-white shadow rounded-lg p-6"},lt={key:0,class:"text-gray-500 text-center py-4"},dt={key:1,class:"divide-y divide-gray-200"},ct=["onClick"],ut={__name:"SistemaHorneado",setup($){const{props:x}=q(),M=x.inventario,b=S(x.hornos||[]),D=S(b.value.map(o=>({...o,horneando:o.estado||!1,pastesHorneando:o.pastesHorneando||[],tiempoInicio:o.tiempo_inicio?new Date(o.tiempo_inicio).getTime():0,tiempoFin:o.tiempo_fin?new Date(o.tiempo_fin).getTime():0,tiempoTranscurrido:0,timer:null,labeltime:"00:00"}))),h=S(9e5),g=S([]),k=()=>{if(g.value.length===0)return;const o=D.value.find(t=>!t.horneando);if(o){o.horneando=!0,o.pastesHorneando=[...g.value],g.value=[],o.tiempoInicio=Date.now(),o.tiempoFin=o.tiempoInicio+h.value;try{te.post("/iniciar-horneado",{horno_id:o.id,tiempo_inicio:o.tiempoInicio,tiempo_fin:o.tiempoFin,pastes_horneando:o.pastesHorneando,estado:!0}).then(t=>{console.log(t)}).catch(t=>{console.error("Error al iniciar el horneado:",t)}),V.fire({icon:"success",title:"Horneando",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500}),F(o.id)}catch(t){console.error("Error al iniciar el horneado:",t),V.fire({icon:"error",title:"Error al iniciar",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}}else O()},m=V.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:o=>{o.addEventListener("mouseenter",V.stopTimer),o.addEventListener("mouseleave",V.resumeTimer)}}),p=async o=>{const t=D.value.find(n=>n.id===o);if(!(!t||!t.horneando))try{clearInterval(t.timer);const n=[...t.pastesHorneando];t.horneando=!1,t.pastesHorneando=[],t.tiempoTranscurrido=0,t.labeltime="00:00",H();for(const d of n){const y=M.find(j=>j.nombre.toLowerCase()===d.nombre.toLowerCase()&&(j.tipo==="pastes"||j.tipo==="empanadas saladas"||j.tipo==="empanadas dulces"));if(y)try{await te.post("/api/control-produccion/horneado",{horno_id:o,paste_id:y.id,cantidad:d.cantidad})}catch(j){console.error(`Horno ${o} - Error al registrar producción para ${d.nombre}:`,j)}else console.error(`Horno ${o} - No se encontró el paste ${d.nombre} en el inventario`)}X.post("/hornear",{horno_id:o,pastes:n},{preserveScroll:!0,preserveState:!1,replace:!0,onSuccess:()=>{m.fire({icon:"success",title:"Horneado finalizado"})},onError:d=>{console.error(`Horno ${o} - Error al registrar el horneado:`,d),m.fire({icon:"error",title:"Error al registrar el horneado"})}})}catch(n){console.error(`Horno ${o} - Error en finalizarHorneado:`,n)}},H=()=>{new Audio("/sound/videoplayback.mp3").play().catch(t=>console.error("Error al reproducir el sonido:",t))},z=w(()=>M.filter(o=>o.tipo==="masa")),L=w(()=>M.filter(o=>o.tipo==="relleno")),A=w(()=>z.value.map(o=>{const t=D.value.filter(n=>n.horneando&&n.pastesHorneando.some(d=>d.masa===o.nombre)).reduce((n,d)=>n+d.pastesHorneando.find(y=>y.masa===o.nombre).cantidad,0);return{...o,cantidad:o.cantidad-t}})),B=w(()=>L.value.map(o=>{const t=D.value.filter(n=>n.horneando&&n.pastesHorneando.some(d=>d.nombre===o.nombre)).reduce((n,d)=>n+d.pastesHorneando.find(y=>y.nombre===o.nombre).cantidad,0);return{...o,cantidad:o.cantidad-t}})),f=S({masa:"",relleno:"",cantidad:1,sucursal_id:x.auth.user.sucursal_id}),C=o=>{const t={pastes:"bola","empanadas saladas":"salada","empanadas dulces":"dulce"},n=x.inventario.find(d=>(d.nombre.toLowerCase()===o.value.relleno.toLowerCase()||d.nombre.toLowerCase().startsWith(o.value.relleno.toLowerCase()))&&t[d.tipo.toLowerCase()]);return n?t[n.tipo.toLowerCase()]:"bola"},_=()=>{const o=C(f).toLowerCase(),t=A.value.find(d=>d.nombre.toLowerCase()===o),n=B.value.find(d=>d.nombre.toLowerCase()===f.value.relleno.toLowerCase());if(!t||t.cantidad<=0){m.fire({icon:"error",title:"No hay suficiente masa disponible"});return}if(t&&n&&f.value.cantidad<=N.value){t.cantidad-=f.value.cantidad,n.cantidad-=f.value.cantidad;const d=g.value.find(y=>y.nombre===n.nombre);d?d.cantidad+=f.value.cantidad:a({id:Date.now(),masa:t.nombre,nombre:n.nombre,cantidad:f.value.cantidad,sucursal_id:x.auth.user.sucursal_id}),f.value={masa:"",relleno:"",cantidad:1,sucursal_id:x.auth.user.sucursal_id}}},N=w(()=>{const o=B.value.find(t=>t.nombre===f.value.relleno);return o?o.cantidad:1}),u=w(()=>f.value.relleno&&f.value.cantidad>0&&f.value.cantidad<=N.value);S("00:00");const s=o=>{if(o<=0)return"00:00";const t=Math.floor(o/1e3),n=Math.floor(t/60),d=t%60;return`${String(n).padStart(2,"0")}:${String(d).padStart(2,"0")}`},a=o=>{const t=M.find(n=>n.nombre.toLowerCase()===o.nombre.toLowerCase()&&(n.tipo==="pastes"||n.tipo==="empanadas saladas"||n.tipo==="empanadas dulces"));t?g.value.push({...o,paste_id:t.id}):console.error(`No se encontró el paste ${o.nombre} en el inventario`)},r=o=>{g.value=g.value.filter(t=>t.id!==o)},v=o=>{p(o).catch(t=>{console.error(`Error al finalizar horneado desde timer: ${t}`)})},F=o=>{const t=D.value.find(y=>y.id===o);if(!t)return;const d=t.tiempoFin-Date.now();if(d<=0){v(o);return}t.tiempoTranscurrido=h.value-d,t.labeltime=s(d),t.timer&&clearInterval(t.timer),t.timer=setInterval(()=>{const y=t.tiempoFin-Date.now();if(y<=0){clearInterval(t.timer),v(o);return}t.tiempoTranscurrido=h.value-y,t.labeltime=s(y)},1e3)},E=o=>{const t=D.value.find(y=>y.id===o);if(!t)return;const d=t.tiempoFin-Date.now();if(d<=0){v(o);return}t.tiempoTranscurrido=h.value-d,t.labeltime=s(d),t.timer&&clearInterval(t.timer),t.timer=setInterval(()=>{const y=t.tiempoFin-Date.now();if(y<=0){clearInterval(t.timer),v(o);return}t.tiempoTranscurrido=h.value-y,t.labeltime=s(y)},1e3)};G(()=>{D.value.forEach(o=>{o.timer&&clearInterval(o.timer)}),D.value.forEach(o=>{if(o.estado){const t=Date.now()-new Date(o.tiempo_inicio).getTime(),n=h.value-t;if(n<=0){v(o.id);return}o.tiempoFin=Date.now()+n,E(o.id)}})});const O=()=>{X.post("/crear-horno",{estado:!1,pastesHorneando:[]},{preserverScroll:!0,preserveState:!1,onSuccess:o=>{var t;b.value=(t=o==null?void 0:o.props)==null?void 0:t.hornos,g.value=[],D.value=b.value.map(n=>({...n,horneando:n.estado||!1,pastesHorneando:n.pastesHorneando||[],tiempoInicio:n.tiempo_inicio?new Date(n.tiempo_inicio).getTime():0,tiempoFin:n.tiempo_fin?new Date(n.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),V.fire({icon:"success",title:"Horno creado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:o=>{console.error("Error al crear el horno:",o),V.fire({icon:"error",title:"Error al crear horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})},ee=o=>{X.post("/eliminar-horno",{horno_id:o},{preserveScroll:!0,preserveState:!1,onSuccess:t=>{var n;b.value=(n=t==null?void 0:t.props)==null?void 0:n.hornos,D.value=b.value.map(d=>({...d,horneando:d.estado||!1,pastesHorneando:d.pastesHorneando||[],tiempoInicio:d.tiempo_inicio?new Date(d.tiempo_inicio).getTime():0,tiempoFin:d.tiempo_fin?new Date(d.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),V.fire({icon:"success",title:"Horno eliminado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:t=>{console.error("Error al eliminar el horno:",t),V.fire({icon:"error",title:"Error al eliminar horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})};return(o,t)=>(l(),c(T,null,[e("div",je,[e("div",Re,[t[4]||(t[4]=e("h2",{class:"text-xl font-semibold mb-4"},"Ingredientes Disponibles",-1)),e("div",Ue,[t[2]||(t[2]=e("h3",{class:"text-lg font-medium mb-2"},"Masas",-1)),e("ul",Oe,[(l(!0),c(T,null,P(A.value,n=>(l(),c("li",{key:n.id,class:"flex justify-between"},[e("span",Ze,i(n.nombre),1),e("span",qe,i(n.cantidad)+" unidades",1)]))),128))])]),e("div",null,[t[3]||(t[3]=e("h3",{class:"text-lg font-medium mb-2"},"Rellenos",-1)),e("ul",Xe,[(l(!0),c(T,null,P(B.value,n=>(l(),c("li",{key:n.id,class:"flex justify-between"},[e("span",null,i(n.nombre),1),e("span",We,i(n.cantidad)+" unidades",1)]))),128))])])]),e("div",Ge,[t[8]||(t[8]=e("h2",{class:"text-xl font-semibold mb-4"},"Crear Nuevo Paste/Empanada",-1)),e("form",{onSubmit:ne(_,["prevent"]),class:"space-y-4"},[e("div",null,[t[6]||(t[6]=e("label",{for:"relleno",class:"block text-sm font-medium text-gray-700"},"Seleccionar Relleno",-1)),U(e("select",{"onUpdate:modelValue":t[0]||(t[0]=n=>f.value.relleno=n),id:"relleno",required:"",class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md"},[t[5]||(t[5]=e("option",{value:""},"Seleccione un relleno",-1)),(l(!0),c(T,null,P(L.value,n=>(l(),c("option",{key:n.id,value:n.nombre},i(n.nombre),9,Je))),128))],512),[[K,f.value.relleno]])]),e("div",null,[t[7]||(t[7]=e("label",{for:"cantidad",class:"block text-sm font-medium text-gray-700"},"Cantidad",-1)),U(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>f.value.cantidad=n),type:"number",id:"cantidad",required:"",min:"1",max:N.value,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 sm:text-sm"},null,8,Qe),[[Y,f.value.cantidad,void 0,{number:!0}]])]),e("button",{type:"submit",disabled:!u.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Asignar Unidades ",8,Ke)],32)])]),e("div",Ye,[(l(!0),c(T,null,P(D.value,(n,d)=>(l(),c("div",{key:n.id,class:"bg-white shadow rounded-lg p-6"},[e("div",et,[e("h2",tt,"Horno "+i(d+1),1),!n.horneando&&b.value.length>1?(l(),c("button",{key:0,onClick:y=>ee(n.id),class:"flex items-center gap-2 bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"},[R(oe(ue),{class:"w-4 h-4"})],8,at)):I("",!0)]),n.horneando?(l(),c("div",ot,[t[9]||(t[9]=e("p",{class:"text-lg mb-2"},"Horneando grupo de pastes:",-1)),e("ul",null,[(l(!0),c(T,null,P(n.pastesHorneando,y=>(l(),c("li",{key:y.nombre},i(y.cantidad)+" "+i(y.nombre)+" - masa "+i(y.masa),1))),128))]),e("div",st,[e("div",{class:"bg-orange-600 h-2.5 rounded-full transition-all duration-100",style:ie({width:`${n.tiempoTranscurrido/h.value*100}%`})},null,4)]),e("p",null,"Tiempo restante: "+i(n.labeltime),1)])):(l(),c("div",nt,[t[10]||(t[10]=e("p",{class:"text-lg mb-4"},"El horno está disponible",-1)),e("button",{onClick:k,disabled:!g.value.length,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Iniciar Horneado de Grupo ",8,it)]))]))),128)),e("div",{class:"mt-4 h-full flex justify-center items-center"},[e("button",{onClick:O,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500"}," Crear Nuevo Horno ")])]),e("div",rt,[t[11]||(t[11]=e("h2",{class:"text-xl font-semibold mb-4"},"Grupos de Pastes por Hornear",-1)),g.value.length===0?(l(),c("div",lt," No hay grupos de pastes en la cola de horneado ")):(l(),c("ul",dt,[(l(!0),c(T,null,P(g.value,n=>(l(),c("li",{key:n.id,class:"py-4 flex justify-between items-center"},[e("span",null,i(n.cantidad)+" "+i(n.nombre)+" - masa "+i(n.masa),1),e("button",{onClick:d=>r(n.id),class:"bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"}," Cancelar ",8,ct)]))),128))]))])],64))}},pt={key:0,class:"mt-8 bg-white shadow rounded-lg p-6"},mt={class:"flex justify-between items-center mb-4"},ft={class:"flex items-center space-x-4"},xt={class:"flex items-center space-x-2"},vt={class:"flex items-center space-x-2"},gt=["value"],ht={class:"mb-6"},yt={class:"overflow-x-auto"},bt={class:"min-w-full divide-y divide-gray-200"},_t={class:"bg-white divide-y divide-gray-200"},wt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 capitalize"},$t={class:"text-xs text-gray-500 block capitalize"},Dt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},kt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ht={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ct={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize"},St={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Mt={class:"px-6 py-4 whitespace-nowrap"},Et={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Tt={class:"mb-6"},Pt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ft={class:"font-medium"},zt={class:"mt-8"},Lt={class:"overflow-x-auto"},Nt={class:"min-w-full divide-y divide-gray-200"},At={class:"bg-white divide-y divide-gray-200"},Vt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Bt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},It={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},jt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Rt={class:"px-6 py-4 whitespace-nowrap capitalize"},Ut={__name:"ControlProduccion",setup($){const{props:x}=q();S([]);const M=S([]),b=S([]);S([]);const D=w(()=>x.auth.user.roles[0].name==="admin");console.log(D.value);const h=S(new Date().toISOString().split("T")[0]),g=S("actual"),k=S([{value:"todas",label:"Todas las horas"},{value:"actual",label:"Hora Actual"},{value:"9-am",label:"9:00 AM"},{value:"10-am",label:"10:00 AM"},{value:"11-am",label:"11:00 AM"},{value:"12-pm",label:"12:00 PM"},{value:"1-pm",label:"1:00 PM"},{value:"2-pm",label:"2:00 PM"},{value:"3-pm",label:"3:00 PM"},{value:"4-pm",label:"4:00 PM"},{value:"5-pm",label:"5:00 PM"},{value:"6-pm",label:"6:00 PM"},{value:"7-pm",label:"7:00 PM"},{value:"8-pm",label:"8:00 PM"},{value:"9-pm",label:"9:00 PM"}]),m=u=>{const s=new Date(u),a=s.getHours();s.getMinutes();const r=a>=12?"pm":"am";return`${a%12||12}-${r}`},p=()=>{const u=new Date(h.value+"T00:00:00-06:00"),s=new Date(h.value+"T23:59:59-06:00");return{inicio:u,fin:s}},H=u=>{const s=p();if(!s)return!0;const a=new Date(u),r=new Date(a.toLocaleString("en-US",{timeZone:"America/Mexico_City"})),v=new Date(s.inicio.toLocaleString("en-US",{timeZone:"America/Mexico_City"})),F=new Date(s.fin.toLocaleString("en-US",{timeZone:"America/Mexico_City"}));return r>=v&&r<=F},z=()=>{const u=new Date,s=new Date(u.toLocaleString("en-US",{timeZone:"America/Mexico_City"}));h.value=s.toISOString().split("T")[0]},L=u=>{if(u.estado==="pendiente")return"pendiente";const a=m(new Date);return m(u.created_at)!==a?"desperdicio":u.estado},A=w(()=>{var a;if(!((a=x.notificaciones)!=null&&a.faltantes))return[];let s=x.notificaciones.faltantes.map(r=>({id:r.id,paste:r.paste,cantidad:r.cantidad,hora_notificacion:r.hora_notificacion,dia_notificacion:r.dia_notificacion,estado:L(r),tiempo_inicio_horneado:r.tiempo_inicio_horneado,hora_ultima_venta:r.hora_ultima_venta,cantidad_vendida:r.cantidad_vendida,diferencia_notificacion_inicio:r.diferencia_notificacion_inicio,created_at:r.created_at,cantidad_horneada:r.cantidad_horneada})).filter(r=>H(r.created_at));if(g.value==="todas")return s;if(g.value==="actual"){const v=m(new Date);return s.filter(F=>m(F.created_at)===v)}return s.filter(r=>m(r.created_at)===g.value)}),B=w(()=>{var u;return(u=x.notificaciones)!=null&&u.faltantes?x.notificaciones.faltantes.map(s=>({id:s.id,paste:s.paste,cantidad:s.cantidad,hora_notificacion:s.hora_notificacion,dia_notificacion:s.dia_notificacion,estado:s.estado,tiempo_inicio_horneado:s.tiempo_inicio_horneado,hora_ultima_venta:s.hora_ultima_venta,cantidad_vendida:s.cantidad_vendida,diferencia_notificacion_inicio:s.diferencia_notificacion_inicio,created_at:s.created_at})):[]});w(()=>{var u;return(u=x.notificaciones)!=null&&u.horneados?x.notificaciones.horneados:[]});const f=w(()=>B.value.map(s=>({paste:s.paste.nombre,recomendacion:"Producir",razon:`Faltan ${s.cantidad} unidades para las ${s.hora_notificacion}`})));Q(()=>{var u;return(u=x.notificaciones)==null?void 0:u.faltantes},u=>{u&&(b.value=f.value)},{immediate:!0});const C=u=>u?new Date(u).toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:"America/Mexico_City"}):"-",_=u=>`px-2 py-1 rounded-full text-xs font-medium ${{horneando:"bg-yellow-100 text-yellow-800 capitalize",retirado:"bg-blue-100 text-blue-800 capitalize",vendido:"bg-green-100 text-green-800 capitalize",desperdicio:"bg-red-100 text-red-800 capitalize",pendiente:"bg-gray-100 text-gray-800 capitalize",en_espera:"bg-green-100 text-green-800"}[u]}`,N=w(()=>{var a;if(!((a=x.notificaciones)!=null&&a.horneados))return[];let s=x.notificaciones.horneados.filter(r=>H(r.created_at));if(g.value==="todas")return s;if(g.value==="actual"){const v=m(new Date);return s.filter(F=>m(F.created_at)===v)}return s.filter(r=>m(r.created_at)===g.value)});return G(()=>{z()}),(u,s)=>D.value?(l(),c("div",pt,[e("div",mt,[s[4]||(s[4]=e("h2",{class:"text-xl font-semibold"},"Control de Producción",-1)),e("div",ft,[e("div",xt,[s[2]||(s[2]=e("label",{for:"fecha",class:"text-sm font-medium text-gray-700"},"Seleccionar día:",-1)),U(e("input",{type:"date",id:"fecha","onUpdate:modelValue":s[0]||(s[0]=a=>h.value=a),class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},null,512),[[Y,h.value]])]),e("div",vt,[s[3]||(s[3]=e("label",{for:"hora",class:"text-sm font-medium text-gray-700"},"Filtrar por hora:",-1)),U(e("select",{id:"hora","onUpdate:modelValue":s[1]||(s[1]=a=>g.value=a),class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[(l(!0),c(T,null,P(k.value,a=>(l(),c("option",{key:a.value,value:a.value},i(a.label),9,gt))),128))],512),[[K,g.value]])])])]),e("div",ht,[s[6]||(s[6]=e("h3",{class:"text-lg font-medium mb-2"},"Productos Faltantes",-1)),e("div",yt,[e("table",bt,[s[5]||(s[5]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Producto"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Faltante"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Horneada"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Vendida"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Día"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora Requerida"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Última Venta")])],-1)),e("tbody",_t,[(l(!0),c(T,null,P(A.value,a=>(l(),c("tr",{key:a.id,class:"hover:bg-gray-50"},[e("td",wt,[W(i(a.paste.nombre)+" ",1),e("span",$t,i(a.paste.tipo),1)]),e("td",Dt,i(a.cantidad)+" unidades ",1),e("td",kt,i(a.cantidad_horneada?`${a.cantidad_horneada} unidades`:"-"),1),e("td",Ht,i(a.cantidad_vendida?`${a.cantidad_vendida} unidades`:"-"),1),e("td",Ct,i(a.dia_notificacion),1),e("td",St,i(C(a.created_at)),1),e("td",Mt,[e("span",{class:Z(["px-2 py-1 text-xs font-medium rounded-full",a.estado==="pendiente"?"bg-red-100 text-red-800":a.estado==="horneando"?"bg-yellow-100 text-yellow-800":a.estado==="desperdicio"?"bg-red-100 text-red-800":"bg-green-100 text-green-800"])},i(a.estado==="pendiente"?"Sin hornear":a.estado==="desperdicio"?"Desperdicio":a.estado),3)]),e("td",Et,i(a.estado==="pendiente"?"-":a.hora_ultima_venta?C(a.hora_ultima_venta):"Sin ventas"),1)]))),128))])])])]),e("div",Tt,[s[7]||(s[7]=e("h3",{class:"text-lg font-medium mb-2"},"Tiempo de Reposición",-1)),e("div",Pt,[(l(!0),c(T,null,P(M.value,(a,r)=>(l(),c("div",{key:r,class:"bg-gray-50 p-4 rounded-lg"},[e("p",Ft,i(a.paste),1),e("p",null,"Tiempo promedio: "+i(a.promedio)+" minutos",1),e("p",null,"Última reposición: "+i(a.ultima),1)]))),128))])]),e("div",zt,[s[9]||(s[9]=e("h3",{class:"text-lg font-medium mb-2"},"Control de Tiempo de Producción",-1)),e("div",Lt,[e("table",Nt,[s[8]||(s[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Paste"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de notificación"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de Producción"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo en meter producción"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado")])],-1)),e("tbody",At,[(l(!0),c(T,null,P(N.value,a=>(l(),c("tr",{key:a.id},[e("td",Vt,i(a.paste.nombre),1),e("td",Bt,i(C(a.created_at)),1),e("td",It,i(C(a.tiempo_inicio_horneado)),1),e("td",jt,i(Math.round((new Date(a.diferencia_notificacion_inicio)-new Date(a.created_at))/6e4))+" min",1),e("td",Rt,[e("span",{class:Z(_(a.estado))},i(a.estado),3)])]))),128))])])])])])):I("",!0)}},Ot={class:"animate-pulse"},Zt={key:0,class:"mt-2"},qt={class:"font-bold"},ae={__name:"NotificationPanel",props:{notifications:{type:Array,required:!0},isVisible:{type:Boolean,default:!1},type:{type:String,required:!0,validator:$=>["warning","info"].includes($)},title:{type:String,required:!0}},emits:["toggle"],setup($){return(x,M)=>(l(),c("div",{class:Z(["p-4 border rounded shadow mb-4 size-fit cursor-pointer",{"bg-yellow-100":$.type==="warning","bg-blue-100":$.type==="info"}]),onClick:M[0]||(M[0]=b=>x.$emit("toggle"))},[e("h2",{class:Z(["text-lg font-bold text-center",{"text-yellow-800":$.type==="warning","text-blue-800":$.type==="info"}])},[W(i($.type==="warning"?"⚠️":"ℹ️")+" "+i($.title)+" ",1),e("span",Ot,"("+i($.notifications.length)+")",1),W(" "+i($.type==="warning"?"⚠️":"ℹ️"),1)],2),$.isVisible?(l(),c("ul",Zt,[(l(!0),c(T,null,P($.notifications,b=>(l(),c("li",{key:b.id,class:"mb-2"},[e("span",null,[e("span",qt,i(b.nombre),1),W(": "+i($.type==="warning"?"Faltan":"Hay")+" "+i($.type==="warning"?Math.abs(b.diferencia):b.diferencia)+" unidades para las "+i(b.hora)+" ",1),e("span",{class:Z(["text-sm",{"text-red-600":$.type==="warning","text-green-600":$.type==="info"}])}," ("+i(b.porcentaje)+"% del estimado) ",3)])]))),128))])):I("",!0)],2))}},Xt={class:"container mx-auto p-4"},Wt={class:"sm:flex justify-between flex-row text-sm"},Gt={class:"flex gap-3 sm:flex-row flex-col"},Jt={class:"mt-6"},Qt={__name:"Hornear",setup($){const x=S(!1),M=S(!1),b=S(null),D=S(null),{props:h}=q(),g=w(()=>h.auth.user.roles[0].name==="admin"),k=w(()=>h.inventario||[]),m=w(()=>h.estimacionesHoy||[]),p=()=>{const s=new Date;return{day:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"][s.getDay()].toLowerCase(),hour:s.getHours(),minutes:s.getMinutes()}},H=S(p());Q(()=>H.value.hour,s=>{s!==b.value&&(b.value=s,C.value.length>0&&(x.value=!0),_.value.length>0&&(M.value=!0))}),G(()=>{b.value=H.value.hour,D.value=setInterval(()=>{H.value=p()},1e3)}),re(()=>{D.value&&clearInterval(D.value)});const z=s=>{const[a,r]=s.toLowerCase().split(" ");let[v,F]=a.split(":").map(Number);return{hours:r==="pm"&&v!==12?v+12:r==="am"&&v===12?0:v,minutes:F}},L=w(()=>k.value.filter(s=>{var a;return["pastes","empanadas dulces","empanadas saladas"].includes((a=s.tipo)==null?void 0:a.toLowerCase())})),A=w(()=>{if(!m.value.length||!L.value.length)return console.log("No hay estimaciones o productos relevantes"),[];const s=new Map(L.value.map(r=>[r.id,r]));return m.value.map(r=>{const v=s.get(r.inventario_id);if(!v)return null;const{hours:F}=z(r.hora);return{id:`${v.id}-${r.hora}`,nombre:v.nombre,estimado:r.cantidad,existente:v.cantidad,diferencia:v.cantidad-r.cantidad,hora:r.hora,dia:r.dia.toLowerCase(),horaEnNumero:F,tipo:v.tipo}}).filter(Boolean).filter((r,v,F)=>v===F.findIndex(E=>E.id===r.id))}),B=w(()=>A.value.filter(a=>a.dia===H.value.day)),f=w(()=>{const a=(H.value.hour+1)%24,r=B.value.filter(E=>E.horaEnNumero===a),v=new Map(r.map(E=>[E.nombre,E]));return L.value.map(E=>{const O=v.get(E.nombre);return O||{id:`${E.id}-${a}:00`,nombre:E.nombre,estimado:0,existente:E.cantidad,diferencia:E.cantidad,hora:`${a}:00`,dia:H.value.day,horaEnNumero:a,tipo:E.tipo}})}),C=w(()=>f.value.filter(a=>a.estimado>0&&a.diferencia<0).map(a=>({...a,porcentaje:a.estimado>0?Math.round(a.existente/a.estimado*100):0}))),_=w(()=>f.value.filter(a=>a.estimado>0&&a.diferencia>0||a.estimado===0&&a.existente>0).map(a=>({...a,porcentaje:a.estimado>0?Math.round(a.existente/a.estimado*100):100}))),N=()=>x.value=!x.value,u=()=>M.value=!M.value;return(s,a)=>(l(),c("div",Xt,[e("div",Wt,[a[0]||(a[0]=e("h1",{class:"text-2xl font-bold mb-4"},"Sistema de Horneado",-1)),e("div",Gt,[R(ae,{notifications:C.value,"is-visible":x.value,type:"warning",title:"Faltantes",onToggle:N},null,8,["notifications","is-visible"]),R(ae,{notifications:_.value,"is-visible":M.value,type:"info",title:"Excedentes",onToggle:u},null,8,["notifications","is-visible"])])]),e("div",Jt,[R(ut),R(Ut),oe(h).user.roles[0]!=="supervisor"?(l(),J(He,{key:0})):I("",!0),g.value?(l(),J(Ie,{key:1})):I("",!0)])]))}},Kt={class:"py-6"},Yt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 rounded-xl overflow-hidden"},ea={class:"flex justify-between p-6 lg:p-8 bg-white border-b border-gray-200 rounded-2xl"},na={__name:"index",setup($){return(x,M)=>(l(),J(se,{title:"Tablero principal"},{default:le(()=>[e("div",Kt,[e("div",Yt,[e("div",ea,[R(Qt)])])])]),_:1}))}};export{na as default};
