import{S as V,_ as se}from"./AppLayout-w_ABFGFk.js";import{Q as q,d as H,p as $,o as l,e as c,a as e,F as E,h as P,t as r,f as j,x as J,i as K,j as O,l as Y,v as ee,z as W,k as ne,b as U,u as oe,B as ie,y as te,g as G,n as Z,C as re,c as Q,w as le}from"./app-C_Trl-Kj.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as ce}from"./createLucideIcon-BvFLNyzH.js";/**
 * @license lucide-vue-next v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=ce("Trash2Icon",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),pe={class:"bg-white rounded-lg shadow-md overflow-hidden"},me={class:"overflow-x-auto"},fe={class:"min-w-full divide-y divide-gray-200"},xe={class:"bg-white divide-y divide-gray-200"},ve={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},ge={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},he={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},_e={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},be={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ye={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},we={key:0},$e={class:"bg-gray-50"},De={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},ke={__name:"PastesHorneados",setup(k){const{props:x}=q();H(x.pastesHorneados);const S=$(()=>{const v={};x.pastesHorneados.forEach(m=>{v[m.relleno]||(v[m.relleno]={totalPiezas:0,items:[]}),v[m.relleno].totalPiezas+=Number(m.piezas),v[m.relleno].items.push(m)});const g=[];return Object.keys(v).forEach(m=>{v[m].items.forEach((F,C)=>{g.push({...F,totalPiezas:v[m].totalPiezas,isFirst:C===0})})}),g}),y=$(()=>S.value.reduce((v,g)=>Number(v)+(g.isFirst?Number(g.totalPiezas):0),0)),w=v=>new Date(v).toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"America/Mexico_City"}),h=v=>new Date(v).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",timeZone:"America/Mexico_City"});return(v,g)=>(l(),c("div",null,[g[3]||(g[3]=e("h1",{class:"pb-4 pt-10 font-semibold text-xl"},"Pastes/Empanadas horneados de hoy",-1)),e("div",pe,[e("div",me,[e("table",fe,[g[2]||(g[2]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Responsable"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Paste/Empanada"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Hora"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Día"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Piezas Horneadas"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Total del día")])],-1)),e("tbody",xe,[(l(!0),c(E,null,P(S.value,(m,F)=>{var C,L,z;return l(),c("tr",{key:F},[e("td",ve,r((C=m==null?void 0:m.responsable)==null?void 0:C.name)+" "+r(((L=m==null?void 0:m.responsable)==null?void 0:L.apellido_p)||"")+" "+r(((z=m==null?void 0:m.responsable)==null?void 0:z.apellido_m)||""),1),e("td",ge,r(m.relleno),1),e("td",he,r(w(m.updated_at)),1),e("td",_e,r(h(m.updated_at)),1),e("td",be,r(m.piezas),1),e("td",ye,[m.isFirst?(l(),c("span",we,r(m.totalPiezas),1)):j("",!0)])])}),128))]),e("tfoot",$e,[e("tr",null,[g[0]||(g[0]=e("td",{colspan:"3",class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},"Total de piezas horneadas:",-1)),e("td",De,r(y.value),1),g[1]||(g[1]=e("td",null,null,-1))])])])])])]))}},Ce=de(ke,[["__scopeId","data-v-1a02fb88"]]),Me={class:"pt-16"},He={class:"max-w-7xl mx-auto space-y-6"},Se={class:"bg-white rounded-lg shadow p-6"},Te={class:"text-2xl font-bold text-gray-900"},Ee={class:"mt-4"},Pe=["value"],Fe={key:0,class:"bg-white rounded-lg shadow overflow-x-auto"},ze={class:"min-w-full divide-y divide-gray-200"},Le={class:"bg-gray-50"},Ne={class:"bg-white divide-y divide-gray-200"},Ae={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ve=["onUpdate:modelValue"],Ie={key:1,class:"w-full flex justify-end"},Be={__name:"EstimacionPastes",setup(k){const{props:x}=q(),S=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"],y=new Date().getDay(),w=S[y],h=H(w||"Lunes"),v=H(!1),g=[{value:"Lunes",label:"Lunes"},{value:"Martes",label:"Martes"},{value:"Miercoles",label:"Miércoles"},{value:"Jueves",label:"Jueves"},{value:"Viernes",label:"Viernes"},{value:"Sábado",label:"Sábado"},{value:"Domingo",label:"Domingo"}],m=["7:00 am","8:00 am","9:00 am","10:00 am","11:00 am","12:00 pm","1:00 pm","2:00 pm","3:00 pm","4:00 pm","5:00 pm","6:00 pm","7:00 pm","8:00 pm","9:00 pm"],F=$(()=>x.inventario.filter(p=>["pastes","empanadas dulces","empanadas saladas"].includes(p.tipo)).map(p=>p.nombre)),C=H({}),L=V.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:p=>{p.onmouseenter=V.stopTimer,p.onmouseleave=V.resumeTimer}}),z=()=>{const p={};return m.forEach(M=>{p[M]={},F.value.forEach(D=>{p[M][D]=0})}),p},N=()=>{v.value=!1,C.value=z(),x.estimaciones.filter(M=>M.dia===h.value).forEach(({hora:M,cantidad:D,inventario_id:T})=>{var b;const A=(b=x.inventario.find(s=>s.id===T))==null?void 0:b.nombre;A&&C.value[M]&&(C.value[M][A]=D)}),v.value=!0},B=()=>{W.post("/estimaciones",{estimaciones:C.value,dia:h.value},{preserveState:!1,preserveScroll:!0,onSuccess:()=>L.fire({icon:"success",title:"Sobrantes guardados exitosamente"}),onError:()=>L.fire({icon:"error",title:"Error al guardar los sobrantes"})})};return J(()=>{N()}),K(h,()=>{N()}),(p,M)=>(l(),c("div",Me,[e("div",He,[e("header",Se,[e("h1",Te,"Sistema de Control de Producción - Día: "+r(h.value),1),e("div",Ee,[O(e("select",{"onUpdate:modelValue":M[0]||(M[0]=D=>h.value=D),class:"rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500"},[(l(),c(E,null,P(g,D=>e("option",{key:D.value,value:D.value},r(D.label),9,Pe)),64))],512),[[Y,h.value]])])]),v.value?(l(),c("div",Fe,[e("table",ze,[e("thead",Le,[e("tr",null,[M[1]||(M[1]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo",-1)),(l(!0),c(E,null,P(F.value,D=>(l(),c("th",{key:D,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},r(D),1))),128))])]),e("tbody",Ne,[(l(),c(E,null,P(m,D=>e("tr",{key:D},[e("td",Ae,r(D),1),(l(!0),c(E,null,P(F.value,T=>(l(),c("td",{key:T,class:"px-6 py-4 whitespace-nowrap"},[O(e("input",{type:"number","onUpdate:modelValue":A=>C.value[D][T]=A,class:"w-20 rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500",min:"0"},null,8,Ve),[[ee,C.value[D][T]]])]))),128))])),64))])])])):j("",!0),p.$page.props.auth.user.roles[0].name=="admin"?(l(),c("div",Ie,[e("button",{onClick:B,class:"px-3 py-2 bg-orange-500 rounded-lg text-white hover:bg-orange-400"}," Guardar ")])):j("",!0)])]))}},je={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Re={class:"bg-white shadow rounded-lg p-6"},Ue={class:"mb-6"},Oe={class:"list-disc pl-5"},Ze={class:"capitalize"},qe={class:"font-semibold"},Xe={class:"list-disc pl-5"},We={class:"font-semibold"},Ge={class:"bg-white shadow rounded-lg p-6"},Je=["value"],Qe=["max"],Ke=["disabled"],Ye={key:0,class:"text-sm text-red-600 mt-2"},et={key:0},tt={key:1},at={class:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-4"},ot={class:"flex justify-between"},st={class:"text-xl font-semibold mb-4"},nt=["onClick"],it={key:0},rt={class:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 mb-4"},lt={key:1},dt=["disabled"],ct={class:"mt-8 bg-white shadow rounded-lg p-6"},ut={key:0,class:"text-gray-500 text-center py-4"},pt={key:1,class:"divide-y divide-gray-200"},mt=["onClick"],ft={__name:"SistemaHorneado",setup(k){const{props:x}=q(),S=x.inventario,y=H(x.hornos||[]),w=H(y.value.map(a=>({...a,horneando:a.estado||!1,pastesHorneando:a.pastesHorneando||[],tiempoInicio:a.tiempo_inicio?new Date(a.tiempo_inicio).getTime():0,tiempoFin:a.tiempo_fin?new Date(a.tiempo_fin).getTime():0,tiempoTranscurrido:0,timer:null,labeltime:"00:00"}))),h=H(9e5),v=H([]),g=()=>{if(v.value.length===0)return;const a=w.value.find(t=>!t.horneando);if(a){a.horneando=!0,a.pastesHorneando=[...v.value],v.value=[],a.tiempoInicio=Date.now(),a.tiempoFin=a.tiempoInicio+h.value;try{te.post("/iniciar-horneado",{horno_id:a.id,tiempo_inicio:a.tiempoInicio,tiempo_fin:a.tiempoFin,pastes_horneando:a.pastesHorneando,estado:!0}).then(t=>{console.log(t)}).catch(t=>{console.error("Error al iniciar el horneado:",t)}),V.fire({icon:"success",title:"Horneando",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500}),u(a.id)}catch(t){console.error("Error al iniciar el horneado:",t),V.fire({icon:"error",title:"Error al iniciar",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}}else I()},m=V.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:a=>{a.addEventListener("mouseenter",V.stopTimer),a.addEventListener("mouseleave",V.resumeTimer)}}),F=async a=>{const t=w.value.find(n=>n.id===a);if(!(!t||!t.horneando))try{clearInterval(t.timer);const n=[...t.pastesHorneando];t.horneando=!1,t.pastesHorneando=[],t.tiempoTranscurrido=0,t.labeltime="00:00",C();for(const d of n){const f=S.find(R=>R.nombre.toLowerCase()===d.nombre.toLowerCase()&&(R.tipo==="pastes"||R.tipo==="empanadas saladas"||R.tipo==="empanadas dulces"));if(f)try{await te.post("/api/control-produccion/horneado",{horno_id:a,paste_id:f.id,cantidad:d.cantidad})}catch(R){console.error(`Horno ${a} - Error al registrar producción para ${d.nombre}:`,R)}else console.error(`Horno ${a} - No se encontró el paste ${d.nombre} en el inventario`)}W.post("/hornear",{horno_id:a,pastes:n},{preserveScroll:!0,preserveState:!1,replace:!0,onSuccess:()=>{m.fire({icon:"success",title:"Horneado finalizado"})},onError:d=>{console.error(`Horno ${a} - Error al registrar el horneado:`,d),m.fire({icon:"error",title:"Error al registrar el horneado"})}})}catch(n){console.error(`Horno ${a} - Error en finalizarHorneado:`,n)}},C=()=>{new Audio("/sound/videoplayback.mp3").play().catch(t=>console.error("Error al reproducir el sonido:",t))},L=$(()=>S.filter(a=>a.tipo==="masa")),z=$(()=>S.filter(a=>a.tipo==="relleno")),N=$(()=>L.value.map(a=>{const t=w.value.filter(n=>n.horneando&&n.pastesHorneando.some(d=>d.masa===a.nombre)).reduce((n,d)=>n+d.pastesHorneando.find(f=>f.masa===a.nombre).cantidad,0);return{...a,cantidad:Math.max(0,a.cantidad-t)}})),B=$(()=>z.value.map(a=>{const t=w.value.filter(n=>n.horneando&&n.pastesHorneando.some(d=>d.nombre===a.nombre)).reduce((n,d)=>n+d.pastesHorneando.find(f=>f.nombre===a.nombre).cantidad,0);return{...a,cantidad:Math.max(0,a.cantidad-t)}})),p=H({masa:"",relleno:"",cantidad:1,sucursal_id:x.auth.user.sucursal_id}),M=a=>{const t={pastes:"bola","empanadas saladas":"salada","empanadas dulces":"dulce"},n=x.inventario.find(d=>(d.nombre.toLowerCase()===a.value.relleno.toLowerCase()||d.nombre.toLowerCase().startsWith(a.value.relleno.toLowerCase()))&&t[d.tipo.toLowerCase()]);return n?t[n.tipo.toLowerCase()]:"bola"},D=()=>{const a=M(p).toLowerCase(),t=N.value.find(f=>f.nombre.toLowerCase()===a),n=B.value.find(f=>f.nombre.toLowerCase()===p.value.relleno.toLowerCase());if(!t||t.cantidad<=0){m.fire({icon:"error",title:"No hay suficiente masa disponible"});return}if(!n||n.cantidad<=0){m.fire({icon:"error",title:"No hay suficiente relleno disponible"});return}const d=Math.min(t.cantidad,n.cantidad);if(p.value.cantidad>d){m.fire({icon:"error",title:`Solo hay ${d} unidades disponibles (${t.cantidad} masa, ${n.cantidad} relleno)`});return}if(t&&n&&p.value.cantidad<=d){t.cantidad-=p.value.cantidad,n.cantidad-=p.value.cantidad;const f=v.value.find(R=>R.nombre===n.nombre);f?f.cantidad+=p.value.cantidad:s({id:Date.now(),masa:t.nombre,nombre:n.nombre,cantidad:p.value.cantidad,sucursal_id:x.auth.user.sucursal_id}),p.value={masa:"",relleno:"",cantidad:1,sucursal_id:x.auth.user.sucursal_id}}},T=$(()=>{const a=M(p).toLowerCase(),t=N.value.find(d=>d.nombre.toLowerCase()===a),n=B.value.find(d=>d.nombre===p.value.relleno);return!t||!n?0:Math.min(t.cantidad,n.cantidad)}),A=$(()=>{const a=M(p).toLowerCase(),t=N.value.find(f=>f.nombre.toLowerCase()===a),n=B.value.find(f=>f.nombre===p.value.relleno);if(!t||!n)return!1;const d=Math.min(t.cantidad,n.cantidad);return p.value.relleno&&p.value.cantidad>0&&p.value.cantidad<=d&&d>0});H("00:00");const b=a=>{if(a<=0)return"00:00";const t=Math.floor(a/1e3),n=Math.floor(t/60),d=t%60;return`${String(n).padStart(2,"0")}:${String(d).padStart(2,"0")}`},s=a=>{const t=S.find(n=>n.nombre.toLowerCase()===a.nombre.toLowerCase()&&(n.tipo==="pastes"||n.tipo==="empanadas saladas"||n.tipo==="empanadas dulces"));t?v.value.push({...a,paste_id:t.id}):console.error(`No se encontró el paste ${a.nombre} en el inventario`)},o=a=>{v.value=v.value.filter(t=>t.id!==a)},i=a=>{F(a).catch(t=>{console.error(`Error al finalizar horneado desde timer: ${t}`)})},u=a=>{const t=w.value.find(f=>f.id===a);if(!t)return;const d=t.tiempoFin-Date.now();if(d<=0){i(a);return}t.tiempoTranscurrido=h.value-d,t.labeltime=b(d),t.timer&&clearInterval(t.timer),t.timer=setInterval(()=>{const f=t.tiempoFin-Date.now();if(f<=0){clearInterval(t.timer),i(a);return}t.tiempoTranscurrido=h.value-f,t.labeltime=b(f)},1e3)},_=a=>{const t=w.value.find(f=>f.id===a);if(!t)return;const d=t.tiempoFin-Date.now();if(d<=0){i(a);return}t.tiempoTranscurrido=h.value-d,t.labeltime=b(d),t.timer&&clearInterval(t.timer),t.timer=setInterval(()=>{const f=t.tiempoFin-Date.now();if(f<=0){clearInterval(t.timer),i(a);return}t.tiempoTranscurrido=h.value-f,t.labeltime=b(f)},1e3)};J(()=>{w.value.forEach(a=>{a.timer&&clearInterval(a.timer)}),w.value.forEach(a=>{if(a.estado){const t=Date.now()-new Date(a.tiempo_inicio).getTime(),n=h.value-t;if(n<=0){i(a.id);return}a.tiempoFin=Date.now()+n,_(a.id)}})});const I=()=>{W.post("/crear-horno",{estado:!1,pastesHorneando:[]},{preserverScroll:!0,preserveState:!1,onSuccess:a=>{var t;y.value=(t=a==null?void 0:a.props)==null?void 0:t.hornos,v.value=[],w.value=y.value.map(n=>({...n,horneando:n.estado||!1,pastesHorneando:n.pastesHorneando||[],tiempoInicio:n.tiempo_inicio?new Date(n.tiempo_inicio).getTime():0,tiempoFin:n.tiempo_fin?new Date(n.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),V.fire({icon:"success",title:"Horno creado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:a=>{console.error("Error al crear el horno:",a),V.fire({icon:"error",title:"Error al crear horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})},X=a=>{W.post("/eliminar-horno",{horno_id:a},{preserveScroll:!0,preserveState:!1,onSuccess:t=>{var n;y.value=(n=t==null?void 0:t.props)==null?void 0:n.hornos,w.value=y.value.map(d=>({...d,horneando:d.estado||!1,pastesHorneando:d.pastesHorneando||[],tiempoInicio:d.tiempo_inicio?new Date(d.tiempo_inicio).getTime():0,tiempoFin:d.tiempo_fin?new Date(d.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),V.fire({icon:"success",title:"Horno eliminado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:t=>{console.error("Error al eliminar el horno:",t),V.fire({icon:"error",title:"Error al eliminar horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})};return(a,t)=>(l(),c(E,null,[e("div",je,[e("div",Re,[t[4]||(t[4]=e("h2",{class:"text-xl font-semibold mb-4"},"Ingredientes Disponibles",-1)),e("div",Ue,[t[2]||(t[2]=e("h3",{class:"text-lg font-medium mb-2"},"Masas",-1)),e("ul",Oe,[(l(!0),c(E,null,P(N.value,n=>(l(),c("li",{key:n.id,class:"flex justify-between"},[e("span",Ze,r(n.nombre),1),e("span",qe,r(n.cantidad)+" unidades",1)]))),128))])]),e("div",null,[t[3]||(t[3]=e("h3",{class:"text-lg font-medium mb-2"},"Rellenos",-1)),e("ul",Xe,[(l(!0),c(E,null,P(B.value,n=>(l(),c("li",{key:n.id,class:"flex justify-between"},[e("span",null,r(n.nombre),1),e("span",We,r(n.cantidad)+" unidades",1)]))),128))])])]),e("div",Ge,[t[8]||(t[8]=e("h2",{class:"text-xl font-semibold mb-4"},"Crear Nuevo Paste/Empanada",-1)),e("form",{onSubmit:ne(D,["prevent"]),class:"space-y-4"},[e("div",null,[t[6]||(t[6]=e("label",{for:"relleno",class:"block text-sm font-medium text-gray-700"},"Seleccionar Relleno",-1)),O(e("select",{"onUpdate:modelValue":t[0]||(t[0]=n=>p.value.relleno=n),id:"relleno",required:"",class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md"},[t[5]||(t[5]=e("option",{value:""},"Seleccione un relleno",-1)),(l(!0),c(E,null,P(z.value,n=>(l(),c("option",{key:n.id,value:n.nombre},r(n.nombre),9,Je))),128))],512),[[Y,p.value.relleno]])]),e("div",null,[t[7]||(t[7]=e("label",{for:"cantidad",class:"block text-sm font-medium text-gray-700"},"Cantidad",-1)),O(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>p.value.cantidad=n),type:"number",id:"cantidad",required:"",min:"1",max:T.value,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 sm:text-sm"},null,8,Qe),[[ee,p.value.cantidad,void 0,{number:!0}]])]),e("button",{type:"submit",disabled:!A.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed"},r(A.value?"Asignar Unidades":"Sin ingredientes suficientes"),9,Ke),p.value.relleno&&!A.value?(l(),c("div",Ye,[T.value===0?(l(),c("span",et,"No hay ingredientes disponibles")):(l(),c("span",tt,"Máximo disponible: "+r(T.value)+" unidades",1))])):j("",!0)],32)])]),e("div",at,[(l(!0),c(E,null,P(w.value,(n,d)=>(l(),c("div",{key:n.id,class:"bg-white shadow rounded-lg p-6"},[e("div",ot,[e("h2",st,"Horno "+r(d+1),1),!n.horneando&&y.value.length>1?(l(),c("button",{key:0,onClick:f=>X(n.id),class:"flex items-center gap-2 bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"},[U(oe(ue),{class:"w-4 h-4"})],8,nt)):j("",!0)]),n.horneando?(l(),c("div",it,[t[9]||(t[9]=e("p",{class:"text-lg mb-2"},"Horneando grupo de pastes:",-1)),e("ul",null,[(l(!0),c(E,null,P(n.pastesHorneando,f=>(l(),c("li",{key:f.nombre},r(f.cantidad)+" "+r(f.nombre)+" - masa "+r(f.masa),1))),128))]),e("div",rt,[e("div",{class:"bg-orange-600 h-2.5 rounded-full transition-all duration-100",style:ie({width:`${n.tiempoTranscurrido/h.value*100}%`})},null,4)]),e("p",null,"Tiempo restante: "+r(n.labeltime),1)])):(l(),c("div",lt,[t[10]||(t[10]=e("p",{class:"text-lg mb-4"},"El horno está disponible",-1)),e("button",{onClick:g,disabled:!v.value.length,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Iniciar Horneado de Grupo ",8,dt)]))]))),128)),e("div",{class:"mt-4 h-full flex justify-center items-center"},[e("button",{onClick:I,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500"}," Crear Nuevo Horno ")])]),e("div",ct,[t[11]||(t[11]=e("h2",{class:"text-xl font-semibold mb-4"},"Grupos de Pastes por Hornear",-1)),v.value.length===0?(l(),c("div",ut," No hay grupos de pastes en la cola de horneado ")):(l(),c("ul",pt,[(l(!0),c(E,null,P(v.value,n=>(l(),c("li",{key:n.id,class:"py-4 flex justify-between items-center"},[e("span",null,r(n.cantidad)+" "+r(n.nombre)+" - masa "+r(n.masa),1),e("button",{onClick:d=>o(n.id),class:"bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"}," Cancelar ",8,mt)]))),128))]))])],64))}},xt={key:0,class:"mt-8 bg-white shadow rounded-lg p-6"},vt={class:"flex justify-between items-center mb-4"},gt={class:"flex items-center space-x-4"},ht={class:"flex items-center space-x-2"},_t={class:"flex items-center space-x-2"},bt=["value"],yt={class:"mb-6"},wt={class:"overflow-x-auto"},$t={class:"min-w-full divide-y divide-gray-200"},Dt={class:"bg-white divide-y divide-gray-200"},kt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 capitalize"},Ct={class:"text-xs text-gray-500 block capitalize"},Mt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ht={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},St={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Tt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize"},Et={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Pt={class:"px-6 py-4 whitespace-nowrap"},Ft={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},zt={class:"mb-6"},Lt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Nt={class:"font-medium"},At={class:"mt-8"},Vt={class:"overflow-x-auto"},It={class:"min-w-full divide-y divide-gray-200"},Bt={class:"bg-white divide-y divide-gray-200"},jt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Rt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ut={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ot={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Zt={class:"px-6 py-4 whitespace-nowrap capitalize"},qt={__name:"ControlProduccion",setup(k){const{props:x}=q();H([]);const S=H([]);H([]);const y=$(()=>x.auth.user.roles[0].name==="admin");console.log(y.value);const w=H(new Date().toISOString().split("T")[0]),h=H("actual"),v=H([{value:"todas",label:"Todas las horas"},{value:"actual",label:"Hora Actual"},{value:"9-am",label:"9:00 AM"},{value:"10-am",label:"10:00 AM"},{value:"11-am",label:"11:00 AM"},{value:"12-pm",label:"12:00 PM"},{value:"1-pm",label:"1:00 PM"},{value:"2-pm",label:"2:00 PM"},{value:"3-pm",label:"3:00 PM"},{value:"4-pm",label:"4:00 PM"},{value:"5-pm",label:"5:00 PM"},{value:"6-pm",label:"6:00 PM"},{value:"7-pm",label:"7:00 PM"},{value:"8-pm",label:"8:00 PM"},{value:"9-pm",label:"9:00 PM"}]),g=s=>{const o=new Date(s),i=o.getHours();o.getMinutes();const u=i>=12?"pm":"am";return`${i%12||12}-${u}`},m=s=>{if(!s.tiempo_inicio_horneado||!s.created_at)return{promedio:0,ultima:"N/A",restante:"N/A"};const o=new Date(s.tiempo_inicio_horneado),i=new Date(s.created_at),u=Math.max(0,o-i),_=Math.floor(u/(1e3*60));return{promedio:_,ultima:T(s.tiempo_inicio_horneado),restante:_>0?`${_} min`:"Completado"}},F=s=>{if(!s.diferencia_notificacion_inicio||!s.created_at)return"N/A";const o=new Date(s.diferencia_notificacion_inicio),i=new Date(s.created_at),u=Math.max(0,o-i);return`${Math.floor(u/(1e3*60))} min`},C=()=>{const s=new Date(w.value+"T00:00:00-06:00"),o=new Date(w.value+"T23:59:59-06:00");return{inicio:s,fin:o}},L=s=>{const o=C();if(!o)return!0;const i=new Date(s),u=new Date(i.toLocaleString("en-US",{timeZone:"America/Mexico_City"})),_=new Date(o.inicio.toLocaleString("en-US",{timeZone:"America/Mexico_City"})),I=new Date(o.fin.toLocaleString("en-US",{timeZone:"America/Mexico_City"}));return u>=_&&u<=I},z=()=>{const s=new Date,o=new Date(s.toLocaleString("en-US",{timeZone:"America/Mexico_City"}));w.value=o.toISOString().split("T")[0]},N=s=>{if(s.estado&&s.estado!=="pendiente")return s.estado;if(s.estado==="pendiente"){const i=g(new Date);if(g(s.created_at)!==i)return"desperdicio"}return s.estado||"pendiente"},B=$(()=>{var i;if(!((i=x.notificaciones)!=null&&i.faltantes))return[];let o=x.notificaciones.faltantes.map(u=>({id:u.id,paste:u.paste,cantidad:u.cantidad,hora_notificacion:u.hora_notificacion,dia_notificacion:u.dia_notificacion,estado:N(u),tiempo_inicio_horneado:u.tiempo_inicio_horneado,hora_ultima_venta:u.hora_ultima_venta,cantidad_vendida:u.cantidad_vendida,diferencia_notificacion_inicio:u.diferencia_notificacion_inicio,created_at:u.created_at,cantidad_horneada:u.cantidad_horneada})).filter(u=>L(u.created_at));if(h.value==="todas")return o;if(h.value==="actual"){const _=g(new Date);return o.filter(I=>g(I.created_at)===_)}return o.filter(u=>g(u.created_at)===h.value)}),p=$(()=>{var s;return(s=x.notificaciones)!=null&&s.faltantes?x.notificaciones.faltantes.filter(o=>o.tiempo_inicio_horneado).map(o=>({paste:o.paste.nombre,...m(o)})):[]}),M=$(()=>{var s;return(s=x.notificaciones)!=null&&s.faltantes?x.notificaciones.faltantes.map(o=>({id:o.id,paste:o.paste,cantidad:o.cantidad,hora_notificacion:o.hora_notificacion,dia_notificacion:o.dia_notificacion,estado:o.estado,tiempo_inicio_horneado:o.tiempo_inicio_horneado,hora_ultima_venta:o.hora_ultima_venta,cantidad_vendida:o.cantidad_vendida,diferencia_notificacion_inicio:o.diferencia_notificacion_inicio,created_at:o.created_at})):[]});$(()=>{var s;return(s=x.notificaciones)!=null&&s.horneados?x.notificaciones.horneados:[]});const D=$(()=>M.value.map(o=>({paste:o.paste.nombre,recomendacion:"Producir",razon:`Faltan ${o.cantidad} unidades para las ${o.hora_notificacion}`})));K(()=>{var s;return(s=x.notificaciones)==null?void 0:s.faltantes},s=>{s&&(S.value=D.value)},{immediate:!0});const T=s=>s?new Date(s).toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:"America/Mexico_City"}):"-",A=s=>`px-2 py-1 rounded-full text-xs font-medium ${{horneando:"bg-yellow-100 text-yellow-800 capitalize",retirado:"bg-blue-100 text-blue-800 capitalize",vendido:"bg-green-100 text-green-800 capitalize",desperdicio:"bg-red-100 text-red-800 capitalize",pendiente:"bg-gray-100 text-gray-800 capitalize",en_espera:"bg-green-100 text-green-800"}[s]}`,b=$(()=>{var i;if(!((i=x.notificaciones)!=null&&i.horneados))return[];let o=x.notificaciones.horneados.map(u=>({...u,estado:N(u)})).filter(u=>L(u.created_at));if(h.value==="todas")return o;if(h.value==="actual"){const _=g(new Date);return o.filter(I=>g(I.created_at)===_)}return o.filter(u=>g(u.created_at)===h.value)});return J(()=>{z()}),(s,o)=>y.value?(l(),c("div",xt,[e("div",vt,[o[4]||(o[4]=e("h2",{class:"text-xl font-semibold"},"Control de Producción",-1)),e("div",gt,[e("div",ht,[o[2]||(o[2]=e("label",{for:"fecha",class:"text-sm font-medium text-gray-700"},"Seleccionar día:",-1)),O(e("input",{type:"date",id:"fecha","onUpdate:modelValue":o[0]||(o[0]=i=>w.value=i),class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},null,512),[[ee,w.value]])]),e("div",_t,[o[3]||(o[3]=e("label",{for:"hora",class:"text-sm font-medium text-gray-700"},"Filtrar por hora:",-1)),O(e("select",{id:"hora","onUpdate:modelValue":o[1]||(o[1]=i=>h.value=i),class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[(l(!0),c(E,null,P(v.value,i=>(l(),c("option",{key:i.value,value:i.value},r(i.label),9,bt))),128))],512),[[Y,h.value]])])])]),e("div",yt,[o[6]||(o[6]=e("h3",{class:"text-lg font-medium mb-2"},"Productos Faltantes",-1)),e("div",wt,[e("table",$t,[o[5]||(o[5]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Producto"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Faltante"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Horneada"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Vendida"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Día"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora Requerida"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Última Venta")])],-1)),e("tbody",Dt,[(l(!0),c(E,null,P(B.value,i=>(l(),c("tr",{key:i.id,class:"hover:bg-gray-50"},[e("td",kt,[G(r(i.paste.nombre)+" ",1),e("span",Ct,r(i.paste.tipo),1)]),e("td",Mt,r(i.cantidad)+" unidades ",1),e("td",Ht,r(i.cantidad_horneada?`${i.cantidad_horneada} unidades`:"-"),1),e("td",St,r(i.cantidad_vendida?`${i.cantidad_vendida} unidades`:"-"),1),e("td",Tt,r(i.dia_notificacion),1),e("td",Et,r(T(i.created_at)),1),e("td",Pt,[e("span",{class:Z(["px-2 py-1 text-xs font-medium rounded-full",i.estado==="pendiente"?"bg-red-100 text-red-800":i.estado==="horneando"?"bg-yellow-100 text-yellow-800":i.estado==="desperdicio"?"bg-red-100 text-red-800":"bg-green-100 text-green-800"])},r(i.estado==="pendiente"?"Sin hornear":i.estado==="desperdicio"?"Desperdicio":i.estado),3)]),e("td",Ft,r(i.estado==="pendiente"?"-":i.hora_ultima_venta?T(i.hora_ultima_venta):"Sin ventas"),1)]))),128))])])])]),e("div",zt,[o[7]||(o[7]=e("h3",{class:"text-lg font-medium mb-2"},"Tiempo de Reposición",-1)),e("div",Lt,[(l(!0),c(E,null,P(p.value,(i,u)=>(l(),c("div",{key:u,class:"bg-gray-50 p-4 rounded-lg"},[e("p",Nt,r(i.paste),1),e("p",null,"Tiempo promedio: "+r(i.promedio)+" minutos",1),e("p",null,"Última reposición: "+r(i.ultima),1),e("p",null,"Tiempo restante: "+r(i.restante),1)]))),128))])]),e("div",At,[o[9]||(o[9]=e("h3",{class:"text-lg font-medium mb-2"},"Control de Tiempo de Producción",-1)),e("div",Vt,[e("table",It,[o[8]||(o[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Paste"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de notificación"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de Producción"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo en meter producción"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado")])],-1)),e("tbody",Bt,[(l(!0),c(E,null,P(b.value,i=>(l(),c("tr",{key:i.id},[e("td",jt,r(i.paste.nombre),1),e("td",Rt,r(T(i.created_at)),1),e("td",Ut,r(T(i.tiempo_inicio_horneado)),1),e("td",Ot,r(F(i)),1),e("td",Zt,[e("span",{class:Z(A(i.estado))},r(i.estado),3)])]))),128))])])])])])):j("",!0)}},Xt={class:"animate-pulse"},Wt={key:0,class:"mt-2"},Gt={class:"font-bold"},ae={__name:"NotificationPanel",props:{notifications:{type:Array,required:!0},isVisible:{type:Boolean,default:!1},type:{type:String,required:!0,validator:k=>["warning","info"].includes(k)},title:{type:String,required:!0}},emits:["toggle"],setup(k){return(x,S)=>(l(),c("div",{class:Z(["p-4 border rounded shadow mb-4 size-fit cursor-pointer",{"bg-yellow-100":k.type==="warning","bg-blue-100":k.type==="info"}]),onClick:S[0]||(S[0]=y=>x.$emit("toggle"))},[e("h2",{class:Z(["text-lg font-bold text-center",{"text-yellow-800":k.type==="warning","text-blue-800":k.type==="info"}])},[G(r(k.type==="warning"?"⚠️":"ℹ️")+" "+r(k.title)+" ",1),e("span",Xt,"("+r(k.notifications.length)+")",1),G(" "+r(k.type==="warning"?"⚠️":"ℹ️"),1)],2),k.isVisible?(l(),c("ul",Wt,[(l(!0),c(E,null,P(k.notifications,y=>(l(),c("li",{key:y.id,class:"mb-2"},[e("span",null,[e("span",Gt,r(y.nombre),1),G(": "+r(k.type==="warning"?"Faltan":"Hay")+" "+r(k.type==="warning"?Math.abs(y.diferencia):y.diferencia)+" unidades para las "+r(y.hora)+" ",1),e("span",{class:Z(["text-sm",{"text-red-600":k.type==="warning","text-green-600":k.type==="info"}])}," ("+r(y.porcentaje)+"% del estimado) ",3)])]))),128))])):j("",!0)],2))}},Jt={class:"container mx-auto p-4"},Qt={class:"sm:flex justify-between flex-row text-sm"},Kt={class:"flex gap-3 sm:flex-row flex-col"},Yt={class:"mt-6"},ea={__name:"Hornear",setup(k){const x=H(!1),S=H(!1),y=H(null),w=H(null),{props:h}=q(),v=$(()=>h.auth.user.roles[0].name==="admin"),g=$(()=>h.inventario||[]),m=$(()=>h.estimacionesHoy||[]),F=()=>{const b=new Date;return{day:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"][b.getDay()].toLowerCase(),hour:b.getHours(),minutes:b.getMinutes()}},C=H(F());K(()=>C.value.hour,b=>{b!==y.value&&(y.value=b,M.value.length>0&&(x.value=!0),D.value.length>0&&(S.value=!0))}),J(()=>{y.value=C.value.hour,w.value=setInterval(()=>{C.value=F()},1e3)}),re(()=>{w.value&&clearInterval(w.value)});const L=b=>{const[s,o]=b.toLowerCase().split(" ");let[i,u]=s.split(":").map(Number);return{hours:o==="pm"&&i!==12?i+12:o==="am"&&i===12?0:i,minutes:u}},z=$(()=>g.value.filter(b=>{var s;return["pastes","empanadas dulces","empanadas saladas"].includes((s=b.tipo)==null?void 0:s.toLowerCase())})),N=$(()=>{if(!m.value.length||!z.value.length)return console.log("No hay estimaciones o productos relevantes"),[];const b=new Map(z.value.map(o=>[o.id,o]));return m.value.map(o=>{const i=b.get(o.inventario_id);if(!i)return null;const{hours:u}=L(o.hora);return{id:`${i.id}-${o.hora}`,nombre:i.nombre,estimado:o.cantidad,existente:i.cantidad,diferencia:i.cantidad-o.cantidad,hora:o.hora,dia:o.dia.toLowerCase(),horaEnNumero:u,tipo:i.tipo}}).filter(Boolean).filter((o,i,u)=>i===u.findIndex(_=>_.id===o.id))}),B=$(()=>N.value.filter(s=>s.dia===C.value.day)),p=$(()=>{const s=(C.value.hour+1)%24,o=B.value.filter(_=>_.horaEnNumero===s),i=new Map(o.map(_=>[_.nombre,_]));return z.value.map(_=>{const I=i.get(_.nombre);return I||{id:`${_.id}-${s}:00`,nombre:_.nombre,estimado:0,existente:_.cantidad,diferencia:_.cantidad,hora:`${s}:00`,dia:C.value.day,horaEnNumero:s,tipo:_.tipo}})}),M=$(()=>p.value.filter(s=>s.estimado>0&&s.diferencia<0).map(s=>({...s,porcentaje:s.estimado>0?Math.round(s.existente/s.estimado*100):0}))),D=$(()=>p.value.filter(s=>s.estimado>0&&s.diferencia>0||s.estimado===0&&s.existente>0).map(s=>({...s,porcentaje:s.estimado>0?Math.round(s.existente/s.estimado*100):100}))),T=()=>x.value=!x.value,A=()=>S.value=!S.value;return(b,s)=>(l(),c("div",Jt,[e("div",Qt,[s[0]||(s[0]=e("h1",{class:"text-2xl font-bold mb-4"},"Sistema de Horneado",-1)),e("div",Kt,[U(ae,{notifications:M.value,"is-visible":x.value,type:"warning",title:"Faltantes",onToggle:T},null,8,["notifications","is-visible"]),U(ae,{notifications:D.value,"is-visible":S.value,type:"info",title:"Excedentes",onToggle:A},null,8,["notifications","is-visible"])])]),e("div",Yt,[U(ft),U(qt),oe(h).user.roles[0]!=="supervisor"?(l(),Q(Ce,{key:0})):j("",!0),v.value?(l(),Q(Be,{key:1})):j("",!0)])]))}},ta={class:"py-6"},aa={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 rounded-xl overflow-hidden"},oa={class:"flex justify-between p-6 lg:p-8 bg-white border-b border-gray-200 rounded-2xl"},la={__name:"index",setup(k){return(x,S)=>(l(),Q(se,{title:"Tablero principal"},{default:le(()=>[e("div",ta,[e("div",aa,[e("div",oa,[U(ea)])])])]),_:1}))}};export{la as default};
