import{S as O,_ as he}from"./AppLayout-DoVd_Kc7.js";import{Q,d as M,p as _,o as i,e as l,a,F as z,h as P,t as d,f as U,x as ne,i as ae,j as X,l as de,v as le,z as W,k as xe,b as Z,u as pe,B as ve,y as ce,g as oe,n as K,C as ge,c as ie,w as _e}from"./app-CtVDveFF.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as be}from"./createLucideIcon-DX4rGE3g.js";/**
 * @license lucide-vue-next v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=be("Trash2Icon",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),$e={class:"bg-white rounded-lg shadow-md overflow-hidden"},Ee={class:"overflow-x-auto"},Se={class:"min-w-full divide-y divide-gray-200"},De={class:"bg-white divide-y divide-gray-200"},He={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},ke={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Me={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Te={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ce={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Fe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ne={key:0},ze={class:"bg-gray-50"},Pe={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Ie={__name:"PastesHorneados",setup(S){const{props:x}=Q();M(x.pastesHorneados);const T=_(()=>{const h={};x.pastesHorneados.forEach(m=>{h[m.relleno]||(h[m.relleno]={totalPiezas:0,items:[]}),h[m.relleno].totalPiezas+=Number(m.piezas),h[m.relleno].items.push(m)});const w=[];return Object.keys(h).forEach(m=>{h[m].items.forEach((I,k)=>{w.push({...I,totalPiezas:h[m].totalPiezas,isFirst:k===0})})}),w}),C=_(()=>T.value.reduce((h,w)=>Number(h)+(w.isFirst?Number(w.totalPiezas):0),0)),b=h=>new Date(h).toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"America/Mexico_City"}),f=h=>new Date(h).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",timeZone:"America/Mexico_City"});return(h,w)=>(i(),l("div",null,[w[3]||(w[3]=a("h1",{class:"pb-4 pt-10 font-semibold text-xl"},"Pastes/Empanadas horneados de hoy",-1)),a("div",$e,[a("div",Ee,[a("table",Se,[w[2]||(w[2]=a("thead",{class:"bg-gray-50"},[a("tr",null,[a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Responsable"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Paste/Empanada"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Hora"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Día"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Piezas Horneadas"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Total del día")])],-1)),a("tbody",De,[(i(!0),l(z,null,P(T.value,(m,I)=>{var k,R,V;return i(),l("tr",{key:I},[a("td",He,d((k=m==null?void 0:m.responsable)==null?void 0:k.name)+" "+d(((R=m==null?void 0:m.responsable)==null?void 0:R.apellido_p)||"")+" "+d(((V=m==null?void 0:m.responsable)==null?void 0:V.apellido_m)||""),1),a("td",ke,d(m.relleno),1),a("td",Me,d(b(m.updated_at)),1),a("td",Te,d(f(m.updated_at)),1),a("td",Ce,d(m.piezas),1),a("td",Fe,[m.isFirst?(i(),l("span",Ne,d(m.totalPiezas),1)):U("",!0)])])}),128))]),a("tfoot",ze,[a("tr",null,[w[0]||(w[0]=a("td",{colspan:"3",class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},"Total de piezas horneadas:",-1)),a("td",Pe,d(C.value),1),w[1]||(w[1]=a("td",null,null,-1))])])])])])]))}},Le=ye(Ie,[["__scopeId","data-v-1a02fb88"]]),Ve={class:"pt-16"},Ae={class:"max-w-7xl mx-auto space-y-6"},je={class:"bg-white rounded-lg shadow p-6"},Be={class:"text-2xl font-bold text-gray-900"},Oe={class:"mt-4"},Ue=["value"],Re={key:0,class:"bg-white rounded-lg shadow overflow-x-auto"},qe={class:"min-w-full divide-y divide-gray-200"},Je={class:"bg-gray-50"},We={class:"bg-white divide-y divide-gray-200"},Ge={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ze=["onUpdate:modelValue"],Xe={key:1,class:"w-full flex justify-end"},Ke={__name:"EstimacionPastes",setup(S){const{props:x}=Q(),T=["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"],C=new Date().getDay(),b=T[C],f=M(b||"Lunes"),h=M(!1),w=[{value:"Lunes",label:"Lunes"},{value:"Martes",label:"Martes"},{value:"Miercoles",label:"Miércoles"},{value:"Jueves",label:"Jueves"},{value:"Viernes",label:"Viernes"},{value:"Sábado",label:"Sábado"},{value:"Domingo",label:"Domingo"}],m=["7:00 am","8:00 am","9:00 am","10:00 am","11:00 am","12:00 pm","1:00 pm","2:00 pm","3:00 pm","4:00 pm","5:00 pm","6:00 pm","7:00 pm","8:00 pm","9:00 pm"],I=_(()=>x.inventario.filter(p=>["pastes","empanadas dulces","empanadas saladas"].includes(p.tipo)).map(p=>p.nombre)),k=M({}),R=O.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:p=>{p.onmouseenter=O.stopTimer,p.onmouseleave=O.resumeTimer}}),V=()=>{const p={};return m.forEach(D=>{p[D]={},I.value.forEach($=>{p[D][$]=0})}),p},A=()=>{h.value=!1,k.value=V(),x.estimaciones.filter(D=>D.dia===f.value).forEach(({hora:D,cantidad:$,inventario_id:j})=>{var v;const B=(v=x.inventario.find(c=>c.id===j))==null?void 0:v.nombre;B&&k.value[D]&&(k.value[D][B]=$)}),h.value=!0},q=()=>{W.post("/estimaciones",{estimaciones:k.value,dia:f.value},{preserveState:!1,preserveScroll:!0,onSuccess:()=>R.fire({icon:"success",title:"Estimaciones guardados exitosamente"}),onError:()=>R.fire({icon:"error",title:"Error al guardar las estimaciones"})})};return ne(()=>{A()}),ae(f,()=>{A()}),(p,D)=>(i(),l("div",Ve,[a("div",Ae,[a("header",je,[a("h1",Be,"Sistema de Control de Producción - Día: "+d(f.value),1),a("div",Oe,[X(a("select",{"onUpdate:modelValue":D[0]||(D[0]=$=>f.value=$),class:"rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500"},[(i(),l(z,null,P(w,$=>a("option",{key:$.value,value:$.value},d($.label),9,Ue)),64))],512),[[de,f.value]])])]),h.value?(i(),l("div",Re,[a("table",qe,[a("thead",Je,[a("tr",null,[D[1]||(D[1]=a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo",-1)),(i(!0),l(z,null,P(I.value,$=>(i(),l("th",{key:$,class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},d($),1))),128))])]),a("tbody",We,[(i(),l(z,null,P(m,$=>a("tr",{key:$},[a("td",Ge,d($),1),(i(!0),l(z,null,P(I.value,j=>(i(),l("td",{key:j,class:"px-6 py-4 whitespace-nowrap"},[X(a("input",{type:"number","onUpdate:modelValue":B=>k.value[$][j]=B,class:"w-20 rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500",min:"0"},null,8,Ze),[[le,k.value[$][j]]])]))),128))])),64))])])])):U("",!0),p.$page.props.auth.user.roles[0].name=="admin"?(i(),l("div",Xe,[a("button",{onClick:q,class:"px-3 py-2 bg-orange-500 rounded-lg text-white hover:bg-orange-400"}," Guardar ")])):U("",!0)])]))}},Qe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ye={class:"bg-white shadow rounded-lg p-6"},et={class:"mb-6"},tt={class:"list-disc pl-5"},ot={class:"capitalize"},at={class:"font-semibold"},nt={class:"list-disc pl-5"},rt={class:"font-semibold"},st={class:"bg-white shadow rounded-lg p-6"},it=["value"],dt=["max"],lt=["disabled"],ct={key:0,class:"text-sm text-red-600 mt-2"},ut={key:0},pt={key:1},mt={class:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-4"},ft={class:"flex justify-between"},ht={class:"text-xl font-semibold mb-4"},xt=["onClick"],vt={key:0},gt={class:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700 mb-4"},_t={key:1},yt=["disabled"],bt={class:"mt-8 bg-white shadow rounded-lg p-6"},wt={key:0,class:"text-gray-500 text-center py-4"},$t={key:1,class:"divide-y divide-gray-200"},Et=["onClick"],St={__name:"SistemaHorneado",setup(S){var ee,te;const{props:x}=Q(),T=x.inventario||[],C=M(x.hornos||[]),b=M(C.value.map(n=>({...n,horneando:n.estado||!1,pastesHorneando:n.pastesHorneando||[],tiempoInicio:n.tiempo_inicio?new Date(n.tiempo_inicio).getTime():0,tiempoFin:n.tiempo_fin?new Date(n.tiempo_fin).getTime():0,tiempoTranscurrido:0,timer:null,labeltime:"00:00"}))),f=M(9e5),h=M([]),w=()=>{if(h.value.length===0)return;const n=b.value.find(t=>!t.horneando);if(n){n.horneando=!0,n.pastesHorneando=[...h.value],h.value=[],n.tiempoInicio=Date.now(),n.tiempoFin=n.tiempoInicio+f.value;try{ce.post("/iniciar-horneado",{horno_id:n.id,tiempo_inicio:n.tiempoInicio,tiempo_fin:n.tiempoFin,pastes_horneando:n.pastesHorneando,estado:!0}).then(t=>{console.log(t)}).catch(t=>{console.error("Error al iniciar el horneado:",t)}),O.fire({icon:"success",title:"Horneando",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500}),L(n.id)}catch(t){console.error("Error al iniciar el horneado:",t),O.fire({icon:"error",title:"Error al iniciar",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}}else G()},m=O.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:n=>{n.addEventListener("mouseenter",O.stopTimer),n.addEventListener("mouseleave",O.resumeTimer)}}),I=async n=>{const t=b.value.find(e=>e.id===n);if(!(!t||!t.horneando))try{clearInterval(t.timer);const e=[...t.pastesHorneando];t.horneando=!1,t.pastesHorneando=[],t.tiempoTranscurrido=0,t.labeltime="00:00",k();for(const o of e){const r=T.find(u=>u.nombre.toLowerCase()===o.nombre.toLowerCase()&&(u.tipo==="pastes"||u.tipo==="empanadas saladas"||u.tipo==="empanadas dulces"));if(r)try{await ce.post("/api/control-produccion/horneado",{horno_id:n,paste_id:r.id,cantidad:o.cantidad})}catch(u){console.error(`Horno ${n} - Error al registrar producción para ${o.nombre}:`,u)}else console.error(`Horno ${n} - No se encontró el paste ${o.nombre} en el inventario`)}W.post("/hornear",{horno_id:n,pastes:e},{preserveScroll:!0,preserveState:!1,replace:!0,onSuccess:()=>{m.fire({icon:"success",title:"Horneado finalizado"})},onError:o=>{console.error(`Horno ${n} - Error al registrar el horneado:`,o),m.fire({icon:"error",title:"Error al registrar el horneado"})}})}catch(e){console.error(`Horno ${n} - Error en finalizarHorneado:`,e)}},k=()=>{new Audio("/sound/videoplayback.mp3").play().catch(t=>console.error("Error al reproducir el sonido:",t))},R=_(()=>T.filter(n=>n.tipo==="masa")),V=_(()=>T.filter(n=>n.tipo==="relleno")),A=_(()=>R.value.map(n=>{const t=b.value.filter(e=>e.horneando&&e.pastesHorneando.some(o=>o.masa===n.nombre)).reduce((e,o)=>e+o.pastesHorneando.find(r=>r.masa===n.nombre).cantidad,0);return{...n,cantidad:Math.max(0,n.cantidad-t)}})),q=_(()=>V.value.map(n=>{const t=b.value.filter(e=>e.horneando&&e.pastesHorneando.some(o=>o.nombre===n.nombre)).reduce((e,o)=>e+o.pastesHorneando.find(r=>r.nombre===n.nombre).cantidad,0);return{...n,cantidad:Math.max(0,n.cantidad-t)}})),p=M({masa:"",relleno:"",cantidad:1,sucursal_id:(te=(ee=x.auth)==null?void 0:ee.user)==null?void 0:te.sucursal_id}),D=n=>{const t={pastes:"bola","empanadas saladas":"salada","empanadas dulces":"dulce"},e=T.find(o=>(o.nombre.toLowerCase()===n.value.relleno.toLowerCase()||o.nombre.toLowerCase().startsWith(n.value.relleno.toLowerCase()))&&t[o.tipo.toLowerCase()]);return e?t[e.tipo.toLowerCase()]:"bola"},$=()=>{var r,u,s,H;const n=D(p).toLowerCase(),t=A.value.find(N=>N.nombre.toLowerCase()===n),e=q.value.find(N=>N.nombre.toLowerCase()===p.value.relleno.toLowerCase());if(!t||t.cantidad<=0){m.fire({icon:"error",title:"No hay suficiente masa disponible"});return}if(!e||e.cantidad<=0){m.fire({icon:"error",title:"No hay suficiente relleno disponible"});return}const o=Math.min(t.cantidad,e.cantidad);if(p.value.cantidad>o){m.fire({icon:"error",title:`Solo hay ${o} unidades disponibles (${t.cantidad} masa, ${e.cantidad} relleno)`});return}if(t&&e&&p.value.cantidad<=o){t.cantidad-=p.value.cantidad,e.cantidad-=p.value.cantidad;const N=h.value.find(E=>E.nombre===e.nombre);N?N.cantidad+=p.value.cantidad:c({id:Date.now(),masa:t.nombre,nombre:e.nombre,cantidad:p.value.cantidad,sucursal_id:(u=(r=x.auth)==null?void 0:r.user)==null?void 0:u.sucursal_id}),p.value={masa:"",relleno:"",cantidad:1,sucursal_id:(H=(s=x.auth)==null?void 0:s.user)==null?void 0:H.sucursal_id}}},j=_(()=>{const n=D(p).toLowerCase(),t=A.value.find(o=>o.nombre.toLowerCase()===n),e=q.value.find(o=>o.nombre===p.value.relleno);return!t||!e?0:Math.min(t.cantidad,e.cantidad)}),B=_(()=>{const n=D(p).toLowerCase(),t=A.value.find(r=>r.nombre.toLowerCase()===n),e=q.value.find(r=>r.nombre===p.value.relleno);if(!t||!e)return!1;const o=Math.min(t.cantidad,e.cantidad);return p.value.relleno&&p.value.cantidad>0&&p.value.cantidad<=o&&o>0});M("00:00");const v=n=>{if(n<=0)return"00:00";const t=Math.floor(n/1e3),e=Math.floor(t/60),o=t%60;return`${String(e).padStart(2,"0")}:${String(o).padStart(2,"0")}`},c=n=>{const t=T.find(e=>e.nombre.toLowerCase()===n.nombre.toLowerCase()&&(e.tipo==="pastes"||e.tipo==="empanadas saladas"||e.tipo==="empanadas dulces"));t?h.value.push({...n,paste_id:t.id}):console.error(`No se encontró el paste ${n.nombre} en el inventario`)},y=n=>{h.value=h.value.filter(t=>t.id!==n)},g=n=>{I(n).catch(t=>{console.error(`Error al finalizar horneado desde timer: ${t}`)})},L=n=>{const t=b.value.find(r=>r.id===n);if(!t)return;const o=t.tiempoFin-Date.now();if(o<=0){g(n);return}t.tiempoTranscurrido=f.value-o,t.labeltime=v(o),t.timer&&clearInterval(t.timer),t.timer=setInterval(()=>{const r=t.tiempoFin-Date.now();if(r<=0){clearInterval(t.timer),g(n);return}t.tiempoTranscurrido=f.value-r,t.labeltime=v(r)},1e3)},F=n=>{const t=b.value.find(r=>r.id===n);if(!t)return;const o=t.tiempoFin-Date.now();if(o<=0){g(n);return}t.tiempoTranscurrido=f.value-o,t.labeltime=v(o),t.timer&&clearInterval(t.timer),t.timer=setInterval(()=>{const r=t.tiempoFin-Date.now();if(r<=0){clearInterval(t.timer),g(n);return}t.tiempoTranscurrido=f.value-r,t.labeltime=v(r)},1e3)};ne(()=>{b.value.forEach(n=>{n.timer&&clearInterval(n.timer)}),b.value.forEach(n=>{if(n.estado){const t=Date.now()-new Date(n.tiempo_inicio).getTime(),e=f.value-t;if(e<=0){g(n.id);return}n.tiempoFin=Date.now()+e,F(n.id)}})});const G=()=>{W.post("/crear-horno",{estado:!1,pastesHorneando:[]},{preserverScroll:!0,preserveState:!1,onSuccess:n=>{var t;C.value=(t=n==null?void 0:n.props)==null?void 0:t.hornos,h.value=[],b.value=C.value.map(e=>({...e,horneando:e.estado||!1,pastesHorneando:e.pastesHorneando||[],tiempoInicio:e.tiempo_inicio?new Date(e.tiempo_inicio).getTime():0,tiempoFin:e.tiempo_fin?new Date(e.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),O.fire({icon:"success",title:"Horno creado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:n=>{console.error("Error al crear el horno:",n),O.fire({icon:"error",title:"Error al crear horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})},Y=n=>{W.post("/eliminar-horno",{horno_id:n},{preserveScroll:!0,preserveState:!1,onSuccess:t=>{var e;C.value=(e=t==null?void 0:t.props)==null?void 0:e.hornos,b.value=C.value.map(o=>({...o,horneando:o.estado||!1,pastesHorneando:o.pastesHorneando||[],tiempoInicio:o.tiempo_inicio?new Date(o.tiempo_inicio).getTime():0,tiempoFin:o.tiempo_fin?new Date(o.tiempo_fin).getTime():0,timer:null,labeltime:"00:00"})),O.fire({icon:"success",title:"Horno eliminado",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})},onError:t=>{console.error("Error al eliminar el horno:",t),O.fire({icon:"error",title:"Error al eliminar horno",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500})}})};return(n,t)=>(i(),l(z,null,[a("div",Qe,[a("div",Ye,[t[4]||(t[4]=a("h2",{class:"text-xl font-semibold mb-4"},"Ingredientes Disponibles",-1)),a("div",et,[t[2]||(t[2]=a("h3",{class:"text-lg font-medium mb-2"},"Masas",-1)),a("ul",tt,[(i(!0),l(z,null,P(A.value,e=>(i(),l("li",{key:e.id,class:"flex justify-between"},[a("span",ot,d(e.nombre),1),a("span",at,d(e.cantidad)+" unidades",1)]))),128))])]),a("div",null,[t[3]||(t[3]=a("h3",{class:"text-lg font-medium mb-2"},"Rellenos",-1)),a("ul",nt,[(i(!0),l(z,null,P(q.value,e=>(i(),l("li",{key:e.id,class:"flex justify-between"},[a("span",null,d(e.nombre),1),a("span",rt,d(e.cantidad)+" unidades",1)]))),128))])])]),a("div",st,[t[8]||(t[8]=a("h2",{class:"text-xl font-semibold mb-4"},"Crear Nuevo Paste/Empanada",-1)),a("form",{onSubmit:xe($,["prevent"]),class:"space-y-4"},[a("div",null,[t[6]||(t[6]=a("label",{for:"relleno",class:"block text-sm font-medium text-gray-700"},"Seleccionar Relleno",-1)),X(a("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>p.value.relleno=e),id:"relleno",required:"",class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md"},[t[5]||(t[5]=a("option",{value:""},"Seleccione un relleno",-1)),(i(!0),l(z,null,P(V.value,e=>(i(),l("option",{key:e.id,value:e.nombre},d(e.nombre),9,it))),128))],512),[[de,p.value.relleno]])]),a("div",null,[t[7]||(t[7]=a("label",{for:"cantidad",class:"block text-sm font-medium text-gray-700"},"Cantidad",-1)),X(a("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>p.value.cantidad=e),type:"number",id:"cantidad",required:"",min:"1",max:j.value,class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500 sm:text-sm"},null,8,dt),[[le,p.value.cantidad,void 0,{number:!0}]])]),a("button",{type:"submit",disabled:!B.value,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed"},d(B.value?"Asignar Unidades":"Sin ingredientes suficientes"),9,lt),p.value.relleno&&!B.value?(i(),l("div",ct,[j.value===0?(i(),l("span",ut,"No hay ingredientes disponibles")):(i(),l("span",pt,"Máximo disponible: "+d(j.value)+" unidades",1))])):U("",!0)],32)])]),a("div",mt,[(i(!0),l(z,null,P(b.value,(e,o)=>(i(),l("div",{key:e.id,class:"bg-white shadow rounded-lg p-6"},[a("div",ft,[a("h2",ht,"Horno "+d(o+1),1),!e.horneando&&C.value.length>1?(i(),l("button",{key:0,onClick:r=>Y(e.id),class:"flex items-center gap-2 bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"},[Z(pe(we),{class:"w-4 h-4"})],8,xt)):U("",!0)]),e.horneando?(i(),l("div",vt,[t[9]||(t[9]=a("p",{class:"text-lg mb-2"},"Horneando grupo de pastes:",-1)),a("ul",null,[(i(!0),l(z,null,P(e.pastesHorneando,r=>(i(),l("li",{key:r.nombre},d(r.cantidad)+" "+d(r.nombre)+" - masa "+d(r.masa),1))),128))]),a("div",gt,[a("div",{class:"bg-orange-600 h-2.5 rounded-full transition-all duration-100",style:ve({width:`${e.tiempoTranscurrido/f.value*100}%`})},null,4)]),a("p",null,"Tiempo restante: "+d(e.labeltime),1)])):(i(),l("div",_t,[t[10]||(t[10]=a("p",{class:"text-lg mb-4"},"El horno está disponible",-1)),a("button",{onClick:w,disabled:!h.value.length,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed"}," Iniciar Horneado de Grupo ",8,yt)]))]))),128)),a("div",{class:"mt-4 h-full flex justify-center items-center"},[a("button",{onClick:G,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500"}," Crear Nuevo Horno ")])]),a("div",bt,[t[11]||(t[11]=a("h2",{class:"text-xl font-semibold mb-4"},"Grupos de Pastes por Hornear",-1)),h.value.length===0?(i(),l("div",wt," No hay grupos de pastes en la cola de horneado ")):(i(),l("ul",$t,[(i(!0),l(z,null,P(h.value,e=>(i(),l("li",{key:e.id,class:"py-4 flex justify-between items-center"},[a("span",null,d(e.cantidad)+" "+d(e.nombre)+" - masa "+d(e.masa),1),a("button",{onClick:o=>y(e.id),class:"bg-red-600 text-white hover:bg-red-800 rounded-lg px-2 py-1 focus:outline-none focus:underline"}," Cancelar ",8,Et)]))),128))]))])],64))}},Dt={key:0,class:"mt-8 bg-white shadow rounded-lg p-6"},Ht={class:"flex justify-between items-center mb-4"},kt={class:"flex items-center space-x-4"},Mt={class:"flex items-center space-x-2"},Tt={class:"flex items-center space-x-2"},Ct=["value"],Ft={class:"mb-6"},Nt={key:0,class:"overflow-x-auto"},zt={class:"min-w-full divide-y divide-gray-200"},Pt={class:"bg-white divide-y divide-gray-200"},It={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 capitalize"},Lt={class:"text-xs text-gray-500 block capitalize"},Vt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},At={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},jt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Bt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize"},Ot={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ut={class:"px-6 py-4 whitespace-nowrap"},Rt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},qt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Jt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},Wt={class:"flex space-x-2"},Gt=["onClick"],Zt=["onClick"],Xt=["onClick"],Kt={key:1,class:"text-center py-8"},Qt={class:"mt-8"},Yt={class:"overflow-x-auto"},eo={class:"min-w-full divide-y divide-gray-200"},to={class:"bg-white divide-y divide-gray-200"},oo={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},ao={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},no={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ro={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},so={class:"px-6 py-4 whitespace-nowrap capitalize"},io={__name:"ControlProduccion",setup(S){const{props:x}=Q();console.log(x),M([]);const T=M([]);M([]);const C=_(()=>{var o,r;const t=(o=x.auth)==null?void 0:o.user,e=t==null?void 0:t.roles;return e&&e.length>0&&((r=e[0])==null?void 0:r.name)==="admin"}),b=M(new Date().toISOString().split("T")[0]),f=M("actual"),h=M([{value:"todas",label:"Todas las horas"},{value:"actual",label:"Hora Siguiente"},{value:"9-am",label:"9:00 AM"},{value:"10-am",label:"10:00 AM"},{value:"11-am",label:"11:00 AM"},{value:"12-pm",label:"12:00 PM"},{value:"1-pm",label:"1:00 PM"},{value:"2-pm",label:"2:00 PM"},{value:"3-pm",label:"3:00 PM"},{value:"4-pm",label:"4:00 PM"},{value:"5-pm",label:"5:00 PM"},{value:"6-pm",label:"6:00 PM"},{value:"7-pm",label:"7:00 PM"},{value:"8-pm",label:"8:00 PM"},{value:"9-pm",label:"9:00 PM"}]),w=t=>{if(!t||typeof t!="string")return"";try{if(t.includes("-"))return t;if(t.includes(":")){const[o,r]=t.split(":"),u=parseInt(o),s=u>=12?"pm":"am";return`${u%12||12}-${s}`}const e=t.match(/(\d+):(\d+)\s*(am|pm)/i);if(e){const[,o,r,u]=e;return`${parseInt(o)%12||12}-${u.toLowerCase()}`}return""}catch(e){return console.error("Error al convertir hora notificación:",t,e),""}},m=()=>{const t=new Date,e=new Date(t.getTime()+60*60*1e3),o=new Date(e);return o.setMinutes(0,0,0),I(o)},I=t=>{if(!t)return"";try{const e=new Date(t);if(isNaN(e.getTime()))return"";const o=e.getHours(),r=e.getMinutes(),u=o>=12?"pm":"am";return`${o%12||12}-${u}`}catch(e){return console.error("Error al obtener formato de hora:",t,e),""}},k=t=>{if(!t.tiempo_inicio_horneado)return{promedio:0,ultima:"N/A",restante:"N/A"};try{const e=new Date(t.tiempo_inicio_horneado),o=new Date(t.created_at);if(isNaN(e.getTime())||isNaN(o.getTime()))return{promedio:0,ultima:"N/A",restante:"N/A"};const r=Math.max(0,e-o),u=Math.floor(r/(1e3*60));return{promedio:u,ultima:D(t.tiempo_inicio_horneado),restante:u>0?`${u} min`:"Completado"}}catch(e){return console.error("Error al calcular tiempo de reposición:",e),{promedio:0,ultima:"Error",restante:"Error"}}},R=t=>{if(!t.tiempo_inicio_horneado||!t.created_at)return"N/A";try{const e=new Date(t.tiempo_inicio_horneado),o=new Date(t.created_at);if(isNaN(e.getTime())||isNaN(o.getTime()))return"N/A";const r=Math.max(0,e-o),u=Math.floor(r/(1e3*60));return u>1440?(console.warn("Tiempo de producción muy alto, posible error de zona horaria:",{tiempoInicio:t.tiempo_inicio_horneado,tiempoNotificacion:t.created_at,diferencia:u}),"Error de fecha"):u===0?"Inmediato":`${u} min`}catch(e){return console.error("Error al calcular tiempo de producción:",e),"Error"}},V=()=>{try{const t=new Date,e=new Date(t.toLocaleString("en-US",{timeZone:"America/Mexico_City"}));b.value=e.toISOString().split("T")[0]}catch(t){console.error("Error al actualizar fecha inicial:",t),b.value=new Date().toISOString().split("T")[0]}},A=_(()=>{var u;const t=F.value,e=((u=x.notificaciones)==null?void 0:u.faltantes)||[],o=new Map;e.forEach(s=>{const H=`${s.paste_id}-${s.hora_notificacion}`;o.set(H,s)});const r=t.map(s=>{const N=`${(typeof s.id=="string"?s.id:String(s.id)).split("-")[0]}-${s.hora_notificacion}`,E=o.get(N);return E?{id:E.id,paste:E.paste||s.paste,cantidad:E.cantidad||s.cantidad,hora_notificacion:E.hora_notificacion||s.hora_notificacion,dia_notificacion:E.dia_notificacion||s.dia_notificacion,estado:E.estado||"pendiente",tiempo_inicio_horneado:E.tiempo_inicio_horneado,hora_ultima_venta:E.hora_ultima_venta,cantidad_vendida:E.cantidad_vendida||0,diferencia_notificacion_inicio:E.diferencia_notificacion_inicio,created_at:E.created_at||s.created_at,cantidad_horneada:E.cantidad_horneada||0}:s});if(e.forEach(s=>{const H=`${s.paste_id}-${s.hora_notificacion}`;r.some(E=>`${(typeof E.id=="string"?E.id:String(E.id)).split("-")[0]}-${E.hora_notificacion}`===H)||r.push({id:s.id,paste:s.paste,cantidad:s.cantidad,hora_notificacion:s.hora_notificacion,dia_notificacion:s.dia_notificacion,estado:s.estado||"pendiente",tiempo_inicio_horneado:s.tiempo_inicio_horneado,hora_ultima_venta:s.hora_ultima_venta,cantidad_vendida:s.cantidad_vendida||0,diferencia_notificacion_inicio:s.diferencia_notificacion_inicio,created_at:s.created_at,cantidad_horneada:s.cantidad_horneada||0})}),f.value==="todas")return r;if(f.value==="actual"){const s=m();return s?r.filter(H=>{const N=H.hora_notificacion;return N?w(N)===s:!1}):[]}return r.filter(s=>{const H=s.hora_notificacion;return H?w(H)===f.value:!1})});_(()=>A.value.filter(t=>t.tiempo_inicio_horneado).map(t=>({paste:t.paste.nombre,...k(t)})));const q=_(()=>{var t;return(t=x.notificaciones)!=null&&t.faltantes?x.notificaciones.faltantes.map(e=>({id:e.id,paste:e.paste,cantidad:e.cantidad,hora_notificacion:e.hora_notificacion,dia_notificacion:e.dia_notificacion,estado:e.estado,tiempo_inicio_horneado:e.tiempo_inicio_horneado,hora_ultima_venta:e.hora_ultima_venta,cantidad_vendida:e.cantidad_vendida,diferencia_notificacion_inicio:e.diferencia_notificacion_inicio,created_at:e.created_at})):[]});_(()=>{var t;return(t=x.notificaciones)!=null&&t.horneados?x.notificaciones.horneados:[]});const p=_(()=>q.value.map(e=>({paste:e.paste.nombre,recomendacion:"Producir",razon:`Faltan ${e.cantidad} unidades para las ${e.hora_notificacion}`})));ae(()=>{var t;return(t=x.notificaciones)==null?void 0:t.faltantes},t=>{t&&(T.value=p.value)},{immediate:!0});const D=t=>{if(!t)return"-";try{const e=new Date(t);return isNaN(e.getTime())?"Fecha inválida":e.toLocaleString("es-MX",{hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:"America/Mexico_City"})}catch(e){return console.error("Error al formatear fecha:",t,e),"Error"}},$=t=>`px-2 py-1 rounded-full text-xs font-medium ${{horneando:"bg-yellow-100 text-yellow-800 capitalize",retirado:"bg-blue-100 text-blue-800 capitalize",vendido:"bg-green-100 text-green-800 capitalize",desperdicio:"bg-red-100 text-red-800 capitalize",pendiente:"bg-gray-100 text-gray-800 capitalize",en_espera:"bg-green-100 text-green-800"}[t]}`,j=_(()=>{const t=t.value.filter(r=>r.estado==="horneando"||r.estado==="en_espera"||r.estado==="vendido"||r.estado==="desperdicio"||r.tiempo_inicio_horneado),o=new Date().toISOString().split("T")[0];return t.filter(r=>{if(!r.created_at)return!1;try{return new Date(r.created_at).toISOString().split("T")[0]===o}catch(u){return console.error("Error al verificar fecha de notificación:",u),!1}})});ne(()=>{V()});const B=t=>{if(!t||typeof t!="string")return 0;try{const[e,o]=t.toLowerCase().split(" ");let[r,u]=e.split(":");return r=parseInt(r,10),r===12?r=o==="am"?0:12:o==="pm"&&(r=r+12),r}catch(e){return console.error("Error al convertir hora:",t,e),0}},v=()=>["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"][new Date().getDay()],c=_(()=>{var t;return((t=x.inventario)==null?void 0:t.filter(e=>["pastes","empanadas dulces","empanadas saladas"].includes(e.tipo)))||[]}),y=_(()=>{const t=new Map(c.value.map(o=>[o.id,o]));return(x.estimacionesHoy||[]).map(o=>{const r=t.get(o.inventario_id);if(!r)return null;const u=B(o.hora);return{id:`${r.id}-${o.hora}`,nombre:r.nombre,estimado:parseInt(o.cantidad),existente:r.cantidad,diferencia:r.cantidad-parseInt(o.cantidad),hora:o.hora,dia:o.dia,horaEnNumero:u,tipo:r.tipo}}).filter(Boolean)}),g=_(()=>y.value.filter(e=>e.dia===v())),L=_(()=>{const e=(new Date().getHours()+1)%24,o=g.value.filter(s=>(s.horaEnNumero||B(s.hora))===e),r=new Map(o.map(s=>[s.nombre,s]));return c.value.map(s=>{const H=r.get(s.nombre);return H||{id:`${s.id}-${e}:00`,nombre:s.nombre,estimado:0,existente:s.cantidad,diferencia:s.cantidad,hora:`${e}:00`,dia:v(),horaEnNumero:e,tipo:s.tipo}})}),F=_(()=>L.value.filter(e=>{const r=e.estimado*.7;return e.estimado>0&&e.existente<r}).map(e=>({id:e.id,paste:{nombre:e.nombre,tipo:e.tipo},cantidad:Math.abs(e.diferencia),hora_notificacion:e.hora,dia_notificacion:e.dia,estado:"pendiente",created_at:new Date().toISOString(),cantidad_horneada:0,cantidad_vendida:0,hora_ultima_venta:null,diferencia_notificacion_inicio:null})));ae(()=>F.value,t=>{t&&t.length>0&&t.forEach(async e=>{var s,H,N,E,re,se;const o=`${e.id}`,r=e.cantidad,u=(H=(s=x.notificaciones)==null?void 0:s.faltantes)==null?void 0:H.find(J=>{const me=typeof e.id=="string"?e.id:String(e.id),fe=parseInt(me.split("-")[0]);return J.paste_id===fe&&J.hora_notificacion===e.hora_notificacion});u?u.cantidad!==r&&W.post(route("notificaciones.actualizar"),{sucursal_id:(se=(re=x.auth)==null?void 0:re.user)==null?void 0:se.sucursal_id,notificacion_id:o,cantidad:r},{preserveScroll:!0,onSuccess:J=>{console.log("Notificación actualizada:",J)},onError:J=>{console.error("Error al actualizar notificación:",J)}}):W.post(route("notificaciones.registrar"),{sucursal_id:(E=(N=x.auth)==null?void 0:N.user)==null?void 0:E.sucursal_id,notificacion_id:o,cantidad:r},{preserveScroll:!0,onSuccess:J=>{console.log("Notificación registrada:",J)},onError:J=>{console.error("Error al registrar notificación:",J)}})})},{deep:!0});const G=t=>{const e=new Date;W.post(route("control-produccion.iniciar-horneado"),{control_produccion_id:t.id,tiempo_inicio_horneado:e.toISOString(),cantidad_horneada:t.cantidad},{preserveScroll:!0,onSuccess:o=>{console.log("Horneado iniciado:",o),window.location.reload()},onError:o=>{console.error("Error al iniciar horneado:",o)}})},Y=t=>{const e=new Date;W.post(route("control-produccion.finalizar-horneado"),{control_produccion_id:t.id,tiempo_fin_horneado:e.toISOString()},{preserveScroll:!0,onSuccess:o=>{console.log("Horneado finalizado:",o),window.location.reload()},onError:o=>{console.error("Error al finalizar horneado:",o)}})},ee=(t,e)=>{W.post(route("control-produccion.registrar-venta"),{control_produccion_id:t.id,cantidad_vendida:e},{preserveScroll:!0,onSuccess:o=>{console.log("Venta registrada:",o),window.location.reload()},onError:o=>{console.error("Error al registrar venta:",o)}})},te=t=>{if(!t.tiempo_inicio_horneado)return"No iniciado";try{const e=new Date(t.tiempo_inicio_horneado),o=new Date;if(isNaN(e.getTime()))return"Fecha inválida";const r=o-e;return`${Math.floor(r/(1e3*60))} min`}catch(e){return console.error("Error al calcular tiempo de horneado:",e),"Error"}},n=t=>{if(!t.hora_ultima_venta)return"Sin ventas";try{const e=new Date(t.hora_ultima_venta),o=new Date;if(isNaN(e.getTime()))return"Fecha inválida";const r=o-e,u=Math.floor(r/(1e3*60));if(u<60)return`${u} min`;{const s=Math.floor(u/60),H=u%60;return`${s}h ${H}min`}}catch(e){return console.error("Error al calcular tiempo de venta:",e),"Error"}};return(t,e)=>C.value?(i(),l("div",Dt,[a("div",Ht,[e[4]||(e[4]=a("h2",{class:"text-xl font-semibold"},"Control de Producción",-1)),a("div",kt,[a("div",Mt,[e[2]||(e[2]=a("label",{for:"fecha",class:"text-sm font-medium text-gray-700"},"Seleccionar día:",-1)),X(a("input",{type:"date",id:"fecha","onUpdate:modelValue":e[0]||(e[0]=o=>b.value=o),class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},null,512),[[le,b.value]])]),a("div",Tt,[e[3]||(e[3]=a("label",{for:"hora",class:"text-sm font-medium text-gray-700"},"Filtrar por hora:",-1)),X(a("select",{id:"hora","onUpdate:modelValue":e[1]||(e[1]=o=>f.value=o),class:"mt-1 block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[(i(!0),l(z,null,P(h.value,o=>(i(),l("option",{key:o.value,value:o.value},d(o.label),9,Ct))),128))],512),[[de,f.value]])])])]),a("div",Ft,[e[7]||(e[7]=a("h3",{class:"text-lg font-medium mb-2"},"Productos Faltantes (Hora Siguiente) - Control de Producción",-1)),A.value.length>0?(i(),l("div",Nt,[a("table",zt,[e[5]||(e[5]=a("thead",{class:"bg-gray-50"},[a("tr",null,[a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Producto"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Faltante"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Horneada"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad Vendida"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Día"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora Requerida"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo Horneado"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo Venta"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Acciones")])],-1)),a("tbody",Pt,[(i(!0),l(z,null,P(A.value,o=>(i(),l("tr",{key:o.id,class:"hover:bg-gray-50"},[a("td",It,[oe(d(o.paste.nombre)+" ",1),a("span",Lt,d(o.paste.tipo),1)]),a("td",Vt,d(o.cantidad)+" unidades ",1),a("td",At,d(o.cantidad_horneada?`${o.cantidad_horneada} unidades`:"-"),1),a("td",jt,d(o.cantidad_vendida?`${o.cantidad_vendida} unidades`:"-"),1),a("td",Bt,d(o.dia_notificacion),1),a("td",Ot,d(o.hora_notificacion),1),a("td",Ut,[a("span",{class:K(["px-2 py-1 text-xs font-medium rounded-full",o.estado==="pendiente"?"bg-red-100 text-red-800":o.estado==="horneando"?"bg-yellow-100 text-yellow-800":o.estado==="en_espera"?"bg-blue-100 text-blue-800":o.estado==="vendido"?"bg-green-100 text-green-800":o.estado==="desperdicio"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"])},d(o.estado==="pendiente"?"Sin hornear":o.estado==="horneando"?"Horneando":o.estado==="en_espera"?"En espera":o.estado==="vendido"?"Vendido":o.estado==="desperdicio"?"Desperdicio":o.estado),3)]),a("td",Rt,d(te(o)),1),a("td",qt,d(n(o)),1),a("td",Jt,[a("div",Wt,[o.estado==="pendiente"?(i(),l("button",{key:0,onClick:r=>G(o),class:"bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-xs"}," Iniciar Horneado ",8,Gt)):U("",!0),o.estado==="horneando"?(i(),l("button",{key:1,onClick:r=>Y(o),class:"bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs"}," Finalizar Horneado ",8,Zt)):U("",!0),o.estado==="en_espera"||o.estado==="horneando"?(i(),l("button",{key:2,onClick:r=>ee(o,1),class:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs"}," +1 Venta ",8,Xt)):U("",!0)])])]))),128))])])])):(i(),l("div",Kt,e[6]||(e[6]=[a("p",{class:"text-gray-500 text-lg"},"No hay productos faltantes para la hora siguiente",-1),a("p",{class:"text-gray-400 text-sm mt-2"},"Los faltantes se calculan en tiempo real basándose en el inventario y estimaciones",-1)])))]),a("div",Qt,[e[9]||(e[9]=a("h3",{class:"text-lg font-medium mb-2"},"Control de Tiempo de Producción",-1)),a("div",Yt,[a("table",eo,[e[8]||(e[8]=a("thead",{class:"bg-gray-50"},[a("tr",null,[a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Paste"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de notificación"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Hora de Producción"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tiempo en meter producción"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Estado")])],-1)),a("tbody",to,[(i(!0),l(z,null,P(j.value,o=>(i(),l("tr",{key:o.id},[a("td",oo,d(o.paste.nombre),1),a("td",ao,d(D(o.created_at)),1),a("td",no,d(D(o.tiempo_inicio_horneado)),1),a("td",ro,d(R(o)),1),a("td",so,[a("span",{class:K($(o.estado))},d(o.estado),3)])]))),128))])])])])])):U("",!0)}},lo={class:"animate-pulse"},co={key:0,class:"mt-2"},uo={class:"font-bold"},ue={__name:"NotificationPanel",props:{notifications:{type:Array,required:!0,default:()=>[]},isVisible:{type:Boolean,default:!1},type:{type:String,required:!0,validator:S=>["warning","info"].includes(S)},title:{type:String,required:!0}},emits:["toggle"],setup(S,{emit:x}){return console.log(S.notifications),(C,b)=>(i(),l("div",{class:K(["p-4 border rounded shadow mb-4 size-fit cursor-pointer",{"bg-yellow-100":S.type==="warning","bg-blue-100":S.type==="info"}]),onClick:b[0]||(b[0]=f=>C.$emit("toggle"))},[a("h2",{class:K(["text-lg font-bold text-center",{"text-yellow-800":S.type==="warning","text-blue-800":S.type==="info"}])},[oe(d(S.type==="warning"?"⚠️":"ℹ️")+" "+d(S.title)+" ",1),a("span",lo,"("+d(S.notifications.length)+")",1),oe(" "+d(S.type==="warning"?"⚠️":"ℹ️"),1)],2),S.isVisible?(i(),l("ul",co,[(i(!0),l(z,null,P(S.notifications,f=>(i(),l("li",{key:f.id,class:"mb-2"},[a("span",null,[a("span",uo,d(f.nombre),1),oe(": "+d(S.type==="warning"?"Faltan":"Hay")+" "+d(S.type==="warning"?Math.abs(f.diferencia):f.diferencia)+" unidades para las "+d(f.hora)+" ",1),a("span",{class:K(["text-sm",{"text-red-600":S.type==="warning","text-green-600":S.type==="info"}])}," ("+d(f.porcentaje)+"% del estimado) ",3)])]))),128))])):U("",!0)],2))}},po={class:"container mx-auto p-4"},mo={class:"sm:flex justify-between flex-row text-sm"},fo={class:"flex gap-3 sm:flex-row flex-col"},ho={class:"mt-6"},xo={__name:"Hornear",setup(S){const x=M(!1),T=M(!1),C=M(null),b=M(null),{props:f}=Q(),h=_(()=>{var y,g;const v=(y=f.auth)==null?void 0:y.user,c=v==null?void 0:v.roles;return c&&c.length>0&&((g=c[0])==null?void 0:g.name)==="admin"}),w=_(()=>f.inventario||[]),m=_(()=>f.estimacionesHoy||[]),I=()=>{const v=new Date;return{day:["Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"][v.getDay()].toLowerCase(),hour:v.getHours(),minutes:v.getMinutes()}},k=M(I());ae(()=>k.value.hour,v=>{v!==C.value&&(C.value=v,D.value.length>0&&(x.value=!0),$.value.length>0&&(T.value=!0))}),ne(()=>{C.value=k.value.hour,b.value=setInterval(()=>{k.value=I()},1e3)}),ge(()=>{b.value&&clearInterval(b.value)});const R=v=>{const[c,y]=v.toLowerCase().split(" ");let[g,L]=c.split(":").map(Number);return{hours:y==="pm"&&g!==12?g+12:y==="am"&&g===12?0:g,minutes:L}},V=_(()=>w.value.filter(v=>{var c;return["pastes","empanadas dulces","empanadas saladas"].includes((c=v.tipo)==null?void 0:c.toLowerCase())})),A=_(()=>{if(!m.value.length||!V.value.length)return console.log("No hay estimaciones o productos relevantes"),[];const v=new Map(V.value.map(y=>[y.id,y]));return m.value.map(y=>{const g=v.get(y.inventario_id);if(!g)return null;const{hours:L}=R(y.hora);return{id:`${g.id}-${y.hora}`,nombre:g.nombre,estimado:y.cantidad,existente:g.cantidad,diferencia:g.cantidad-y.cantidad,hora:y.hora,dia:y.dia.toLowerCase(),horaEnNumero:L,tipo:g.tipo}}).filter(Boolean).filter((y,g,L)=>g===L.findIndex(F=>F.id===y.id))}),q=_(()=>A.value.filter(c=>c.dia===k.value.day)),p=_(()=>{const c=(k.value.hour+1)%24,y=q.value.filter(F=>F.horaEnNumero===c),g=new Map(y.map(F=>[F.nombre,F]));return V.value.map(F=>{const G=g.get(F.nombre);return G||{id:`${F.id}-${c}:00`,nombre:F.nombre,estimado:0,existente:F.cantidad,diferencia:F.cantidad,hora:`${c}:00`,dia:k.value.day,horaEnNumero:c,tipo:F.tipo}})}),D=_(()=>p.value.filter(c=>{const g=c.estimado*.7;return c.estimado>0&&c.existente<g}).map(c=>({...c,porcentaje:c.estimado>0?Math.round(c.existente/c.estimado*100):0}))),$=_(()=>p.value.filter(c=>c.estimado>0&&c.diferencia>0||c.estimado===0&&c.existente>0).map(c=>({...c,porcentaje:c.estimado>0?Math.round(c.existente/c.estimado*100):100}))),j=()=>x.value=!x.value,B=()=>T.value=!T.value;return(v,c)=>{var y,g,L;return i(),l("div",po,[a("div",mo,[c[0]||(c[0]=a("h1",{class:"text-2xl font-bold mb-4"},"Sistema de Horneado",-1)),a("div",fo,[Z(ue,{notifications:D.value,"is-visible":x.value,type:"warning",title:"Faltantes",onToggle:j},null,8,["notifications","is-visible"]),Z(ue,{notifications:$.value,"is-visible":T.value,type:"info",title:"Excedentes",onToggle:B},null,8,["notifications","is-visible"])])]),a("div",ho,[Z(St),Z(io),((L=(g=(y=pe(f).auth)==null?void 0:y.user)==null?void 0:g.roles)==null?void 0:L[0])!=="supervisor"?(i(),ie(Le,{key:0})):U("",!0),h.value?(i(),ie(Ke,{key:1})):U("",!0)])])}}},vo={class:"py-6"},go={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 rounded-xl overflow-hidden"},_o={class:"flex justify-between p-6 lg:p-8 bg-white border-b border-gray-200 rounded-2xl"},Eo={__name:"index",setup(S){return(x,T)=>(i(),ie(he,{title:"Tablero principal"},{default:_e(()=>[a("div",vo,[a("div",go,[a("div",_o,[Z(xo)])])])]),_:1}))}};export{Eo as default};
