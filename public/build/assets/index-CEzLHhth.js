import{S as F,_ as se}from"./AppLayout-BX7n8Ah4.js";import{Q as J,d as u,i as U,o as n,e as l,a as e,n as y,f as w,j as i,v as q,k as N,F as _,h,t as a,l as f,m as ae,p as j,u as ne,c as le,w as re,b as ie}from"./app-COT3Dlhe.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"relative px-6 py-8 bg-white shadow-lg sm:rounded-3xl sm:p-12"},ue={key:0,class:"flex border-b border-gray-200 mb-6"},ce={class:"mb-4 bg-gray-50 p-4 rounded-lg"},pe={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},xe=["value"],be={class:"mt-4 flex justify-end"},ge=["disabled"],me={key:0},fe={key:1},ve={class:"overflow-x-auto"},ye={class:"min-w-full bg-white border border-gray-200 rounded-lg"},_e={class:"px-4 py-3 border-b"},he={class:"text-sm font-medium text-gray-900"},we={class:"text-xs text-gray-500"},ke={class:"px-4 py-3 border-b text-sm text-gray-700"},Se={class:"px-4 py-3 border-b text-sm text-gray-700"},Ce={class:"px-4 py-3 border-b"},Te={class:"px-4 py-3 border-b text-sm text-gray-700"},Fe={class:"px-4 py-3 border-b"},Ne={key:0,class:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800"},Ve=["onClick"],Ae={key:0},$e={class:"mb-6 bg-gray-50 p-4 rounded-lg"},Ue={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},je=["value"],Be=["value"],De={class:"mt-4 flex justify-end"},Pe=["disabled"],Ie={key:0},Ee={key:1},Me={class:"mb-6 grid grid-cols-2 md:grid-cols-4 gap-4"},Oe={class:"bg-blue-50 p-4 rounded-lg border border-blue-200"},He={class:"text-2xl font-bold text-blue-800"},ze={class:"bg-yellow-50 p-4 rounded-lg border border-yellow-200"},Ge={class:"text-2xl font-bold text-yellow-800"},Le={class:"text-sm text-yellow-600"},Qe={class:"bg-green-50 p-4 rounded-lg border border-green-200"},Xe={class:"text-2xl font-bold text-green-800"},qe={class:"text-sm text-green-600"},Je={class:"bg-purple-50 p-4 rounded-lg border border-purple-200"},Ke={class:"text-2xl font-bold text-purple-800"},Re={class:"overflow-x-auto"},We={class:"min-w-full bg-white border border-gray-200 rounded-lg"},Ye={class:"px-4 py-3 border-b"},Ze={class:"text-sm font-medium text-gray-900"},et={class:"text-xs text-gray-500"},tt={class:"px-4 py-3 border-b text-sm text-gray-700"},ot={class:"px-4 py-3 border-b text-sm text-gray-700"},st={class:"px-4 py-3 border-b"},at={class:"px-4 py-3 border-b"},nt={class:"px-4 py-3 border-b text-sm text-gray-700"},lt=["title"],rt={key:1},it={key:0},dt={key:0,class:"mt-4 flex justify-center items-center space-x-2"},ut=["disabled"],ct={class:"text-sm text-gray-600"},pt=["disabled"],xt={class:"mt-2 text-center text-sm text-gray-500"},B=20,bt={__name:"ActividadPersonal",setup(K){const{props:c}=J(),D=u(c.usuarios||[]),V=u(c.sucursales||[]),v=u(c.actividades||[]),b=u(c.resumen||{}),d=u({fecha_inicio:c.fechaInicio||new Date().toISOString().split("T")[0],fecha_fin:c.fechaFin||new Date().toISOString().split("T")[0],sucursal_id:null,usuario_id:null,tipo_actividad:null}),k=u(!1),p=u(1),S=U(()=>Math.ceil(v.value.length/B)),P=U(()=>{const s=(p.value-1)*B,t=s+B;return v.value.slice(s,t)}),R=async()=>{k.value=!0,p.value=1;try{const s=await j.post("/actividad-personal/filtro",d.value);v.value=s.data.actividades,b.value=s.data.resumen}catch(s){console.error("Error al filtrar:",s),F.fire({icon:"error",title:"Error",text:"No se pudieron cargar las actividades",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3})}finally{k.value=!1}},g=u("actividades"),W=U(()=>{var m;const s=((m=c.auth)==null?void 0:m.user)||c.user;return((s==null?void 0:s.roles)||[]).some(x=>(typeof x=="string"?x:x==null?void 0:x.name)==="admin")}),Y=()=>{g.value="notificaciones",I()},A=u([]),C=u(!1),r=u({fecha_inicio:new Date().toISOString().split("T")[0],fecha_fin:new Date().toISOString().split("T")[0],sucursal_id:null,tipo:null,atendida:null}),I=async()=>{C.value=!0;try{const s={};r.value.fecha_inicio&&(s.fecha_inicio=r.value.fecha_inicio),r.value.fecha_fin&&(s.fecha_fin=r.value.fecha_fin),r.value.sucursal_id&&(s.sucursal_id=r.value.sucursal_id),r.value.tipo&&(s.tipo=r.value.tipo),r.value.atendida!==null&&(s.atendida=r.value.atendida);const t=await j.get("/api/notificaciones-personal",{params:s});A.value=t.data.notificaciones}catch(s){console.error("Error al cargar notificaciones:",s),F.fire({icon:"error",title:"Error",text:"No se pudieron cargar las notificaciones",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3})}finally{C.value=!1}},Z=async s=>{try{await j.post(`/api/notificaciones-personal/${s.id}/atender`),s.atendida=!0,F.fire({icon:"success",title:"Atendida",toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3})}catch{F.fire({icon:"error",title:"Error",text:"No se pudo marcar como atendida",toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3})}},ee=s=>({faltante:"bg-red-100 text-red-800",excedente:"bg-yellow-100 text-yellow-800",horneado:"bg-orange-100 text-orange-800"})[s]||"bg-gray-100 text-gray-800",E=s=>new Intl.NumberFormat("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}).format(s),te=s=>({produccion:"bg-orange-100 text-orange-800",venta:"bg-green-100 text-green-800",asistencia:"bg-purple-100 text-purple-800",inventario:"bg-blue-100 text-blue-800",gasto:"bg-red-100 text-red-800",corte_caja:"bg-gray-100 text-gray-800"})[s]||"bg-gray-100 text-gray-800",oe=(s,t)=>s==="venta"?t==="manual"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800":s==="asistencia"?t==="entrada"?"bg-green-100 text-green-800":"bg-red-100 text-red-800":s==="produccion"&&{pendiente:"bg-yellow-100 text-yellow-800",horneando:"bg-orange-100 text-orange-800",en_espera:"bg-blue-100 text-blue-800",vendido:"bg-green-100 text-green-800"}[t]||"bg-gray-100 text-gray-800";return(s,t)=>{var m,x,M,O,H,z,G,L,Q;return n(),l("div",de,[t[37]||(t[37]=e("h1",{class:"text-3xl font-semibold mb-6 text-center"},"Actividad del Personal",-1)),W.value?(n(),l("div",ue,[e("button",{onClick:t[0]||(t[0]=o=>g.value="actividades"),class:y([g.value==="actividades"?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700","px-6 py-3 text-sm font-medium border-b-2 transition-colors"])}," Actividades ",2),e("button",{onClick:Y,class:y([g.value==="notificaciones"?"border-orange-500 text-orange-600":"border-transparent text-gray-500 hover:text-gray-700","px-6 py-3 text-sm font-medium border-b-2 transition-colors"])}," Notificaciones de Turno ",2)])):w("",!0),i(e("div",null,[e("div",ce,[e("div",pe,[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha Inicio",-1)),i(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=o=>r.value.fecha_inicio=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},null,512),[[N,r.value.fecha_inicio]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha Fin",-1)),i(e("input",{type:"date","onUpdate:modelValue":t[2]||(t[2]=o=>r.value.fecha_fin=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},null,512),[[N,r.value.fecha_fin]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Sucursal",-1)),i(e("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>r.value.sucursal_id=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},[t[15]||(t[15]=e("option",{value:null},"Todas",-1)),(n(!0),l(_,null,h(V.value,o=>(n(),l("option",{key:o.id,value:o.id},a(o.nombre),9,xe))),128))],512),[[f,r.value.sucursal_id]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tipo",-1)),i(e("select",{"onUpdate:modelValue":t[4]||(t[4]=o=>r.value.tipo=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},t[17]||(t[17]=[e("option",{value:null},"Todos",-1),e("option",{value:"faltante"},"Faltante",-1),e("option",{value:"excedente"},"Excedente",-1),e("option",{value:"horneado"},"Horneado",-1)]),512),[[f,r.value.tipo]])]),e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Estado",-1)),i(e("select",{"onUpdate:modelValue":t[5]||(t[5]=o=>r.value.atendida=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},t[19]||(t[19]=[e("option",{value:null},"Todos",-1),e("option",{value:"0"},"Sin atender",-1),e("option",{value:"1"},"Atendidas",-1)]),512),[[f,r.value.atendida]])])]),e("div",be,[e("button",{onClick:I,disabled:C.value,class:"bg-orange-500 text-white px-6 py-2 rounded-md hover:bg-orange-600 transition-colors disabled:opacity-50"},[C.value?(n(),l("span",me,"Cargando...")):(n(),l("span",fe,"Filtrar"))],8,ge)])]),e("div",ve,[e("table",ye,[t[22]||(t[22]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Fecha/Hora"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Trabajador"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Sucursal"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Tipo"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"DescripciÃ³n"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Atendida")])],-1)),e("tbody",null,[(n(!0),l(_,null,h(A.value,o=>(n(),l("tr",{key:o.id,class:"hover:bg-gray-50 transition-colors"},[e("td",_e,[e("div",he,a(o.fecha),1),e("div",we,a(o.hora),1)]),e("td",ke,a(o.trabajador),1),e("td",Se,a(o.sucursal),1),e("td",Ce,[e("span",{class:y([ee(o.tipo),"px-2 py-1 text-xs font-medium rounded-full"])},a(o.tipo),3)]),e("td",Te,a(o.descripcion),1),e("td",Fe,[o.atendida?(n(),l("span",Ne," Atendida ")):(n(),l("button",{key:1,onClick:$=>Z(o),class:"px-3 py-1 text-xs font-medium bg-orange-500 text-white rounded-full hover:bg-orange-600 transition-colors"}," Atender ",8,Ve))])]))),128)),A.value.length===0?(n(),l("tr",Ae,t[21]||(t[21]=[e("td",{colspan:"6",class:"px-4 py-8 text-center text-gray-500"}," No se encontraron notificaciones para los filtros seleccionados ",-1)]))):w("",!0)])])])],512),[[q,g.value==="notificaciones"]]),i(e("div",null,[e("div",$e,[e("div",Ue,[e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha Inicio",-1)),i(e("input",{type:"date","onUpdate:modelValue":t[6]||(t[6]=o=>d.value.fecha_inicio=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},null,512),[[N,d.value.fecha_inicio]])]),e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha Fin",-1)),i(e("input",{type:"date","onUpdate:modelValue":t[7]||(t[7]=o=>d.value.fecha_fin=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},null,512),[[N,d.value.fecha_fin]])]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Sucursal",-1)),i(e("select",{"onUpdate:modelValue":t[8]||(t[8]=o=>d.value.sucursal_id=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},[t[25]||(t[25]=e("option",{value:null},"Todas las sucursales",-1)),(n(!0),l(_,null,h(V.value,o=>(n(),l("option",{key:o.id,value:o.id},a(o.nombre),9,je))),128))],512),[[f,d.value.sucursal_id]])]),e("div",null,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Usuario",-1)),i(e("select",{"onUpdate:modelValue":t[9]||(t[9]=o=>d.value.usuario_id=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},[t[27]||(t[27]=e("option",{value:null},"Todos los usuarios",-1)),(n(!0),l(_,null,h(D.value,o=>(n(),l("option",{key:o.id,value:o.id},a(o.nombre_completo),9,Be))),128))],512),[[f,d.value.usuario_id]])]),e("div",null,[t[30]||(t[30]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tipo",-1)),i(e("select",{"onUpdate:modelValue":t[10]||(t[10]=o=>d.value.tipo_actividad=o),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"},t[29]||(t[29]=[ae('<option>Todos los tipos</option><option value="produccion">Produccion</option><option value="venta">Ventas</option><option value="asistencia">Asistencia</option><option value="inventario">Inventario</option><option value="gasto">Gastos</option><option value="corte_caja">Corte de Caja</option>',7)]),512),[[f,d.value.tipo_actividad]])])]),e("div",De,[e("button",{onClick:R,disabled:k.value,class:"bg-orange-500 text-white px-6 py-2 rounded-md hover:bg-orange-600 transition-colors duration-200 disabled:opacity-50"},[k.value?(n(),l("span",Ie,"Cargando...")):(n(),l("span",Ee,"Filtrar"))],8,Pe)])]),e("div",Me,[e("div",Oe,[t[31]||(t[31]=e("div",{class:"text-sm text-blue-600 font-medium"},"Total Actividades",-1)),e("div",He,a(b.value.total_actividades),1)]),e("div",ze,[t[32]||(t[32]=e("div",{class:"text-sm text-yellow-600 font-medium"},"Ventas Manuales",-1)),e("div",Ge,a(((x=(m=b.value.ventas)==null?void 0:m.manuales)==null?void 0:x.cantidad)||0),1),e("div",Le,"$"+a(E(((O=(M=b.value.ventas)==null?void 0:M.manuales)==null?void 0:O.total)||0)),1)]),e("div",Qe,[t[33]||(t[33]=e("div",{class:"text-sm text-green-600 font-medium"},"Ventas Sistema (POS)",-1)),e("div",Xe,a(((z=(H=b.value.ventas)==null?void 0:H.sistema)==null?void 0:z.cantidad)||0),1),e("div",qe,"$"+a(E(((L=(G=b.value.ventas)==null?void 0:G.sistema)==null?void 0:L.total)||0)),1)]),e("div",Je,[t[34]||(t[34]=e("div",{class:"text-sm text-purple-600 font-medium"},"Asistencias",-1)),e("div",Ke,a(((Q=b.value.por_tipo)==null?void 0:Q.asistencia)||0),1)])]),e("div",Re,[e("table",We,[t[36]||(t[36]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Fecha/Hora"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Usuario"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Sucursal"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Tipo"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Subtipo"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-700 border-b"},"Detalles")])],-1)),e("tbody",null,[(n(!0),l(_,null,h(P.value,o=>{var $,X;return n(),l("tr",{key:o.id,class:"hover:bg-gray-50 transition-colors"},[e("td",Ye,[e("div",Ze,a(o.fecha),1),e("div",et,a(o.hora),1)]),e("td",tt,a(o.usuario),1),e("td",ot,a(o.sucursal),1),e("td",st,[e("span",{class:y([te(o.tipo),"px-2 py-1 text-xs font-medium rounded-full"])},a(o.tipo_label),3)]),e("td",at,[e("span",{class:y([oe(o.tipo,o.subtipo),"px-2 py-1 text-xs font-medium rounded-full"])},a(o.subtipo_label),3)]),e("td",nt,[o.tipo==="venta"&&((X=($=o.extra)==null?void 0:$.productos)!=null&&X.length)?(n(),l("span",{key:0,title:o.extra.productos.map(T=>`${T.nombre} x${T.cantidad} = $${(T.cantidad*T.precio_unitario).toFixed(2)}`).join(`
`),class:"cursor-help underline decoration-dotted"},a(o.detalles),9,lt)):(n(),l("span",rt,a(o.detalles),1))])])}),128)),v.value.length===0?(n(),l("tr",it,t[35]||(t[35]=[e("td",{colspan:"6",class:"px-4 py-8 text-center text-gray-500"}," No se encontraron actividades para los filtros seleccionados ",-1)]))):w("",!0)])])]),S.value>1?(n(),l("div",dt,[e("button",{onClick:t[11]||(t[11]=o=>p.value=Math.max(1,p.value-1)),disabled:p.value===1,class:"px-3 py-1 border rounded-md disabled:opacity-50 hover:bg-gray-100"}," Anterior ",8,ut),e("span",ct," Pagina "+a(p.value)+" de "+a(S.value),1),e("button",{onClick:t[12]||(t[12]=o=>p.value=Math.min(S.value,p.value+1)),disabled:p.value===S.value,class:"px-3 py-1 border rounded-md disabled:opacity-50 hover:bg-gray-100"}," Siguiente ",8,pt)])):w("",!0),e("div",xt," Mostrando "+a(P.value.length)+" de "+a(v.value.length)+" actividades ",1)],512),[[q,g.value==="actividades"]])])}}},gt={class:"py-6"},mt={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 p-2 md:p-8"},ft={class:"bg-white overflow-hidden shadow-xl rounded-xl"},ht={__name:"index",setup(K){const{props:c}=J();return(D,V)=>ne(c).user.roles[0]!=="trabajador"?(n(),le(se,{key:0,title:"Actividad Personal"},{default:re(()=>[e("div",gt,[e("div",mt,[e("div",ft,[ie(bt)])])])]),_:1})):w("",!0)}};export{ht as default};
